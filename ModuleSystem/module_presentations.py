# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_common import *
from header_presentations import *
from header_mission_templates import *
from ID_meshes import *
from header_operations import *
from header_triggers import *
from module_constants import *
import string

####################################################################################################################
#  Each presentation record contains the following fields:
#  1) Presentation id: used for referencing presentations in other files. The prefix prsnt_ is automatically added before each presentation id.
#  2) Presentation flags. See header_presentations.py for a list of available flags
#  3) Presentation background mesh: See module_meshes.py for a list of available background meshes
#  4) Triggers: Simple triggers that are associated with the presentation
####################################################################################################################

presentations = [
  ("game_credits", prsntf_read_only, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (assign, "$g_presentation_credits_obj_1", -1),
      (assign, "$g_presentation_credits_obj_2", -1),
      (assign, "$g_presentation_credits_obj_3", -1),
      (assign, "$g_presentation_credits_obj_4", -1),
      (assign, "$g_presentation_credits_obj_5", -1),
      (assign, "$g_presentation_credits_obj_6", -1),
      (assign, "$g_presentation_credits_obj_7", -1),
      (assign, "$g_presentation_credits_obj_8", -1),
      (assign, "$g_presentation_credits_obj_9", -1),
      (assign, "$g_presentation_credits_obj_10", -1),
      (assign, "$g_presentation_credits_obj_11", -1),
      (assign, "$g_presentation_credits_obj_12", -1),
      (assign, "$g_presentation_credits_obj_1_alpha", 0),
      (assign, "$g_presentation_credits_obj_2_alpha", 0),
      (assign, "$g_presentation_credits_obj_3_alpha", 0),
      (assign, "$g_presentation_credits_obj_4_alpha", 0),
      (assign, "$g_presentation_credits_obj_5_alpha", 0),
      (assign, "$g_presentation_credits_obj_6_alpha", 0),
      (assign, "$g_presentation_credits_obj_7_alpha", 0),
      (assign, "$g_presentation_credits_obj_8_alpha", 0),
      (assign, "$g_presentation_credits_obj_9_alpha", 0),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (set_fixed_point_multiplier, 1000),
      (presentation_set_duration, 1000000),
      (try_begin),
        (this_or_next|key_clicked, key_space),
        (this_or_next|key_clicked, key_enter),
        (this_or_next|key_clicked, key_escape),
        (this_or_next|key_clicked, key_back_space),
        (this_or_next|key_clicked, key_left_mouse_button),
        (key_clicked, key_right_mouse_button),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (lt, "$g_presentation_credits_obj_1", 0),
        (str_store_string, s1, "str_credits_1"),
        (create_text_overlay, "$g_presentation_credits_obj_1", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_1", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_1", 0x00),
        (position_set_x, pos1, 1500),
        (position_set_y, pos1, 1500),
        (overlay_set_size, "$g_presentation_credits_obj_1", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_1", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_1", 1000, 255),
      (else_try),
        (gt, ":var0", 2000),
        (eq, "$g_presentation_credits_obj_1_alpha", 0),
        (assign, "$g_presentation_credits_obj_1_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_1", 1000, 0),
      (else_try),
        (gt, ":var0", 3500),
        (lt, "$g_presentation_credits_obj_2", 0),
        (str_store_string, s1, "str_credits_2"),
        (create_text_overlay, "$g_presentation_credits_obj_2", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_2", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_2", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_2", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_2", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_2", 1000, 255),
      (else_try),
        (gt, ":var0", 5500),
        (eq, "$g_presentation_credits_obj_2_alpha", 0),
        (assign, "$g_presentation_credits_obj_2_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_2", 1000, 0),
      (else_try),
        (gt, ":var0", 7000),
        (lt, "$g_presentation_credits_obj_3", 0),
        (str_store_string, s1, "str_credits_3"),
        (create_text_overlay, "$g_presentation_credits_obj_3", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_3", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_3", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_3", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_3", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_3", 1000, 255),
      (else_try),
        (gt, ":var0", 9000),
        (eq, "$g_presentation_credits_obj_3_alpha", 0),
        (assign, "$g_presentation_credits_obj_3_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_3", 1000, 0),
      (else_try),
        (gt, ":var0", 10500),
        (lt, "$g_presentation_credits_obj_4", 0),
        (str_store_string, s1, "str_credits_4"),
        (create_text_overlay, "$g_presentation_credits_obj_4", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_4", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_4", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_4", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_4", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_4", 1000, 255),
      (else_try),
        (gt, ":var0", 12500),
        (eq, "$g_presentation_credits_obj_4_alpha", 0),
        (assign, "$g_presentation_credits_obj_4_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_4", 1000, 0),
      (else_try),
        (gt, ":var0", 14000),
        (lt, "$g_presentation_credits_obj_5", 0),
        (str_store_string, s1, "str_credits_8"),
        (create_text_overlay, "$g_presentation_credits_obj_5", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_5", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_5", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_5", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_5", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_5", 1000, 255),
      (else_try),
        (gt, ":var0", 16000),
        (eq, "$g_presentation_credits_obj_5_alpha", 0),
        (assign, "$g_presentation_credits_obj_5_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_5", 1000, 0),
      (else_try),
        (gt, ":var0", 17500),
        (lt, "$g_presentation_credits_obj_6", 0),
        (str_store_string, s1, "str_credits_5"),
        (create_text_overlay, "$g_presentation_credits_obj_6", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_6", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_6", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_6", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_6", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_6", 1000, 255),
      (else_try),
        (gt, ":var0", 19500),
        (eq, "$g_presentation_credits_obj_6_alpha", 0),
        (assign, "$g_presentation_credits_obj_6_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_6", 1000, 0),
      (else_try),
        (gt, ":var0", 21000),
        (lt, "$g_presentation_credits_obj_7", 0),
        (str_store_string, s1, "str_credits_6"),
        (create_text_overlay, "$g_presentation_credits_obj_7", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_7", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_7", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_7", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_7", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_7", 1000, 255),
      (else_try),
        (gt, ":var0", 23000),
        (eq, "$g_presentation_credits_obj_7_alpha", 0),
        (assign, "$g_presentation_credits_obj_7_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_7", 1000, 0),
      (else_try),
        (gt, ":var0", 24500),
        (lt, "$g_presentation_credits_obj_8", 0),
        (str_store_string, s1, "str_credits_9"),
        (create_text_overlay, "$g_presentation_credits_obj_8", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_8", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_8", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_8", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_8", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_8", 1000, 255),
      (else_try),
        (gt, ":var0", 26500),
        (eq, "$g_presentation_credits_obj_8_alpha", 0),
        (assign, "$g_presentation_credits_obj_8_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_8", 1000, 0),
      (else_try),
        (gt, ":var0", 28000),
        (lt, "$g_presentation_credits_obj_9", 0),
        (str_store_string, s1, "str_credits_10"),
        (create_text_overlay, "$g_presentation_credits_obj_9", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_9", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_9", 0x00),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_credits_obj_9", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 485),
        (overlay_set_position, "$g_presentation_credits_obj_9", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_9", 1000, 255),
        (str_store_string, s1, "str_credits_11"),
        (create_text_overlay, "$g_presentation_credits_obj_10", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_10", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_10", 0x00),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_credits_obj_10", pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 470),
        (overlay_set_position, "$g_presentation_credits_obj_10", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_10", 1000, 255),
        (str_store_string, s1, "str_credits_12"),
        (create_text_overlay, "$g_presentation_credits_obj_11", s1, 6160),
        (overlay_set_color, "$g_presentation_credits_obj_11", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_11", 0x00),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_credits_obj_11", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 105),
        (overlay_set_position, "$g_presentation_credits_obj_11", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_11", 1000, 255),
      (else_try),
        (gt, ":var0", 34000),
        (eq, "$g_presentation_credits_obj_9_alpha", 0),
        (assign, "$g_presentation_credits_obj_9_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_9", 1000, 0),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_10", 1000, 0),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_11", 1000, 0),
      (else_try),
        (gt, ":var0", 35500),
        (lt, "$g_presentation_credits_obj_12", 0),
        (str_store_string, s1, "str_credits_7"),
        (create_text_overlay, "$g_presentation_credits_obj_12", s1, 2064),
        (overlay_set_color, "$g_presentation_credits_obj_12", 0),
        (overlay_set_alpha, "$g_presentation_credits_obj_12", 0xFF),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (overlay_set_size, "$g_presentation_credits_obj_12", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, -6100),
        (overlay_set_position, "$g_presentation_credits_obj_12", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 760),
        (overlay_animate_to_position, "$g_presentation_credits_obj_12", 70000, pos1),
      (else_try),
        (gt, ":var0", 105500),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (str_store_string, s1, "str_banner_selection_text"),
      (create_text_overlay, reg1, s1, 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (overlay_set_text, reg1, s1),
      (create_button_overlay, "$g_presentation_obj_1", "@Next Page", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (assign, ":var0", 150),
      (assign, ":var1", 575),
      (assign, ":var2", "mesh_banner_f21"),
      (store_mul, ":var3", 16, "$g_presentation_page_no"),
      (val_add, ":var3", "mesh_banner_a05"),
      (store_add, ":var4", ":var3", 16),
      (val_min, ":var2", ":var4"),
      (store_add, "$g_presentation_banner_start", "$g_presentation_obj_1", 1),
      (try_for_range, ":var5", ":var3", ":var2"),
        (create_image_button_overlay, reg1, ":var5", ":var5"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (val_add, ":var0", 100),
        (ge, ":var0", 900),
        (assign, ":var0", 150),
        (val_sub, ":var1", 250),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (val_add, "$g_presentation_page_no", 1),
        (val_mod, "$g_presentation_page_no", 8),
        (start_presentation, "prsnt_banner_selection"),
      (else_try),
        (store_sub, ":var1", ":var0", "$g_presentation_banner_start"),
        (store_mul, ":var2", 16, "$g_presentation_page_no"),
        (val_add, ":var1", ":var2"),
        (store_add, ":var3", ":var1", "icon_banner_05"),
        (party_set_banner_icon, "p_main_party", ":var3"),
        (store_add, ":var4", ":var1", "spr_banner_e"),
        (troop_set_slot, "trp_player", 13, ":var4"),
        (presentation_set_duration, 0),
        (assign, ":var5", 0),
        (assign, ":var6", "trp_knight_1_1_wife"),
        (try_for_range, ":var7", "trp_kingdom_1_lord", ":var6"),
          (store_troop_faction, ":var8", ":var7"),
          (troop_slot_eq, ":var7", 13, ":var4"),
          (try_begin),
            (faction_slot_eq, ":var8", 9, "fac_culture_1"),
            (store_add, ":var9", "spr_banner_a", 14),
            (store_add, ":var10", "icon_banner_01", 14),
          (else_try),
            (faction_slot_eq, ":var8", 9, "fac_culture_2"),
            (store_add, ":var9", "spr_banner_a", 25),
            (store_add, ":var10", "icon_banner_01", 25),
          (else_try),
            (faction_slot_eq, ":var8", 9, "fac_culture_3"),
            (store_add, ":var9", "spr_banner_a", 36),
            (store_add, ":var10", "icon_banner_01", 36),
          (else_try),
            (faction_slot_eq, ":var8", 9, "fac_culture_4"),
            (store_add, ":var9", "spr_banner_a", 47),
            (store_add, ":var10", "icon_banner_01", 47),
          (else_try),
            (faction_slot_eq, ":var8", 9, "fac_culture_5"),
            (store_add, ":var9", "spr_banner_a", 68),
            (store_add, ":var10", "icon_banner_01", 68),
          (else_try),
            (faction_slot_eq, ":var8", 9, "fac_culture_6"),
            (store_add, ":var9", "spr_banner_a", 89),
            (store_add, ":var10", "icon_banner_01", 89),
          (else_try),
            (faction_slot_eq, ":var8", 9, "fac_culture_7"),
            (store_add, ":var9", "spr_banner_a", 110),
            (store_add, ":var10", "icon_banner_01", 110),
          (try_end),
          (assign, ":var5", ":var7"),
          (assign, ":var6", 0),
          (troop_set_slot, ":var7", 13, ":var9"),
          (troop_get_slot, ":var11", ":var7", 10),
          (gt, ":var11", 0),
          (party_set_banner_icon, ":var11", ":var10"),
        (try_end),
        (try_for_range, ":var12", "p_town_1", "p_village_1"),
          (try_begin),
            (party_slot_eq, ":var12", 7, "trp_player"),
            (party_set_banner_icon, ":var12", ":var3"),
          (else_try),
            (party_slot_eq, ":var12", 7, ":var5"),
            (party_set_banner_icon, ":var12", ":var10"),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_space),
        (this_or_next|key_clicked, key_enter),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_back_space),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("custom_banner", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (troop_get_slot, ":var0", "trp_player", 96),
      (val_max, ":var0", 0),
      (val_add, ":var0", "mesh_custom_banner_01"),
      (troop_get_slot, ":var1", "trp_player", 99),
      (val_max, ":var1", 0),
      (val_add, ":var1", "mesh_custom_map_banner_01"),
      (troop_get_slot, ":var2", "trp_player", 85),
      (troop_get_slot, ":var3", "trp_player", 86),
      (create_text_overlay, reg1, "str_color_no_1", 0),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "str_color_no_2", 0),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg1, pos1),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_22", "mesh_color_picker", "tableau_color_picker", ":var2"),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_23", "mesh_color_picker", "tableau_color_picker", ":var3"),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 565),
      (overlay_set_position, "$g_presentation_obj_22", pos1),
      (position_set_y, pos1, 515),
      (overlay_set_position, "$g_presentation_obj_23", pos1),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 250),
      (overlay_set_size, "$g_presentation_obj_22", pos1),
      (overlay_set_size, "$g_presentation_obj_23", pos1),
      (create_button_overlay, "$g_presentation_obj_2", "str_change", 16),
      (create_button_overlay, "$g_presentation_obj_3", "str_change", 16),
      (create_button_overlay, "$g_presentation_obj_4", "str_change_background", 16),
      (create_button_overlay, "$g_presentation_obj_5", "str_change", 16),
      (create_button_overlay, "$g_presentation_obj_19", "str_change", 16),
      (create_button_overlay, "$g_presentation_obj_20", "str_accept", 16),
      (troop_get_slot, ":var4", "trp_player", 97),
      (create_button_overlay, "$g_presentation_obj_16", "str_randomize", 16),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_17", ":var0", "tableau_custom_banner_default", "trp_player"),
      (try_begin),
        (eq, ":var1", "mesh_custom_map_banner_01"),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_18", ":var1", "tableau_custom_banner_square", "trp_player"),
      (else_try),
        (eq, ":var1", "mesh_custom_map_banner_02"),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_18", ":var1", "tableau_custom_banner_short", "trp_player"),
      (else_try),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_18", ":var1", "tableau_custom_banner_tall", "trp_player"),
      (try_end),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_1", -1, "tableau_custom_banner_square_no_mesh", "trp_player"),
      (create_text_overlay, reg1, "str_sample_banner", 16),
      (position_set_x, pos1, 825),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "str_sample_map_banner", 16),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 640),
      (overlay_set_position, "$g_presentation_obj_17", pos1),
      (position_set_x, pos1, 780),
      (position_set_y, pos1, 315),
      (overlay_set_position, "$g_presentation_obj_18", pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_size, "$g_presentation_obj_17", pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_size, "$g_presentation_obj_18", pos1),
      (create_text_overlay, reg1, "str_number_of_charges", 0),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (assign, reg1, ":var4"),
      (create_text_overlay, reg2, "str_reg1", 16),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg2, pos1),
      (try_begin),
        (lt, ":var4", 4),
        (create_button_overlay, "$g_presentation_obj_15", "str_plus", 16),
        (position_set_x, pos1, 385),
        (position_set_y, pos1, 350),
        (overlay_set_position, "$g_presentation_obj_15", pos1),
      (else_try),
        (assign, "$g_presentation_obj_15", -1),
      (try_end),
      (try_begin),
        (gt, ":var4", 0),
        (create_button_overlay, "$g_presentation_obj_21", "str_minus", 16),
        (position_set_x, pos1, 370),
        (position_set_y, pos1, 350),
        (overlay_set_position, "$g_presentation_obj_21", pos1),
      (else_try),
        (assign, "$g_presentation_obj_21", -1),
      (try_end),
      (try_begin),
        (ge, ":var4", 1),
        (create_text_overlay, reg1, "str_charge", 16),
        (position_set_x, pos1, 300),
        (position_set_y, pos1, 300),
        (overlay_set_position, reg1, pos1),
        (create_text_overlay, reg1, "str_color", 16),
        (position_set_x, pos1, 550),
        (position_set_y, pos1, 300),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_14", "str_change_charge_position", 16),
        (position_set_y, pos1, 350),
        (position_set_x, pos1, 550),
        (overlay_set_position, "$g_presentation_obj_14", pos1),
        (create_text_overlay, reg1, "str_charge_no_1", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 240),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_6", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_6", pos1),
        (create_button_overlay, "$g_presentation_obj_7", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_7", pos1),
        (troop_get_slot, ":var5", "trp_player", 92),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_24", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 255),
        (overlay_set_position, "$g_presentation_obj_24", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_24", pos1),
        (troop_get_slot, ":var6", "trp_player", 87),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_28", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 255),
        (overlay_set_position, "$g_presentation_obj_28", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_28", pos1),
        (create_button_overlay, "$g_presentation_obj_32", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 240),
        (overlay_set_position, "$g_presentation_obj_32", pos1),
        (create_button_overlay, "$g_presentation_obj_33", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_33", pos1),
      (try_end),
      (try_begin),
        (ge, ":var4", 2),
        (create_text_overlay, reg1, "str_charge_no_2", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 180),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_8", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_8", pos1),
        (create_button_overlay, "$g_presentation_obj_9", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_9", pos1),
        (troop_get_slot, ":var5", "trp_player", 93),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_25", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 195),
        (overlay_set_position, "$g_presentation_obj_25", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_25", pos1),
        (troop_get_slot, ":var6", "trp_player", 88),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_29", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 195),
        (overlay_set_position, "$g_presentation_obj_29", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_29", pos1),
        (create_button_overlay, "$g_presentation_obj_34", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 180),
        (overlay_set_position, "$g_presentation_obj_34", pos1),
        (create_button_overlay, "$g_presentation_obj_35", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_35", pos1),
      (try_end),
      (try_begin),
        (ge, ":var4", 3),
        (create_text_overlay, reg1, "str_charge_no_3", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 120),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_10", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_10", pos1),
        (create_button_overlay, "$g_presentation_obj_11", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_11", pos1),
        (troop_get_slot, ":var5", "trp_player", 94),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_26", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 135),
        (overlay_set_position, "$g_presentation_obj_26", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_26", pos1),
        (troop_get_slot, ":var6", "trp_player", 89),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_30", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 135),
        (overlay_set_position, "$g_presentation_obj_30", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_30", pos1),
        (create_button_overlay, "$g_presentation_obj_36", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 120),
        (overlay_set_position, "$g_presentation_obj_36", pos1),
        (create_button_overlay, "$g_presentation_obj_37", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_37", pos1),
      (try_end),
      (try_begin),
        (ge, ":var4", 4),
        (create_text_overlay, reg1, "str_charge_no_4", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 60),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_12", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_12", pos1),
        (create_button_overlay, "$g_presentation_obj_13", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_13", pos1),
        (troop_get_slot, ":var5", "trp_player", 95),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_27", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 75),
        (overlay_set_position, "$g_presentation_obj_27", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_27", pos1),
        (troop_get_slot, ":var6", "trp_player", 90),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_31", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 75),
        (overlay_set_position, "$g_presentation_obj_31", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_31", pos1),
        (create_button_overlay, "$g_presentation_obj_38", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 60),
        (overlay_set_position, "$g_presentation_obj_38", pos1),
        (create_button_overlay, "$g_presentation_obj_39", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_39", pos1),
      (try_end),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 550),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (position_set_x, pos1, 880),
      (position_set_y, pos1, 575),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_19", pos1),
      (position_set_y, pos1, 650),
      (position_set_x, pos1, 175),
      (overlay_set_position, "$g_presentation_obj_16", pos1),
      (position_set_y, pos1, 150),
      (position_set_x, pos1, 850),
      (overlay_set_position, "$g_presentation_obj_20", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (troop_get_slot, ":var1", "trp_player", 97),
      (try_begin),
        (this_or_next|eq, ":var0", "$g_presentation_obj_2"),
        (eq, ":var0", "$g_presentation_obj_22"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 85),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_3"),
        (eq, ":var0", "$g_presentation_obj_23"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 86),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_4"),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_background_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_5"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_type_selection"),
      (else_try),
        (ge, ":var1", 1),
        (this_or_next|eq, ":var0", "$g_presentation_obj_6"),
        (eq, ":var0", "$g_presentation_obj_24"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 92),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 1),
        (this_or_next|eq, ":var0", "$g_presentation_obj_7"),
        (eq, ":var0", "$g_presentation_obj_28"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 87),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 2),
        (this_or_next|eq, ":var0", "$g_presentation_obj_8"),
        (eq, ":var0", "$g_presentation_obj_25"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 93),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 2),
        (this_or_next|eq, ":var0", "$g_presentation_obj_9"),
        (eq, ":var0", "$g_presentation_obj_29"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 88),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 3),
        (this_or_next|eq, ":var0", "$g_presentation_obj_10"),
        (eq, ":var0", "$g_presentation_obj_26"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 94),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 3),
        (this_or_next|eq, ":var0", "$g_presentation_obj_11"),
        (eq, ":var0", "$g_presentation_obj_30"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 89),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 4),
        (this_or_next|eq, ":var0", "$g_presentation_obj_12"),
        (eq, ":var0", "$g_presentation_obj_27"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 95),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 4),
        (this_or_next|eq, ":var0", "$g_presentation_obj_13"),
        (eq, ":var0", "$g_presentation_obj_31"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 90),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 1),
        (eq, ":var0", "$g_presentation_obj_14"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_charge_positioning"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_15"),
        (troop_get_slot, ":var1", "trp_player", 97),
        (val_add, ":var1", 1),
        (val_clamp, ":var1", 0, 5),
        (troop_set_slot, "trp_player", 97, ":var1"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_21"),
        (troop_get_slot, ":var1", "trp_player", 97),
        (val_sub, ":var1", 1),
        (val_clamp, ":var1", 0, 5),
        (troop_set_slot, "trp_player", 97, ":var1"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_16"),
        (call_script, "script_get_random_custom_banner", "trp_player"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_17"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_type_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_18"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_map_type_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_19"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_map_type_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_32"),
        (troop_get_slot, ":var2", "trp_player", 92),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 92, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_34"),
        (troop_get_slot, ":var2", "trp_player", 93),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 93, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_36"),
        (troop_get_slot, ":var2", "trp_player", 94),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 94, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_38"),
        (troop_get_slot, ":var2", "trp_player", 95),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 95, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_33"),
        (troop_get_slot, ":var2", "trp_player", 92),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 92, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_35"),
        (troop_get_slot, ":var2", "trp_player", 93),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 93, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_37"),
        (troop_get_slot, ":var2", "trp_player", 94),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 94, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_39"),
        (troop_get_slot, ":var2", "trp_player", 95),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 95, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_20"),
        (troop_get_slot, ":var5", "trp_player", 99),
        (try_begin),
          (ge, ":var5", 0),
          (val_add, ":var5", "icon_custom_banner_01"),
          (party_set_banner_icon, "p_main_party", ":var5"),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_charge_positioning", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_position", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 125),
      (assign, ":var1", 400),
      (call_script, "script_get_troop_custom_banner_num_positionings", "trp_player"),
      (assign, ":var2", reg0),
      (store_mul, ":var3", ":var2", 125),
      (val_sub, ":var3", 25),
      (store_div, ":var0", ":var3", 2),
      (store_sub, ":var0", 500, ":var0"),
      (try_for_range, ":var4", 0, ":var2"),
        (create_image_button_overlay_with_tableau_material, reg1, -1, "tableau_positioning_selection", ":var4"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 125),
        (overlay_set_position, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var4", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (call_script, "script_get_troop_custom_banner_num_positionings", "trp_player"),
      (assign, ":var1", reg0),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 98, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_charge_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_charge", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 100),
      (assign, ":var1", 600),
      (try_for_range, ":var2", "mesh_custom_banner_charge_01", "mesh_tableau_mesh_custom_banner"),
        (create_image_button_overlay, reg1, ":var2", ":var2"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 100),
        (try_begin),
          (gt, ":var0", 900),
          (assign, ":var0", 100),
          (val_sub, ":var1", 100),
        (try_end),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 80),
        (position_set_y, pos1, 80),
        (overlay_set_size, reg1, pos1),
        (store_sub, ":var3", ":var2", "mesh_custom_banner_charge_01"),
        (troop_set_slot, "trp_temp_array_a", ":var3", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_tableau_mesh_custom_banner"),
      (val_sub, ":var1", "mesh_custom_banner_charge_01"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", "$g_presentation_output_slot", ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_background_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_background", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 75),
      (assign, ":var1", 450),
      (try_for_range, ":var2", "mesh_custom_banner_bg", "mesh_custom_banner_charge_01"),
        (store_sub, ":var3", ":var2", "mesh_custom_banner_bg"),
        (create_image_button_overlay_with_tableau_material, reg1, -1, "tableau_background_selection", ":var3"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 125),
        (try_begin),
          (gt, ":var0", 900),
          (assign, ":var0", 75),
          (val_sub, ":var1", 125),
        (try_end),
        (overlay_set_position, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var3", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_custom_banner_charge_01"),
      (val_sub, ":var1", "mesh_custom_banner_bg"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 91, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_flag_type_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_flag_type", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 435),
      (assign, ":var1", 450),
      (try_for_range, ":var2", "mesh_custom_banner_01", "mesh_custom_banner_bg"),
        (store_sub, ":var3", ":var2", "mesh_custom_banner_01"),
        (troop_set_slot, "trp_player", 96, ":var3"),
        (create_image_button_overlay_with_tableau_material, reg1, ":var2", "tableau_custom_banner_default", "trp_player"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 130),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var3", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_custom_banner_bg"),
      (val_sub, ":var1", "mesh_custom_banner_01"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 96, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_flag_map_type_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_map_flag_type", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (troop_get_slot, ":var0", "trp_player", 91),
      (val_add, ":var0", "mesh_custom_banner_bg"),
      (assign, ":var1", 250),
      (assign, ":var2", 150),
      (try_for_range, ":var3", "mesh_custom_map_banner_01", "mesh_custom_banner_01"),
        (store_sub, ":var4", ":var3", "mesh_custom_map_banner_01"),
        (troop_set_slot, "trp_player", 99, ":var4"),
        (try_begin),
          (eq, ":var3", "mesh_custom_map_banner_01"),
          (create_image_button_overlay_with_tableau_material, reg1, ":var3", "tableau_custom_banner_square", "trp_player"),
        (else_try),
          (eq, ":var3", "mesh_custom_map_banner_02"),
          (create_image_button_overlay_with_tableau_material, reg1, ":var3", "tableau_custom_banner_short", "trp_player"),
        (else_try),
          (create_image_button_overlay_with_tableau_material, reg1, ":var3", "tableau_custom_banner_tall", "trp_player"),
        (try_end),
        (position_set_x, pos1, ":var1"),
        (position_set_y, pos1, ":var2"),
        (val_add, ":var1", 200),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var4", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_custom_banner_01"),
      (val_sub, ":var1", "mesh_custom_map_banner_01"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 99, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("color_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_color", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 125),
      (assign, ":var1", 450),
      (try_for_range, ":var2", 0, 42),
        (call_script, "script_get_custom_banner_color_from_index", ":var2"),
        (assign, ":var3", reg0),
        (create_image_button_overlay_with_tableau_material, reg1, "mesh_color_picker", "tableau_color_picker", ":var3"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 50),
        (try_begin),
          (store_mod, ":var4", ":var2", 7),
          (eq, ":var4", 6),
          (assign, ":var0", 125),
          (val_sub, ":var1", 50),
        (try_end),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 500),
        (overlay_set_size, reg1, pos1),
        (store_mul, ":var5", ":var2", 2),
        (store_add, ":var6", ":var5", 1),
        (troop_set_slot, "trp_temp_array_a", ":var5", reg1),
        (troop_set_slot, "trp_temp_array_a", ":var6", ":var3"),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", 64),
      (try_for_range, ":var2", 0, ":var1"),
        (store_mul, ":var3", ":var2", 2),
        (troop_slot_eq, "trp_temp_array_a", ":var3", ":var0"),
        (store_add, ":var4", ":var3", 1),
        (troop_get_slot, ":var5", "trp_temp_array_a", ":var4"),
        (troop_set_slot, "trp_player", "$g_presentation_output_slot", ":var5"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("marshall_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (assign, "$g_presentation_obj_1", -1),
      (assign, "$g_presentation_obj_2", -1),
      (assign, "$g_presentation_obj_3", -1),
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_presentation_next_presentation", -1),
      (store_add, ":var0", "$g_presentation_marshall_selection_max_renown_1", "$g_presentation_marshall_selection_max_renown_2"),
      (faction_get_slot, ":var1", "$players_kingdom", 10),
      (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
      (create_text_overlay, reg1, "@Candidate #1: {s1}", 16),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_2_troop"),
      (create_text_overlay, reg1, "@Candidate #2: {s1}", 16),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", "$g_presentation_marshall_selection_max_renown_1_troop"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 500),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 100),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", "$g_presentation_marshall_selection_max_renown_2_troop"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 500),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg1, pos1),
      (assign, ":var2", "$g_presentation_input"),
      (val_add, "$g_presentation_input", 1),
      (try_begin),
        (lt, ":var2", 0),
        (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
        (str_store_troop_name, s2, "$g_presentation_marshall_selection_max_renown_2_troop"),
        (str_store_troop_name, s3, ":var1"),
        (str_store_faction_name, s4, "$players_kingdom"),
        (create_text_overlay, reg1, "@{s3} of {s4} wishes to select a new marshall and invites his vassals for a counsel. {s1} and {s2} are the likely candidates.", 16),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 200),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_1", "@Continue...", 16),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 100),
        (overlay_set_position, "$g_presentation_obj_1", pos1),
        (assign, "$g_presentation_next_presentation", "prsnt_marshall_selection"),
      (else_try),
        (assign, ":var3", ":var2"),
        (try_for_range_backwards, ":var4", "trp_kingdom_heroes_including_player_begin", "trp_knight_1_1_wife"),
          (ge, ":var3", 0),
          (assign, ":var5", ":var4"),
          (assign, ":var6", 0),
          (try_begin),
            (eq, ":var4", "trp_kingdom_heroes_including_player_begin"),
            (assign, ":var5", "trp_player"),
            (try_begin),
              (eq, "$g_player_is_captive", 0),
              (assign, ":var6", 1),
            (try_end),
          (else_try),
            (store_troop_faction, ":var7", ":var5"),
            (eq, "$players_kingdom", ":var7"),
            (neg|troop_slot_ge, ":var5", 8, 0),
            (troop_slot_ge, ":var5", 10, 1),
            (troop_slot_eq, ":var5", 2, 2),
            (neg|faction_slot_eq, ":var7", 10, ":var5"),
            (assign, ":var6", 1),
          (try_end),
          (eq, ":var6", 1),
          (neq, "$g_presentation_marshall_selection_max_renown_1_troop", ":var5"),
          (neq, "$g_presentation_marshall_selection_max_renown_2_troop", ":var5"),
          (val_sub, ":var3", 1),
          (lt, ":var3", 0),
          (assign, "$g_presentation_next_presentation", "prsnt_marshall_selection"),
          (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", ":var5"),
          (position_set_x, pos1, 300),
          (position_set_y, pos1, 300),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, 440),
          (position_set_y, pos1, 400),
          (overlay_set_position, reg1, pos1),
          (try_begin),
            (eq, ":var5", "trp_player"),
            (create_text_overlay, reg1, "@Who do you wish to support?", 16),
            (position_set_x, pos1, 500),
            (position_set_y, pos1, 200),
            (overlay_set_position, reg1, pos1),
            (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
            (create_button_overlay, "$g_presentation_obj_2", "@{s1}", 16),
            (position_set_x, pos1, 300),
            (position_set_y, pos1, 100),
            (overlay_set_position, "$g_presentation_obj_2", pos1),
            (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_2_troop"),
            (create_button_overlay, "$g_presentation_obj_3", "@{s1}", 16),
            (position_set_x, pos1, 700),
            (position_set_y, pos1, 100),
            (overlay_set_position, "$g_presentation_obj_3", pos1),
          (else_try),
            (str_store_troop_name, s1, ":var5"),
            (store_random_in_range, ":var8", 0, ":var0"),
            (val_sub, ":var8", "$g_presentation_marshall_selection_max_renown_1"),
            (try_begin),
              (lt, ":var8", 0),
              (val_add, "$g_presentation_marshall_selection_1_vote", 1),
              (str_store_troop_name, s2, "$g_presentation_marshall_selection_max_renown_1_troop"),
            (else_try),
              (val_add, "$g_presentation_marshall_selection_2_vote", 1),
              (str_store_troop_name, s2, "$g_presentation_marshall_selection_max_renown_2_troop"),
            (try_end),
            (create_text_overlay, reg1, "@{s1} gives his support to {s2}.", 16),
            (position_set_x, pos1, 500),
            (position_set_y, pos1, 200),
            (overlay_set_position, reg1, pos1),
            (create_button_overlay, "$g_presentation_obj_1", "@Continue...", 16),
            (position_set_x, pos1, 500),
            (position_set_y, pos1, 100),
            (overlay_set_position, "$g_presentation_obj_1", pos1),
          (try_end),
        (try_end),
      (try_end),
      (assign, reg0, "$g_presentation_marshall_selection_1_vote"),
      (create_text_overlay, reg1, "@Number of Supporters: {reg0}", 16),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, "$g_presentation_marshall_selection_2_vote"),
      (create_text_overlay, reg1, "@Number of Supporters: {reg0}", 16),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, "$g_presentation_next_presentation", 0),
        (try_begin),
          (gt, "$g_presentation_marshall_selection_2_vote", "$g_presentation_marshall_selection_1_vote"),
          (assign, ":var9", "$g_presentation_marshall_selection_max_renown_1_troop"),
          (assign, "$g_presentation_marshall_selection_max_renown_1_troop", "$g_presentation_marshall_selection_max_renown_2_troop"),
          (assign, "$g_presentation_marshall_selection_max_renown_2_troop", ":var9"),
        (try_end),
        (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
        (str_store_troop_name, s2, ":var1"),
        (str_store_faction_name, s3, "$players_kingdom"),
        (create_text_overlay, reg1, "@{s2} has heard his vassals' counsel. He selects {s1} as the marshall of {s3}.", 16),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 200),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_1", "@Continue...", 16),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 100),
        (overlay_set_position, "$g_presentation_obj_1", pos1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_2"),
        (val_add, "$g_presentation_marshall_selection_1_vote", 1),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_1_troop", 2),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_2_troop", -2),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (val_add, "$g_presentation_marshall_selection_2_vote", 1),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_1_troop", -2),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_2_troop", 2),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var0", "$g_presentation_obj_1"),
        (this_or_next|eq, ":var0", "$g_presentation_obj_2"),
        (eq, ":var0", "$g_presentation_obj_3"),
        (try_begin),
          (ge, "$g_presentation_next_presentation", 0),
          (start_presentation, "$g_presentation_next_presentation"),
        (else_try),
          (try_begin),
            (neg|faction_slot_eq, "$players_kingdom", 7, "$g_presentation_marshall_selection_max_renown_1_troop"),
            (call_script, "script_check_and_finish_active_army_quests_for_faction", "$players_kingdom"),
          (try_end),
          (faction_set_slot, "$players_kingdom", 7, "$g_presentation_marshall_selection_max_renown_1_troop"),
          (try_begin),
            (eq, "$g_presentation_marshall_selection_max_renown_1_troop", "trp_player"),
            (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_2_troop", -3),
          (try_end),
          (assign, "$g_recalculate_ais", 1),
          (assign, "$g_presentation_marshall_selection_ended", 1),
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
    ]),
  ]),

  ("battle", 0, mesh_pic_mb_warrior_1,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_formation_infantry_selected", 0),
      (assign, "$g_formation_archers_selected", 0),
      (assign, "$g_formation_cavalry_selected", 0),
      (assign, "$g_presentation_battle_active", 1),
      (str_clear, s7),
      (try_for_agents, ":var0"),
        (agent_set_slot, ":var0", 10, 0),
      (try_end),
      (position_set_x, pos1, 0),
      (create_image_button_overlay, "$g_presentation_obj_1", "mesh_white_plane", "mesh_white_plane"),
      (position_set_y, pos1, 653),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (create_image_button_overlay, "$g_presentation_obj_2", "mesh_white_plane", "mesh_white_plane"),
      (position_set_y, pos1, 613),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (create_image_button_overlay, "$g_presentation_obj_3", "mesh_white_plane", "mesh_white_plane"),
      (position_set_y, pos1, 573),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (position_set_x, pos1, 32500),
      (position_set_y, pos1, 2000),
      (overlay_set_size, "$g_presentation_obj_1", pos1),
      (overlay_set_size, "$g_presentation_obj_2", pos1),
      (overlay_set_size, "$g_presentation_obj_3", pos1),
      (overlay_set_alpha, "$g_presentation_obj_1", 0x00),
      (overlay_set_alpha, "$g_presentation_obj_2", 0x00),
      (overlay_set_alpha, "$g_presentation_obj_3", 0x00),
      (overlay_set_color, "$g_presentation_obj_1", 16776960),
      (overlay_set_color, "$g_presentation_obj_2", 16776960),
      (overlay_set_color, "$g_presentation_obj_3", 16776960),
      (position_set_x, pos1, 20),
      (create_check_box_overlay, "$g_presentation_obj_4", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 663),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (create_check_box_overlay, "$g_presentation_obj_5", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 623),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (create_check_box_overlay, "$g_presentation_obj_6", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 583),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (get_player_agent_no, ":var1"),
      (agent_get_team, ":var2", ":var1"),
      (position_set_x, pos1, 50),
      (create_text_overlay, "$g_presentation_obj_7", s7, 0),
      (position_set_y, pos1, 660),
      (overlay_set_position, "$g_presentation_obj_7", pos1),
      (create_text_overlay, "$g_presentation_obj_8", s7, 0),
      (position_set_y, pos1, 620),
      (overlay_set_position, "$g_presentation_obj_8", pos1),
      (create_text_overlay, "$g_presentation_obj_9", s7, 0),
      (position_set_y, pos1, 580),
      (overlay_set_position, "$g_presentation_obj_9", pos1),
      (position_set_y, pos1, 700),
      (create_text_overlay, reg1, "@Action", 16),
      (position_set_x, pos1, 250),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Mount", 16),
      (position_set_x, pos1, 400),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Attack Type", 16),
      (position_set_x, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, "$g_presentation_infantry_movement", s7, 16),
      (create_text_overlay, "$g_presentation_infantry_riding", s7, 16),
      (create_text_overlay, "$g_presentation_infantry_weapon_usage", s7, 16),
      (create_text_overlay, "$g_presentation_archers_movement", s7, 16),
      (create_text_overlay, "$g_presentation_archers_riding", s7, 16),
      (create_text_overlay, "$g_presentation_archers_weapon_usage", s7, 16),
      (create_text_overlay, "$g_presentation_cavalry_movement", s7, 16),
      (create_text_overlay, "$g_presentation_cavalry_riding", s7, 16),
      (create_text_overlay, "$g_presentation_cavalry_weapon_usage", s7, 16),
      (call_script, "script_update_order_panel", ":var2"),
      (create_button_overlay, "$g_presentation_obj_10", "@Hold This Position", 16),
      (create_button_overlay, "$g_presentation_obj_11", "@Follow Me", 16),
      (create_button_overlay, "$g_presentation_obj_12", "@Charge", 16),
      (create_button_overlay, "$g_presentation_obj_13", "@Advance", 16),
      (create_button_overlay, "$g_presentation_obj_14", "@Fall Back", 16),
      (create_button_overlay, "$g_presentation_obj_15", "@Stand Closer", 16),
      (create_button_overlay, "$g_presentation_obj_16", "@Spread Out", 16),
      (create_button_overlay, "$g_presentation_obj_17", "@Stand Ground", 16),
      (create_button_overlay, "$g_presentation_obj_18", "@Mount", 16),
      (create_button_overlay, "$g_presentation_obj_19", "@Dismount", 16),
      (create_button_overlay, "$g_presentation_obj_20", "@Use Any Weapon", 16),
      (create_button_overlay, "$g_presentation_obj_21", "@Use Blunt Weapons", 16),
      (create_button_overlay, "$g_presentation_obj_28", "@Hold Your Fire", 16),
      (create_button_overlay, "$g_presentation_obj_29", "@Fire At Will", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, "$g_presentation_obj_10", pos1),
      (overlay_set_size, "$g_presentation_obj_11", pos1),
      (overlay_set_size, "$g_presentation_obj_12", pos1),
      (overlay_set_size, "$g_presentation_obj_13", pos1),
      (overlay_set_size, "$g_presentation_obj_14", pos1),
      (overlay_set_size, "$g_presentation_obj_15", pos1),
      (overlay_set_size, "$g_presentation_obj_16", pos1),
      (overlay_set_size, "$g_presentation_obj_17", pos1),
      (overlay_set_size, "$g_presentation_obj_18", pos1),
      (overlay_set_size, "$g_presentation_obj_19", pos1),
      (overlay_set_size, "$g_presentation_obj_20", pos1),
      (overlay_set_size, "$g_presentation_obj_21", pos1),
      (overlay_set_size, "$g_presentation_obj_28", pos1),
      (overlay_set_size, "$g_presentation_obj_29", pos1),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 540),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
      (position_set_y, pos1, 520),
      (overlay_set_position, "$g_presentation_obj_11", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_12", pos1),
      (position_set_y, pos1, 480),
      (overlay_set_position, "$g_presentation_obj_13", pos1),
      (position_set_y, pos1, 460),
      (overlay_set_position, "$g_presentation_obj_14", pos1),
      (position_set_y, pos1, 440),
      (overlay_set_position, "$g_presentation_obj_15", pos1),
      (position_set_y, pos1, 420),
      (overlay_set_position, "$g_presentation_obj_16", pos1),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_17", pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 540),
      (overlay_set_position, "$g_presentation_obj_18", pos1),
      (position_set_y, pos1, 520),
      (overlay_set_position, "$g_presentation_obj_19", pos1),
      (position_set_x, pos1, 550),
      (position_set_y, pos1, 540),
      (overlay_set_position, "$g_presentation_obj_20", pos1),
      (position_set_y, pos1, 520),
      (overlay_set_position, "$g_presentation_obj_21", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_28", pos1),
      (position_set_y, pos1, 480),
      (overlay_set_position, "$g_presentation_obj_29", pos1),
      (create_text_overlay, "$g_presentation_obj_22", "@Us", 0),
      (create_text_overlay, "$g_presentation_obj_24", "@Enemies", 0),
      (create_text_overlay, "$g_presentation_obj_25", "@Ready", 16),
      (create_text_overlay, "$g_presentation_obj_26", "@Wounded", 16),
      (create_text_overlay, "$g_presentation_obj_27", "@Dead", 16),
      (create_text_overlay, "$g_battle_us_ready", s7, 16),
      (create_text_overlay, "$g_battle_us_wounded", s7, 16),
      (create_text_overlay, "$g_battle_us_dead", s7, 16),
      (create_text_overlay, "$g_battle_enemies_ready", s7, 16),
      (create_text_overlay, "$g_battle_enemies_wounded", s7, 16),
      (create_text_overlay, "$g_battle_enemies_dead", s7, 16),
      (create_text_overlay, "$g_presentation_obj_23", "@Allies", 0),
      (create_text_overlay, "$g_battle_allies_ready", s7, 16),
      (create_text_overlay, "$g_battle_allies_wounded", s7, 16),
      (create_text_overlay, "$g_battle_allies_dead", s7, 16),
      (assign, ":var3", 100),
      (assign, ":var4", 100),
      (val_add, ":var3", 150),
      (val_add, ":var4", 120),
      (position_set_x, pos1, ":var3"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_25", pos1),
      (val_add, ":var3", 150),
      (position_set_x, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_26", pos1),
      (val_add, ":var3", 150),
      (position_set_x, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_27", pos1),
      (val_add, ":var3", -450),
      (val_add, ":var4", -40),
      (position_set_x, pos1, ":var3"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_22", pos1),
      (val_add, ":var4", -40),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_23", pos1),
      (val_add, ":var4", -40),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_24", pos1),
      (get_scene_boundaries, pos2, pos3),
      (position_transform_position_to_local, pos4, pos2, pos3),
      (set_fixed_point_multiplier, 1000),
      (position_get_x, ":var5", pos4),
      (position_get_y, ":var6", pos4),
      (set_fixed_point_multiplier, 1000),
      (store_div, ":var7", ":var6", 100),
      (store_div, ":var7", ":var5", ":var7"),
      (try_begin),
        (gt, ":var7", 100),
        (assign, "$g_battle_map_width", 300),
        (store_div, "$g_battle_map_scale", ":var5", "$g_battle_map_width"),
        (store_div, "$g_battle_map_height", ":var6", "$g_battle_map_scale"),
      (else_try),
        (assign, "$g_battle_map_height", 300),
        (store_div, "$g_battle_map_scale", ":var6", "$g_battle_map_height"),
        (store_div, "$g_battle_map_width", ":var5", "$g_battle_map_scale"),
      (try_end),
      (create_image_button_overlay, "$g_battle_map_plane", "mesh_white_plane", "mesh_white_plane"),
      (overlay_set_color, "$g_battle_map_plane", 0),
      (store_add, ":var8", "$g_battle_map_width", 20),
      (store_add, ":var9", "$g_battle_map_height", 20),
      (store_mul, ":var10", ":var8", 50),
      (store_mul, ":var11", ":var9", 50),
      (position_set_x, pos1, ":var10"),
      (position_set_y, pos1, ":var11"),
      (overlay_set_size, "$g_battle_map_plane", pos1),
      (store_sub, ":var12", 990, ":var8"),
      (store_sub, ":var13", 740, ":var9"),
      (position_set_x, pos1, ":var12"),
      (position_set_y, pos1, ":var13"),
      (overlay_set_position, "$g_battle_map_plane", pos1),
      (overlay_set_alpha, "$g_battle_map_plane", 0x44),
      (create_mesh_overlay, "$g_battle_map_infantry_order_flag", "mesh_flag_infantry"),
      (create_mesh_overlay, "$g_battle_map_archers_order_flag", "mesh_flag_archers"),
      (create_mesh_overlay, "$g_battle_map_cavalry_order_flag", "mesh_flag_cavalry"),
      (overlay_set_alpha, "$g_battle_map_infantry_order_flag", 0x00),
      (overlay_set_alpha, "$g_battle_map_archers_order_flag", 0x00),
      (overlay_set_alpha, "$g_battle_map_cavalry_order_flag", 0x00),
      (call_script, "script_update_order_panel_checked_classes"),
      (call_script, "script_update_order_panel_statistics_and_map"),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (get_player_agent_no, ":var2"),
      (agent_get_team, ":var3", ":var2"),
      (assign, ":var4", 0),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_4"),
        (assign, ":var4", 1),
        (assign, "$g_formation_infantry_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_1", 250, 68),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_1", 250, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_5"),
        (assign, ":var4", 1),
        (assign, "$g_formation_archers_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_2", 250, 68),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_2", 250, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_6"),
        (assign, ":var4", 1),
        (assign, "$g_formation_cavalry_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_3", 250, 68),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_3", 250, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, ":var4", 1),
        (assign, "$g_formation_infantry_selected", 1),
        (assign, "$g_formation_archers_selected", 0),
        (assign, "$g_formation_cavalry_selected", 0),
        (overlay_animate_to_alpha, "$g_presentation_obj_1", 250, 68),
        (overlay_animate_to_alpha, "$g_presentation_obj_2", 250, 0),
        (overlay_animate_to_alpha, "$g_presentation_obj_3", 250, 0),
        (overlay_set_val, "$g_presentation_obj_4", 1),
        (overlay_set_val, "$g_presentation_obj_5", 0),
        (overlay_set_val, "$g_presentation_obj_6", 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (assign, ":var4", 1),
        (assign, "$g_formation_infantry_selected", 0),
        (assign, "$g_formation_archers_selected", 1),
        (assign, "$g_formation_cavalry_selected", 0),
        (overlay_animate_to_alpha, "$g_presentation_obj_1", 250, 0),
        (overlay_animate_to_alpha, "$g_presentation_obj_2", 250, 68),
        (overlay_animate_to_alpha, "$g_presentation_obj_3", 250, 0),
        (overlay_set_val, "$g_presentation_obj_4", 0),
        (overlay_set_val, "$g_presentation_obj_5", 1),
        (overlay_set_val, "$g_presentation_obj_6", 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (assign, ":var4", 1),
        (assign, "$g_formation_infantry_selected", 0),
        (assign, "$g_formation_archers_selected", 0),
        (assign, "$g_formation_cavalry_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_1", 250, 0),
        (overlay_animate_to_alpha, "$g_presentation_obj_2", 250, 0),
        (overlay_animate_to_alpha, "$g_presentation_obj_3", 250, 68),
        (overlay_set_val, "$g_presentation_obj_4", 0),
        (overlay_set_val, "$g_presentation_obj_5", 0),
        (overlay_set_val, "$g_presentation_obj_6", 1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 0),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_11"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 1),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_12"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 2),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_13"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 5),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_14"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 6),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_15"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 7),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_16"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 8),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_17"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 11),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_18"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 3),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_19"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 4),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_20"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 10),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_21"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 9),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_28"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 12),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_29"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 13),
        (call_script, "script_update_order_panel", ":var3"),
      (else_try),
        (eq, ":var0", "$g_battle_map_plane"),
        (get_scene_boundaries, pos2, pos3),
        (mouse_get_position, pos1),
        (set_fixed_point_multiplier, 1000),
        (position_get_x, ":var5", pos1),
        (position_get_y, ":var6", pos1),
        (store_sub, ":var7", 980, "$g_battle_map_width"),
        (store_sub, ":var8", 730, "$g_battle_map_height"),
        (val_sub, ":var5", ":var7"),
        (val_sub, ":var6", ":var8"),
        (val_clamp, ":var5", 0, "$g_battle_map_width"),
        (val_clamp, ":var6", 0, "$g_battle_map_height"),
        (val_mul, ":var5", "$g_battle_map_scale"),
        (val_mul, ":var6", "$g_battle_map_scale"),
        (set_fixed_point_multiplier, 1000),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (position_transform_position_to_parent, pos3, pos2, pos1),
        (try_begin),
          (eq, "$g_formation_infantry_selected", 1),
          (team_give_order, ":var3", 0, 0),
          (team_set_order_position, ":var3", 0, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_archers_selected", 1),
          (team_give_order, ":var3", 1, 0),
          (team_set_order_position, ":var3", 1, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_cavalry_selected", 1),
          (team_give_order, ":var3", 2, 0),
          (team_set_order_position, ":var3", 2, pos3),
        (try_end),
        (call_script, "script_update_order_flags_on_map"),
        (call_script, "script_update_order_panel", ":var3"),
      (try_end),
      (try_begin),
        (eq, ":var4", 1),
        (try_begin),
          (eq, "$g_formation_infantry_selected", 1),
          (eq, "$g_formation_archers_selected", 1),
          (eq, "$g_formation_cavalry_selected", 1),
          (team_set_order_listener, ":var3", 10),
        (else_try),
          (eq, "$g_formation_infantry_selected", 1),
          (team_set_order_listener, ":var3", 0),
        (else_try),
          (eq, "$g_formation_archers_selected", 1),
          (team_set_order_listener, ":var3", 1),
        (else_try),
          (eq, "$g_formation_cavalry_selected", 1),
          (team_set_order_listener, ":var3", 2),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_infantry_movement", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_infantry_riding", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_infantry_weapon_usage", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_obj_7", 250, 16777215),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_infantry_movement", 250, 0),
          (overlay_animate_to_color, "$g_presentation_infantry_riding", 250, 0),
          (overlay_animate_to_color, "$g_presentation_infantry_weapon_usage", 250, 0),
          (overlay_animate_to_color, "$g_presentation_obj_7", 250, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_archers_movement", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_archers_riding", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_archers_weapon_usage", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_obj_8", 250, 16777215),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_archers_movement", 250, 0),
          (overlay_animate_to_color, "$g_presentation_archers_riding", 250, 0),
          (overlay_animate_to_color, "$g_presentation_archers_weapon_usage", 250, 0),
          (overlay_animate_to_color, "$g_presentation_obj_8", 250, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_cavalry_movement", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_cavalry_riding", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_cavalry_weapon_usage", 250, 16777215),
          (overlay_animate_to_color, "$g_presentation_obj_9", 250, 16777215),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_cavalry_movement", 250, 0),
          (overlay_animate_to_color, "$g_presentation_cavalry_riding", 250, 0),
          (overlay_animate_to_color, "$g_presentation_cavalry_weapon_usage", 250, 0),
          (overlay_animate_to_color, "$g_presentation_obj_9", 250, 0),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|game_key_clicked, 32),
        (this_or_next|game_key_clicked, 33),
        (this_or_next|game_key_clicked, 34),
        (this_or_next|game_key_clicked, 31),
        (game_key_clicked, 35),
        (call_script, "script_update_order_panel_checked_classes"),
      (try_end),
      (try_begin),
        (this_or_next|game_key_clicked, 21),
        (this_or_next|game_key_clicked, 22),
        (this_or_next|game_key_clicked, 23),
        (this_or_next|game_key_clicked, 24),
        (this_or_next|game_key_clicked, 26),
        (this_or_next|game_key_clicked, 27),
        (this_or_next|game_key_clicked, 28),
        (this_or_next|game_key_clicked, 29),
        (this_or_next|game_key_clicked, 25),
        (game_key_clicked, 30),
        (get_player_agent_no, ":var1"),
        (agent_get_team, ":var2", ":var1"),
        (call_script, "script_update_order_panel", ":var2"),
      (try_end),
      (try_begin),
        (gt, ":var0", 200),
        (game_key_clicked, 20),
        (assign, "$g_presentation_battle_active", 0),
        (try_for_agents, ":var3"),
          (agent_set_slot, ":var3", 10, 0),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("sliders", 0, mesh_pic_mb_warrior_1,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_slider_overlay, "$g_presentation_obj_1", 0, 100),
      (create_slider_overlay, "$g_presentation_obj_2", 0, 100),
      (create_slider_overlay, "$g_presentation_obj_3", 0, 100),
      (create_slider_overlay, "$g_presentation_obj_4", 0, 100),
      (assign, reg1, 25),
      (str_store_string, s1, "str_reg1"),
      (create_text_overlay, "$g_presentation_obj_5", s1),
      (create_text_overlay, "$g_presentation_obj_6", s1),
      (create_text_overlay, "$g_presentation_obj_7", s1),
      (create_text_overlay, "$g_presentation_obj_8", s1),
      (assign, "$g_presentation_obj_1_val", 25),
      (overlay_set_val, "$g_presentation_obj_1", 25),
      (assign, "$g_presentation_obj_2_val", 25),
      (overlay_set_val, "$g_presentation_obj_2", 25),
      (assign, "$g_presentation_obj_3_val", 25),
      (overlay_set_val, "$g_presentation_obj_3", 25),
      (assign, "$g_presentation_obj_4_val", 25),
      (overlay_set_val, "$g_presentation_obj_4", 25),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 200),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 200),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_7", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_8", pos1),
      (position_set_x, pos1, 500),
      (overlay_set_size, "$g_presentation_obj_3", pos1),
    ]),
    (ti_on_presentation_run,
    [
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (assign, ":var2", 0),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (try_begin),
          (neq, "$g_presentation_obj_1_val", ":var1"),
          (assign, "$g_presentation_obj_1_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (try_begin),
          (neq, "$g_presentation_obj_2_val", ":var1"),
          (assign, "$g_presentation_obj_2_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (try_begin),
          (neq, "$g_presentation_obj_3_val", ":var1"),
          (assign, "$g_presentation_obj_3_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_4"),
        (try_begin),
          (neq, "$g_presentation_obj_4_val", ":var1"),
          (assign, "$g_presentation_obj_4_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var2", 1),
        (assign, ":var3", 0),
        (val_add, ":var3", "$g_presentation_obj_1_val"),
        (val_add, ":var3", "$g_presentation_obj_2_val"),
        (val_add, ":var3", "$g_presentation_obj_3_val"),
        (val_add, ":var3", "$g_presentation_obj_4_val"),
        (store_sub, ":var4", 100, ":var3"),
        (assign, ":var5", "$g_presentation_obj_1_val"),
        (assign, ":var6", "$g_presentation_obj_2_val"),
        (assign, ":var7", "$g_presentation_obj_3_val"),
        (assign, ":var8", "$g_presentation_obj_4_val"),
        (assign, ":var9", 1),
        (assign, ":var10", 0),
        (assign, ":var11", 100),
        (try_begin),
          (lt, ":var4", 0),
          (val_mul, ":var4", -1),
          (assign, ":var9", -1),
          (assign, ":var10", 1),
          (assign, ":var11", 101),
        (try_end),
        (store_sub, ":var12", ":var3", ":var1"),
        (val_add, ":var12", 30),
        (try_for_range, ":var13", 0, ":var4"),
          (store_random_in_range, ":var14", 0, ":var12"),
          (try_begin),
            (neq, ":var0", "$g_presentation_obj_1"),
            (val_sub, ":var14", "$g_presentation_obj_1_val"),
            (val_sub, ":var14", 10),
            (lt, ":var14", 0),
            (is_between, ":var5", ":var10", ":var11"),
            (val_add, ":var5", ":var9"),
          (else_try),
            (neq, ":var0", "$g_presentation_obj_2"),
            (val_sub, ":var14", "$g_presentation_obj_2_val"),
            (val_sub, ":var14", 10),
            (lt, ":var14", 0),
            (is_between, ":var6", ":var10", ":var11"),
            (val_add, ":var6", ":var9"),
          (else_try),
            (neq, ":var0", "$g_presentation_obj_3"),
            (val_sub, ":var14", "$g_presentation_obj_3_val"),
            (val_sub, ":var14", 10),
            (lt, ":var14", 0),
            (is_between, ":var7", ":var10", ":var11"),
            (val_add, ":var7", ":var9"),
          (else_try),
            (is_between, ":var8", ":var10", ":var11"),
            (val_add, ":var8", ":var9"),
          (else_try),
            (val_add, ":var4", 1),
          (try_end),
        (try_end),
        (assign, "$g_presentation_obj_1_val", ":var5"),
        (assign, "$g_presentation_obj_2_val", ":var6"),
        (assign, "$g_presentation_obj_3_val", ":var7"),
        (assign, "$g_presentation_obj_4_val", ":var8"),
      (try_end),
      (overlay_set_val, "$g_presentation_obj_1", "$g_presentation_obj_1_val"),
      (overlay_set_val, "$g_presentation_obj_2", "$g_presentation_obj_2_val"),
      (overlay_set_val, "$g_presentation_obj_3", "$g_presentation_obj_3_val"),
      (overlay_set_val, "$g_presentation_obj_4", "$g_presentation_obj_4_val"),
      (assign, reg1, "$g_presentation_obj_1_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_5", s1),
      (assign, reg1, "$g_presentation_obj_2_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_6", s1),
      (assign, reg1, "$g_presentation_obj_3_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_7", s1),
      (assign, reg1, "$g_presentation_obj_4_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_8", s1),
    ]),
  ]),

  ("arena_training", prsntf_read_only, mesh_pic_mb_warrior_1,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (get_player_agent_no, ":var0"),
      (agent_get_kill_count, reg1, ":var0", 1),
      (str_store_string, s1, "@Number of men knocked down: {reg1}"),
      (create_text_overlay, "$g_presentation_obj_1", s1),
      (overlay_set_color, "$g_presentation_obj_1", 16777215),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 700),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (assign, reg1, 0),
      (str_store_string, s1, "@Number of men left: {reg1}"),
      (create_text_overlay, "$g_presentation_obj_2", s1),
      (overlay_set_color, "$g_presentation_obj_2", 16777215),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 670),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
    ]),
    (ti_on_presentation_run,
    [
      (get_player_agent_no, ":var0"),
      (agent_get_kill_count, reg1, ":var0", 1),
      (str_store_string, s1, "@Opponents Beaten: {reg1}"),
      (overlay_set_text, "$g_presentation_obj_1", s1),
      (assign, ":var1", "$g_arena_training_max_opponents"),
      (try_for_agents, ":var2"),
        (agent_is_human, ":var2"),
        (neg|agent_is_alive, ":var2"),
        (neq, ":var2", ":var0"),
        (val_sub, ":var1", 1),
      (try_end),
      (assign, reg1, ":var1"),
      (str_store_string, s1, "@Opponents Remaining: {reg1}"),
      (overlay_set_text, "$g_presentation_obj_2", s1),
    ]),
  ]),

  ("retirement", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_button_overlay, "$g_presentation_obj_1", "@Remain in retirement.", 16),
      (create_button_overlay, "$g_presentation_obj_2", "@Go back to the adventuring.", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 80),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_y, pos1, 40),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (assign, ":var0", 0),
      (store_troop_gold, ":var1", "trp_player"),
      (store_div, ":var2", ":var1", 200),
      (val_add, ":var0", ":var2"),
      (assign, ":var3", 0),
      (assign, ":var4", 0),
      (assign, ":var5", 0),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (assign, ":var8", 0),
      (assign, ":var9", 0),
      (try_for_range, ":var10", "p_town_1", "p_salt_mine"),
        (party_get_slot, ":var11", ":var10", 0),
        (try_begin),
          (party_slot_eq, ":var10", 7, "trp_player"),
          (try_begin),
            (eq, ":var11", 3),
            (val_add, ":var3", 1),
          (else_try),
            (eq, ":var11", 2),
            (val_add, ":var4", 1),
          (else_try),
            (val_add, ":var5", 1),
          (try_end),
        (try_end),
        (party_get_slot, ":var12", ":var10", 26),
        (try_begin),
          (ge, ":var12", 40),
          (try_begin),
            (eq, ":var11", 3),
            (val_add, ":var6", 1),
          (else_try),
            (eq, ":var11", 4),
            (val_add, ":var7", 1),
          (try_end),
        (else_try),
          (le, ":var12", -40),
          (try_begin),
            (eq, ":var11", 3),
            (val_add, ":var8", 1),
          (else_try),
            (eq, ":var11", 4),
            (val_add, ":var9", 1),
          (try_end),
        (try_end),
      (try_end),
      (store_mul, ":var13", ":var3", 100),
      (store_mul, ":var14", ":var4", 50),
      (store_mul, ":var15", ":var5", 20),
      (store_add, ":var16", ":var3", ":var4"),
      (val_add, ":var16", ":var5"),
      (store_add, ":var17", ":var13", ":var14"),
      (val_add, ":var17", ":var15"),
      (val_add, ":var0", ":var17"),
      (store_mul, ":var18", ":var6", 20),
      (store_mul, ":var19", ":var7", 4),
      (store_add, ":var20", ":var6", ":var7"),
      (store_add, ":var21", ":var18", ":var19"),
      (val_add, ":var0", ":var21"),
      (store_mul, ":var22", ":var8", -40),
      (store_mul, ":var23", ":var9", -8),
      (store_add, ":var24", ":var8", ":var9"),
      (store_add, ":var25", ":var22", ":var23"),
      (val_add, ":var0", ":var25"),
      (assign, ":var26", 0),
      (troop_get_inventory_capacity, ":var27", "trp_player"),
      (try_for_range, ":var28", 0, ":var27"),
        (troop_get_inventory_slot, ":var29", "trp_player", ":var28"),
        (ge, ":var29", 0),
        (store_item_value, ":var30", ":var29"),
        (val_add, ":var26", ":var30"),
      (try_end),
      (store_div, ":var31", ":var26", 200),
      (val_add, ":var0", ":var31"),
      (troop_get_slot, ":var32", "trp_player", 7),
      (store_div, ":var33", ":var32", 1),
      (val_add, ":var0", ":var33"),
      (assign, ":var34", 0),
      (assign, ":var35", 0),
      (try_for_range, ":var36", "trp_kingdom_1_lord", "trp_heroes_end"),
        (this_or_next|troop_slot_eq, ":var36", 2, 2),
        (troop_slot_eq, ":var36", 2, 4),
        (call_script, "script_troop_get_player_relation", ":var36"),
        (assign, ":var12", reg0),
        (try_begin),
          (ge, ":var12", 40),
          (val_add, ":var35", 1),
        (else_try),
          (le, ":var12", -40),
          (val_add, ":var34", 1),
        (try_end),
      (try_end),
      (store_mul, ":var37", ":var35", 10),
      (val_add, ":var0", ":var37"),
      (store_mul, ":var38", ":var34", -10),
      (val_add, ":var0", ":var38"),
      (store_current_day, ":var39"),
      (store_div, ":var40", ":var39", -1),
      (val_add, ":var0", ":var40"),
      (store_mul, ":var41", "$g_total_victories", 2),
      (val_add, ":var0", ":var41"),
      (store_mul, ":var42", "$g_total_defeats", -3),
      (val_add, ":var0", ":var42"),
      (store_mul, ":var43", "$g_total_quests_completed", 4),
      (val_add, ":var0", ":var43"),
      (troop_get_xp, ":var44", "trp_player"),
      (store_div, ":var45", ":var44", 5000),
      (val_add, ":var0", ":var45"),
      (assign, ":var46", 0),
      (assign, ":var47", 0),
      (try_for_range, ":var36", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
        (try_begin),
          (troop_slot_eq, ":var36", 2, 3),
          (val_add, ":var46", 1),
        (else_try),
          (troop_slot_ge, ":var36", 82, 1),
          (val_add, ":var47", 1),
        (try_end),
      (try_end),
      (store_div, ":var48", ":var46", 2),
      (val_add, ":var0", ":var48"),
      (store_div, ":var49", ":var47", -4),
      (val_add, ":var0", ":var49"),
      (get_average_game_difficulty, ":var50"),
      (assign, ":var51", ":var0"),
      (val_mul, ":var0", ":var50"),
      (val_div, ":var0", 75),
      (val_mul, ":var0", ":var50"),
      (val_div, ":var0", 75),
      (store_sub, ":var51", ":var0", ":var51"),
      (assign, reg5, ":var39"),
      (store_character_level, reg4, "trp_player"),
      (create_text_overlay, reg1, "@You have retired at level {reg4} after {reg5} days of adventuring.", 16),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 950),
      (position_set_y, pos1, 950),
      (overlay_set_size, reg1, pos1),
      (create_text_overlay, reg2, "@Effect on Score", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg2, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 670),
      (overlay_set_position, reg2, pos1),
      (assign, reg0, ":var16"),
      (create_text_overlay, reg1, "@Settlements owned by you: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var17"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var20"),
      (create_text_overlay, reg1, "@Friendly Settlements: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 630),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var21"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 630),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var24"),
      (create_text_overlay, reg1, "@Hostile Settlements: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 610),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var25"),
      (create_text_overlay, reg1, "@{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 610),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 16711680),
      (try_end),
      (assign, reg0, ":var35"),
      (create_text_overlay, reg1, "@Friendly Commandants: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 590),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var37"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 590),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var34"),
      (create_text_overlay, reg1, "@Enemy Commandants: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 570),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var38"),
      (create_text_overlay, reg1, "@{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 570),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 16711680),
      (try_end),
      (assign, reg0, "$g_total_victories"),
      (create_text_overlay, reg1, "@Victories: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var41"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, "$g_total_defeats"),
      (create_text_overlay, reg1, "@Defeats: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 530),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var42"),
      (create_text_overlay, reg1, "@{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 530),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 16711680),
      (try_end),
      (assign, reg0, "$g_total_quests_completed"),
      (create_text_overlay, reg1, "@Quests Completed: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 510),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var43"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 510),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var46"),
      (create_text_overlay, reg1, "@Companions Found: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 490),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var48"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 490),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var47"),
      (create_text_overlay, reg1, "@Companions Lost/Departed: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 470),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var49"),
      (create_text_overlay, reg1, "@{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 470),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 16711680),
      (try_end),
      (assign, reg0, ":var1"),
      (create_text_overlay, reg1, "@Wealth: {reg0} cents", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var2"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var26"),
      (create_text_overlay, reg1, "@Inventory: {reg0} cents", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 430),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var31"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 430),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var32"),
      (create_text_overlay, reg1, "@Renown: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 410),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var33"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 410),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var44"),
      (create_text_overlay, reg1, "@Experience: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 390),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var45"),
      (create_text_overlay, reg1, "@{reg0?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 390),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (try_end),
      (assign, reg0, ":var39"),
      (create_text_overlay, reg1, "@Days Passed: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 370),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var40"),
      (create_text_overlay, reg1, "@{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 370),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 16711680),
      (try_end),
      (assign, reg0, ":var50"),
      (create_text_overlay, reg1, "@Difficulty: {reg0}%", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var51"),
      (assign, reg3, reg0),
      (val_max, reg3, 0),
      (create_text_overlay, reg1, "@{reg3?+:}{reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 65280),
      (else_try),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 16711680),
      (try_end),
      (assign, reg0, ":var0"),
      (create_text_overlay, reg1, "@TOTAL SCORE: {reg0}", 16),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 320),
      (overlay_set_position, reg1, pos1),
      (assign, ":var52", 0),
      (assign, ":var53", 0),
      (assign, ":var54", 0),
      (assign, ":var55", 0),
      (assign, ":var56", 0),
      (assign, ":var57", 0),
      (try_for_range, ":var58", "p_town_1", "p_salt_mine"),
        (try_begin),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (try_begin),
            (party_slot_eq, ":var58", 0, 3),
            (val_add, ":var54", 1),
          (else_try),
            (party_slot_eq, ":var58", 0, 2),
            (val_add, ":var53", 1),
          (else_try),
            (val_add, ":var52", 1),
          (try_end),
        (else_try),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (try_begin),
            (party_slot_eq, ":var58", 0, 3),
            (val_add, ":var57", ":var59"),
          (else_try),
            (party_slot_eq, ":var58", 0, 2),
            (val_add, ":var56", ":var59"),
          (else_try),
            (val_add, ":var55", ":var59"),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (gt, ":var54", 0),
        (store_random_in_range, ":var60", 0, ":var54"),
        (try_for_range, ":var58", "p_town_1", "p_castle_1"),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (val_sub, ":var60", 1),
          (lt, ":var60", 0),
          (str_store_party_name, s9, ":var58"),
        (try_end),
      (else_try),
        (gt, ":var57", 0),
        (store_random_in_range, ":var61", 0, ":var57"),
        (try_for_range, ":var58", "p_town_1", "p_castle_1"),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (val_sub, ":var61", ":var59"),
          (lt, ":var61", 0),
          (str_store_party_name, s9, ":var58"),
        (try_end),
      (else_try),
        (store_random_in_range, ":var60", "p_town_1", "p_castle_1"),
        (str_store_party_name, s9, ":var60"),
      (try_end),
      (try_begin),
        (gt, ":var53", 0),
        (store_random_in_range, ":var62", 0, ":var53"),
        (try_for_range, ":var58", "p_castle_1", "p_village_1"),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (val_sub, ":var62", 1),
          (lt, ":var62", 0),
          (str_store_party_name, s8, ":var58"),
        (try_end),
      (else_try),
        (gt, ":var56", 0),
        (store_random_in_range, ":var63", 0, ":var56"),
        (try_for_range, ":var58", "p_castle_1", "p_village_1"),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (val_sub, ":var63", ":var59"),
          (lt, ":var63", 0),
          (str_store_party_name, s8, ":var58"),
        (try_end),
      (else_try),
        (store_random_in_range, ":var62", "p_castle_1", "p_village_1"),
        (str_store_party_name, s8, ":var62"),
      (try_end),
      (try_begin),
        (gt, ":var52", 0),
        (store_random_in_range, ":var64", 0, ":var52"),
        (try_for_range, ":var58", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (val_sub, ":var64", 1),
          (lt, ":var64", 0),
          (str_store_party_name, s7, ":var58"),
        (try_end),
      (else_try),
        (gt, ":var55", 0),
        (store_random_in_range, ":var65", 0, ":var55"),
        (try_for_range, ":var58", "p_village_1", "p_salt_mine"),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (val_sub, ":var65", ":var59"),
          (lt, ":var65", 0),
          (str_store_party_name, s7, ":var58"),
        (try_end),
      (else_try),
        (store_random_in_range, ":var64", "p_village_1", "p_salt_mine"),
        (str_store_party_name, s7, ":var64"),
      (try_end),
      (try_begin),
        (lt, ":var0", 100),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 0),
        (str_store_string, s0, "str_retirement_text_1"),
      (else_try),
        (lt, ":var0", 200),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 1),
        (str_store_string, s0, "str_retirement_text_2"),
      (else_try),
        (lt, ":var0", 400),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 2),
        (str_store_string, s0, "str_retirement_text_3"),
      (else_try),
        (lt, ":var0", 700),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 3),
        (str_store_string, s0, "str_retirement_text_4"),
      (else_try),
        (lt, ":var0", 1200),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 4),
        (str_store_string, s0, "str_retirement_text_5"),
      (else_try),
        (lt, ":var0", 1850),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 5),
        (str_store_string, s0, "str_retirement_text_6"),
      (else_try),
        (lt, ":var0", 2500),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 6),
        (str_store_string, s0, "str_retirement_text_7"),
      (else_try),
        (lt, ":var0", 3500),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 7),
        (str_store_string, s0, "str_retirement_text_8"),
      (else_try),
        (lt, ":var0", 5000),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 8),
        (str_store_string, s0, "str_retirement_text_9"),
      (else_try),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 9),
        (str_store_string, s0, "str_retirement_text_10"),
      (try_end),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 120),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, s0, 10240),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 120),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 360),
      (position_set_y, pos1, 190),
      (overlay_set_area_size, reg1, pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg1, pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (jump_to_menu, "mnu_end_game"),
        (start_presentation, "prsnt_game_credits"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (presentation_set_duration, 0),
        (change_screen_return),
      (try_end),
    ]),
  ]),

  ("body_design", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (store_mul, ":var0", "trp_player", 4),
      (val_add, ":var0", "$player_bp_rotation"),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_5", -1, "tableau_game_character_sheet_b", ":var0"),
      (set_fixed_point_multiplier, 1000),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, 290),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_5", pos1),
      (init_position, pos1),
      (create_text_overlay, reg1, "@Chest"),
      (create_text_overlay, reg2, "@Belly"),
      (create_text_overlay, reg3, "@Back"),
      (create_text_overlay, reg4, "@Arms"),
      (init_position, pos1),
      (position_set_x, pos1, 630),
      (position_set_y, pos1, 655),
      (overlay_set_position, reg1, pos1),
      (position_set_y, pos1, 595),
      (overlay_set_position, reg2, pos1),
      (position_set_y, pos1, 535),
      (overlay_set_position, reg3, pos1),
      (position_set_y, pos1, 475),
      (overlay_set_position, reg4, pos1),
      (init_position, pos1),
      (create_mesh_overlay, reg1, "mesh_body_design_board"),
      (overlay_set_position, reg1, pos1),
      (create_image_button_overlay, "$g_presentation_obj_1", "mesh_bp_button_r", "mesh_bp_button_r_down"),
      (create_image_button_overlay, "$g_presentation_obj_2", "mesh_bp_button_r", "mesh_bp_button_r_down"),
      (create_image_button_overlay, "$g_presentation_obj_3", "mesh_bp_button_r", "mesh_bp_button_r_down"),
      (create_image_button_overlay, "$g_presentation_obj_4", "mesh_bp_button_r", "mesh_bp_button_r_down"),
      (init_position, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 650),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_y, pos1, 590),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (position_set_y, pos1, 530),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (position_set_y, pos1, 470),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (init_position, pos1),
      (create_image_button_overlay, "$g_presentation_obj_6", "mesh_bp_button_l", "mesh_bp_button_l_down"),
      (create_image_button_overlay, "$g_presentation_obj_7", "mesh_bp_button_l", "mesh_bp_button_l_down"),
      (create_image_button_overlay, "$g_presentation_obj_8", "mesh_bp_button_l", "mesh_bp_button_l_down"),
      (create_image_button_overlay, "$g_presentation_obj_9", "mesh_bp_button_l", "mesh_bp_button_l_down"),
      (init_position, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 650),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (position_set_y, pos1, 590),
      (overlay_set_position, "$g_presentation_obj_7", pos1),
      (position_set_y, pos1, 530),
      (overlay_set_position, "$g_presentation_obj_8", pos1),
      (position_set_y, pos1, 470),
      (overlay_set_position, "$g_presentation_obj_9", pos1),
      (create_image_button_overlay, "$g_presentation_obj_10", "mesh_medium_button_b", "mesh_medium_button_down_b"),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 120),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
      (create_text_overlay, reg1, "@Enter"),
      (position_set_x, pos1, 730),
      (position_set_y, pos1, 125),
      (overlay_set_position, reg1, pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (set_fixed_point_multiplier, 1000),
      (assign, ":var1", 0),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, ":var1", 1),
        (val_add, "$player_bp_breast", 1),
        (ge, "$player_bp_breast", "mesh_tableau_mesh_body_belly1"),
        (assign, "$player_bp_breast", "mesh_tableau_mesh_body_breast1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (assign, ":var1", 1),
        (val_add, "$player_bp_belly", 1),
        (ge, "$player_bp_belly", "mesh_tableau_mesh_body_back1"),
        (assign, "$player_bp_belly", "mesh_tableau_mesh_body_belly1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (assign, ":var1", 1),
        (val_add, "$player_bp_back", 1),
        (ge, "$player_bp_back", "mesh_tableau_mesh_body_arm1"),
        (assign, "$player_bp_back", "mesh_tableau_mesh_body_back1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_4"),
        (assign, ":var1", 1),
        (val_add, "$player_bp_arm", 1),
        (ge, "$player_bp_arm", "mesh_tableau_mesh_wantedposter"),
        (assign, "$player_bp_arm", "mesh_tableau_mesh_body_arm1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_5"),
        (assign, ":var1", 1),
        (val_add, "$player_bp_rotation", 1),
        (gt, "$player_bp_rotation", 3),
        (assign, "$player_bp_rotation", 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_6"),
        (assign, ":var1", 1),
        (val_sub, "$player_bp_breast", 1),
        (lt, "$player_bp_breast", "mesh_tableau_mesh_body_breast1"),
        (store_sub, "$player_bp_breast", "mesh_tableau_mesh_body_belly1", 1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_7"),
        (assign, ":var1", 1),
        (val_sub, "$player_bp_belly", 1),
        (lt, "$player_bp_belly", "mesh_tableau_mesh_body_belly1"),
        (store_sub, "$player_bp_belly", "mesh_tableau_mesh_body_back1", 1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_8"),
        (assign, ":var1", 1),
        (val_sub, "$player_bp_back", 1),
        (lt, "$player_bp_back", "mesh_tableau_mesh_body_back1"),
        (store_sub, "$player_bp_back", "mesh_tableau_mesh_body_arm1", 1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_9"),
        (assign, ":var1", 1),
        (val_sub, "$player_bp_arm", 1),
        (lt, "$player_bp_arm", "mesh_tableau_mesh_body_arm1"),
        (store_sub, "$player_bp_arm", "mesh_tableau_mesh_wantedposter", 1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (eq, ":var1", 1),
        (start_presentation, "prsnt_body_design"),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_space),
        (this_or_next|key_clicked, key_enter),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_back_space),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (key_clicked, key_m),
        (mouse_get_position, pos1),
        (position_get_x, reg1, pos1),
        (position_get_y, reg2, pos1),
        (display_message, "@Mouse position: {reg1}, {reg2}"),
      (try_end),
    ]),
  ]),

  ("player_wounded", prsntf_read_only, mesh_pic_mb_warrior_1,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (init_position, pos1),
      (position_set_y, pos1, -1000),
      (create_mesh_overlay, reg1, "mesh_eyelids"),
      (overlay_set_position, reg1, pos1),
      (position_set_y, pos1, 1000),
      (overlay_animate_to_position, reg1, 3000, pos1),
      (create_mesh_overlay, reg1, "mesh_eyelids"),
      (overlay_set_position, reg1, pos1),
      (position_set_y, pos1, -1000),
      (overlay_animate_to_position, reg1, 3000, pos1),
      (play_sound, "snd_breath"),
    ]),
    (ti_on_presentation_run,
    [
    ]),
  ]),

  ("blackjack", 0, mesh_pic_mb_warrior_1,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_presentation_obj_1", -1),
      (assign, "$g_presentation_obj_2", -1),
      (assign, "$g_presentation_obj_3", -1),
      (assign, "$g_presentation_obj_4", -1),
      (assign, "$g_presentation_obj_5", -1),
      (assign, "$g_presentation_obj_6", -1),
      (assign, "$g_presentation_obj_7", -1),
      (assign, "$g_presentation_obj_8", -1),
      (assign, "$g_presentation_obj_9", -1),
      (assign, "$g_presentation_obj_10", -1),
      (assign, "$g_presentation_obj_11", -1),
      (assign, "$g_presentation_obj_12", -1),
      (assign, "$g_presentation_credits_obj_1", -1),
      (assign, "$g_presentation_credits_obj_2", -1),
      (assign, "$g_presentation_credits_obj_3", -1),
      (assign, "$g_presentation_credits_obj_4", -1),
      (assign, "$g_presentation_credits_obj_5", -1),
      (assign, reg1, 0),
      (assign, reg21, 0),
      (assign, reg22, 0),
      (assign, reg23, 0),
      (assign, reg24, 0),
      (assign, reg25, 0),
      (assign, reg26, 0),
      (assign, reg27, 0),
      (assign, reg28, 0),
      (assign, reg29, 0),
      (assign, reg30, 0),
      (assign, reg31, 0),
      (assign, reg32, 0),
      (assign, reg33, 0),
      (assign, reg34, 0),
      (assign, reg35, 0),
      (assign, reg36, 0),
      (assign, reg37, 0),
      (assign, reg38, 0),
      (assign, reg39, 0),
      (assign, reg51, 1),
      (assign, reg52, 0),
      (assign, reg53, 0),
      (assign, reg54, 0),
      (assign, reg55, 0),
      (assign, reg56, 0),
      (assign, reg57, 0),
      (assign, reg58, 0),
      (assign, reg60, 0),
      (assign, reg61, 0),
      (assign, reg62, 0),
      (assign, reg63, 0),
      (create_mesh_overlay, reg1, "mesh_wood_table"),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 0),
      (overlay_set_position, reg1, pos1),
      (str_store_troop_name, s1, "$g_talk_troop"),
      (create_text_overlay, reg1, "@{s1}", 16),
      (position_set_x, pos1, 120),
      (position_set_y, pos1, 470),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 16777215),
      (str_store_troop_name, s1, "trp_player"),
      (create_text_overlay, reg1, "@{s1}", 16),
      (position_set_x, pos1, 815),
      (position_set_y, pos1, 8),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 16777215),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", "$g_talk_troop"),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 7),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", "trp_player"),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 740),
      (position_set_y, pos1, 45),
      (overlay_set_position, reg1, pos1),
      (create_image_button_overlay, "$g_presentation_obj_1", "mesh_21_button", "mesh_21_button_down"),
      (position_set_x, pos1, 650),
      (position_set_y, pos1, 160),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 450),
      (overlay_set_size, "$g_presentation_obj_1", pos1),
      (create_text_overlay, reg1, "@Hit"),
      (position_set_x, pos1, 660),
      (position_set_y, pos1, 160),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 16777215),
      (create_image_button_overlay, "$g_presentation_obj_2", "mesh_21_button", "mesh_21_button_down"),
      (position_set_x, pos1, 650),
      (position_set_y, pos1, 100),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 450),
      (overlay_set_size, "$g_presentation_obj_2", pos1),
      (create_text_overlay, reg1, "@Stay"),
      (position_set_x, pos1, 660),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 16777215),
      (create_image_button_overlay, "$g_presentation_obj_3", "mesh_21_button", "mesh_21_button_down"),
      (position_set_x, pos1, 650),
      (position_set_y, pos1, 40),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 450),
      (overlay_set_size, "$g_presentation_obj_3", pos1),
      (create_text_overlay, reg1, "@Double"),
      (position_set_x, pos1, 660),
      (position_set_y, pos1, 40),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 16777215),
      (create_mesh_overlay, reg1, "mesh_text_bar"),
      (position_set_x, pos1, 240),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 740),
      (position_set_y, pos1, 305),
      (overlay_set_position, reg1, pos1),
      (str_store_string, s1, "@Bet: {reg51} cents"),
      (create_text_overlay, "$g_presentation_obj_4", s1),
      (position_set_x, pos1, 755),
      (position_set_y, pos1, 355),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (overlay_set_color, "$g_presentation_obj_4", 16776396),
      (store_troop_gold, reg1, "trp_player"),
      (create_text_overlay, "$g_presentation_obj_5", "@Money: {reg1} cents"),
      (position_set_x, pos1, 755),
      (position_set_y, pos1, 325),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (overlay_set_color, "$g_presentation_obj_5", 16776396),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (set_fixed_point_multiplier, 1000),
      (ge, ":var0", 500),
      (try_begin),
        (eq, reg50, 0),
        (assign, reg50, 3),
        (create_mesh_overlay, "$g_presentation_obj_6", "mesh_text_bar"),
        (position_set_x, pos1, 350),
        (position_set_y, pos1, 1800),
        (overlay_set_size, "$g_presentation_obj_6", pos1),
        (position_set_x, pos6, 330),
        (position_set_y, pos6, 250),
        (create_slider_overlay, "$g_presentation_obj_7", 1, 50),
        (overlay_set_val, "$g_presentation_obj_7", reg51),
        (position_set_x, pos7, 510),
        (position_set_y, pos7, 360),
        (create_text_overlay, "$g_presentation_obj_8", "@Bet: {reg51} cents"),
        (position_set_x, pos8, 420),
        (position_set_y, pos8, 400),
        (create_mesh_overlay, "$g_presentation_obj_9", "mesh_button_used"),
        (position_set_x, pos1, 350),
        (position_set_y, pos1, 500),
        (overlay_set_size, "$g_presentation_obj_9", pos1),
        (position_set_x, pos9, 453),
        (position_set_y, pos9, 284),
        (create_button_overlay, "$g_presentation_obj_10", "@Done", 16),
        (position_set_x, pos1, 1400),
        (position_set_y, pos1, 1400),
        (overlay_set_size, "$g_presentation_obj_10", pos1),
        (position_set_x, pos10, 500),
        (position_set_y, pos10, 284),
        (overlay_set_position, "$g_presentation_obj_6", pos6),
        (overlay_set_val, "$g_presentation_obj_7", reg51),
        (overlay_set_position, "$g_presentation_obj_7", pos7),
        (overlay_set_position, "$g_presentation_obj_8", pos8),
        (overlay_set_position, "$g_presentation_obj_9", pos9),
        (overlay_set_position, "$g_presentation_obj_10", pos10),
      (try_end),
      (try_begin),
        (eq, reg50, 4),
        (assign, reg50, 5),
        (assign, reg58, ":var0"),
        (position_set_x, pos13, 320),
        (position_set_y, pos13, 265),
        (position_set_x, pos14, 450),
        (position_set_y, pos14, 400),
        (assign, reg63, 0),
      (try_end),
      (try_begin),
        (eq, reg50, 5),
        (lt, reg63, 30),
        (store_sub, ":var1", ":var0", reg58),
        (ge, ":var1", 20),
        (assign, reg58, ":var0"),
        (position_get_x, ":var2", pos13),
        (val_add, ":var2", 3),
        (position_set_x, pos13, ":var2"),
        (create_mesh_overlay, reg1, "mesh_poker_back"),
        (overlay_set_position, reg1, pos13),
        (overlay_set_size, reg1, pos14),
        (val_add, reg63, 1),
      (else_try),
        (eq, reg63, 30),
        (assign, reg63, 0),
        (assign, reg50, 1),
        (assign, reg58, ":var0"),
      (try_end),
      (eq, reg50, 1),
      (store_sub, ":var1", ":var0", reg58),
      (ge, ":var1", 700),
      (try_begin),
        (eq, reg21, 0),
        (assign, ":var3", "mesh_poker_heart_a"),
        (assign, ":var4", "mesh_poker_red_joker"),
        (store_random_in_range, ":var5", ":var3", ":var4"),
        (assign, reg21, ":var5"),
        (store_sub, ":var6", ":var5", ":var3"),
        (val_add, ":var6", 1),
        (try_begin),
          (le, ":var6", 13),
        (else_try),
          (val_mod, ":var6", 13),
          (try_begin),
            (eq, ":var6", 0),
            (assign, ":var6", 13),
          (try_end),
        (try_end),
        (val_min, ":var6", 10),
        (val_add, reg52, ":var6"),
        (val_add, reg53, ":var6"),
        (try_begin),
          (this_or_next|eq, reg21, "mesh_poker_heart_a"),
          (this_or_next|eq, reg21, "mesh_poker_spade_a"),
          (this_or_next|eq, reg21, "mesh_poker_diamond_a"),
          (eq, reg21, "mesh_poker_club_a"),
          (val_add, reg53, 10),
        (try_end),
        (create_mesh_overlay, "$g_presentation_credits_obj_1", "mesh_poker_back"),
        (overlay_set_position, "$g_presentation_credits_obj_1", pos13),
        (overlay_set_size, "$g_presentation_credits_obj_1", pos14),
        (position_set_x, pos11, 350),
        (position_set_y, pos11, 500),
        (copy_position, pos60, pos11),
        (overlay_animate_to_position, "$g_presentation_credits_obj_1", 300, pos11),
        (try_for_range, ":var7", 0, 200),
          (eq, reg22, 0),
          (store_random_in_range, ":var5", ":var3", ":var4"),
          (neq, ":var5", reg21),
          (assign, reg22, ":var5"),
        (try_end),
        (store_sub, ":var6", ":var5", ":var3"),
        (val_add, ":var6", 1),
        (try_begin),
          (le, ":var6", 13),
        (else_try),
          (val_mod, ":var6", 13),
          (try_begin),
            (eq, ":var6", 0),
            (assign, ":var6", 13),
          (try_end),
        (try_end),
        (val_min, ":var6", 10),
        (val_add, reg52, ":var6"),
        (val_add, reg53, ":var6"),
        (try_begin),
          (eq, reg53, reg52),
          (this_or_next|eq, reg22, "mesh_poker_heart_a"),
          (this_or_next|eq, reg22, "mesh_poker_spade_a"),
          (this_or_next|eq, reg22, "mesh_poker_diamond_a"),
          (eq, reg22, "mesh_poker_club_a"),
          (val_add, reg53, 10),
        (try_end),
        (create_mesh_overlay, "$g_presentation_credits_obj_2", reg22),
        (overlay_set_position, "$g_presentation_credits_obj_2", pos13),
        (overlay_set_size, "$g_presentation_credits_obj_2", pos14),
        (position_get_x, ":var8", pos11),
        (val_add, ":var8", 150),
        (position_set_x, pos11, ":var8"),
        (overlay_animate_to_position, "$g_presentation_credits_obj_2", 300, pos11),
        (try_for_range, ":var7", 0, 200),
          (eq, reg23, 0),
          (store_random_in_range, ":var5", ":var3", ":var4"),
          (neq, ":var5", reg21),
          (neq, ":var5", reg22),
          (assign, reg23, ":var5"),
        (try_end),
        (store_sub, ":var9", ":var5", ":var3"),
        (val_add, ":var9", 1),
        (try_begin),
          (le, ":var9", 13),
        (else_try),
          (val_mod, ":var9", 13),
          (try_begin),
            (eq, ":var9", 0),
            (assign, ":var9", 13),
          (try_end),
        (try_end),
        (val_min, ":var9", 10),
        (val_add, reg54, ":var9"),
        (val_add, reg55, ":var9"),
        (try_begin),
          (this_or_next|eq, reg23, "mesh_poker_heart_a"),
          (this_or_next|eq, reg23, "mesh_poker_spade_a"),
          (this_or_next|eq, reg23, "mesh_poker_diamond_a"),
          (eq, reg23, "mesh_poker_club_a"),
          (val_add, reg55, 10),
        (try_end),
        (create_mesh_overlay, "$g_presentation_credits_obj_3", reg23),
        (overlay_set_position, "$g_presentation_credits_obj_3", pos13),
        (overlay_set_size, "$g_presentation_credits_obj_3", pos14),
        (position_set_x, pos12, 200),
        (position_set_y, pos12, 30),
        (overlay_animate_to_position, "$g_presentation_credits_obj_3", 300, pos12),
        (try_for_range, ":var7", 0, 200),
          (eq, reg24, 0),
          (store_random_in_range, ":var5", ":var3", ":var4"),
          (neq, ":var5", reg21),
          (neq, ":var5", reg22),
          (neq, ":var5", reg23),
          (assign, reg24, ":var5"),
        (try_end),
        (store_sub, ":var9", ":var5", ":var3"),
        (val_add, ":var9", 1),
        (try_begin),
          (le, ":var9", 13),
        (else_try),
          (val_mod, ":var9", 13),
          (try_begin),
            (eq, ":var9", 0),
            (assign, ":var9", 13),
          (try_end),
        (try_end),
        (val_min, ":var9", 10),
        (val_add, reg54, ":var9"),
        (val_add, reg55, ":var9"),
        (try_begin),
          (eq, reg55, reg54),
          (this_or_next|eq, reg24, "mesh_poker_heart_a"),
          (this_or_next|eq, reg24, "mesh_poker_spade_a"),
          (this_or_next|eq, reg24, "mesh_poker_diamond_a"),
          (eq, reg24, "mesh_poker_club_a"),
          (val_add, reg55, 10),
        (try_end),
        (create_mesh_overlay, "$g_presentation_credits_obj_4", reg24),
        (overlay_set_position, "$g_presentation_credits_obj_4", pos13),
        (overlay_set_size, "$g_presentation_credits_obj_4", pos14),
        (position_get_x, ":var8", pos12),
        (val_add, ":var8", 60),
        (position_set_x, pos12, ":var8"),
        (overlay_animate_to_position, "$g_presentation_credits_obj_4", 300, pos12),
        (assign, reg58, ":var0"),
      (try_end),
      (gt, reg24, 0),
      (store_sub, ":var10", ":var0", reg58),
      (ge, ":var10", 1200),
      (try_begin),
        (eq, reg25, 0),
        (eq, reg56, 0),
        (try_begin),
          (eq, reg53, 21),
          (eq, reg55, 21),
          (display_message, "@Draw! Your bets have been returned.", 0x88FFFF),
          (call_script, "script_troop_add_gold", "trp_player", reg51),
          (assign, reg56, 3),
        (else_try),
          (eq, reg53, 21),
          (val_div, reg51, 2),
          (troop_remove_gold, "trp_player", reg51),
          (play_sound, "snd_money_paid"),
          (display_message, "@Your opponent has Blackjack! You lose an additional 50%!", 0x88FFFF),
          (assign, reg56, 1),
        (else_try),
          (eq, reg55, 21),
          (val_mul, reg51, 5),
          (val_div, reg51, 2),
          (call_script, "script_troop_add_gold", "trp_player", reg51),
          (display_message, "@You have Blackjack! You win an additional 50%!", 0x88FFFF),
          (assign, reg56, 2),
        (try_end),
        (neq, reg56, 0),
        (try_begin),
          (eq, reg61, 0),
          (assign, reg61, 1),
          (create_mesh_overlay, reg1, reg21),
          (overlay_set_position, reg1, pos60),
          (overlay_set_size, reg1, pos14),
        (try_end),
        (store_troop_gold, reg1, "trp_player"),
        (str_store_string, s1, "@Bet: 0 cents"),
        (overlay_set_text, "$g_presentation_obj_4", s1),
        (str_store_string, s1, "@Money: {reg1} cents"),
        (overlay_set_text, "$g_presentation_obj_5", s1),
        (assign, reg58, ":var0"),
      (try_end),
      (try_begin),
        (gt, reg24, 0),
        (eq, reg56, 0),
        (ge, reg57, 1),
        (store_sub, ":var10", ":var0", reg58),
        (ge, ":var10", 600),
        (try_begin),
          (gt, reg52, 21),
          (val_mul, reg51, 2),
          (display_message, "@Your opponent busted. You win!", 0x88FFFF),
          (call_script, "script_troop_add_gold", "trp_player", reg51),
          (assign, reg56, 2),
        (else_try),
          (gt, reg54, 21),
          (display_message, "@You busted. You lose!", 0x88FFFF),
          (assign, reg56, 1),
        (else_try),
          (eq, reg60, 1),
          (eq, reg61, 1),
          (try_begin),
            (assign, ":var11", 0),
            (try_begin),
              (le, reg53, 21),
              (try_begin),
                (le, reg55, 21),
                (gt, reg53, reg55),
                (assign, ":var11", 1),
              (else_try),
                (gt, reg55, 21),
                (gt, reg53, reg54),
                (assign, ":var11", 1),
              (try_end),
            (else_try),
              (gt, reg53, 21),
              (try_begin),
                (le, reg55, 21),
                (gt, reg52, reg55),
                (assign, ":var11", 1),
              (else_try),
                (gt, reg55, 21),
                (gt, reg52, reg54),
                (assign, ":var11", 1),
              (try_end),
            (try_end),
            (eq, ":var11", 1),
            (assign, reg56, 1),
            (display_message, "@Your opponent has a better hand. You lose!", 0x88FFFF),
            (overlay_set_text, "$g_presentation_obj_4", "@Bet: 0 cents"),
          (else_try),
            (assign, ":var11", 0),
            (try_begin),
              (le, reg55, 21),
              (try_begin),
                (le, reg53, 21),
                (gt, reg55, reg53),
                (assign, ":var11", 1),
              (else_try),
                (gt, reg53, 21),
                (gt, reg55, reg52),
                (assign, ":var11", 1),
              (try_end),
            (else_try),
              (gt, reg55, 21),
              (try_begin),
                (le, reg55, 21),
                (gt, reg54, reg53),
                (assign, ":var11", 1),
              (else_try),
                (gt, reg53, 21),
                (gt, reg54, reg52),
                (assign, ":var11", 1),
              (try_end),
            (try_end),
            (eq, ":var11", 1),
            (assign, reg56, 2),
            (display_message, "@You have a better hand. You win!", 0x88FFFF),
            (val_mul, reg51, 2),
            (call_script, "script_troop_add_gold", "trp_player", reg51),
          (else_try),
            (display_message, "@Draw! Your bets have been returned.", 0x88FFFF),
            (call_script, "script_troop_add_gold", "trp_player", reg51),
            (assign, reg56, 3),
          (try_end),
        (try_end),
        (neq, reg56, 0),
        (try_begin),
          (eq, reg61, 0),
          (assign, reg61, 1),
          (create_mesh_overlay, reg1, reg21),
          (overlay_set_position, reg1, pos60),
          (overlay_set_size, reg1, pos14),
        (try_end),
        (store_troop_gold, reg1, "trp_player"),
        (str_store_string, s1, "@Bet: 0 cents"),
        (overlay_set_text, "$g_presentation_obj_4", s1),
        (str_store_string, s1, "@Money: {reg1} cents"),
        (overlay_set_text, "$g_presentation_obj_5", s1),
        (assign, reg58, ":var0"),
      (try_end),
      (try_begin),
        (neq, reg56, 0),
        (store_sub, ":var12", ":var0", reg58),
        (ge, ":var12", 800),
        (assign, reg50, 2),
        (try_begin),
          (eq, reg56, 1),
          (str_store_string, s1, "@You lose. Try again?"),
        (else_try),
          (eq, reg56, 2),
          (str_store_string, s1, "@You win! Try again?"),
        (else_try),
          (eq, reg56, 3),
          (str_store_string, s1, "@Draw. Try again?"),
        (try_end),
        (create_text_overlay, reg1, "@{s1}", 16),
        (position_set_x, pos1, 480),
        (position_set_y, pos1, 480),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, reg1, pos1),
        (overlay_set_color, reg1, 16777215),
        (create_button_overlay, "$g_presentation_obj_11", "@Yes", 16),
        (position_set_x, pos1, 450),
        (position_set_y, pos1, 370),
        (overlay_set_position, "$g_presentation_obj_11", pos1),
        (position_set_x, pos1, 1500),
        (position_set_y, pos1, 1500),
        (overlay_set_size, "$g_presentation_obj_11", pos1),
        (overlay_set_color, "$g_presentation_obj_11", 16777215),
        (create_button_overlay, "$g_presentation_obj_12", "@No", 16),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 370),
        (overlay_set_position, "$g_presentation_obj_12", pos1),
        (position_set_x, pos1, 1500),
        (position_set_y, pos1, 1500),
        (overlay_set_size, "$g_presentation_obj_12", pos1),
        (overlay_set_color, "$g_presentation_obj_12", 16777215),
      (try_end),
      (try_begin),
        (eq, reg56, 0),
        (eq, reg57, 0),
        (assign, reg57, 1),
      (try_end),
      (try_begin),
        (eq, reg56, 0),
        (eq, reg60, 0),
        (this_or_next|eq, reg61, 1),
        (eq, reg57, 2),
        (neq, reg57, 3),
        (assign, reg57, 3),
        (assign, reg58, ":var0"),
      (try_end),
      (try_begin),
        (eq, reg56, 0),
        (eq, reg60, 0),
        (eq, reg57, 3),
        (store_sub, ":var12", ":var0", reg58),
        (ge, ":var12", 700),
        (try_begin),
          (gt, reg52, 16),
          (le, reg52, 21),
          (assign, reg60, 1),
          (display_message, "@Your opponent stays.", 0x88FFFF),
          (create_text_overlay, reg1, "@Stay"),
          (position_set_x, pos1, 255),
          (position_set_y, pos1, 650),
          (overlay_set_position, reg1, pos1),
          (position_set_x, pos1, 1600),
          (position_set_y, pos1, 1600),
          (overlay_set_size, reg1, pos1),
          (overlay_set_color, reg1, 1162001),
        (else_try),
          (le, reg52, 16),
          (assign, ":var13", 0),
          (try_begin),
            (le, reg53, 16),
            (assign, ":var13", 1),
          (else_try),
            (gt, reg53, 16),
            (try_begin),
              (gt, reg53, 21),
              (assign, ":var13", 1),
            (else_try),
              (le, reg53, 21),
              (store_sub, ":var14", 21, reg53),
              (val_mul, ":var14", 15),
              (try_begin),
                (eq, reg61, 1),
                (try_begin),
                  (le, reg55, 21),
                  (store_sub, ":var15", reg55, reg53),
                (else_try),
                  (gt, reg55, 21),
                  (store_sub, ":var15", reg54, reg53),
                (try_end),
                (val_mul, ":var15", 10),
                (val_add, ":var14", ":var15"),
              (try_end),
              (store_random_in_range, ":var5", 0, 100),
              (try_begin),
                (lt, ":var5", ":var14"),
                (assign, ":var13", 1),
              (else_try),
                (assign, reg60, 1),
                (display_message, "@Your opponent stays.", 0x88FFFF),
                (create_text_overlay, reg1, "@Stay"),
                (position_set_x, pos1, 255),
                (position_set_y, pos1, 650),
                (overlay_set_position, reg1, pos1),
                (position_set_x, pos1, 1400),
                (position_set_y, pos1, 1400),
                (overlay_set_size, reg1, pos1),
                (overlay_set_color, reg1, 1162001),
              (try_end),
            (try_end),
          (try_end),
          (eq, ":var13", 1),
          (assign, ":var3", "mesh_poker_heart_a"),
          (assign, ":var4", "mesh_poker_red_joker"),
          (assign, ":var16", 0),
          (try_for_range, ":var7", 0, 300),
            (eq, ":var16", 0),
            (store_random_in_range, ":var5", ":var3", ":var4"),
            (neq, ":var5", reg21),
            (neq, ":var5", reg22),
            (neq, ":var5", reg23),
            (neq, ":var5", reg24),
            (neq, ":var5", reg25),
            (neq, ":var5", reg26),
            (neq, ":var5", reg27),
            (neq, ":var5", reg28),
            (neq, ":var5", reg29),
            (neq, ":var5", reg30),
            (neq, ":var5", reg31),
            (neq, ":var5", reg32),
            (neq, ":var5", reg33),
            (neq, ":var5", reg34),
            (neq, ":var5", reg35),
            (neq, ":var5", reg36),
            (neq, ":var5", reg37),
            (neq, ":var5", reg38),
            (neq, ":var5", reg39),
            (assign, ":var16", ":var5"),
          (try_end),
          (try_begin),
            (eq, reg25, 0),
            (assign, reg25, ":var16"),
          (else_try),
            (eq, reg26, 0),
            (assign, reg26, ":var16"),
          (else_try),
            (eq, reg27, 0),
            (assign, reg27, ":var16"),
          (else_try),
            (eq, reg28, 0),
            (assign, reg28, ":var16"),
          (else_try),
            (eq, reg29, 0),
            (assign, reg29, ":var16"),
          (else_try),
            (eq, reg30, 0),
            (assign, reg30, ":var16"),
          (else_try),
            (eq, reg31, 0),
            (assign, reg31, ":var16"),
          (else_try),
            (eq, reg32, 0),
            (assign, reg32, ":var16"),
          (else_try),
            (eq, reg33, 0),
            (assign, reg33, ":var16"),
          (else_try),
            (eq, reg34, 0),
            (assign, reg34, ":var16"),
          (else_try),
            (eq, reg35, 0),
            (assign, reg35, ":var16"),
          (else_try),
            (eq, reg36, 0),
            (assign, reg36, ":var16"),
          (else_try),
            (eq, reg37, 0),
            (assign, reg37, ":var16"),
          (else_try),
            (eq, reg38, 0),
            (assign, reg38, ":var16"),
          (else_try),
            (eq, reg39, 0),
            (assign, reg39, ":var16"),
          (try_end),
          (store_sub, ":var6", ":var16", ":var3"),
          (val_add, ":var6", 1),
          (try_begin),
            (le, ":var6", 13),
          (else_try),
            (val_mod, ":var6", 13),
            (try_begin),
              (eq, ":var6", 0),
              (assign, ":var6", 13),
            (try_end),
          (try_end),
          (val_min, ":var6", 10),
          (val_add, reg52, ":var6"),
          (val_add, reg53, ":var6"),
          (try_begin),
            (eq, reg53, reg52),
            (this_or_next|eq, ":var16", "mesh_poker_heart_a"),
            (this_or_next|eq, ":var16", "mesh_poker_spade_a"),
            (this_or_next|eq, ":var16", "mesh_poker_diamond_a"),
            (eq, ":var16", "mesh_poker_club_a"),
            (val_add, reg53, 10),
          (try_end),
          (create_mesh_overlay, "$g_presentation_credits_obj_5", ":var16"),
          (overlay_set_position, "$g_presentation_credits_obj_5", pos13),
          (overlay_set_size, "$g_presentation_credits_obj_5", pos14),
          (position_get_x, ":var8", pos11),
          (val_add, ":var8", 60),
          (position_set_x, pos11, ":var8"),
          (overlay_animate_to_position, "$g_presentation_credits_obj_5", 300, pos11),
        (try_end),
        (assign, reg57, 1),
        (assign, reg58, ":var0"),
      (else_try),
        (eq, reg60, 1),
        (eq, reg56, 0),
        (assign, reg57, 1),
        (assign, reg58, ":var0"),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_7"),
        (try_begin),
          (neq, reg51, ":var1"),
          (assign, reg51, ":var1"),
        (try_end),
        (overlay_set_val, "$g_presentation_obj_7", reg51),
        (str_store_string, s1, "@Bet: {reg51} cents"),
        (overlay_set_text, "$g_presentation_obj_8", s1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (store_troop_gold, reg1, "trp_player"),
        (try_begin),
          (lt, reg1, reg51),
          (display_message, "@You don't have enough money.", 0x88FFFF),
        (else_try),
          (troop_remove_gold, "trp_player", reg51),
          (play_sound, "snd_money_paid"),
          (position_set_x, pos1, 1400),
          (position_set_y, pos1, 1400),
          (overlay_set_position, "$g_presentation_obj_6", pos1),
          (overlay_set_position, "$g_presentation_obj_7", pos1),
          (overlay_set_position, "$g_presentation_obj_8", pos1),
          (overlay_set_position, "$g_presentation_obj_9", pos1),
          (overlay_set_position, "$g_presentation_obj_10", pos1),
          (store_troop_gold, reg1, "trp_player"),
          (str_store_string, s1, "@Bet: {reg51} cents"),
          (overlay_set_text, "$g_presentation_obj_4", s1),
          (str_store_string, s1, "@Money: {reg1} cents"),
          (overlay_set_text, "$g_presentation_obj_5", s1),
          (assign, reg50, 4),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_11"),
        (store_troop_gold, reg1, "trp_player"),
        (try_begin),
          (lt, reg1, 1),
          (display_message, "@You don't have enough money.", 0x88FFFF),
        (else_try),
          (presentation_set_duration, 0),
          (assign, reg50, 0),
          (start_presentation, "prsnt_blackjack"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_12"),
        (assign, "$black_jack", 0),
        (assign, reg1, 0),
        (assign, reg21, 0),
        (assign, reg22, 0),
        (assign, reg23, 0),
        (assign, reg24, 0),
        (assign, reg25, 0),
        (assign, reg26, 0),
        (assign, reg27, 0),
        (assign, reg28, 0),
        (assign, reg29, 0),
        (assign, reg30, 0),
        (assign, reg31, 0),
        (assign, reg32, 0),
        (assign, reg33, 0),
        (assign, reg34, 0),
        (assign, reg35, 0),
        (assign, reg36, 0),
        (assign, reg37, 0),
        (assign, reg38, 0),
        (assign, reg39, 0),
        (assign, reg51, 0),
        (assign, reg50, 0),
        (assign, reg52, 0),
        (assign, reg53, 0),
        (assign, reg54, 0),
        (assign, reg55, 0),
        (assign, reg56, 0),
        (assign, reg57, 0),
        (assign, reg58, 0),
        (assign, reg60, 0),
        (assign, reg61, 0),
        (assign, reg62, 0),
        (assign, reg63, 0),
        (presentation_set_duration, 0),
      (try_end),
      (eq, reg56, 0),
      (eq, reg57, 1),
      (eq, reg61, 0),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, ":var2", "mesh_poker_heart_a"),
        (assign, ":var3", "mesh_poker_red_joker"),
        (assign, ":var4", 0),
        (try_for_range, ":var5", 0, 300),
          (eq, ":var4", 0),
          (store_random_in_range, ":var6", ":var2", ":var3"),
          (neq, ":var6", reg21),
          (neq, ":var6", reg22),
          (neq, ":var6", reg23),
          (neq, ":var6", reg24),
          (neq, ":var6", reg25),
          (neq, ":var6", reg26),
          (neq, ":var6", reg27),
          (neq, ":var6", reg28),
          (neq, ":var6", reg29),
          (neq, ":var6", reg30),
          (neq, ":var6", reg31),
          (neq, ":var6", reg32),
          (neq, ":var6", reg33),
          (neq, ":var6", reg34),
          (neq, ":var6", reg35),
          (neq, ":var6", reg36),
          (neq, ":var6", reg37),
          (neq, ":var6", reg38),
          (neq, ":var6", reg39),
          (assign, ":var4", ":var6"),
        (try_end),
        (try_begin),
          (eq, reg25, 0),
          (assign, reg25, ":var4"),
        (else_try),
          (eq, reg26, 0),
          (assign, reg26, ":var4"),
        (else_try),
          (eq, reg27, 0),
          (assign, reg27, ":var4"),
        (else_try),
          (eq, reg28, 0),
          (assign, reg28, ":var4"),
        (else_try),
          (eq, reg29, 0),
          (assign, reg29, ":var4"),
        (else_try),
          (eq, reg30, 0),
          (assign, reg30, ":var4"),
        (else_try),
          (eq, reg31, 0),
          (assign, reg31, ":var4"),
        (else_try),
          (eq, reg32, 0),
          (assign, reg32, ":var4"),
        (else_try),
          (eq, reg33, 0),
          (assign, reg33, ":var4"),
        (else_try),
          (eq, reg34, 0),
          (assign, reg34, ":var4"),
        (else_try),
          (eq, reg35, 0),
          (assign, reg35, ":var4"),
        (else_try),
          (eq, reg36, 0),
          (assign, reg36, ":var4"),
        (else_try),
          (eq, reg37, 0),
          (assign, reg37, ":var4"),
        (else_try),
          (eq, reg38, 0),
          (assign, reg38, ":var4"),
        (else_try),
          (eq, reg39, 0),
          (assign, reg39, ":var4"),
        (try_end),
        (store_sub, ":var7", ":var4", ":var2"),
        (val_add, ":var7", 1),
        (try_begin),
          (le, ":var7", 13),
        (else_try),
          (val_mod, ":var7", 13),
          (try_begin),
            (eq, ":var7", 0),
            (assign, ":var7", 13),
          (try_end),
        (try_end),
        (val_min, ":var7", 10),
        (val_add, reg54, ":var7"),
        (val_add, reg55, ":var7"),
        (try_begin),
          (eq, reg55, reg54),
          (this_or_next|eq, ":var4", "mesh_poker_heart_a"),
          (this_or_next|eq, ":var4", "mesh_poker_spade_a"),
          (this_or_next|eq, ":var4", "mesh_poker_diamond_a"),
          (eq, ":var4", "mesh_poker_club_a"),
          (val_add, reg55, 10),
        (try_end),
        (create_mesh_overlay, "$g_presentation_credits_obj_5", ":var4"),
        (overlay_set_position, "$g_presentation_credits_obj_5", pos13),
        (overlay_set_size, "$g_presentation_credits_obj_5", pos14),
        (position_get_x, ":var8", pos12),
        (val_add, ":var8", 60),
        (position_set_x, pos12, ":var8"),
        (overlay_animate_to_position, "$g_presentation_credits_obj_5", 300, pos12),
        (try_begin),
          (eq, reg62, 1),
          (assign, reg61, 1),
          (display_message, "@You stay.", 0x88FFFF),
          (create_text_overlay, reg1, "@Stay"),
          (position_set_x, pos1, 660),
          (position_set_y, pos1, 100),
          (overlay_set_position, reg1, pos1),
          (overlay_set_color, reg1, 1162001),
          (create_mesh_overlay, reg1, reg21),
          (overlay_set_position, reg1, pos60),
          (overlay_set_size, reg1, pos14),
        (try_end),
        (assign, reg57, 2),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (display_message, "@You stay.", 0x88FFFF),
        (create_text_overlay, reg1, "@Stay"),
        (position_set_x, pos1, 660),
        (position_set_y, pos1, 100),
        (overlay_set_position, reg1, pos1),
        (overlay_set_color, reg1, 1162001),
        (create_mesh_overlay, reg1, reg21),
        (overlay_set_position, reg1, pos60),
        (overlay_set_size, reg1, pos14),
        (assign, reg61, 1),
        (assign, reg57, 2),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (try_begin),
          (store_troop_gold, reg1, "trp_player"),
          (lt, reg1, reg51),
          (display_message, "@You don't have enough money.", 0x88FFFF),
        (else_try),
          (eq, reg25, 0),
          (assign, reg62, 1),
          (display_message, "@You doubled down! You can only draw one more card.", 0x88FFFF),
          (create_text_overlay, reg1, "@Double"),
          (position_set_x, pos1, 660),
          (position_set_y, pos1, 40),
          (overlay_set_position, reg1, pos1),
          (overlay_set_color, reg1, 1162001),
          (troop_remove_gold, "trp_player", reg51),
          (play_sound, "snd_money_paid"),
          (val_mul, reg51, 2),
          (store_troop_gold, reg1, "trp_player"),
          (str_store_string, s1, "@Bet: {reg51} cents"),
          (overlay_set_text, "$g_presentation_obj_4", s1),
          (str_store_string, s1, "@Money: {reg1} cents"),
          (overlay_set_text, "$g_presentation_obj_5", s1),
        (else_try),
          (display_message, "@Not right now.", 0x88FFFF),
        (try_end),
      (try_end),
    ]),
  ]),


  # copied from native modsys
  ("game_profile_banner_selection", 0, mesh_load_window, [
    (ti_on_presentation_load, [
      (set_fixed_point_multiplier, 1000),
      (str_store_string, s1, "str_profile_banner_selection_text"),
      (create_text_overlay, reg1, s1, tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (overlay_set_text, reg1, s1),
      (create_button_overlay, "$g_presentation_obj_profile_banner_selection_1", "@Next Page", tf_center_justify),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_profile_banner_selection_1", pos1),

      (create_button_overlay, "$g_presentation_obj_profile_banner_selection_2", "str_use_default_banner", tf_center_justify),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_profile_banner_selection_2", pos1),

      (assign, ":x_pos", 150),
      (assign, ":y_pos", 575),
      (store_mul, ":starting_banner", 16, "$g_presentation_page_no"),
      (store_add, ":ending_banner", ":starting_banner", 16),
      (store_add, "$g_presentation_banner_start", "$g_presentation_obj_profile_banner_selection_2", 1),
      (assign, ":num_valid_banners", 0),
      (try_for_range, ":cur_banner_mesh", banner_meshes_begin, banner_meshes_end_minus_one),
        (assign, ":already_used", 0),
        (try_for_range, ":cur_faction", npc_kingdoms_begin, npc_kingdoms_end),
          (faction_slot_eq, ":cur_faction", slot_faction_banner, ":cur_banner_mesh"),
          (assign, ":already_used", 1),
        (try_end),
        (eq, ":already_used", 0),
        (val_add, ":num_valid_banners", 1),
        (gt, ":num_valid_banners", ":starting_banner"),
        (le, ":num_valid_banners", ":ending_banner"),
        (create_image_button_overlay, reg1, ":cur_banner_mesh", ":cur_banner_mesh"),
        (position_set_x, pos1, ":x_pos"),
        (position_set_y, pos1, ":y_pos"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (val_add, ":x_pos", 100),
        (ge, ":x_pos", 900),
        (assign, ":x_pos", 150),
        (val_sub, ":y_pos", 250),
      (try_end),
      (presentation_set_duration, 999999),
      ]),

    (ti_on_presentation_event_state_change, [
      (store_trigger_param_1, ":object"),
      (try_begin),
        (eq, ":object", "$g_presentation_obj_profile_banner_selection_1"),
        (val_add, "$g_presentation_page_no", 1),
        (val_mod, "$g_presentation_page_no", 8),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_profile_banner_selection"),
      (else_try),
        (eq, ":object", "$g_presentation_obj_profile_banner_selection_2"),
        (profile_set_banner_id, -1),
        (presentation_set_duration, 0),
      (else_try),
        (store_sub, ":selected_banner", ":object", "$g_presentation_banner_start"),
        (store_mul, ":page_adder", 16, "$g_presentation_page_no"),
        (val_add, ":selected_banner", ":page_adder"),
        (assign, ":num_valid_banners", 0),
        (assign, ":end_cond", banner_meshes_end_minus_one),
        (try_for_range, ":cur_banner_mesh", banner_meshes_begin, ":end_cond"),
          (assign, ":already_used", 0),
          (try_for_range, ":cur_faction", npc_kingdoms_begin, npc_kingdoms_end),
            (faction_slot_eq, ":cur_faction", slot_faction_banner, ":cur_banner_mesh"),
            (assign, ":already_used", 1),
          (try_end),
          (eq, ":already_used", 0),
          (try_begin),
            (eq, ":selected_banner", ":num_valid_banners"),
            (store_sub, ":selected_banner_index", ":cur_banner_mesh", banner_meshes_begin),
            (profile_set_banner_id, ":selected_banner_index"),
            (assign, ":end_cond", 0), #break
          (try_end),
          (val_add, ":num_valid_banners", 1),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
      ]),
    ]),

]


