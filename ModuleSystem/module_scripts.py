# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_common import *
from header_operations import *
from module_constants import *
from header_presentations import *
from header_parties import *
from header_skills import *
from header_mission_templates import *
from header_items import *
from header_triggers import *
from header_terrain_types import *
from header_music import *
from header_map_icons import *
from ID_animations import *


####################################################################################################################
# scripts is a list of script records.
# Each script record contns the following two fields:
# 1) Script id: The prefix "script_" will be inserted when referencing scripts.
# 2) Operation block: This must be a valid operation block. See header_operations.py for reference.
####################################################################################################################

scripts = [
  ("game_start",
  [
    (assign, "$hamilton_beaten", 0),
    (faction_set_slot, "fac_player_supporters_faction", 21, 2),
    (try_for_range, ":var0", "fac_unused_1", "fac_kingdoms_end"),
      (faction_set_slot, ":var0", 21, 2),
    (try_end),
    (item_set_slot, "itm_springfield_61_bayonet", 12, "itm_springfield"),
    (item_set_slot, "itm_springfield", 12, "itm_springfield_61_bayonet"),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_looters", 1),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_outlaws_american", 1),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_outlaws_mexican", 1),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_deserters", 0),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_mountain_bandits", 2),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_indian_raiders", 2),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_scalphunters", 2),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_forest_bandits", 2),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_imperialists", 0),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_confederate_renegades", 0),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_trappers", -1),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_miners", -1),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_homesteaders", -2),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_stagecoach", -4),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_manhunters", -3),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_village_farmers", -4),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_village_caravan", -4),
    (troop_set_slot, "trp_party_template_comm_effect", "pt_bank_defenders", -4),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_looters", 1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_outlaws_american", 1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_outlaws_mexican", 1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_deserters", 0),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_mountain_bandits", 1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_indian_raiders", 0),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_scalphunters", 0),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_forest_bandits", 1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_imperialists", 0),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_confederate_renegades", 0),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_trappers", -1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_miners", -1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_homesteaders", -1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_stagecoach", -1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_manhunters", -1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_village_farmers", -1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_village_caravan", -1),
    (troop_set_slot, "trp_party_template_honor_effect", "pt_bank_defenders", -1),
    (troop_set_slot, "trp_party_template_other_faction", "pt_looters", "fac_outlaws"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_looters", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_outlaws_american", "fac_outlaws"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_outlaws_american", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_outlaws_mexican", "fac_outlaws"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_outlaws_mexican", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_forest_bandits", "fac_outlaws"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_forest_bandits", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_deserters", "fac_deserters"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_deserters", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_mountain_bandits", "fac_outlaws"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_mountain_bandits", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_indian_raiders", "fac_indian_raiders"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_indian_raiders", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_imperialists", "fac_imperialists"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_imperialists", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_scalphunters", "fac_scalphunters"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_scalphunters", -2),
    (troop_set_slot, "trp_party_template_other_faction", "pt_confederate_renegades", "fac_confederate_renegades"),
    (troop_set_slot, "trp_party_template_other_faction_effect", "pt_confederate_renegades", -2),
    (faction_set_slot, "fac_commoners", 90, 1),
    (faction_set_slot, "fac_outlaws", 90, -1),
    (faction_set_slot, "fac_kingdom_1", 90, 1),
    (faction_set_slot, "fac_kingdom_2", 90, 1),
    (faction_set_slot, "fac_kingdom_3", 90, 1),
    (faction_set_slot, "fac_kingdom_4", 90, 1),
    (faction_set_slot, "fac_confederate_renegades", 90, 1),
    (faction_set_slot, "fac_imperialists", 90, 1),
    (faction_set_slot, "fac_scalphunters", 90, -1),
    (faction_set_slot, "fac_indian_raiders", 90, 0),
    (item_set_slot, "itm_winchester_carbine", 13, 1),
    (item_set_slot, "itm_joslyn", 13, 1),
    (item_set_slot, "itm_winchester_shorty", 13, 2),
    (item_set_slot, "itm_winchester_carbine_nickel", 13, 1),
    (item_set_slot, "itm_sharps_carbine", 13, 1),
    (item_set_slot, "itm_burnside", 13, 1),
    (item_set_slot, "itm_smithcarbine", 13, 1),
    (item_set_slot, "itm_maynard", 13, 1),
    (item_set_slot, "itm_tarpley", 13, 1),
    (item_set_slot, "itm_hallcarbine", 13, 1),
    (item_set_slot, "itm_spencer_b", 13, 1),
    (item_set_slot, "itm_ballcarbine", 13, 1),
    (item_set_slot, "itm_enfield_trade_gun", 13, 1),
    (item_set_slot, "itm_enfield_carbine", 13, 1),
    (item_set_slot, "itm_enfield_carbine_csa", 13, 1),
    (item_set_slot, "itm_springfield_42carbine", 13, 1),
    (item_set_slot, "itm_coltcarbinealt", 13, 1),
    (item_set_slot, "itm_coltcarbine", 13, 1),
    (item_set_slot, "itm_springfield_shotgun", 13, 2),
    (item_set_slot, "itm_doublebarrelshotgun", 13, 2),
    (item_set_slot, "itm_coachgun", 13, 2),
    (item_set_slot, "itm_shotgun8", 13, 2),
    (item_set_slot, "itm_sawnoffshotgun", 13, 2),
    (item_set_slot, "itm_triplett_b", 13, 1),
    (item_set_slot, "itm_morse", 13, 1),
    (item_set_slot, "itm_starrcarbine", 13, 1),
    (item_set_slot, "itm_colt_navy_36", 13, 3),
    (item_set_slot, "itm_colt_navy_36_rusty", 13, 3),
    (item_set_slot, "itm_colt_navy_61", 13, 3),
    (item_set_slot, "itm_colt_navy_61_rusty", 13, 3),
    (item_set_slot, "itm_remington_a", 13, 3),
    (item_set_slot, "itm_starr_navy_da", 13, 3),
    (item_set_slot, "itm_starr_navy_triggerless", 13, 3),
    (item_set_slot, "itm_spiller_burr", 13, 3),
    (item_set_slot, "itm_whitney", 13, 3),
    (item_set_slot, "itm_sharps_pepperbox", 13, 3),
    (item_set_slot, "itm_sharps_pepperbox_rusty", 13, 3),
    (item_set_slot, "itm_allen_t_pepperbox", 13, 3),
    (item_set_slot, "itm_smithwesson2", 13, 3),
    (item_set_slot, "itm_smithwesson1", 13, 3),
    (item_set_slot, "itm_ger_pinfire", 13, 3),
    (item_set_slot, "itm_volcanic_pistol", 13, 3),
    (item_set_slot, "itm_lefau20", 13, 3),
    (item_set_slot, "itm_coltpocket", 13, 3),
    (item_set_slot, "itm_coltpolice", 13, 3),
    (item_set_slot, "itm_coltfargo", 13, 3),
    (item_set_slot, "itm_moore", 13, 3),
    (item_set_slot, "itm_bacon_navy", 13, 3),
    (item_set_slot, "itm_bootpistol", 13, 3),
    (item_set_slot, "itm_singleshot", 13, 3),
    (item_set_slot, "itm_deringer", 13, 3),
    (item_set_slot, "itm_savage", 13, 3),
    (item_set_slot, "itm_baconpocket", 13, 3),
    (item_set_slot, "itm_volcanic_rifle", 13, 1),
    (troop_set_slot, "trp_gang_colors", 0, 15761536),
    (troop_set_slot, "trp_gang_colors", 1, 15631086),
    (troop_set_slot, "trp_gang_colors", 2, 8421376),
    (troop_set_slot, "trp_gang_colors", 3, 32896),
    (troop_set_slot, "trp_gang_colors", 4, 15787660),
    (troop_set_slot, "trp_gang_colors", 5, 16753920),
    (troop_set_slot, "trp_gang_colors", 6, 9699539),
    (troop_set_slot, "trp_gang_colors", 7, 6159370),
    (troop_set_slot, "trp_gang_colors", 8, 65535),
    (troop_set_slot, "trp_gang_colors", 9, 16770229),
    (troop_set_slot, "trp_gang_colors", 10, 65407),
    (troop_set_slot, "trp_gang_colors", 11, 11393254),
    (troop_ensure_inventory_space, "trp_debt", 100),
    (try_for_range, ":var1", "itm_certificate_1", "itm_certificates_end"),
      (troop_add_item, "trp_debt", ":var1"),
    (try_end),
    (try_for_range, ":var2", "p_town_1b", "p_castle_1"),
      (troop_set_slot, "trp_party_type_2", ":var2", 2),
    (try_end),
    (try_for_range, ":var2", "p_village_1", "p_salt_mine"),
      (troop_set_slot, "trp_party_type_2", ":var2", 0),
      (troop_set_slot, "trp_party_custom_reinforcements", ":var2", 0),
    (try_end),
    (troop_set_slot, "trp_party_type_2", "p_bank_1", 1),
    (troop_set_slot, "trp_party_type_2", "p_bank_2", 1),
    (troop_set_slot, "trp_party_custom_reinforcements", ":var2", "pt_kingdom_6_reinforcements_c"),
    (troop_set_slot, "trp_john_marvin", 142, "scn_town_1_center"),
    (troop_set_slot, "trp_john_marvin", 143, 8),
    (troop_set_slot, "trp_bishop_beggar", 142, "scn_town_2_center"),
    (troop_set_slot, "trp_bishop_beggar", 143, 8),
    (troop_set_slot, "trp_linda", 142, "scn_town_2_center"),
    (troop_set_slot, "trp_linda", 143, 50),
    (troop_set_slot, "trp_deputy_saunders", 142, "scn_town_3_center"),
    (troop_set_slot, "trp_deputy_saunders", 143, 6),
    (troop_set_slot, "trp_barrett", 142, "scn_town_3_center"),
    (troop_set_slot, "trp_barrett", 143, 7),
    (troop_set_slot, "trp_cottonwood_undertaker", 142, "scn_town_3_center"),
    (troop_set_slot, "trp_cottonwood_undertaker", 143, 8),
    (troop_set_slot, "trp_gy_duel_master", 142, "scn_town_4_center"),
    (troop_set_slot, "trp_gy_duel_master", 143, 8),
    (troop_set_slot, "trp_ramun_the_slave_trader", 142, "scn_town_7_center"),
    (troop_set_slot, "trp_ramun_the_slave_trader", 143, 8),
    (troop_set_slot, "trp_buckskin_bill", 142, "scn_old_cabin"),
    (troop_set_slot, "trp_buckskin_bill", 143, 16),
    (troop_set_slot, "trp_jansen_junior", 142, "scn_village_26"),
    (troop_set_slot, "trp_jansen_junior", 143, 7),
    (item_set_slot, "itm_colt_navy_36", 5, 6),
    (item_set_slot, "itm_colt_navy_36_rusty", 5, 6),
    (item_set_slot, "itm_colt_army_44", 5, 6),
    (item_set_slot, "itm_colt_army_44_chrome", 5, 6),
    (item_set_slot, "itm_colt_army_44_rusty", 5, 6),
    (item_set_slot, "itm_remington_a", 5, 6),
    (item_set_slot, "itm_remington_b", 5, 6),
    (item_set_slot, "itm_colt_walker_44", 5, 6),
    (item_set_slot, "itm_starr_sa", 5, 6),
    (item_set_slot, "itm_starr_triggerless", 5, 6),
    (item_set_slot, "itm_starr_da", 5, 6),
    (item_set_slot, "itm_starr_navy_triggerless", 5, 6),
    (item_set_slot, "itm_starr_navy_da", 5, 6),
    (item_set_slot, "itm_sharps_pepperbox", 5, 4),
    (item_set_slot, "itm_sharps_pepperbox_rusty", 5, 4),
    (item_set_slot, "itm_allen_t_pepperbox", 5, 6),
    (item_set_slot, "itm_smithwesson2", 5, 6),
    (item_set_slot, "itm_smithwesson1", 5, 7),
    (item_set_slot, "itm_ger_pinfire", 5, 6),
    (item_set_slot, "itm_fr_pinfire", 5, 6),
    (item_set_slot, "itm_beaumont_adams", 5, 5),
    (item_set_slot, "itm_volcanic_pistol", 5, 10),
    (item_set_slot, "itm_lemat", 5, 9),
    (item_set_slot, "itm_lefau20", 5, 20),
    (item_set_slot, "itm_mortimer", 5, 6),
    (item_set_slot, "itm_volcanic_rifle", 5, 25),
    (item_set_slot, "itm_henry_a", 5, 15),
    (item_set_slot, "itm_henry_b", 5, 15),
    (item_set_slot, "itm_doublebarrelshotgun", 5, 2),
    (item_set_slot, "itm_coachgun", 5, 2),
    (item_set_slot, "itm_shotgun8", 5, 2),
    (item_set_slot, "itm_sawnoffshotgun", 5, 2),
    (item_set_slot, "itm_winchester_rifle", 5, 15),
    (item_set_slot, "itm_winchester_musket", 5, 17),
    (item_set_slot, "itm_winchester_carbine", 5, 13),
    (item_set_slot, "itm_winchester_rifle_nickel", 5, 15),
    (item_set_slot, "itm_winchester_carbine_nickel", 5, 13),
    (item_set_slot, "itm_spencer_a", 5, 7),
    (item_set_slot, "itm_spencer_b", 5, 7),
    (item_set_slot, "itm_coltpocket", 5, 5),
    (item_set_slot, "itm_coltdragoon", 5, 6),
    (item_set_slot, "itm_coltpolice", 5, 5),
    (item_set_slot, "itm_coltrifle", 5, 6),
    (item_set_slot, "itm_coltriflealt", 5, 5),
    (item_set_slot, "itm_winchester_shorty", 5, 7),
    (item_set_slot, "itm_coltcarbine", 5, 6),
    (item_set_slot, "itm_coltcarbinealt", 5, 5),
    (item_set_slot, "itm_colt_navy_61", 5, 6),
    (item_set_slot, "itm_colt_navy_61_rusty", 5, 6),
    (item_set_slot, "itm_ballcarbine", 5, 7),
    (item_set_slot, "itm_whitney", 5, 6),
    (item_set_slot, "itm_spiller_burr", 5, 6),
    (item_set_slot, "itm_coltfargo", 5, 5),
    (item_set_slot, "itm_moore", 5, 7),
    (item_set_slot, "itm_triplett_a", 5, 7),
    (item_set_slot, "itm_triplett_b", 5, 7),
    (item_set_slot, "itm_bacon_navy", 5, 6),
    (item_set_slot, "itm_baconpocket", 5, 5),
    (item_set_slot, "itm_savage", 5, 6),
    (item_set_slot, "itm_doublebarrel", 5, 2),
    (item_set_slot, "itm_volcanic_rifle", 7, "itm_henry_a"),
    (item_set_slot, "itm_volcanic_rifle", 8, "itm_henry_b"),
    (item_set_slot, "itm_henry_a", 7, "itm_winchester_rifle"),
    (item_set_slot, "itm_henry_a", 8, "itm_winchester_rifle_nickel"),
    (item_set_slot, "itm_henry_b", 7, "itm_winchester_carbine"),
    (item_set_slot, "itm_henry_b", 8, "itm_winchester_carbine_nickel"),
    (assign, "$player_bp_rotation", 0),
    (assign, "$player_bp_breast", "mesh_tableau_mesh_body_breast1"),
    (assign, "$player_bp_belly", "mesh_tableau_mesh_body_belly1"),
    (assign, "$player_bp_back", "mesh_tableau_mesh_body_back1"),
    (assign, "$player_bp_arm", "mesh_tableau_mesh_body_arm1"),
    (assign, "$auto_presentation", -1),
    (troop_set_slot, "trp_prop_chance_to_appear", "spr_skeleton_cow", 5),
    (troop_set_slot, "trp_prop_chance_to_appear", "spr_1866_cactus_a", 10),
    (troop_set_slot, "trp_prop_chance_to_appear", "spr_cross_a", 1),
    (troop_set_slot, "trp_prop_chance_to_appear", "spr_cross_b", 1),
    (troop_set_slot, "trp_prop_chance_to_appear", "spr_cross_c", 1),
    (troop_set_slot, "trp_prop_chance_to_appear", "spr_cross_d", 1),
    (troop_set_slot, "trp_prop_chance_to_appear", "spr_carriage_tipped_over", 3),
    (faction_set_slot, fac_no_faction, 101, 0),
    (faction_set_slot, fac_no_faction, 102, 1),
    (faction_set_slot, fac_no_faction, 103, 0),
    (store_random_in_range, ":var3", 7, 10),
    (try_for_range, ":var4", 0, ":var3"),
      (store_random_in_range, ":var5", "fac_culture_5", "fac_player_faction"),
      (try_for_range, ":var6", "trp_knight_5_1", "trp_duvalle_1"),
        (assign, ":var7", 1),
        (try_for_range, ":var8", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (faction_slot_eq, ":var8", 10, ":var6"),
          (assign, ":var7", 0),
        (try_end),
        (eq, ":var7", 1),
        (assign, ":var9", ":var6"),
      (try_end),
      (gt, ":var9", 0),
      (call_script, "script_cf_create_gang", ":var5", ":var9"),
      (assign, ":var0", reg0),
      (call_script, "script_change_troop_faction", ":var9", ":var0"),
    (try_end),
    (try_for_range, ":var10", "p_town_1b", "p_castle_1"),
      (store_random_in_range, ":var6", "trp_knight_5_1", "trp_duvalle_1"),
      (call_script, "script_give_center_to_lord", ":var10", ":var6", 1),
    (try_end),
    (try_for_range, ":var6", "trp_knight_5_1", "trp_duvalle_1"),
      (assign, ":var7", 1),
      (try_for_range, ":var8", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var8", 10, ":var6"),
        (assign, ":var7", 0),
      (try_end),
      (eq, ":var7", 1),
      (store_random_in_range, ":var11", 0, ":var3"),
      (try_for_range, ":var12", "fac_unused_1", "fac_kingdoms_end"),
        (faction_slot_eq, ":var12", 21, 0),
        (val_sub, ":var11", 1),
        (eq, ":var11", -1),
        (call_script, "script_change_troop_faction", ":var6", ":var12"),
      (try_end),
    (try_end),
    (try_for_range, ":var6", "trp_knight_5_1", "trp_duvalle_1"),
      (store_troop_faction, ":var13", ":var6"),
      (try_begin),
        (faction_slot_eq, ":var13", 9, "fac_culture_5"),
        (troop_clear_inventory, ":var6"),
        (store_random_in_range, ":var14", "itm_standardbred_chestnut", "itm_leather_gloves"),
        (troop_set_inventory_slot, ":var6", ek_item_0, ":var14"),
        (troop_set_inventory_slot, ":var6", ek_item_1, 220),
        (troop_set_inventory_slot, ":var6", ek_item_2, 220),
        (troop_set_inventory_slot, ":var6", ek_item_3, 188),
        (troop_set_inventory_slot, ":var6", ek_head, 188),
        (troop_set_inventory_slot, ":var6", ek_body, 323),
        (troop_set_inventory_slot, ":var6", ek_foot, 403),
        (troop_set_inventory_slot, ":var6", ek_gloves, 571),
        (troop_set_inventory_slot, ":var6", ek_horse, 426),
        (troop_set_inventory_slot, ":var6", ek_food, 176),
        (troop_equip_items, ":var6"),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_6"),
        (troop_clear_inventory, ":var6"),
        (store_random_in_range, ":var14", "itm_standardbred_chestnut", "itm_leather_gloves"),
        (troop_set_inventory_slot, ":var6", ek_item_0, ":var14"),
        (troop_set_inventory_slot, ":var6", ek_item_1, 211),
        (troop_set_inventory_slot, ":var6", ek_item_2, 211),
        (troop_set_inventory_slot, ":var6", ek_item_3, 188),
        (troop_set_inventory_slot, ":var6", ek_head, 188),
        (troop_set_inventory_slot, ":var6", ek_body, 348),
        (troop_set_inventory_slot, ":var6", ek_foot, 405),
        (troop_set_inventory_slot, ":var6", ek_gloves, 547),
        (troop_set_inventory_slot, ":var6", ek_horse, 426),
        (troop_set_inventory_slot, ":var6", ek_food, 176),
        (troop_equip_items, ":var6"),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_7"),
        (troop_clear_inventory, ":var6"),
        (store_random_in_range, ":var14", "itm_standardbred_chestnut", "itm_leather_gloves"),
        (troop_set_inventory_slot, ":var6", ek_item_0, ":var14"),
        (troop_set_inventory_slot, ":var6", ek_item_1, 226),
        (troop_set_inventory_slot, ":var6", ek_item_2, 226),
        (troop_set_inventory_slot, ":var6", ek_item_3, 188),
        (troop_set_inventory_slot, ":var6", ek_head, 188),
        (troop_set_inventory_slot, ":var6", ek_body, 346),
        (troop_set_inventory_slot, ":var6", ek_foot, 410),
        (troop_set_inventory_slot, ":var6", ek_gloves, 556),
        (troop_set_inventory_slot, ":var6", ek_horse, 426),
        (troop_set_inventory_slot, ":var6", ek_food, 176),
        (troop_equip_items, ":var6"),
      (try_end),
    (try_end),
    (try_begin),
      (call_script, "script_cf_create_gang", "fac_culture_7", "trp_robert"),
      (assign, ":var15", reg0),
      (call_script, "script_change_troop_faction", "trp_robert", ":var15"),
      (faction_set_name, ":var15", "@The Cottonwood Gang"),
      (call_script, "script_give_center_to_lord", "p_town_3b", "trp_robert", 1),
      (faction_set_slot, ":var15", 200, 1),
      (call_script, "script_change_troop_faction", "trp_duvalle_1", ":var15"),
      (call_script, "script_change_troop_faction", "trp_hamilton", ":var15"),
      (call_script, "script_change_troop_faction", "trp_el_puerco", ":var15"),
    (try_end),
    (assign, "$g_player_luck", 200),
    (troop_set_slot, "trp_player", 2, 2),
    (troop_set_slot, "trp_player", 8, -1),
    (try_for_range, ":var16", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (troop_set_slot, ":var16", 8, -1),
      (troop_set_slot, ":var16", 96, -1),
      (troop_set_slot, ":var16", 99, -1),
    (try_end),
    (troop_set_slot, "trp_player", 96, -1),
    (troop_set_slot, "trp_player", 99, -1),
    (store_random_in_range, "$g_election_date", 0, 45),
    (call_script, "script_store_average_center_value_per_faction"),
    (troop_set_slot, "trp_player", 85, 4294967295),
    (troop_set_slot, "trp_player", 86, 4294967295),
    (troop_set_slot, "trp_player", 87, 4294967295),
    (troop_set_slot, "trp_player", 88, 4294967295),
    (troop_set_slot, "trp_player", 89, 4294967295),
    (troop_set_slot, "trp_player", 90, 4294967295),
    (troop_set_slot, "trp_banner_background_color_array", 0, 4287579441),
    (troop_set_slot, "trp_banner_background_color_array", 1, 4281422936),
    (troop_set_slot, "trp_banner_background_color_array", 2, 4281808694),
    (troop_set_slot, "trp_banner_background_color_array", 3, 4288973608),
    (troop_set_slot, "trp_banner_background_color_array", 4, 4283004725),
    (troop_set_slot, "trp_banner_background_color_array", 5, 4286723629),
    (troop_set_slot, "trp_banner_background_color_array", 6, 4286133033),
    (troop_set_slot, "trp_banner_background_color_array", 7, 4280689953),
    (troop_set_slot, "trp_banner_background_color_array", 8, 4292467409),
    (troop_set_slot, "trp_banner_background_color_array", 9, 4283581795),
    (troop_set_slot, "trp_banner_background_color_array", 10, 4287705388),
    (troop_set_slot, "trp_banner_background_color_array", 11, 4289700401),
    (troop_set_slot, "trp_banner_background_color_array", 12, 4285558076),
    (troop_set_slot, "trp_banner_background_color_array", 13, 4292269006),
    (troop_set_slot, "trp_banner_background_color_array", 14, 4287703337),
    (troop_set_slot, "trp_banner_background_color_array", 15, 4281943428),
    (troop_set_slot, "trp_banner_background_color_array", 16, 4282541614),
    (troop_set_slot, "trp_banner_background_color_array", 17, 4292861654),
    (troop_set_slot, "trp_banner_background_color_array", 18, 4280887076),
    (troop_set_slot, "trp_banner_background_color_array", 19, 4283982107),
    (troop_set_slot, "trp_banner_background_color_array", 20, 4281416295),
    (troop_set_slot, "trp_banner_background_color_array", 21, 4290093617),
    (troop_set_slot, "trp_banner_background_color_array", 22, 4290623017),
    (troop_set_slot, "trp_banner_background_color_array", 23, 4285430057),
    (troop_set_slot, "trp_banner_background_color_array", 24, 4292269006),
    (troop_set_slot, "trp_banner_background_color_array", 25, 4287931970),
    (troop_set_slot, "trp_banner_background_color_array", 26, 4287906097),
    (troop_set_slot, "trp_banner_background_color_array", 27, 4287183668),
    (troop_set_slot, "trp_banner_background_color_array", 28, 4282537232),
    (troop_set_slot, "trp_banner_background_color_array", 29, 4287907118),
    (troop_set_slot, "trp_banner_background_color_array", 30, 4282866324),
    (troop_set_slot, "trp_banner_background_color_array", 31, 4291932721),
    (troop_set_slot, "trp_banner_background_color_array", 32, 4292993759),
    (troop_set_slot, "trp_banner_background_color_array", 33, 4283058498),
    (troop_set_slot, "trp_banner_background_color_array", 34, 4291213133),
    (troop_set_slot, "trp_banner_background_color_array", 35, 4286271876),
    (troop_set_slot, "trp_banner_background_color_array", 36, 4280362017),
    (troop_set_slot, "trp_banner_background_color_array", 37, 4282146202),
    (troop_set_slot, "trp_banner_background_color_array", 38, 4283265334),
    (troop_set_slot, "trp_banner_background_color_array", 39, 4292861910),
    (troop_set_slot, "trp_banner_background_color_array", 40, 4283594041),
    (troop_set_slot, "trp_banner_background_color_array", 41, 4288429113),
    (troop_set_slot, "trp_banner_background_color_array", 42, 4282536332),
    (troop_set_slot, "trp_banner_background_color_array", 43, 4288965164),
    (troop_set_slot, "trp_banner_background_color_array", 44, 4286855209),
    (troop_set_slot, "trp_banner_background_color_array", 45, 4281098633),
    (troop_set_slot, "trp_banner_background_color_array", 46, 4283786273),
    (troop_set_slot, "trp_banner_background_color_array", 47, 4288504350),
    (troop_set_slot, "trp_banner_background_color_array", 48, 4292796118),
    (troop_set_slot, "trp_banner_background_color_array", 49, 4285417617),
    (troop_set_slot, "trp_banner_background_color_array", 50, 4286994985),
    (troop_set_slot, "trp_banner_background_color_array", 51, 4292796377),
    (troop_set_slot, "trp_banner_background_color_array", 52, 4283581043),
    (troop_set_slot, "trp_banner_background_color_array", 53, 4287379489),
    (troop_set_slot, "trp_banner_background_color_array", 54, 4287923203),
    (troop_set_slot, "trp_banner_background_color_array", 55, 4281413681),
    (troop_set_slot, "trp_banner_background_color_array", 56, 4282868237),
    (troop_set_slot, "trp_banner_background_color_array", 57, 4292861654),
    (troop_set_slot, "trp_banner_background_color_array", 58, 4292270038),
    (troop_set_slot, "trp_banner_background_color_array", 59, 4281216812),
    (troop_set_slot, "trp_banner_background_color_array", 60, 4284498563),
    (troop_set_slot, "trp_banner_background_color_array", 61, 4281947524),
    (troop_set_slot, "trp_banner_background_color_array", 62, 4281413681),
    (troop_set_slot, "trp_banner_background_color_array", 63, 4286463790),
    (troop_set_slot, "trp_banner_background_color_array", 64, 4281611316),
    (troop_set_slot, "trp_banner_background_color_array", 65, 4282141035),
    (troop_set_slot, "trp_banner_background_color_array", 66, 4292466897),
    (troop_set_slot, "trp_banner_background_color_array", 67, 4288250428),
    (troop_set_slot, "trp_banner_background_color_array", 68, 4288643630),
    (troop_set_slot, "trp_banner_background_color_array", 69, 4281940025),
    (troop_set_slot, "trp_banner_background_color_array", 70, 4289022257),
    (troop_set_slot, "trp_banner_background_color_array", 71, 4292861142),
    (troop_set_slot, "trp_banner_background_color_array", 72, 4288629302),
    (troop_set_slot, "trp_banner_background_color_array", 73, 4287395105),
    (troop_set_slot, "trp_banner_background_color_array", 74, 4288628273),
    (troop_set_slot, "trp_banner_background_color_array", 75, 4286133028),
    (troop_set_slot, "trp_banner_background_color_array", 76, 4281946230),
    (troop_set_slot, "trp_banner_background_color_array", 77, 4281084716),
    (troop_set_slot, "trp_banner_background_color_array", 78, 4284838177),
    (troop_set_slot, "trp_banner_background_color_array", 79, 4286460193),
    (troop_set_slot, "trp_banner_background_color_array", 80, 4285944110),
    (troop_set_slot, "trp_banner_background_color_array", 81, 4293387230),
    (troop_set_slot, "trp_banner_background_color_array", 82, 4287920417),
    (troop_set_slot, "trp_banner_background_color_array", 83, 4283267964),
    (troop_set_slot, "trp_banner_background_color_array", 84, 4281611057),
    (troop_set_slot, "trp_banner_background_color_array", 85, 4289154358),
    (troop_set_slot, "trp_banner_background_color_array", 86, 4293387230),
    (troop_set_slot, "trp_banner_background_color_array", 87, 4292270286),
    (troop_set_slot, "trp_banner_background_color_array", 88, 4282273127),
    (troop_set_slot, "trp_banner_background_color_array", 89, 4287705905),
    (troop_set_slot, "trp_banner_background_color_array", 90, 4283263380),
    (troop_set_slot, "trp_banner_background_color_array", 91, 4283064600),
    (troop_set_slot, "trp_banner_background_color_array", 92, 4292466899),
    (troop_set_slot, "trp_banner_background_color_array", 93, 4281943161),
    (troop_set_slot, "trp_banner_background_color_array", 94, 4281611057),
    (troop_set_slot, "trp_banner_background_color_array", 95, 4282338653),
    (troop_set_slot, "trp_banner_background_color_array", 96, 4283065481),
    (troop_set_slot, "trp_banner_background_color_array", 97, 4281413681),
    (troop_set_slot, "trp_banner_background_color_array", 98, 4292270030),
    (troop_set_slot, "trp_banner_background_color_array", 99, 4291206656),
    (troop_set_slot, "trp_banner_background_color_array", 100, 4284714578),
    (troop_set_slot, "trp_banner_background_color_array", 101, 4292664275),
    (troop_set_slot, "trp_banner_background_color_array", 102, 4292598995),
    (troop_set_slot, "trp_banner_background_color_array", 103, 4286855217),
    (troop_set_slot, "trp_banner_background_color_array", 104, 4291743686),
    (troop_set_slot, "trp_banner_background_color_array", 105, 4287579185),
    (troop_set_slot, "trp_banner_background_color_array", 106, 4284492070),
    (troop_set_slot, "trp_banner_background_color_array", 107, 4292072651),
    (troop_set_slot, "trp_banner_background_color_array", 108, 4292664275),
    (troop_set_slot, "trp_banner_background_color_array", 109, 4283785252),
    (troop_set_slot, "trp_banner_background_color_array", 110, 4284493100),
    (troop_set_slot, "trp_banner_background_color_array", 111, 4281422212),
    (troop_set_slot, "trp_banner_background_color_array", 112, 4281413681),
    (troop_set_slot, "trp_banner_background_color_array", 113, 4293388263),
    (troop_set_slot, "trp_banner_background_color_array", 114, 4283592007),
    (troop_set_slot, "trp_banner_background_color_array", 115, 4292795350),
    (troop_set_slot, "trp_banner_background_color_array", 116, 4289898033),
    (troop_set_slot, "trp_banner_background_color_array", 117, 4285952319),
    (troop_set_slot, "trp_banner_background_color_array", 118, 4292795350),
    (troop_set_slot, "trp_banner_background_color_array", 119, 4293520103),
    (troop_set_slot, "trp_banner_background_color_array", 120, 4285223217),
    (troop_set_slot, "trp_banner_background_color_array", 121, 4281423227),
    (troop_set_slot, "trp_banner_background_color_array", 122, 4285543204),
    (troop_set_slot, "trp_banner_background_color_array", 123, 4293387230),
    (troop_set_slot, "trp_banner_background_color_array", 124, 4292270030),
    (troop_set_slot, "trp_banner_background_color_array", 125, 4282347065),
    (troop_set_slot, "trp_banner_background_color_array", 126, 4280361505),
    (troop_set_slot, "trp_banner_background_color_array", 127, 4280361505),
    (troop_set_slot, "trp_banner_background_color_array", 128, 4281219856),
    (troop_set_slot, "trp_banner_background_color_array", 129, 4282539387),
    (troop_set_slot, "trp_banner_background_color_array", 130, 4281943560),
    (store_random_in_range, ":var17", "p_training_ground_1", "p_forest_bandit_spawn_point_1"),
    (party_relocate_near_party, "p_main_party", ":var17", 3),
    (str_store_troop_name, s5, "trp_player"),
    (party_set_name, "p_main_party", s5),
    (call_script, "script_update_party_creation_random_limits"),
    (assign, "$g_player_party_icon", -1),
    (item_set_slot, "itm_smoked_fish", 1, 5),
    (item_set_slot, "itm_dried_meat", 1, 5),
    (item_set_slot, "itm_cattle_meat", 1, 7),
    (item_set_slot, "itm_pork", 1, 6),
    (item_set_slot, "itm_bread", 1, 4),
    (item_set_slot, "itm_apples", 1, 5),
    (item_set_slot, "itm_cheese", 1, 5),
    (item_set_slot, "itm_chicken", 1, 6),
    (item_set_slot, "itm_honey", 1, 10),
    (item_set_slot, "itm_cabbages", 1, 4),
    (item_set_slot, "itm_sausages", 1, 5),
    (item_set_slot, "itm_butter", 1, 8),
    (item_set_slot, "itm_wine", 1, 5),
    (item_set_slot, "itm_ale", 1, 4),
    (item_set_slot, "itm_deer_meat", 1, 6),
    (call_script, "script_initialize_npcs"),
    (assign, "$disable_npc_complaints", 1),
    (call_script, "script_change_random_party_color"),
    (item_set_slot, "itm_book_tactics", 4, 9),
    (item_set_slot, "itm_book_persuasion", 4, 8),
    (item_set_slot, "itm_book_leadership", 4, 7),
    (item_set_slot, "itm_book_intelligence", 4, 10),
    (item_set_slot, "itm_book_trade", 4, 11),
    (item_set_slot, "itm_book_weapon_mastery", 4, 9),
    (item_set_slot, "itm_book_engineering", 4, 12),
    (item_set_slot, "itm_book_wound_treatment_reference", 4, 10),
    (item_set_slot, "itm_book_training_reference", 4, 10),
    (item_set_slot, "itm_book_surgery_reference", 4, 10),
    (item_set_slot, "itm_manacles", 4, 6),
    (item_set_slot, "itm_compass", 4, 7),
    (item_set_slot, "itm_telescope", 4, 6),
    (store_sub, ":var18", "p_castle_1", "p_town_1"),
    (assign, ":var19", ":var18"),
    (try_for_range, ":var20", 0, ":var18"),
      (troop_set_slot, "trp_random_town_sequence", ":var20", -1),
    (try_end),
    (assign, ":var20", 0),
    (try_for_range, ":var4", 0, ":var19"),
      (store_random_in_range, ":var21", 0, ":var18"),
      (assign, ":var22", 1),
      (try_for_range, ":var23", 0, ":var18"),
        (troop_slot_eq, "trp_random_town_sequence", ":var23", ":var21"),
        (assign, ":var22", 0),
      (try_end),
      (try_begin),
        (eq, ":var22", 1),
        (troop_set_slot, "trp_random_town_sequence", ":var20", ":var21"),
        (val_add, ":var20", 1),
      (else_try),
        (val_add, ":var19", 1),
      (try_end),
    (try_end),
    (faction_set_slot, "fac_culture_1", 41, "trp_recruit"),
    (faction_set_slot, "fac_culture_1", 42, "trp_infantry_recruit"),
    (faction_set_slot, "fac_culture_1", 43, "trp_regular"),
    (faction_set_slot, "fac_culture_1", 44, "trp_veteran_cavalry"),
    (faction_set_slot, "fac_culture_1", 45, "trp_cavalry_officer"),
    (faction_set_slot, "fac_culture_2", 41, "trp_recluta"),
    (faction_set_slot, "fac_culture_2", 42, "trp_soldado"),
    (faction_set_slot, "fac_culture_2", 43, "trp_husar"),
    (faction_set_slot, "fac_culture_2", 44, "trp_oficial_de_los_dragones"),
    (faction_set_slot, "fac_culture_2", 45, "trp_supremos_poderes_caballero"),
    (faction_set_slot, "fac_culture_3", 41, "trp_apache_rabbit_hunter"),
    (faction_set_slot, "fac_culture_3", 42, "trp_apache_scout"),
    (faction_set_slot, "fac_culture_3", 43, "trp_apache_brave"),
    (faction_set_slot, "fac_culture_3", 44, "trp_apache_mounted_thunder_warrior"),
    (faction_set_slot, "fac_culture_3", 45, "trp_apache_thunder_spirit"),
    (faction_set_slot, "fac_culture_4", 41, "trp_comanche_buffalo_hunter"),
    (faction_set_slot, "fac_culture_4", 42, "trp_comanche_vision_seeker"),
    (faction_set_slot, "fac_culture_4", 43, "trp_comanche_medicine_man"),
    (faction_set_slot, "fac_culture_4", 44, "trp_comanche_horse_archer"),
    (faction_set_slot, "fac_culture_4", 45, "trp_comanche_wind_rider"),
    (faction_set_slot, "fac_culture_5", 41, "trp_vagabond"),
    (faction_set_slot, "fac_culture_5", 42, "trp_marauder"),
    (faction_set_slot, "fac_culture_5", 43, "trp_rustler"),
    (faction_set_slot, "fac_culture_5", 44, "trp_pistolero"),
    (faction_set_slot, "fac_culture_5", 45, "trp_desperado"),
    (faction_set_slot, "fac_culture_6", 41, "trp_local_militia"),
    (faction_set_slot, "fac_culture_6", 42, "trp_posseman"),
    (faction_set_slot, "fac_culture_6", 43, "trp_deputy_sheriff"),
    (faction_set_slot, "fac_culture_6", 44, "trp_pinkerton_agent"),
    (faction_set_slot, "fac_culture_6", 45, "trp_ranger"),
    (faction_set_slot, "fac_culture_7", 41, "trp_gambler"),
    (faction_set_slot, "fac_culture_7", 42, "trp_horse_thief"),
    (faction_set_slot, "fac_culture_7", 43, "trp_stagecoach_robber"),
    (faction_set_slot, "fac_culture_7", 44, "trp_thug"),
    (faction_set_slot, "fac_culture_7", 45, "trp_bank_robber"),
    (faction_set_slot, "fac_kingdom_1", 9, "fac_culture_1"),
    (faction_set_slot, "fac_kingdom_1", 10, "trp_kingdom_1_lord"),
    (faction_set_slot, "fac_kingdom_2", 9, "fac_culture_2"),
    (faction_set_slot, "fac_kingdom_2", 10, "trp_kingdom_2_lord"),
    (faction_set_slot, "fac_kingdom_3", 9, "fac_culture_3"),
    (faction_set_slot, "fac_kingdom_3", 10, "trp_kingdom_3_lord"),
    (faction_set_slot, "fac_kingdom_4", 9, "fac_culture_4"),
    (faction_set_slot, "fac_kingdom_4", 10, "trp_kingdom_4_lord"),
    (try_for_range, ":var24", "fac_kingdom_1", "fac_unused_1"),
      (faction_set_slot, ":var24", 100, 0),
      (faction_set_slot, ":var24", 101, 1),
      (faction_set_slot, ":var24", 102, 0),
      (faction_set_slot, ":var24", 103, 1),
      (faction_set_slot, ":var24", 104, 1),
      (faction_set_slot, ":var24", 105, 0),
      (faction_set_slot, ":var24", 106, 1),
    (try_end),
    (try_for_range, ":var4", 0, 70),
      (call_script, "script_randomly_start_war_peace", 0),
    (try_end),
    (try_for_range, ":var24", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_set_slot, ":var24", 7, -1),
      (faction_get_slot, ":var5", ":var24", 9),
      (faction_get_slot, ":var6", ":var5", 41),
      (faction_set_slot, ":var24", 41, ":var6"),
      (faction_get_slot, ":var6", ":var5", 42),
      (faction_set_slot, ":var24", 42, ":var6"),
      (faction_get_slot, ":var6", ":var5", 43),
      (faction_set_slot, ":var24", 43, ":var6"),
      (faction_get_slot, ":var6", ":var5", 44),
      (faction_set_slot, ":var24", 44, ":var6"),
      (faction_get_slot, ":var6", ":var5", 45),
      (faction_set_slot, ":var24", 45, ":var6"),
      (try_begin),
        (faction_slot_eq, ":var24", 9, "fac_culture_1"),
        (faction_set_slot, ":var24", 48, 0),
        (faction_set_slot, ":var24", 49, "trp_regular"),
        (faction_set_slot, ":var24", 50, "trp_volunteer"),
        (faction_set_slot, ":var24", 51, "trp_veteran_regular"),
        (faction_set_slot, ":var24", 52, "trp_cavalry_officer"),
        (faction_set_slot, ":var24", 77, "pt_kingdom_1_reinforcements_a"),
        (faction_set_slot, ":var24", 78, "pt_kingdom_1_reinforcements_b"),
        (faction_set_slot, ":var24", 79, "pt_kingdom_1_reinforcements_c"),
        (faction_set_slot, ":var24", 76, "pt_kingdom_1_reinforcements_d"),
      (else_try),
        (faction_slot_eq, ":var24", 9, "fac_culture_2"),
        (faction_set_slot, ":var24", 48, 0),
        (faction_set_slot, ":var24", 49, "trp_sargento"),
        (faction_set_slot, ":var24", 50, "trp_husar"),
        (faction_set_slot, ":var24", 51, "trp_oficial_de_los_dragones"),
        (faction_set_slot, ":var24", 52, "trp_supremos_poderes_caballero"),
        (faction_set_slot, ":var24", 77, "pt_kingdom_2_reinforcements_a"),
        (faction_set_slot, ":var24", 78, "pt_kingdom_2_reinforcements_b"),
        (faction_set_slot, ":var24", 79, "pt_kingdom_2_reinforcements_c"),
        (faction_set_slot, ":var24", 76, "pt_kingdom_2_reinforcements_d"),
      (else_try),
        (faction_slot_eq, ":var24", 9, "fac_culture_3"),
        (faction_set_slot, ":var24", 48, 0),
        (faction_set_slot, ":var24", 49, "trp_apache_thunder_brave"),
        (faction_set_slot, ":var24", 50, "trp_apache_mounted_brave"),
        (faction_set_slot, ":var24", 51, "trp_apache_thunder_warrior"),
        (faction_set_slot, ":var24", 52, "trp_apache_sun_dance_spirit"),
        (faction_set_slot, ":var24", 77, "pt_kingdom_3_reinforcements_a"),
        (faction_set_slot, ":var24", 78, "pt_kingdom_3_reinforcements_b"),
        (faction_set_slot, ":var24", 79, "pt_kingdom_3_reinforcements_c"),
      (else_try),
        (faction_slot_eq, ":var24", 9, "fac_culture_4"),
        (faction_set_slot, ":var24", 48, 0),
        (faction_set_slot, ":var24", 49, "trp_comanche_horse_archer"),
        (faction_set_slot, ":var24", 50, "trp_comanche_fire_rider"),
        (faction_set_slot, ":var24", 51, "trp_comanche_wind_rider"),
        (faction_set_slot, ":var24", 52, "trp_comanche_shaman"),
        (faction_set_slot, ":var24", 77, "pt_kingdom_4_reinforcements_a"),
        (faction_set_slot, ":var24", 78, "pt_kingdom_4_reinforcements_b"),
        (faction_set_slot, ":var24", 79, "pt_kingdom_4_reinforcements_c"),
      (else_try),
        (faction_slot_eq, ":var24", 9, "fac_culture_5"),
        (faction_set_slot, ":var24", 48, 0),
        (faction_set_slot, ":var24", 49, "trp_cut_throat"),
        (faction_set_slot, ":var24", 50, "trp_rustler"),
        (faction_set_slot, ":var24", 51, "trp_pistolero"),
        (faction_set_slot, ":var24", 52, "trp_desperado"),
        (faction_set_slot, ":var24", 77, "pt_kingdom_5_reinforcements_a"),
        (faction_set_slot, ":var24", 78, "pt_kingdom_5_reinforcements_b"),
        (faction_set_slot, ":var24", 79, "pt_kingdom_5_reinforcements_c"),
      (else_try),
        (faction_slot_eq, ":var24", 9, "fac_culture_6"),
        (faction_set_slot, ":var24", 48, 0),
        (faction_set_slot, ":var24", 49, "trp_state_militia"),
        (faction_set_slot, ":var24", 50, "trp_pinkerton_agent"),
        (faction_set_slot, ":var24", 51, "trp_deputy_marshal"),
        (faction_set_slot, ":var24", 52, "trp_ranger"),
        (faction_set_slot, ":var24", 77, "pt_kingdom_6_reinforcements_a"),
        (faction_set_slot, ":var24", 78, "pt_kingdom_6_reinforcements_b"),
        (faction_set_slot, ":var24", 79, "pt_kingdom_6_reinforcements_c"),
      (else_try),
        (faction_slot_eq, ":var24", 9, "fac_culture_7"),
        (faction_set_slot, ":var24", 48, 0),
        (faction_set_slot, ":var24", 49, "trp_thug"),
        (faction_set_slot, ":var24", 50, "trp_train_robber"),
        (faction_set_slot, ":var24", 51, "trp_bank_robber"),
        (faction_set_slot, ":var24", 52, "trp_gunslinger"),
        (faction_set_slot, ":var24", 77, "pt_kingdom_7_reinforcements_a"),
        (faction_set_slot, ":var24", 78, "pt_kingdom_7_reinforcements_b"),
        (faction_set_slot, ":var24", 79, "pt_kingdom_7_reinforcements_c"),
      (try_end),
    (try_end),
    (faction_set_slot, "fac_player_supporters_faction", 7, "trp_player"),
    (try_for_range, ":var25", "itm_smoked_fish", "itm_gold_bar"),
      (store_sub, ":var26", ":var25", "itm_smoked_fish"),
      (val_add, ":var26", 234),
      (try_for_range, ":var27", "p_town_1", "p_salt_mine"),
        (party_set_slot, ":var27", ":var26", 1000),
      (try_end),
    (try_end),
    (call_script, "script_set_trade_route_between_centers", "p_town_1", "p_town_2"),
    (call_script, "script_set_trade_route_between_centers", "p_town_1", "p_town_4"),
    (call_script, "script_set_trade_route_between_centers", "p_town_1", "p_town_8"),
    (call_script, "script_set_trade_route_between_centers", "p_town_2", "p_town_4"),
    (call_script, "script_set_trade_route_between_centers", "p_town_2", "p_town_6"),
    (call_script, "script_set_trade_route_between_centers", "p_town_2", "p_town_8"),
    (call_script, "script_set_trade_route_between_centers", "p_town_3", "p_town_4"),
    (call_script, "script_set_trade_route_between_centers", "p_town_3", "p_town_5"),
    (call_script, "script_set_trade_route_between_centers", "p_town_3", "p_town_6"),
    (call_script, "script_set_trade_route_between_centers", "p_town_3", "p_town_7"),
    (call_script, "script_set_trade_route_between_centers", "p_town_4", "p_town_6"),
    (call_script, "script_set_trade_route_between_centers", "p_town_5", "p_town_6"),
    (call_script, "script_set_trade_route_between_centers", "p_town_5", "p_town_7"),
    (call_script, "script_set_trade_route_between_centers", "p_town_6", "p_town_7"),
    (try_for_range, ":var28", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var28", 151, 4),
      (party_set_slot, ":var28", 152, 8),
    (try_end),
    (party_set_slot, "p_town_6", 152, 2),
    (try_for_range, ":var28", "p_town_1", "p_castle_1"),
      (store_random_in_range, ":var29", 0, 100),
      (lt, ":var29", 20),
      (store_random_in_range, ":var30", 12, 15),
      (party_set_slot, ":var28", 150, ":var30"),
    (try_end),
    (party_set_slot, "p_town_1", 80, 2),
    (party_set_slot, "p_town_1", 81, 1),
    (party_set_slot, "p_town_1", 82, 4),
    (party_set_slot, "p_town_1", 83, 1),
    (party_set_slot, "p_town_1", 84, 4),
    (party_set_slot, "p_town_1", 85, 1),
    (call_script, "script_center_change_trade_good_production", "p_town_1", "itm_linen", 110, 0),
    (party_set_slot, "p_town_2", 80, 4),
    (party_set_slot, "p_town_2", 81, 4),
    (party_set_slot, "p_town_2", 82, 4),
    (party_set_slot, "p_town_2", 83, 6),
    (party_set_slot, "p_town_2", 84, 4),
    (party_set_slot, "p_town_2", 85, 8),
    (call_script, "script_center_change_trade_good_production", "p_town_2", "itm_smoked_fish", 130, 0),
    (party_set_slot, "p_town_3", 80, 2),
    (party_set_slot, "p_town_3", 81, 8),
    (party_set_slot, "p_town_3", 82, 2),
    (party_set_slot, "p_town_3", 83, 8),
    (party_set_slot, "p_town_3", 84, 2),
    (party_set_slot, "p_town_3", 85, 8),
    (call_script, "script_center_change_trade_good_production", "p_town_3", "itm_wine", 120, 0),
    (party_set_slot, "p_town_4", 80, 2),
    (party_set_slot, "p_town_4", 81, 8),
    (party_set_slot, "p_town_4", 82, 3),
    (party_set_slot, "p_town_4", 83, 8),
    (party_set_slot, "p_town_4", 84, 2),
    (party_set_slot, "p_town_4", 85, 5),
    (call_script, "script_center_change_trade_good_production", "p_town_4", "itm_fire_wood", 130, 0),
    (party_set_slot, "p_town_5", 80, 2),
    (party_set_slot, "p_town_5", 81, 3),
    (party_set_slot, "p_town_5", 82, 2),
    (party_set_slot, "p_town_5", 83, 5),
    (party_set_slot, "p_town_5", 84, 2),
    (party_set_slot, "p_town_5", 85, 8),
    (call_script, "script_center_change_trade_good_production", "p_town_5", "itm_velvet", 80, 0),
    (party_set_slot, "p_town_6", 80, 2),
    (party_set_slot, "p_town_6", 81, 4),
    (party_set_slot, "p_town_6", 82, 3),
    (party_set_slot, "p_town_6", 83, 4),
    (party_set_slot, "p_town_6", 84, 3),
    (party_set_slot, "p_town_6", 85, 6),
    (call_script, "script_center_change_trade_good_production", "p_town_6", "itm_ale", 130, 0),
    (party_set_slot, "p_town_7", 80, 4),
    (party_set_slot, "p_town_7", 81, 4),
    (party_set_slot, "p_town_7", 82, 4),
    (party_set_slot, "p_town_7", 83, 6),
    (party_set_slot, "p_town_7", 84, 4),
    (party_set_slot, "p_town_7", 85, 8),
    (call_script, "script_center_change_trade_good_production", "p_town_7", "itm_grain", 140, 0),
    (call_script, "script_center_change_trade_good_production", "p_town_7", "itm_flour", 110, 0),
    (try_for_range, ":var4", 0, 1),
      (call_script, "script_average_trade_good_productions"),
    (try_end),
    (call_script, "script_normalize_trade_good_productions"),
    (try_for_range, ":var28", "p_town_1", "p_castle_1"),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_smoked_fish", -12, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_dried_meat", -12, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_cattle_meat", -15, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_cheese", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_chicken", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_honey", -9, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_cabbages", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_butter", -12, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_wine", -14, 2),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_flour", -13, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_ale", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_apples", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_grain", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_iron", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_wool", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_furs", -10, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_fire_wood", -12, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_velvet", -3, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_spice", -5, 3),
      (call_script, "script_center_change_trade_good_production", ":var28", "itm_linen", -3, 3),
    (try_end),
    (try_for_range, ":var28", "p_town_1", "p_castle_1"),
      (store_sub, ":var26", ":var28", "p_town_1"),
      (party_set_slot, ":var28", 0, 3),
      (store_add, ":var31", "scn_town_1_center", ":var26"),
      (party_set_slot, ":var28", 10, ":var31"),
      (store_add, ":var31", "scn_town_1_castle", ":var26"),
      (party_set_slot, ":var28", 11, ":var31"),
      (store_add, ":var31", "scn_town_1_prison", ":var26"),
      (party_set_slot, ":var28", 12, ":var31"),
      (store_add, ":var31", "scn_town_1_walls", ":var26"),
      (party_set_slot, ":var28", 18, ":var31"),
      (store_add, ":var31", "scn_town_1_tavern", ":var26"),
      (party_set_slot, ":var28", 13, ":var31"),
      (store_add, ":var31", "scn_town_1_store", ":var26"),
      (party_set_slot, ":var28", 14, ":var31"),
      (store_add, ":var31", "scn_town_1_arena", ":var26"),
      (party_set_slot, ":var28", 16, ":var31"),
      (store_add, ":var31", "scn_town_1_alley", ":var26"),
      (party_set_slot, ":var28", 17, ":var31"),
      (store_add, ":var31", "trp_town_1_mayor", ":var26"),
      (party_set_slot, ":var28", 25, ":var31"),
      (store_add, ":var31", "trp_town_1_tavernkeeper", ":var26"),
      (party_set_slot, ":var28", 20, ":var31"),
      (store_add, ":var31", "trp_town_1_weaponsmith", ":var26"),
      (party_set_slot, ":var28", 21, ":var31"),
      (store_add, ":var31", "trp_town_1_armorer", ":var26"),
      (party_set_slot, ":var28", 22, ":var31"),
      (store_add, ":var31", "trp_town_1_merchant", ":var26"),
      (party_set_slot, ":var28", 23, ":var31"),
      (store_add, ":var31", "trp_town_1_horse_merchant", ":var26"),
      (party_set_slot, ":var28", 24, ":var31"),
      (store_add, ":var31", "scn_town_1_center", ":var26"),
      (party_set_slot, ":var28", 10, ":var31"),
      (party_set_slot, ":var28", 60, "pt_center_reinforcements"),
    (try_end),
    (try_for_range, ":var32", "p_castle_1", "p_village_1"),
      (store_sub, ":var26", ":var32", "p_castle_1"),
      (val_mul, ":var26", 3),
      (store_add, ":var33", "scn_castle_1_exterior", ":var26"),
      (party_set_slot, ":var32", 10, ":var33"),
      (store_add, ":var34", "scn_castle_1_interior", ":var26"),
      (party_set_slot, ":var32", 11, ":var34"),
      (store_add, ":var34", "scn_castle_1_prison", ":var26"),
      (party_set_slot, ":var32", 12, ":var34"),
      (party_set_slot, ":var32", 60, "pt_center_reinforcements"),
      (party_set_slot, ":var32", 0, 2),
      (party_set_slot, ":var32", 54, -1),
    (try_end),
    (party_set_slot, "p_town_1", 27, 0),
    (party_set_slot, "p_castle_1", 27, 0),
    (party_set_slot, "p_castle_2", 27, 1),
    (party_set_slot, "p_castle_3", 27, 0),
    (party_set_slot, "p_castle_4", 27, 1),
    (party_set_slot, "p_castle_5", 27, 0),
    (party_set_slot, "p_castle_6", 27, 0),
    (party_set_slot, "p_castle_7", 27, 1),
    (party_set_slot, "p_castle_8", 27, 1),
    (party_set_slot, "p_castle_9", 27, 0),
    (party_set_slot, "p_castle_10", 27, 0),
    (party_set_slot, "p_castle_11", 27, 1),
    (try_for_range, ":var35", "p_village_1", "p_salt_mine"),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_dried_meat", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_pork", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_bread", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_apples", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_cheese", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_chicken", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_honey", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_cabbages", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_butter", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_wine", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_flour", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_ale", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_apples", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_grain", ":var29", 0),
      (store_random_in_range, ":var29", -5, 18),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_fire_wood", ":var29", 0),
    (try_end),
    (try_for_range, ":var35", "p_village_1", "p_salt_mine"),
      (store_random_in_range, ":var36", 0, 5),
      (party_set_slot, ":var35", 44, ":var36"),
      (store_random_in_range, ":var37", 25, 75),
      (party_set_slot, ":var35", 45, ":var37"),
      (store_sub, ":var38", ":var37", 10),
      (val_div, ":var38", 2),
      (call_script, "script_center_change_trade_good_production", ":var35", "itm_cattle_meat", ":var38", 0),
      (store_sub, ":var26", ":var35", "p_village_1"),
      (store_add, ":var33", "scn_village_1", ":var26"),
      (party_set_slot, ":var35", 10, ":var33"),
      (store_add, ":var39", "trp_village_1_elder", ":var26"),
      (party_set_slot, ":var35", 25, ":var39"),
      (party_set_slot, ":var35", 0, 4),
      (party_set_slot, ":var35", 34, -1),
      (call_script, "script_refresh_village_merchant_inventory", ":var35"),
      (call_script, "script_refresh_village_merchant_inventory", ":var35"),
    (try_end),
    (try_for_range, ":var27", "p_town_1", "p_salt_mine"),
      (party_set_slot, ":var27", 55, -1),
      (party_set_slot, ":var27", 54, -1),
      (party_set_slot, ":var27", 28, -1),
      (store_random_in_range, ":var40", -25, 15),
      (call_script, "script_get_center_ideal_prosperity", ":var27"),
      (assign, ":var41", reg0),
      (val_add, ":var41", ":var40"),
      (try_begin),
        (party_slot_eq, ":var27", 0, 3),
        (val_add, ":var41", 20),
      (try_end),
      (val_clamp, ":var41", 0, 100),
      (party_set_slot, ":var27", 50, ":var41"),
    (try_end),
    (try_for_range, ":var27", "p_town_1", "p_salt_mine"),
      (this_or_next|party_slot_eq, ":var27", 0, 3),
      (party_slot_eq, ":var27", 0, 4),
      (try_for_range, ":var42", 0, 8),
        (call_script, "script_center_set_walker_to_type", ":var27", ":var42", 0),
      (try_end),
    (try_end),
    (assign, ":var43", 0),
    (assign, ":var44", 0),
    (assign, ":var45", 0),
    (assign, ":var46", 0),
    (assign, ":var47", 0),
    (assign, ":var48", 0),
    (assign, ":var49", 0),
    (assign, ":var50", 0),
    (try_for_range, ":var51", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (store_troop_faction, ":var13", ":var51"),
      (try_begin),
        (le, ":var43", 3),
        (store_add, ":var52", "spr_banner_a", 0),
        (store_add, ":var53", ":var52", ":var43"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var43", 1),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_1"),
        (store_add, ":var54", "spr_banner_a", 4),
        (store_add, ":var53", ":var54", ":var44"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var44", 1),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_2"),
        (store_add, ":var55", "spr_banner_a", 15),
        (store_add, ":var53", ":var55", ":var45"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var45", 1),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_3"),
        (store_add, ":var56", "spr_banner_a", 26),
        (store_add, ":var53", ":var56", ":var46"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var46", 1),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_4"),
        (store_add, ":var57", "spr_banner_a", 37),
        (store_add, ":var53", ":var57", ":var47"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var47", 1),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_5"),
        (store_add, ":var58", "spr_banner_a", 48),
        (store_add, ":var53", ":var58", ":var48"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var48", 1),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_6"),
        (store_add, ":var59", "spr_banner_a", 69),
        (store_add, ":var53", ":var59", ":var49"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var49", 1),
      (else_try),
        (faction_slot_eq, ":var13", 9, "fac_culture_7"),
        (store_add, ":var60", "spr_banner_a", 90),
        (store_add, ":var53", ":var60", ":var50"),
        (troop_set_slot, ":var51", 13, ":var53"),
        (val_add, ":var50", 1),
      (try_end),
      (store_character_level, ":var61", ":var51"),
      (store_mul, ":var62", ":var61", ":var61"),
      (val_div, ":var62", 2),
      (try_begin),
        (faction_slot_eq, ":var13", 10, ":var51"),
        (troop_set_slot, ":var51", 15, 100),
        (store_random_in_range, ":var63", 250, 400),
      (else_try),
        (store_random_in_range, ":var64", 50, 100),
        (troop_set_slot, ":var51", 15, ":var64"),
        (store_random_in_range, ":var63", 100, 200),
      (try_end),
      (val_add, ":var62", ":var63"),
      (troop_set_slot, ":var51", 7, ":var62"),
      (store_random_in_range, ":var65", 0, 100),
      (troop_set_slot, ":var51", 57, ":var65"),
      (troop_set_slot, ":var51", 58, 100),
      (troop_set_slot, ":var51", 16, -1),
      (troop_set_slot, ":var51", 17, -1),
    (try_end),
    (troop_get_slot, ":var66", "trp_player", 13),
    (assign, ":var67", "trp_knight_1_1_wife"),
    (try_for_range, ":var16", "trp_kingdom_1_lord", ":var67"),
      (troop_slot_eq, ":var16", 13, ":var66"),
      (troop_set_slot, ":var16", 13, "spr_banner_f21"),
      (assign, ":var67", 0),
    (try_end),
    (call_script, "script_give_center_to_lord", "p_town_1", "trp_kingdom_1_lord", 0),
    (call_script, "script_give_center_to_lord", "p_town_2", "trp_knight_1_1", 0),
    (call_script, "script_give_center_to_lord", "p_town_3", "trp_knight_1_2", 0),
    (call_script, "script_give_center_to_lord", "p_town_4", "trp_kingdom_2_lord", 0),
    (call_script, "script_give_center_to_lord", "p_town_5", "trp_knight_2_1", 0),
    (call_script, "script_give_center_to_lord", "p_town_6", "trp_knight_2_2", 0),
    (call_script, "script_give_center_to_lord", "p_town_7", "trp_kingdom_4_lord", 0),
    (call_script, "script_give_center_to_lord", "p_town_8", "trp_kingdom_3_lord", 0),
    (call_script, "script_give_center_to_faction_aux", "p_castle_1", "fac_kingdom_1"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_2", "fac_kingdom_1"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_3", "fac_kingdom_1"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_4", "fac_kingdom_1"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_5", "fac_kingdom_2"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_6", "fac_kingdom_4"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_7", "fac_kingdom_2"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_8", "fac_kingdom_2"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_9", "fac_kingdom_3"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_10", "fac_kingdom_3"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_11", "fac_kingdom_4"),
    (call_script, "script_give_center_to_faction_aux", "p_castle_12", "fac_kingdom_2"),
    (try_for_range, ":var68", "p_castle_1", "p_village_1"),
      (assign, ":var69", 999999),
      (assign, ":var70", -1),
      (try_for_range, ":var71", "p_village_1", "p_salt_mine"),
        (neg|party_slot_ge, ":var71", 120, 1),
        (store_distance_to_party_from_party, ":var72", ":var71", ":var68"),
        (lt, ":var72", ":var69"),
        (assign, ":var69", ":var72"),
        (assign, ":var70", ":var71"),
      (try_end),
      (party_set_slot, ":var70", 120, ":var68"),
      (store_faction_of_party, ":var73", ":var68"),
      (call_script, "script_give_center_to_faction_aux", ":var70", ":var73"),
    (try_end),
    (try_for_range, ":var71", "p_village_1", "p_salt_mine"),
      (neg|party_slot_ge, ":var71", 120, 1),
      (assign, ":var69", 999999),
      (assign, ":var74", -1),
      (try_for_range, ":var75", "p_town_1", "p_castle_1"),
        (store_distance_to_party_from_party, ":var72", ":var71", ":var75"),
        (store_faction_of_party, ":var0", ":var75"),
        (neg|faction_slot_eq, ":var0", 100, 1),
        (lt, ":var72", ":var69"),
        (assign, ":var69", ":var72"),
        (assign, ":var74", ":var75"),
      (try_end),
      (party_set_slot, ":var71", 120, ":var74"),
      (store_faction_of_party, ":var73", ":var74"),
      (call_script, "script_give_center_to_faction_aux", ":var71", ":var73"),
    (try_end),
    (party_set_slot, "p_bank_1", 120, "p_town_1b"),
    (store_faction_of_party, ":var73", "p_town_1b"),
    (call_script, "script_give_center_to_faction_aux", "p_bank_1", ":var73"),
    (troop_set_slot, "trp_party_source_party", "p_bank_1", "p_town_1"),
    (party_set_slot, "p_bank_2", 120, "p_town_5b"),
    (store_faction_of_party, ":var73", "p_town_5b"),
    (call_script, "script_give_center_to_faction_aux", "p_bank_2", ":var73"),
    (troop_set_slot, "trp_party_source_party", "p_bank_2", "p_town_5"),
    (party_set_slot, "p_village_26", 120, "p_town_3b"),
    (store_faction_of_party, ":var73", "p_town_3b"),
    (call_script, "script_give_center_to_faction_aux", "p_village_26", ":var73"),
    (party_set_slot, "p_village_16", 120, "p_town_4"),
    (store_faction_of_party, ":var73", "p_town_4"),
    (call_script, "script_give_center_to_faction_aux", "p_village_16", ":var73"),
    (troop_set_slot, "trp_party_source_party", "p_town_1b", "p_town_1"),
    (troop_set_slot, "trp_party_source_party", "p_town_1b", "p_town_1"),
    (troop_set_slot, "trp_party_source_party", "p_town_2b", "p_town_2"),
    (troop_set_slot, "trp_party_source_party", "p_town_3b", "p_town_3"),
    (troop_set_slot, "trp_party_source_party", "p_town_4b", "p_town_4"),
    (troop_set_slot, "trp_party_source_party", "p_town_5b", "p_town_5"),
    (troop_set_slot, "trp_party_source_party", "p_town_6b", "p_town_6"),
    (troop_set_slot, "trp_party_source_party", "p_village_7b", "p_village_7"),
    (troop_set_slot, "trp_party_source_party", "p_village_9b", "p_village_9"),
    (troop_set_slot, "trp_party_source_party", "p_village_17b", "p_village_17"),
    (try_for_range, ":var27", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var76", ":var27"),
      (faction_get_slot, ":var5", ":var76", 9),
      (party_set_slot, ":var27", 19, ":var5"),
      (party_set_slot, ":var27", 61, ":var76"),
      (party_set_slot, ":var27", 62, ":var76"),
    (try_end),
    (call_script, "script_update_village_market_towns"),
    (troop_set_slot, "trp_knight_1_1", 30, "trp_knight_1_1_wife"),
    (troop_set_slot, "trp_knight_2_1", 30, "trp_knight_2_1_wife"),
    (troop_set_slot, "trp_knight_3_1", 30, "trp_knight_3_1_wife"),
    (troop_set_slot, "trp_knight_4_1", 30, "trp_knight_4_1_wife"),
    (troop_set_slot, "trp_knight_5_1", 30, "trp_knight_5_1_wife"),
    (troop_set_slot, "trp_knight_1_2", 30, "trp_knight_1_2_wife"),
    (troop_set_slot, "trp_knight_2_2", 30, "trp_knight_2_2_wife"),
    (troop_set_slot, "trp_knight_3_2", 30, "trp_knight_3_2_wife"),
    (troop_set_slot, "trp_knight_4_2", 30, "trp_knight_4_2_wife"),
    (troop_set_slot, "trp_knight_5_2", 30, "trp_knight_5_2_wife"),
    (troop_set_slot, "trp_knight_1_3", 30, "trp_knight_1_1_daughter"),
    (troop_set_slot, "trp_knight_2_3", 30, "trp_knight_2_1_daughter"),
    (troop_set_slot, "trp_knight_3_3", 30, "trp_knight_3_1_daughter"),
    (troop_set_slot, "trp_knight_4_3", 30, "trp_knight_4_1_daughter"),
    (troop_set_slot, "trp_knight_5_3", 30, "trp_knight_5_1_daughter"),
    (troop_set_slot, "trp_knight_1_4", 30, "trp_knight_1_2_daughter"),
    (troop_set_slot, "trp_knight_2_4", 30, "trp_knight_2_2_daughter"),
    (troop_set_slot, "trp_knight_3_4", 30, "trp_knight_3_2_daughter"),
    (troop_set_slot, "trp_knight_4_4", 30, "trp_knight_4_2_daughter"),
    (troop_set_slot, "trp_knight_5_4", 30, "trp_knight_5_2_daughter"),
    (try_for_range, ":var77", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (try_begin),
        (store_troop_faction, ":var78", ":var77"),
        (is_between, ":var78", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (troop_set_slot, ":var77", 14, ":var78"),
        (try_begin),
          (is_between, ":var77", 0, 0),
          (faction_set_slot, ":var78", 60, 1),
        (else_try),
          (troop_set_slot, ":var77", 2, 2),
        (try_end),
      (try_end),
      (assign, ":var79", 6000),
      (try_begin),
        (store_troop_faction, ":var0", ":var77"),
        (faction_slot_eq, ":var0", 10, ":var77"),
        (assign, ":var79", 20000),
      (try_end),
      (troop_set_slot, ":var77", 11, ":var79"),
    (try_end),
    (try_for_range, ":var27", "p_town_1", "p_village_1"),
      (try_begin),
        (is_between, ":var27", "p_town_1b", "p_castle_1"),
        (assign, ":var79", 1000),
      (else_try),
        (assign, ":var79", 2000),
      (try_end),
      (try_begin),
        (is_between, ":var27", "p_town_1", "p_castle_1"),
        (val_mul, ":var79", 2),
      (try_end),
      (party_set_slot, ":var27", 49, ":var79"),
      (assign, ":var80", 3),
      (try_begin),
        (party_slot_eq, ":var27", 0, 3),
        (try_begin),
          (is_between, ":var27", "p_town_1b", "p_castle_1"),
          (assign, ":var80", 3),
        (else_try),
          (assign, ":var80", 7),
        (try_end),
      (try_end),
      (try_for_range, ":var4", 0, ":var80"),
        (call_script, "script_cf_reinforce_party", ":var27"),
      (try_end),
      (store_div, ":var81", ":var80", 8),
      (val_add, ":var81", 4),
      (try_for_range, ":var4", 0, ":var81"),
        (store_random_in_range, ":var82", 7000, 9000),
        (party_upgrade_with_xp, ":var27", ":var82", 0),
      (try_end),
      (call_script, "script_center_get_food_store_limit", ":var27"),
      (assign, ":var83", reg0),
      (val_div, ":var83", 2),
      (party_set_slot, ":var27", 53, ":var83"),
      (party_get_slot, ":var84", ":var27", 7),
      (ge, ":var84", 1),
      (troop_slot_eq, ":var84", 10, 0),
      (call_script, "script_create_kingdom_hero_party", ":var84", ":var27"),
      (assign, ":var85", "$pout_party"),
      (party_attach_to_party, ":var85", ":var27"),
      (party_set_slot, ":var27", 51, 1000),
    (try_end),
    (call_script, "script_complete_family_relations"),
    (call_script, "script_complete_family_relations"),
    (try_for_range, ":var77", "trp_knight_1_1_wife", "trp_heroes_end"),
      (troop_set_slot, ":var77", 2, 4),
      (troop_get_slot, ":var86", ":var77", 31),
      (try_begin),
        (eq, ":var86", 0),
        (troop_get_slot, ":var86", ":var77", 30),
      (try_end),
      (try_begin),
        (gt, ":var86", 0),
        (call_script, "script_get_troop_attached_party", ":var86"),
        (assign, ":var68", reg0),
        (gt, ":var68", 0),
        (troop_set_slot, ":var77", 12, ":var68"),
      (else_try),
        (store_troop_faction, ":var24", ":var77"),
        (call_script, "script_cf_select_random_walled_center_with_faction", ":var24", -1),
        (assign, ":var68", reg0),
        (troop_set_slot, ":var77", 12, ":var68"),
      (try_end),
    (try_end),
    (try_for_range, ":var77", "trp_kingdom_1_lord", "trp_heroes_end"),
      (troop_slot_eq, ":var77", 2, 4),
      (troop_get_slot, ":var87", ":var77", 31),
      (gt, ":var87", 0),
      (store_random_in_range, ":var21", 0, 100),
      (le, ":var21", 80),
      (call_script, "script_cf_get_random_kingdom_hero_as_lover", ":var77"),
      (assign, ":var88", reg0),
      (troop_set_slot, ":var77", 36, ":var88"),
      (troop_set_slot, ":var88", 36, ":var77"),
    (try_end),
    (try_for_range, ":var77", "trp_kingdom_1_lord", "trp_heroes_end"),
      (troop_get_slot, ":var89", ":var77", 30),
      (troop_get_slot, ":var90", ":var77", 35),
      (troop_get_slot, ":var91", ":var77", 33),
      (troop_get_slot, ":var92", ":var77", 34),
      (troop_get_slot, ":var93", ":var77", 31),
      (troop_get_slot, ":var94", ":var77", 32),
      (troop_get_slot, ":var95", ":var77", 36),
      (store_troop_faction, ":var96", ":var77"),
      (assign, ":var97", 0),
      (try_for_range, ":var98", 40, 45),
        (troop_slot_ge, ":var77", ":var98", 1),
        (val_add, ":var97", 1),
      (try_end),
      (try_for_range, ":var98", 40, 45),
        (troop_set_slot, ":var77", ":var98", -1),
      (try_end),
      (store_random_in_range, ":var99", 0, 4),
      (val_add, ":var99", ":var97"),
      (val_min, ":var99", 5),
      (try_for_range, ":var4", ":var97", ":var99"),
        (assign, ":var100", 0),
        (try_for_range, ":var101", "trp_kingdom_1_lord", "trp_heroes_end"),
          (neq, ":var101", ":var77"),
          (neq, ":var101", ":var89"),
          (neq, ":var101", ":var90"),
          (neq, ":var101", ":var91"),
          (neq, ":var101", ":var92"),
          (neq, ":var101", ":var93"),
          (neq, ":var101", ":var94"),
          (neq, ":var101", ":var95"),
          (store_troop_faction, ":var102", ":var101"),
          (eq, ":var102", ":var96"),
          (assign, ":var103", 0),
          (try_for_range, ":var104", 40, 45),
            (troop_slot_eq, ":var77", ":var104", ":var101"),
            (assign, ":var103", 1),
          (try_end),
          (eq, ":var103", 0),
          (val_add, ":var100", 1),
        (try_end),
        (store_random_in_range, ":var105", 0, ":var100"),
        (assign, ":var100", 0),
        (assign, ":var106", -1),
        (try_for_range, ":var101", "trp_kingdom_1_lord", "trp_heroes_end"),
          (eq, ":var106", -1),
          (neq, ":var101", ":var77"),
          (neq, ":var101", ":var89"),
          (neq, ":var101", ":var90"),
          (neq, ":var101", ":var91"),
          (neq, ":var101", ":var92"),
          (neq, ":var101", ":var93"),
          (neq, ":var101", ":var94"),
          (neq, ":var101", ":var95"),
          (store_troop_faction, ":var102", ":var101"),
          (eq, ":var102", ":var96"),
          (assign, ":var103", 0),
          (try_for_range, ":var104", 40, 45),
            (troop_slot_eq, ":var77", ":var104", ":var101"),
            (assign, ":var103", 1),
          (try_end),
          (eq, ":var103", 0),
          (val_add, ":var100", 1),
          (gt, ":var100", ":var105"),
          (assign, ":var106", ":var101"),
        (try_end),
        (gt, ":var106", 0),
        (assign, ":var107", 0),
        (try_for_range, ":var98", 40, 45),
          (troop_slot_ge, ":var106", ":var98", 1),
          (val_add, ":var107", 1),
        (try_end),
        (lt, ":var107", 5),
        (assign, ":var97", 0),
        (try_for_range, ":var98", 40, 45),
          (troop_slot_ge, ":var77", ":var98", 1),
          (val_add, ":var97", 1),
        (try_end),
        (store_add, ":var108", 40, ":var97"),
        (troop_set_slot, ":var77", ":var108", ":var106"),
        (store_add, ":var108", 40, ":var107"),
        (troop_set_slot, ":var106", ":var108", ":var77"),
      (try_end),
    (try_end),
    (try_for_range, ":var4", 0, 11),
      (call_script, "script_spawn_bandits"),
    (try_end),
    (set_spawn_radius, 50),
    (try_for_range, ":var4", 0, 30),
      (spawn_around_party, "p_main_party", "pt_looters"),
    (try_end),
    (try_for_range, ":var4", 0, 6),
      (call_script, "script_update_trade_good_prices"),
    (try_end),
    (call_script, "script_assign_lords_to_empty_centers"),
    (call_script, "script_update_mercenary_units_of_towns"),
    (call_script, "script_update_companion_candidates_in_taverns"),
    (try_for_range, ":var35", "p_village_1", "p_salt_mine"),
      (call_script, "script_update_volunteer_troops_in_village", ":var35"),
    (try_end),
    (try_for_range, ":var28", "p_town_1", "p_castle_1"),
      (call_script, "script_update_volunteer_troops_in_towns", ":var28"),
    (try_end),
    (try_for_range, ":var28", "p_castle_1", "p_village_1"),
      (call_script, "script_update_volunteer_troops_in_castles", ":var28"),
    (try_end),
    (try_for_range, ":var109", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (call_script, "script_update_faction_notes", ":var109"),
      (store_random_in_range, ":var21", -60, 0),
      (faction_set_slot, ":var24", 6, ":var21"),
    (try_end),
    (try_for_range, ":var16", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (call_script, "script_update_troop_notes", ":var16"),
    (try_end),
    (try_for_range, ":var68", "p_town_1", "p_salt_mine"),
      (call_script, "script_update_center_notes", ":var68"),
    (try_end),
    (call_script, "script_update_troop_notes", "trp_player"),
    (try_for_range, ":var24", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (call_script, "script_faction_recalculate_strength", ":var24"),
    (try_end),
    (call_script, "script_get_player_party_morale_values"),
    (party_set_morale, "p_main_party", reg0),
    (try_for_range, ":var110", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var110", 2, 2),
      (neg|troop_slot_ge, ":var110", 8, 0),
      (neg|troop_slot_ge, ":var110", 10, 1),
      (store_troop_faction, ":var15", ":var110"),
      (try_begin),
        (call_script, "script_cf_select_random_walled_center_with_faction_and_owner_priority_no_siege", ":var15", ":var110"),
        (assign, ":var27", reg0),
        (call_script, "script_create_kingdom_hero_party", ":var110", ":var27"),
        (party_attach_to_party, "$pout_party", ":var27"),
      (else_try),
        (call_script, "script_cf_select_random_town_at_peace_with_faction", ":var15"),
        (assign, ":var27", reg0),
        (call_script, "script_create_kingdom_hero_party", ":var110", ":var27"),
        (party_attach_to_party, "$pout_party", ":var27"),
      (try_end),
    (try_end),
    (call_script, "script_update_fugitive_quest"),
    (call_script, "script_setup_wanted_fugitive_quest"),
    (party_set_slot, "p_village_26", 25, "trp_jansen"),
    (try_for_range, ":var27", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var27", 0, 3),
      (try_for_range, ":var111", 250, 255),
        (store_random_in_range, ":var6", "trp_tavern_visitor_1", "trp_local_merchant"),
        (party_set_slot, ":var27", ":var111", ":var6"),
      (try_end),
    (try_end),
  ]),

  ("game_event_party_encounter",
  [
    (assign, "$spawn_bottle_troops", 0),
    (store_script_param_1, "$g_encountered_party"),
    (store_script_param_2, "$g_encountered_party_2"),
    (store_faction_of_party, "$g_encountered_party_faction", "$g_encountered_party"),
    (store_relation, "$g_encountered_party_relation", "$g_encountered_party_faction", "fac_player_faction"),
    (party_get_slot, "$g_encountered_party_type", "$g_encountered_party", 0),
    (party_get_template_id, "$g_encountered_party_template", "$g_encountered_party"),
    (call_script, "script_party_count_fit_regulars", "p_main_party"),
    (assign, "$playerparty_prebattle_regulars", reg0),
    (assign, "$g_last_rest_center", -1),
    (assign, "$talk_context", 0),
    (assign, "$g_player_surrenders", 0),
    (assign, "$g_enemy_surrenders", 0),
    (assign, "$g_leave_encounter", 0),
    (assign, "$g_engaged_enemy", 0),
    (try_begin),
      (neg|is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
      (rest_for_hours, 0),
    (try_end),
    (assign, "$new_encounter", 1),
    (try_begin),
      (lt, "$g_encountered_party_2", 0),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (jump_to_menu, "mnu_castle_outside"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 21),
        (jump_to_menu, "mnu_ambushed_encounter_pre_battle"),
      (else_try),
        (party_get_template_id, ":var0", "$g_encountered_party"),
        (eq, ":var0", "pt_deer_herd"),
        (jump_to_menu, "mnu_deer_herd"),
      (else_try),
        (party_get_template_id, ":var0", "$g_encountered_party"),
        (eq, ":var0", "pt_buffalo_herd"),
        (jump_to_menu, "mnu_buffalo_herd"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (jump_to_menu, "mnu_castle_outside"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 16),
        (jump_to_menu, "mnu_ship_reembark"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (jump_to_menu, "mnu_village"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 17),
        (jump_to_menu, "mnu_cattle_herd"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 20),
        (jump_to_menu, "mnu_horses_herd"),
      (else_try),
        (is_between, "$g_encountered_party", "p_training_ground_1", "p_forest_bandit_spawn_point_1"),
        (jump_to_menu, "mnu_training_ground"),
      (else_try),
        (eq, "$g_encountered_party", "p_mine_1"),
        (jump_to_menu, "mnu_mine"),
      (else_try),
        (eq, "$g_encountered_party", "p_graveyard_1"),
        (jump_to_menu, "mnu_graveyard"),
      (else_try),
        (eq, "$g_encountered_party", "p_old_cabin"),
        (jump_to_menu, "mnu_old_cabin"),
      (else_try),
        (eq, "$g_encountered_party", "p_bl_station"),
        (jump_to_menu, "mnu_bl_station"),
      (else_try),
        (eq, "$g_encountered_party", "p_target"),
        (jump_to_menu, "mnu_target"),
      (else_try),
        (eq, "$g_encountered_party", "p_tull"),
        (jump_to_menu, "mnu_tull"),
      (else_try),
        (eq, "$g_encountered_party", "p_zendar"),
        (jump_to_menu, "mnu_zendar"),
      (else_try),
        (eq, "$g_encountered_party", "p_salt_mine"),
        (jump_to_menu, "mnu_salt_mine"),
      (else_try),
        (eq, "$g_encountered_party", "p_four_ways_inn"),
        (jump_to_menu, "mnu_four_ways_inn"),
      (else_try),
        (eq, "$g_encountered_party", "p_test_scene"),
        (jump_to_menu, "mnu_test_scene"),
      (else_try),
        (eq, "$g_encountered_party", "p_battlefields"),
        (jump_to_menu, "mnu_battlefields"),
      (else_try),
        (eq, "$g_encountered_party", "p_training_ground"),
        (jump_to_menu, "mnu_tutorial"),
      (else_try),
        (eq, "$g_encountered_party", "p_camp_bandits"),
        (jump_to_menu, "mnu_camp"),
      (else_try),
        (jump_to_menu, "mnu_simple_encounter"),
      (try_end),
    (else_try),
      (try_begin),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 3),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (try_begin),
          (eq, "$auto_enter_town", "$g_encountered_party"),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (eq, "$auto_besiege_town", "$g_encountered_party"),
          (jump_to_menu, "mnu_besiegers_camp_with_allies"),
        (else_try),
          (jump_to_menu, "mnu_join_siege_outside"),
        (try_end),
      (else_try),
        (jump_to_menu, "mnu_pre_join"),
      (try_end),
    (try_end),
    (assign, "$auto_enter_town", 0),
    (assign, "$auto_besiege_town", 0),
  ]),

  ("game_event_simulate_battle",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (store_faction_of_party, ":var2", ":var0"),
      (store_faction_of_party, ":var3", ":var1"),
      (neq, ":var2", "fac_player_faction"),
      (neq, ":var3", "fac_player_faction"),
      (store_relation, ":var4", ":var2", ":var3"),
      (ge, ":var4", 0),
      (set_trigger_result, 1),
    (else_try),
      (assign, ":var5", 0),
      (try_begin),
        (this_or_next|eq, "$g_battle_simulation_cancel_for_party", ":var0"),
        (eq, "$g_battle_simulation_cancel_for_party", ":var1"),
        (assign, "$g_battle_simulation_cancel_for_party", -1),
        (assign, "$auto_enter_town", "$g_battle_simulation_auto_enter_town_after_battle"),
        (assign, ":var5", 1),
      (else_try),
        (try_begin),
          (this_or_next|party_slot_eq, ":var0", 2, 1),
          (party_slot_eq, ":var1", 2, 1),
          (assign, ":var5", 1),
        (try_end),
        (party_set_slot, ":var1", 2, 0),
        (party_collect_attachments_to_party, ":var0", "p_collective_ally"),
        (party_collect_attachments_to_party, ":var1", "p_collective_enemy"),
        (call_script, "script_party_calculate_strength", "p_collective_ally", 0),
        (assign, ":var6", reg0),
        (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
        (assign, ":var7", reg0),
        (store_div, ":var6", ":var6", 20),
        (val_min, ":var6", 50),
        (val_max, ":var6", 1),
        (store_div, ":var7", ":var7", 20),
        (val_min, ":var7", 50),
        (val_add, ":var7", 1),
        (try_begin),
          (this_or_next|party_slot_eq, ":var0", 0, 2),
          (party_slot_eq, ":var0", 0, 3),
          (val_mul, ":var6", 3),
          (val_div, ":var6", 2),
          (val_div, ":var7", 2),
        (try_end),
        (try_begin),
          (neg|is_currently_night),
          (inflict_casualties_to_party_group, ":var1", ":var6", "p_temp_casualties"),
          (party_collect_attachments_to_party, ":var1", "p_collective_enemy"),
        (try_end),
        (call_script, "script_party_count_fit_for_battle", "p_collective_enemy", 0),
        (assign, ":var8", reg0),
        (try_begin),
          (gt, ":var8", 0),
          (neg|is_currently_night),
          (inflict_casualties_to_party_group, ":var0", ":var7", "p_temp_casualties"),
          (party_collect_attachments_to_party, ":var0", "p_collective_ally"),
        (try_end),
        (call_script, "script_party_count_fit_for_battle", "p_collective_ally", 0),
        (assign, ":var9", reg0),
        (try_begin),
          (this_or_next|eq, ":var8", 0),
          (eq, ":var9", 0),
          (try_begin),
            (eq, ":var8", 0),
            (eq, ":var9", 0),
            (assign, ":var10", -1),
            (assign, ":var11", -1),
            (assign, ":var12", -1),
          (else_try),
            (eq, ":var8", 0),
            (assign, ":var10", ":var0"),
            (assign, ":var11", ":var1"),
            (assign, ":var12", "p_collective_enemy"),
          (else_try),
            (assign, ":var10", ":var1"),
            (assign, ":var11", ":var0"),
            (assign, ":var12", "p_collective_ally"),
          (try_end),
          (try_begin),
            (ge, ":var10", 0),
            (call_script, "script_get_nonempty_party_in_group", ":var10"),
            (assign, ":var13", reg0),
            (store_faction_of_party, ":var14", ":var13"),
            (store_faction_of_party, ":var15", ":var11"),
          (else_try),
            (assign, ":var13", -1),
          (try_end),
          (try_begin),
            (ge, ":var12", 0),
            (party_get_num_companion_stacks, ":var16", ":var12"),
          (else_try),
            (assign, ":var16", 0),
          (try_end),
          (try_for_range, ":var17", 0, ":var16"),
            (party_stack_get_troop_id, ":var18", ":var12", ":var17"),
            (troop_is_hero, ":var18"),
            (call_script, "script_remove_troop_from_prison", ":var18"),
            (troop_set_slot, ":var18", 10, -1),
            (store_random_in_range, ":var19", 0, 100),
            (str_store_troop_name_link, s1, ":var18"),
            (str_store_faction_name_link, s2, ":var14"),
            (store_troop_faction, ":var20", ":var18"),
            (str_store_faction_name_link, s3, ":var20"),
            (try_begin),
              (ge, ":var19", 0),
              (party_stack_get_troop_id, ":var21", ":var13", 0),
              (is_between, ":var21", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
              (party_add_prisoners, ":var13", ":var18", 1),
              (gt, reg0, 0),
              (troop_set_slot, ":var18", 8, ":var13"),
              (display_log_message, "str_hero_taken_prisoner"),
            (else_try),
              (display_message, "@{s1} of {s3} was defeated in battle but managed to escape."),
            (try_end),
            (try_begin),
              (store_troop_faction, ":var22", ":var18"),
              (faction_slot_eq, ":var22", 7, ":var18"),
              (assign, "$g_recalculate_ais", 1),
            (try_end),
          (try_end),
          (try_begin),
            (ge, ":var12", 0),
            (party_get_num_prisoner_stacks, ":var16", ":var12"),
          (else_try),
            (assign, ":var16", 0),
          (try_end),
          (try_for_range, ":var17", 0, ":var16"),
            (party_prisoner_stack_get_troop_id, ":var18", ":var12", ":var17"),
            (troop_is_hero, ":var18"),
            (call_script, "script_remove_troop_from_prison", ":var18"),
            (store_troop_faction, ":var22", ":var18"),
            (str_store_troop_name_link, s1, ":var18"),
            (str_store_faction_name_link, s2, ":var14"),
            (str_store_faction_name_link, s3, ":var22"),
            (display_log_message, "str_hero_freed"),
          (try_end),
          (try_begin),
            (ge, ":var12", 0),
            (party_clear, "p_temp_party"),
            (assign, "$g_move_heroes", 0),
            (call_script, "script_party_add_party_prisoners", "p_temp_party", ":var12"),
            (call_script, "script_party_prisoners_add_party_companions", "p_temp_party", ":var12"),
            (distribute_party_among_party_group, "p_temp_party", ":var10"),
            (call_script, "script_clear_party_group", ":var11"),
          (try_end),
          (assign, ":var5", 1),
          (try_begin),
            (ge, ":var12", 0),
            (party_get_slot, ":var23", ":var11", 0),
            (this_or_next|eq, ":var23", 3),
            (eq, ":var23", 2),
            (assign, "$g_recalculate_ais", 1),
            (store_faction_of_party, ":var24", ":var10"),
            (store_faction_of_party, ":var15", ":var11"),
            (str_store_party_name, s1, ":var11"),
            (str_store_faction_name, s2, ":var24"),
            (str_store_faction_name, s3, ":var15"),
            (display_log_message, "str_center_captured"),
            (try_begin),
              (eq, "$g_encountered_party", ":var11"),
              (call_script, "script_add_log_entry", 18, "trp_player", "$g_encountered_party", 0, "$g_encountered_party_faction"),
            (try_end),
            (try_begin),
              (party_get_num_companion_stacks, ":var16", ":var10"),
              (gt, ":var16", 0),
              (party_stack_get_troop_id, ":var25", ":var10", 0),
              (is_between, ":var25", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
              (party_set_slot, ":var11", 28, ":var25"),
            (else_try),
              (party_set_slot, ":var11", 28, -1),
            (try_end),
            (call_script, "script_lift_siege", ":var11", 0),
            (call_script, "script_give_center_to_faction", ":var11", ":var24"),
            (try_begin),
              (eq, ":var15", "fac_player_supporters_faction"),
              (call_script, "script_add_notification_menu", "mnu_notification_center_lost", ":var11", ":var24"),
            (try_end),
            (call_script, "script_change_center_prosperity", ":var11", -5),
            (call_script, "script_order_best_besieger_party_to_guard_center", ":var11", ":var24"),
            (call_script, "script_cf_reinforce_party", ":var11"),
            (call_script, "script_cf_reinforce_party", ":var11"),
          (try_end),
        (try_end),
        (try_begin),
          (party_slot_eq, ":var1"),
          (store_random_in_range, ":var26", 0, 100),
          (lt, ":var26", 25),
          (gt, ":var8", 0),
          (call_script, "script_upgrade_hero_party", ":var1", 1000),
        (try_end),
        (try_begin),
          (party_slot_eq, ":var0"),
          (store_random_in_range, ":var26", 0, 100),
          (lt, ":var26", 25),
          (gt, ":var9", 0),
          (call_script, "script_upgrade_hero_party", ":var0", 1000),
        (try_end),
        (store_random_in_range, ":var26", 0, 100),
        (try_begin),
          (lt, ":var26", 10),
          (assign, ":var5", 1),
        (try_end),
      (try_end),
      (set_trigger_result, ":var5"),
    (try_end),
  ]),

  ("game_event_battle_end",
  [
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var1", ":var0", 10),
      (troop_get_slot, ":var2", ":var0", 8),
      (try_begin),
        (ge, ":var1", 0),
        (assign, ":var3", 0),
        (try_begin),
          (neg|party_is_active, ":var1"),
          (assign, ":var3", 1),
        (else_try),
          (party_count_companions_of_type, ":var4", ":var1", ":var0"),
          (le, ":var4", 0),
          (assign, ":var3", 1),
        (try_end),
        (eq, ":var3", 1),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_troop_name, s1, ":var0"),
          (display_message, "@DEBUG: {s1} no longer leads a party."),
        (try_end),
        (troop_set_slot, ":var0", 10, -1),
      (try_end),
      (try_begin),
        (ge, ":var2", 0),
        (assign, ":var3", 0),
        (try_begin),
          (neg|party_is_active, ":var2"),
          (assign, ":var3", 1),
        (else_try),
          (party_count_prisoners_of_type, ":var4", ":var2", ":var0"),
          (le, ":var4", 0),
          (assign, ":var3", 1),
        (try_end),
        (eq, ":var3", 1),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_troop_name, s1, ":var0"),
          (display_message, "@DEBUG: {s1} is no longer a prisoner."),
        (try_end),
        (call_script, "script_remove_troop_from_prison", ":var0"),
        (try_begin),
          (party_count_prisoners_of_type, ":var4", "p_main_party", ":var0"),
          (gt, ":var4", 0),
          (troop_set_slot, ":var0", 8, "p_main_party"),
          (assign, ":var3", 0),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (str_store_troop_name, s1, ":var0"),
            (display_message, "@DEBUG: {s1} is now a prisoner of player."),
          (try_end),
        (try_end),
        (eq, ":var3", 1),
        (try_for_range, ":var5", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
          (eq, ":var3", 1),
          (troop_get_slot, ":var6", ":var5", 10),
          (party_is_active, ":var6"),
          (party_count_prisoners_of_type, ":var4", ":var6", ":var0"),
          (gt, ":var4", 0),
          (troop_set_slot, ":var0", 8, ":var6"),
          (assign, ":var3", 0),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (str_store_troop_name, s1, ":var0"),
            (str_store_party_name, s2, ":var6"),
            (display_message, "@DEBUG: {s1} is now a prisoner of {s2}."),
          (try_end),
        (try_end),
        (try_for_range, ":var6", "p_town_1", "p_village_1"),
          (eq, ":var3", 1),
          (party_count_prisoners_of_type, ":var4", ":var6", ":var0"),
          (gt, ":var4", 0),
          (troop_set_slot, ":var0", 8, ":var6"),
          (assign, ":var3", 0),
          (try_begin),
            (eq, "$cheat_mode", 1),
            (str_store_troop_name, s1, ":var0"),
            (str_store_party_name, s2, ":var6"),
            (display_message, "@DEBUG: {s1} is now a prisoner of {s2}."),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("order_best_besieger_party_to_guard_center",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var5", ":var4", 10),
      (gt, ":var5", 0),
      (store_distance_to_party_from_party, ":var6", ":var5", ":var0"),
      (lt, ":var6", 5),
      (store_faction_of_party, ":var7", ":var5"),
      (eq, ":var1", ":var7"),
      (neg|faction_slot_eq, ":var1", 7, ":var4"),
      (assign, ":var8", 0),
      (try_begin),
        (party_slot_eq, ":var5", 4, 1),
        (party_slot_eq, ":var5", 5, ":var0"),
        (assign, ":var8", 1),
      (else_try),
        (party_slot_eq, ":var5", 4, 11),
        (party_get_slot, ":var9", ":var5", 30),
        (party_slot_eq, ":var9", 4, 1),
        (party_slot_eq, ":var9", 5, ":var0"),
        (assign, ":var8", 1),
      (try_end),
      (eq, ":var8", 1),
      (party_get_slot, ":var10", ":var5", 56),
      (gt, ":var10", ":var3"),
      (assign, ":var3", ":var10"),
      (assign, ":var2", ":var5"),
    (try_end),
    (try_begin),
      (gt, ":var2", 0),
      (call_script, "script_party_set_ai_state", ":var2", 7, ":var0"),
      (party_set_slot, ":var2", 30, -1),
      (party_set_flags, ":var2", 65536, 1),
    (try_end),
  ]),

  ("game_get_item_buy_price_factor",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 100),
    (call_script, "script_get_trade_penalty", ":var0"),
    (assign, ":var2", reg0),
    (assign, ":var3", "$g_encountered_party"),
    (try_begin),
      (neg|is_between, ":var3", 0, "p_spawn_points_end"),
      (assign, ":var3", "p_town_1"),
    (try_end),
    (try_begin),
      (is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
      (is_between, ":var0", "itm_smoked_fish", "itm_gold_bar"),
      (store_sub, ":var4", ":var0", "itm_smoked_fish"),
      (val_add, ":var4", 234),
      (party_get_slot, ":var1", "$g_encountered_party", ":var4"),
      (val_mul, ":var1", 100),
      (val_div, ":var1", 1000),
    (try_end),
    (item_get_type, ":var5", ":var0"),
    (assign, ":var3", "$g_encountered_party"),
    (try_begin),
      (lt, ":var3", 0),
      (assign, ":var3", "p_town_1"),
    (try_end),
    (try_begin),
      (this_or_next|eq, ":var5", 17),
      (this_or_next|eq, ":var5", 16),
      (eq, ":var5", 9),
      (store_faction_of_party, ":var6", ":var3"),
      (try_begin),
        (this_or_next|eq, ":var6", "fac_kingdom_3"),
        (eq, ":var6", "fac_kingdom_4"),
        (assign, ":var1", 200),
      (else_try),
        (eq, ":var6", "fac_kingdom_2"),
        (assign, ":var1", 150),
      (try_end),
    (try_end),
    (try_begin),
      (this_or_next|eq, ":var0", "itm_wine"),
      (eq, ":var0", "itm_ale"),
      (store_faction_of_party, ":var6", ":var3"),
      (try_begin),
        (this_or_next|eq, ":var6", "fac_kingdom_3"),
        (eq, ":var6", "fac_kingdom_4"),
        (assign, ":var1", 200),
      (else_try),
        (eq, ":var6", "fac_kingdom_2"),
        (assign, ":var1", 75),
      (try_end),
    (try_end),
    (try_begin),
      (this_or_next|eq, ":var0", "itm_tools"),
      (this_or_next|eq, ":var0", "itm_warhammer"),
      (this_or_next|eq, ":var0", "itm_pickaxe"),
      (this_or_next|eq, ":var0", "itm_shovel"),
      (this_or_next|eq, ":var0", "itm_dynamite"),
      (this_or_next|eq, ":var0", "itm_dynamite_big"),
      (eq, ":var0", "itm_sledgehammer"),
      (store_distance_to_party_from_party, ":var7", ":var3", "p_mine_1"),
      (val_mul, ":var7", 2),
      (try_begin),
        (gt, ":var7", 100),
        (assign, ":var1", 49),
      (else_try),
        (store_sub, ":var1", 150, ":var7"),
      (try_end),
    (try_end),
    (store_add, ":var8", 100, ":var2"),
    (val_mul, ":var1", ":var8"),
    (val_div, ":var1", 100),
    (assign, reg0, ":var1"),
    (try_begin),
      (is_between, ":var0", "itm_certificate_1", "itm_certificates_end"),
      (assign, ":var1", 100),
      (item_get_slot, ":var9", ":var0", 11),
      (val_div, ":var9", 24),
      (val_div, ":var9", 31),
      (try_for_range, ":var10", 0, ":var9"),
        (val_mul, ":var1", 110),
        (val_div, ":var1", 100),
      (try_end),
      (assign, reg0, ":var1"),
    (try_end),
    (set_trigger_result, reg0),
  ]),

  ("game_get_item_sell_price_factor",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 100),
    (call_script, "script_get_trade_penalty", ":var0"),
    (assign, ":var2", reg0),
    (assign, ":var3", "$g_encountered_party"),
    (try_begin),
      (neg|is_between, ":var3", 0, "p_spawn_points_end"),
      (assign, ":var3", "p_town_1"),
    (try_end),
    (try_begin),
      (is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
      (is_between, ":var0", "itm_smoked_fish", "itm_gold_bar"),
      (store_sub, ":var4", ":var0", "itm_smoked_fish"),
      (val_add, ":var4", 234),
      (party_get_slot, ":var1", "$g_encountered_party", ":var4"),
      (val_mul, ":var1", 100),
      (val_div, ":var1", 1000),
    (else_try),
      (val_mul, ":var2", 4),
    (try_end),
    (item_get_type, ":var5", ":var0"),
    (try_begin),
      (this_or_next|eq, ":var5", 17),
      (this_or_next|eq, ":var5", 16),
      (eq, ":var5", 9),
      (store_faction_of_party, ":var6", ":var3"),
      (try_begin),
        (this_or_next|eq, ":var6", "fac_kingdom_3"),
        (eq, ":var6", "fac_kingdom_4"),
        (assign, ":var1", 200),
      (else_try),
        (eq, ":var6", "fac_kingdom_2"),
        (assign, ":var1", 150),
      (try_end),
    (try_end),
    (try_begin),
      (this_or_next|eq, ":var0", "itm_wine"),
      (eq, ":var0", "itm_ale"),
      (store_faction_of_party, ":var6", ":var3"),
      (try_begin),
        (this_or_next|eq, ":var6", "fac_kingdom_3"),
        (eq, ":var6", "fac_kingdom_4"),
        (assign, ":var1", 200),
      (else_try),
        (eq, ":var6", "fac_kingdom_2"),
        (assign, ":var1", 75),
      (try_end),
    (try_end),
    (try_begin),
      (this_or_next|eq, ":var0", "itm_tools"),
      (this_or_next|eq, ":var0", "itm_warhammer"),
      (this_or_next|eq, ":var0", "itm_pickaxe"),
      (this_or_next|eq, ":var0", "itm_shovel"),
      (this_or_next|eq, ":var0", "itm_dynamite"),
      (this_or_next|eq, ":var0", "itm_dynamite_big"),
      (eq, ":var0", "itm_sledgehammer"),
      (store_distance_to_party_from_party, ":var7", ":var3", "p_mine_1"),
      (val_mul, ":var7", 2),
      (try_begin),
        (gt, ":var7", 100),
        (assign, ":var1", 49),
      (else_try),
        (store_sub, ":var1", 150, ":var7"),
      (try_end),
    (try_end),
    (store_add, ":var8", 100, ":var2"),
    (val_mul, ":var1", 100),
    (val_div, ":var1", ":var8"),
    (assign, reg0, ":var1"),
    (try_begin),
      (is_between, ":var0", "itm_certificate_1", "itm_certificates_end"),
      (assign, ":var1", 100),
      (item_get_slot, ":var9", ":var0", 11),
      (val_div, ":var9", 24),
      (val_div, ":var9", 31),
      (try_for_range, ":var10", 0, ":var9"),
        (val_mul, ":var1", 110),
        (val_div, ":var1", 100),
      (try_end),
      (assign, reg0, ":var1"),
    (try_end),
    (set_trigger_result, reg0),
  ]),

  ("get_trade_penalty",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (party_get_skill_level, ":var2", "p_main_party", skl_trade),
    (try_begin),
      (is_between, ":var0", "itm_smoked_fish", "itm_gold_bar"),
      (assign, ":var1", 20),
      (store_mul, ":var3", ":var2", 2),
      (val_sub, ":var1", ":var3"),
    (else_try),
      (assign, ":var1", 80),
      (store_mul, ":var3", ":var2", 5),
      (val_sub, ":var1", ":var3"),
    (try_end),
    (assign, ":var4", 1000),
    (try_begin),
      (is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
      (party_get_slot, ":var5", "$g_encountered_party", 26),
      (store_mul, ":var6", ":var5", -3),
      (val_add, ":var4", ":var6"),
      (try_begin),
        (lt, ":var5", 0),
        (store_sub, ":var7", 100, ":var5"),
        (val_mul, ":var4", ":var7"),
        (val_div, ":var4", 100),
      (try_end),
    (try_end),
    (call_script, "script_troop_get_player_relation", "$g_talk_troop"),
    (assign, ":var8", reg0),
    (try_begin),
      (lt, ":var8", 0),
      (store_sub, ":var9", 0, ":var8"),
      (store_mul, ":var10", ":var9", 20),
      (val_add, ":var4", ":var10"),
    (try_end),
    (val_mul, ":var1", ":var4"),
    (val_div, ":var1", 1000),
    (val_max, ":var1", 1),
    (assign, reg0, ":var1"),
  ]),

  ("game_event_buy_item",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (is_between, ":var0", "itm_smoked_fish", "itm_gold_bar"),
      (store_sub, ":var2", ":var0", "itm_smoked_fish"),
      (val_add, ":var2", 234),
      (party_get_slot, ":var3", "$g_encountered_party", ":var2"),
      (try_begin),
        (eq, ":var1", 0),
        (val_add, ":var3", 10),
      (else_try),
        (val_add, ":var3", 15),
      (try_end),
      (val_min, ":var3", 10000),
      (party_set_slot, "$g_encountered_party", ":var2", ":var3"),
    (try_end),
  ]),

  ("game_event_sell_item",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (is_between, ":var0", "itm_smoked_fish", "itm_gold_bar"),
      (store_sub, ":var2", ":var0", "itm_smoked_fish"),
      (val_add, ":var2", 234),
      (party_get_slot, ":var3", "$g_encountered_party", ":var2"),
      (try_begin),
        (eq, ":var1", 0),
        (val_sub, ":var3", 15),
      (else_try),
        (val_sub, ":var3", 10),
      (try_end),
      (val_max, ":var3", 100),
      (party_set_slot, "$g_encountered_party", ":var2", ":var3"),
    (try_end),
  ]),

  ("game_get_troop_wage",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 0),
    (try_begin),
      (this_or_next|eq, ":var0", "trp_player"),
      (eq, ":var0", "trp_kidnapped_girl"),
    (else_try),
      (is_between, ":var0", 0, 0),
    (else_try),
      (store_character_level, ":var3", ":var0"),
      (assign, ":var2", ":var3"),
      (val_mul, ":var2", 5),
      (val_div, ":var2", 3),
      (val_add, ":var2", 8),
      (val_div, ":var2", 3),
    (try_end),
    (val_mul, ":var2", 10),
    (try_begin),
      (troop_is_mounted, ":var0"),
      (val_mul, ":var2", 3),
      (val_div, ":var2", 2),
    (try_end),
    (try_begin),
      (is_between, ":var0", "trp_osage_scout", "trp_town_walker_1"),
      (val_mul, ":var2", 3),
      (val_div, ":var2", 2),
    (try_end),
    (try_begin),
      (is_between, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
      (val_mul, ":var2", 3),
    (try_end),
    (store_skill_level, ":var4", "skl_leadership", "trp_player"),
    (store_mul, ":var5", 5, ":var4"),
    (store_sub, ":var6", 100, ":var5"),
    (val_mul, ":var2", ":var6"),
    (val_div, ":var2", 100),
    (try_begin),
      (neq, ":var0", "trp_player"),
      (neq, ":var0", "trp_kidnapped_girl"),
      (neg|is_between, ":var0", 0, 0),
      (val_max, ":var2", 1),
    (try_end),
    (assign, reg0, ":var2"),
    (set_trigger_result, reg0),
  ]),

  ("game_get_total_wage",
  [
    (assign, ":var0", 0),
    (party_get_num_companion_stacks, ":var1", "p_main_party"),
    (try_for_range, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
      (party_stack_get_size, ":var4", "p_main_party", ":var2"),
      (call_script, "script_game_get_troop_wage", ":var3", 0),
      (val_mul, reg0, ":var4"),
      (val_add, ":var0", reg0),
    (try_end),
    (assign, reg0, ":var0"),
    (set_trigger_result, reg0),
  ]),

  ("game_get_join_cost",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_begin),
      (troop_is_hero, ":var0"),
    (else_try),
      (store_character_level, ":var2", ":var0"),
      (assign, ":var1", ":var2"),
      (val_add, ":var1", 5),
      (val_mul, ":var1", ":var1"),
      (val_add, ":var1", 40),
      (val_div, ":var1", 2),
      (try_begin),
        (troop_is_mounted, ":var0"),
        (val_mul, ":var1", 2),
      (try_end),
    (try_end),
    (assign, reg0, ":var1"),
    (set_trigger_result, reg0),
  ]),

  ("game_get_prisoner_price",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (this_or_next|is_between, "$g_talk_troop", "trp_ransom_broker_1", "trp_tavern_traveler_1"),
      (eq, "$g_talk_troop", "trp_ramun_the_slave_trader"),
      (store_character_level, ":var1", ":var0"),
      (assign, ":var2", 50),
      (assign, ":var3", 10),
      (val_mul, ":var3", ":var1"),
      (val_div, ":var3", 2),
      (val_add, ":var2", ":var3"),
    (else_try),
      (assign, ":var2", 100),
    (try_end),
    (assign, reg0, ":var2"),
    (set_trigger_result, reg0),
  ]),

  ("game_check_prisoner_can_be_sold",
  [
    (store_script_param_1, ":var0"),
    (assign, reg0, 0),
    (try_begin),
      (neg|troop_is_hero, ":var0"),
      (assign, reg0, 1),
    (try_end),
    (set_trigger_result, reg0),
  ]),

  ("game_event_detect_party",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (party_slot_eq, ":var0", 0, 13),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (is_between, ":var1", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (call_script, "script_update_troop_location_notes", ":var1", 0),
    (else_try),
      (is_between, ":var0", "p_town_1", "p_village_1"),
      (party_get_num_attached_parties, ":var2", ":var0"),
      (try_for_range, ":var3", 0, ":var2"),
        (party_get_attached_party_with_rank, ":var4", ":var0", ":var3"),
        (party_stack_get_troop_id, ":var1", ":var4", 0),
        (is_between, ":var1", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (call_script, "script_update_troop_location_notes", ":var1", 0),
      (try_end),
    (try_end),
  ]),

  ("game_event_undetect_party",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (party_slot_eq, ":var0", 0, 13),
      (party_stack_get_troop_id, ":var1", ":var0", 0),
      (is_between, ":var1", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (call_script, "script_update_troop_location_notes", ":var1", 0),
    (try_end),
  ]),

  ("game_get_statistics_line",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (eq, ":var0", 0),
      (get_player_agent_kill_count, reg1),
      (str_store_string, s1, "str_number_of_troops_killed_reg1"),
      (set_result_string, s1),
    (else_try),
      (eq, ":var0", 1),
      (get_player_agent_kill_count, reg1, 1),
      (str_store_string, s1, "str_number_of_troops_wounded_reg1"),
      (set_result_string, s1),
    (else_try),
      (eq, ":var0", 2),
      (get_player_agent_own_troop_kill_count, reg1),
      (str_store_string, s1, "str_number_of_own_troops_killed_reg1"),
      (set_result_string, s1),
    (else_try),
      (eq, ":var0", 3),
      (get_player_agent_own_troop_kill_count, reg1, 1),
      (str_store_string, s1, "str_number_of_own_troops_wounded_reg1"),
      (set_result_string, s1),
    (try_end),
  ]),

  ("game_get_date_text",
  [
    (store_script_param_2, ":var0"),
    (store_div, ":var1", ":var0", 24),
    (store_add, ":var2", ":var1", 2),
    (assign, ":var3", 5),
    (assign, ":var4", 1866),
    (assign, ":var5", 99999),
    (try_for_range, ":var6", 0, ":var5"),
      (try_begin),
        (this_or_next|eq, ":var3", 1),
        (this_or_next|eq, ":var3", 3),
        (this_or_next|eq, ":var3", 5),
        (this_or_next|eq, ":var3", 7),
        (this_or_next|eq, ":var3", 8),
        (this_or_next|eq, ":var3", 10),
        (eq, ":var3", 12),
        (assign, ":var7", 31),
      (else_try),
        (this_or_next|eq, ":var3", 4),
        (this_or_next|eq, ":var3", 6),
        (this_or_next|eq, ":var3", 9),
        (eq, ":var3", 11),
        (assign, ":var7", 30),
      (else_try),
        (try_begin),
          (store_div, ":var8", ":var4", 4),
          (val_mul, ":var8", 4),
          (eq, ":var8", ":var4"),
          (assign, ":var7", 29),
        (else_try),
          (assign, ":var7", 28),
        (try_end),
      (try_end),
      (try_begin),
        (gt, ":var2", ":var7"),
        (val_sub, ":var2", ":var7"),
        (val_add, ":var3", 1),
        (try_begin),
          (gt, ":var3", 12),
          (val_sub, ":var3", 12),
          (val_add, ":var4", 1),
        (try_end),
      (else_try),
        (assign, ":var5", 0),
      (try_end),
    (try_end),
    (assign, reg1, ":var2"),
    (assign, reg2, ":var4"),
    (try_begin),
      (eq, ":var3", 1),
      (str_store_string, s1, "str_january_reg1_reg2"),
    (else_try),
      (eq, ":var3", 2),
      (str_store_string, s1, "str_february_reg1_reg2"),
    (else_try),
      (eq, ":var3", 3),
      (str_store_string, s1, "str_march_reg1_reg2"),
    (else_try),
      (eq, ":var3", 4),
      (str_store_string, s1, "str_april_reg1_reg2"),
    (else_try),
      (eq, ":var3", 5),
      (str_store_string, s1, "str_may_reg1_reg2"),
    (else_try),
      (eq, ":var3", 6),
      (str_store_string, s1, "str_june_reg1_reg2"),
    (else_try),
      (eq, ":var3", 7),
      (str_store_string, s1, "str_july_reg1_reg2"),
    (else_try),
      (eq, ":var3", 8),
      (str_store_string, s1, "str_august_reg1_reg2"),
    (else_try),
      (eq, ":var3", 9),
      (str_store_string, s1, "str_september_reg1_reg2"),
    (else_try),
      (eq, ":var3", 10),
      (str_store_string, s1, "str_october_reg1_reg2"),
    (else_try),
      (eq, ":var3", 11),
      (str_store_string, s1, "str_november_reg1_reg2"),
    (else_try),
      (eq, ":var3", 12),
      (str_store_string, s1, "str_december_reg1_reg2"),
    (try_end),
    (set_result_string, s1),
  ]),

  ("game_get_money_text",
  [
    (store_script_param_1, ":var0"),
    (store_div, ":var1", ":var0", 100),
    (store_mod, ":var2", ":var0", 100),
    (try_begin),
      (eq, ":var1", 1),
      (str_store_string, s2, "@1 dollar"),
    (else_try),
      (assign, reg1, ":var1"),
      (str_store_string, s2, "@{reg1} dollars"),
    (try_end),
    (try_begin),
      (eq, ":var2", 1),
      (str_store_string, s3, "@1 cent"),
    (else_try),
      (assign, reg1, ":var2"),
      (str_store_string, s3, "@{reg1} cents"),
    (try_end),
    (try_begin),
      (eq, ":var1", 0),
      (str_store_string, s1, "@{s3}"),
    (else_try),
      (eq, ":var2", 0),
      (str_store_string, s1, "@{s2}"),
    (else_try),
      (str_store_string, s1, "@{s2} and {s3}"),
    (try_end),
    (set_result_string, s1),
  ]),

  ("game_get_money_text_alt",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", reg1),
    (store_div, ":var2", ":var0", 100),
    (store_mod, ":var3", ":var0", 100),
    (assign, reg1, ":var2"),
    (str_store_string, s1, "@${reg1}"),
    (assign, reg1, ":var3"),
    (try_begin),
      (eq, ":var3", 0),
      (str_store_string, s1, "@{s1}.00"),
    (else_try),
      (lt, ":var3", 10),
      (str_store_string, s1, "@{s1}.0{reg1}"),
    (else_try),
      (str_store_string, s1, "@{s1}.{reg1}"),
    (try_end),
    (assign, reg1, ":var1"),
    (set_result_string, s1),
  ]),

  ("game_get_party_companion_limit",
  [
    (assign, ":var0", "trp_player"),
    (assign, ":var1", 10),
    (store_skill_level, ":var2", "skl_leadership", ":var0"),
    (store_attribute_level, ":var3", ":var0", ca_charisma),
    (val_mul, ":var2", 5),
    (val_add, ":var1", ":var2"),
    (val_add, ":var1", ":var3"),
    (troop_get_slot, ":var4", ":var0", 7),
    (store_div, ":var5", ":var4", 25),
    (val_add, ":var1", ":var5"),
    (store_troop_faction, ":var6", "trp_player"),
    (try_begin),
      (this_or_next|eq, ":var6", 0),
      (neg|faction_slot_eq, ":var6", 100, 0),
      (val_div, ":var1", 3),
      (val_mul, ":var1", 2),
    (try_end),
    (assign, reg0, ":var1"),
    (set_trigger_result, reg0),
  ]),

  ("game_reset_player_party_name",
  [
    (str_store_troop_name, s5, "trp_player"),
    (party_set_name, "p_main_party", s5),
  ]),

  ("party_get_ideal_size",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 30),
    (try_begin),
      (party_slot_eq, ":var0", 0, 13),
      (party_stack_get_troop_id, ":var2", ":var0", 0),
      (store_faction_of_party, ":var3", ":var0"),
      (assign, ":var1", 10),
      (store_skill_level, ":var4", "skl_leadership", ":var2"),
      (store_attribute_level, ":var5", ":var2", ca_charisma),
      (val_mul, ":var4", 5),
      (val_add, ":var1", ":var4"),
      (val_add, ":var1", ":var5"),
      (troop_get_slot, ":var6", ":var2", 7),
      (store_div, ":var7", ":var6", 25),
      (val_add, ":var1", ":var7"),
      (try_begin),
        (faction_slot_eq, ":var3", 10, ":var2"),
        (val_add, ":var1", 100),
      (try_end),
    (try_end),
    (store_character_level, ":var8", "trp_player"),
    (store_add, ":var9", 90, ":var8"),
    (val_mul, ":var1", ":var9"),
    (val_div, ":var1", 180),
    (assign, reg0, ":var1"),
  ]),

  ("game_get_party_prisoner_limit",
  [
    (assign, ":var0", "trp_player"),
    (assign, ":var1", 0),
    (store_skill_level, ":var2", "skl_prisoner_management", ":var0"),
    (store_mul, ":var1", ":var2", 5),
    (assign, reg0, ":var1"),
    (set_trigger_result, reg0),
  ]),

  ("game_get_item_extra_text",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (try_begin),
      (is_between, ":var0", "itm_smoked_fish", "itm_wine"),
      (try_begin),
        (eq, ":var1", 0),
        (assign, ":var3", 1),
        (try_begin),
          (this_or_next|eq, ":var0", "itm_deer_meat"),
          (eq, ":var0", "itm_cattle_meat"),
          (eq, ":var2", 41),
          (assign, ":var3", 0),
        (try_end),
        (eq, ":var3", 1),
        (item_get_slot, ":var4", ":var0", 1),
        (assign, reg1, ":var4"),
        (set_result_string, "@+{reg1} to party morale"),
        (set_trigger_result, 4474111),
      (try_end),
    (else_try),
      (is_between, ":var0", "itm_book_tactics", "itm_book_wound_treatment_reference"),
      (try_begin),
        (eq, ":var1", 0),
        (item_get_slot, reg1, ":var0", 4),
        (set_result_string, "@Requires {reg1} intelligence to read"),
        (set_trigger_result, 16772829),
      (else_try),
        (eq, ":var1", 1),
        (item_get_slot, ":var5", ":var0", 2),
        (val_div, ":var5", 10),
        (assign, reg1, ":var5"),
        (set_result_string, "@Reading Progress: {reg1}%"),
        (set_trigger_result, 16772829),
      (try_end),
    (else_try),
      (is_between, ":var0", "itm_book_wound_treatment_reference", "itm_smoked_fish"),
      (try_begin),
        (eq, ":var1", 0),
        (try_begin),
          (eq, ":var0", "itm_book_wound_treatment_reference"),
          (str_store_string, s1, "@Wound Treament"),
        (else_try),
          (eq, ":var0", "itm_book_training_reference"),
          (str_store_string, s1, "@Trainer"),
        (else_try),
          (eq, ":var0", "itm_book_surgery_reference"),
          (str_store_string, s1, "@Surgery"),
        (else_try),
          (eq, ":var0", "itm_manacles"),
          (str_store_string, s1, "@Prisoner Management"),
        (else_try),
          (eq, ":var0", "itm_telescope"),
          (str_store_string, s1, "@Spotting"),
        (else_try),
          (eq, ":var0", "itm_compass"),
          (str_store_string, s1, "@Trail Blazing"),
        (try_end),
        (set_result_string, "@+1 to {s1} while in inventory"),
        (set_trigger_result, 16772829),
      (try_end),
    (else_try),
      (this_or_next|eq, ":var0", "itm_cartridges"),
      (eq, ":var0", "itm_cartridges_bolts"),
      (eq, ":var1", 0),
      (set_result_string, "@You should not see this item."),
    (else_try),
      (this_or_next|eq, ":var0", "itm_shotgun8"),
      (eq, ":var0", "itm_un_shotgun8"),
      (eq, ":var1", 0),
      (set_result_string, "@Requires 10 STR to use"),
    (else_try),
      (is_between, ":var0", "itm_cartridges_bolts_0", "itm_cartridges_end"),
      (try_begin),
        (eq, ":var1", 0),
        (try_begin),
          (is_between, ":var0", "itm_cartridges_bolts_0", "itm_cartridges_0"),
          (store_sub, reg1, ":var0", "itm_cartridges_bolts_0"),
        (else_try),
          (is_between, ":var0", "itm_cartridges_0", "itm_cartridges_end"),
          (store_sub, reg1, ":var0", "itm_cartridges_0"),
        (try_end),
        (set_result_string, "@Requires {reg1} stockpiling to use"),
        (set_trigger_result, 16772829),
      (try_end),
    (else_try),
      (is_between, ":var0", "itm_un_cartridges_bolts_0", "itm_un_cartridges_end"),
      (try_begin),
        (eq, ":var1", 0),
        (try_begin),
          (is_between, ":var0", "itm_un_cartridges_bolts_0", "itm_un_cartridges_0"),
          (store_sub, reg1, ":var0", "itm_un_cartridges_bolts_0"),
        (else_try),
          (is_between, ":var0", "itm_un_cartridges_0", "itm_un_cartridges_end"),
          (store_sub, reg1, ":var0", "itm_un_cartridges_0"),
        (try_end),
        (set_result_string, "@Requires {reg1} stockpiling to use"),
        (set_trigger_result, 16772829),
      (else_try),
        (eq, ":var1", 1),
        (set_result_string, "@Small delay between skill increase and ability to use."),
      (try_end),
    (else_try),
      (item_slot_ge, ":var0", 5, 1),
      (eq, ":var1", 0),
      (item_get_slot, reg1, ":var0", 5),
      (set_result_string, "@Rounds: {reg1}"),
    (else_try),
      (eq, ":var1", 1),
      (item_get_type, ":var6", ":var0"),
      (try_begin),
        (item_slot_eq, ":var0", 13, 3),
        (set_result_string, "@Very low penalty from horseback"),
      (else_try),
        (this_or_next|eq, ":var6", 16),
        (item_slot_eq, ":var0", 13, 2),
        (set_result_string, "@Low penalty from horseback"),
      (else_try),
        (eq, ":var6", 9),
        (item_slot_eq, ":var0", 13, 1),
        (set_result_string, "@Medium penalty from horseback"),
      (else_try),
        (eq, ":var6", 9),
        (item_slot_eq, ":var0", 13, 0),
        (set_result_string, "@High penalty from horseback"),
      (try_end),
    (else_try),
      (eq, ":var0", "itm_native_body_warpaint"),
      (try_begin),
        (eq, ":var1", 0),
        (set_result_string, "@Warpaint can be customised"),
      (else_try),
        (eq, ":var1", 1),
        (set_result_string, "@in the camp menu"),
      (try_end),
    (try_end),
  ]),

  ("game_on_disembark",
  [
    (jump_to_menu, "mnu_disembark"),
  ]),

  ("game_context_menu_get_buttons",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (neq, ":var0", "p_main_party"),
      (context_menu_add_item, "@Move here", -7),
    (try_end),
    (try_begin),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (context_menu_add_item, "@View notes", 1),
    (else_try),
      (party_get_num_companion_stacks, ":var1", ":var0"),
      (gt, ":var1", 0),
      (party_stack_get_troop_id, ":var2", ":var0", 0),
      (is_between, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (context_menu_add_item, "@View notes", 2),
    (try_end),
  ]),

  ("game_event_context_menu_button_clicked",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (try_begin),
      (eq, ":var1", 1),
      (change_screen_notes, 3, ":var0"),
    (else_try),
      (eq, ":var1", 2),
      (party_stack_get_troop_id, ":var2", ":var0", 0),
      (change_screen_notes, 1, ":var2"),
    (try_end),
  ]),

  ("game_get_skill_modifier_for_troop",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (try_begin),
      (eq, ":var1", "skl_wound_treatment"),
      (call_script, "script_get_troop_item_amount", ":var0", "itm_book_wound_treatment_reference"),
      (gt, reg0, 0),
      (val_add, ":var2", 1),
    (else_try),
      (eq, ":var1", "skl_trainer"),
      (call_script, "script_get_troop_item_amount", ":var0", "itm_book_training_reference"),
      (gt, reg0, 0),
      (val_add, ":var2", 1),
    (else_try),
      (eq, ":var1", "skl_surgery"),
      (call_script, "script_get_troop_item_amount", ":var0", "itm_book_surgery_reference"),
      (gt, reg0, 0),
      (val_add, ":var2", 1),
    (else_try),
      (eq, ":var1", "skl_prisoner_management"),
      (call_script, "script_get_troop_item_amount", ":var0", "itm_manacles"),
      (gt, reg0, 0),
      (val_add, ":var2", 1),
    (else_try),
      (eq, ":var1", "skl_spotting"),
      (call_script, "script_get_troop_item_amount", ":var0", "itm_telescope"),
      (gt, reg0, 0),
      (val_add, ":var2", 1),
    (else_try),
      (eq, ":var1", "skl_pathfinding"),
      (call_script, "script_get_troop_item_amount", ":var0", "itm_compass"),
      (gt, reg0, 0),
      (val_add, ":var2", 1),
    (else_try),
      (eq, ":var1", "skl_horse_archery"),
      (get_player_agent_no, ":var3"),
      (ge, ":var3", 1),
      (agent_get_wielded_item, ":var4", ":var3", 0),
      (gt, ":var4", 0),
      (item_get_type, ":var5", ":var4"),
      (try_begin),
        (item_slot_eq, ":var4", 13, 3),
        (val_add, ":var2", 5),
      (else_try),
        (item_slot_eq, ":var4", 13, 1),
        (val_add, ":var2", 2),
      (else_try),
        (eq, ":var5", 16),
        (val_add, ":var2", 4),
      (try_end),
    (try_end),
    (set_trigger_result, ":var2"),
  ]),

  ("npc_get_troop_wage",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_begin),
      (troop_is_hero, ":var0"),
    (else_try),
      (store_character_level, ":var1", ":var0"),
      (val_mul, ":var1", ":var1"),
      (val_add, ":var1", 50),
      (val_div, ":var1", 30),
      (troop_is_mounted, ":var0"),
      (val_mul, ":var1", 5),
      (val_div, ":var1", 4),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("setup_talk_info",
  [
    (talk_info_set_relation_bar, "$g_talk_troop_relation"),
    (str_store_troop_name, s61, "$g_talk_troop"),
    (str_store_string, s61, "@ {s61}"),
    (assign, reg1, "$g_talk_troop_relation"),
    (str_store_string, s62, "str_relation_reg1"),
    (talk_info_set_line, 0, s61),
    (talk_info_set_line, 1, s62),
    (call_script, "script_describe_relation_to_s63", "$g_talk_troop_relation"),
    (talk_info_set_line, 3, s63),
  ]),

  ("setup_talk_info_companions",
  [
    (call_script, "script_npc_morale", "$g_talk_troop"),
    (assign, ":var0", reg0),
    (talk_info_set_relation_bar, ":var0"),
    (str_store_troop_name, s61, "$g_talk_troop"),
    (str_store_string, s61, "@ {s61}"),
    (assign, reg1, ":var0"),
    (str_store_string, s62, "str_morale_reg1"),
    (talk_info_set_line, 0, s61),
    (talk_info_set_line, 1, s62),
    (talk_info_set_line, 3, s63),
  ]),

  ("update_party_creation_random_limits",
  [
    (store_random_in_range, ":var0", 0, 100),
    (set_party_creation_random_limits, 0, ":var0"),
    (assign, reg0, ":var0"),
  ]),

  ("set_trade_route_between_centers",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (try_for_range, ":var4", 190, 205),
      (try_begin),
        (eq, ":var2", 0),
        (party_slot_eq, ":var0", ":var4", 0),
        (party_set_slot, ":var0", ":var4", ":var1"),
        (assign, ":var2", 1),
      (try_end),
      (try_begin),
        (eq, ":var3", 0),
        (party_slot_eq, ":var1", ":var4", 0),
        (party_set_slot, ":var1", ":var4", ":var0"),
        (assign, ":var3", 1),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var2", 0),
      (str_store_party_name, s1, ":var0"),
      (display_message, "@ERROR: More than 15 trade routes are given for {s1}."),
    (try_end),
    (try_begin),
      (eq, ":var3", 0),
      (str_store_party_name, s1, ":var1"),
      (display_message, "@ERROR: More than 15 trade routes are given for {s1}."),
    (try_end),
  ]),

  ("center_change_trade_good_production",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_script_param, ":var3", 4),
    (store_random_in_range, ":var4", 0, ":var3"),
    (store_random_in_range, ":var5", 0, 2),
    (try_begin),
      (eq, ":var5", 0),
      (val_add, ":var2", ":var4"),
    (else_try),
      (val_sub, ":var2", ":var4"),
    (try_end),
    (val_sub, ":var1", "itm_smoked_fish"),
    (val_add, ":var1", 205),
    (party_get_slot, ":var6", ":var0", ":var1"),
    (val_add, ":var2", ":var6"),
    (party_set_slot, ":var0", ":var1", ":var2"),
  ]),

  ("average_trade_good_productions",
  [
    (store_sub, ":var0", 205, "itm_smoked_fish"),
    (try_for_range, ":var1", "p_town_1", "p_castle_1"),
      (this_or_next|is_between, ":var1", "p_town_1", "p_castle_1"),
      (is_between, ":var1", "p_village_1", "p_salt_mine"),
      (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
        (this_or_next|is_between, ":var1", "p_town_1", "p_castle_1"),
        (is_between, ":var1", "p_village_1", "p_salt_mine"),
        (neq, ":var2", ":var1"),
        (store_distance_to_party_from_party, ":var3", ":var1", ":var2"),
        (lt, ":var3", 110),
        (store_sub, ":var4", 110, ":var3"),
        (try_for_range, ":var5", "itm_smoked_fish", "itm_gold_bar"),
          (store_add, ":var6", ":var5", ":var0"),
          (party_get_slot, ":var7", ":var1", ":var6"),
          (party_get_slot, ":var8", ":var2", ":var6"),
          (store_sub, ":var9", ":var7", ":var8"),
          (gt, ":var9", 0),
          (store_mul, ":var10", ":var9", 1),
          (val_mul, ":var10", ":var4"),
          (val_div, ":var10", 110),
          (val_add, ":var8", ":var10"),
          (party_set_slot, ":var2", ":var6", ":var8"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("normalize_trade_good_productions",
  [
    (store_sub, ":var0", 205, "itm_smoked_fish"),
    (try_for_range, ":var1", "itm_smoked_fish", "itm_gold_bar"),
      (assign, ":var2", 0),
      (assign, ":var3", 0),
      (store_add, ":var4", ":var1", ":var0"),
      (try_for_range, ":var5", "p_town_1", "p_salt_mine"),
        (val_add, ":var3", 1),
        (try_begin),
          (is_between, ":var5", "p_town_1", "p_castle_1"),
          (val_add, ":var3", 4),
        (try_end),
        (party_get_slot, ":var6", ":var5", ":var4"),
        (val_add, ":var2", ":var6"),
      (try_end),
      (store_div, ":var7", ":var2", ":var3"),
      (neq, ":var7", 0),
      (try_for_range, ":var5", "p_town_1", "p_salt_mine"),
        (this_or_next|is_between, ":var5", "p_town_1", "p_castle_1"),
        (is_between, ":var5", "p_village_1", "p_salt_mine"),
        (party_get_slot, ":var6", ":var5", ":var4"),
        (val_sub, ":var6", ":var7"),
        (party_set_slot, ":var5", ":var4", ":var6"),
      (try_end),
    (try_end),
  ]),

  ("update_trade_good_prices",
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (this_or_next|is_between, ":var0", "p_town_1", "p_castle_1"),
      (is_between, ":var0", "p_village_1", "p_salt_mine"),
      (call_script, "script_update_trade_good_price_for_party", ":var0"),
    (try_end),
  ]),

  ("update_trade_good_price_for_party",
  [
    (store_script_param, ":var0", 1),
    (try_for_range, ":var1", "itm_smoked_fish", "itm_gold_bar"),
      (store_sub, ":var2", ":var1", "itm_smoked_fish"),
      (val_add, ":var2", 205),
      (store_sub, ":var3", ":var1", "itm_smoked_fish"),
      (val_add, ":var3", 234),
      (party_get_slot, ":var4", ":var0", ":var2"),
      (party_get_slot, ":var5", ":var0", ":var3"),
      (try_begin),
        (lt, ":var4", 0),
        (store_mul, ":var6", ":var4", -3),
      (else_try),
        (store_mul, ":var6", ":var4", 3),
      (try_end),
      (store_random_in_range, ":var7", 0, ":var6"),
      (try_begin),
        (lt, ":var4", 0),
        (val_add, ":var5", ":var7"),
      (else_try),
        (val_sub, ":var5", ":var7"),
      (try_end),
      (store_sub, ":var8", ":var5", 1000),
      (val_mul, ":var8", 97),
      (val_div, ":var8", 100),
      (store_add, ":var9", 1000, ":var8"),
      (val_clamp, ":var9", 100, 10000),
      (party_set_slot, ":var0", ":var3", ":var9"),
    (try_end),
  ]),

  ("do_merchant_town_trade",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (call_script, "script_do_party_center_trade", ":var0", ":var1", 20),
    (assign, ":var2", reg0),
    (val_div, ":var2", 2),
    (str_store_party_name, s1, ":var0"),
    (str_store_party_name, s2, ":var1"),
    (assign, reg1, ":var2"),
    (party_get_slot, ":var3", ":var1", 48),
    (party_get_slot, ":var4", ":var1", 50),
    (store_add, ":var5", ":var4", 10),
    (val_mul, ":var5", ":var2"),
    (val_div, ":var5", 600),
    (val_div, ":var3", 400),
    (val_add, ":var3", ":var5"),
    (party_set_slot, ":var1", 48, ":var3"),
    (try_begin),
      (store_random_in_range, ":var6", 0, 100),
      (lt, ":var6", 35),
      (call_script, "script_change_center_prosperity", ":var1", 1),
    (try_end),
  ]),

  ("party_calculate_regular_strength",
  [
    (store_script_param_1, ":var0"),
    (assign, reg0, 0),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (try_for_range, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (neg|troop_is_hero, ":var3"),
      (store_character_level, ":var4", ":var3"),
      (val_add, ":var4", 12),
      (val_mul, ":var4", ":var4"),
      (val_div, ":var4", 100),
      (party_stack_get_size, ":var5", ":var0", ":var2"),
      (party_stack_get_num_wounded, ":var6", ":var0", ":var2"),
      (val_sub, ":var5", ":var6"),
      (val_mul, ":var4", ":var5"),
      (val_add, reg0, ":var4"),
    (try_end),
  ]),

  ("party_calculate_strength",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, reg0, 0),
    (party_get_num_companion_stacks, ":var2", ":var0"),
    (assign, ":var3", 0),
    (try_begin),
      (neq, ":var1", 0),
      (assign, ":var3", 1),
    (try_end),
    (try_for_range, ":var4", ":var3", ":var2"),
      (party_stack_get_troop_id, ":var5", ":var0", ":var4"),
      (store_character_level, ":var6", ":var5"),
      (val_add, ":var6", 12),
      (val_mul, ":var6", ":var6"),
      (val_div, ":var6", 100),
      (try_begin),
        (neg|troop_is_hero, ":var5"),
        (party_stack_get_size, ":var7", ":var0", ":var4"),
        (party_stack_get_num_wounded, ":var8", ":var0", ":var4"),
        (val_sub, ":var7", ":var8"),
        (val_mul, ":var6", ":var7"),
      (else_try),
        (troop_is_wounded, ":var5"),
        (assign, ":var6", 0),
      (try_end),
      (val_add, reg0, ":var6"),
    (try_end),
    (party_set_slot, ":var0", 56, reg0),
  ]),

  ("loot_player_items",
  [
    (store_script_param, ":var0", 1),
    (troop_get_inventory_capacity, ":var1", "trp_player"),
    (try_for_range, ":var2", 0, ":var1"),
      (troop_get_inventory_slot, ":var3", "trp_player", ":var2"),
      (ge, ":var3", 0),
      (troop_get_inventory_slot_modifier, ":var4", "trp_player", ":var2"),
      (try_begin),
        (is_between, ":var3", "itm_smoked_fish", "itm_gold_bar"),
        (assign, ":var5", 20),
      (else_try),
        (is_between, ":var3", "itm_gold_bar", "itm_certificate_1"),
        (assign, ":var5", 101),
      (else_try),
        (is_between, ":var3", "itm_certificate_1", "itm_siege_supply"),
        (assign, ":var5", 0),
      (else_try),
        (is_between, ":var3", "itm_feral_horse", "itm_leather_gloves"),
        (assign, ":var5", 15),
      (else_try),
        (this_or_next|is_between, ":var3", "itm_wooden_stick", "itm_arrows"),
        (is_between, ":var3", "itm_javelin", "itm_torch"),
        (assign, ":var5", 5),
      (else_try),
        (this_or_next|is_between, ":var3", "itm_leather_gloves", "itm_native_shield_a"),
        (is_between, ":var3", "itm_native_shield_a", "itm_wooden_stick"),
        (assign, ":var5", 5),
      (try_end),
      (store_random_in_range, ":var6", 0, 100),
      (lt, ":var6", ":var5"),
      (troop_remove_item, "trp_player", ":var3"),
      (try_begin),
        (gt, ":var0", 0),
        (party_get_slot, ":var7", ":var0", 109),
        (val_add, ":var7", 110),
        (party_set_slot, ":var0", ":var7", ":var3"),
        (val_sub, ":var7", 110),
        (val_add, ":var7", 115),
        (party_set_slot, ":var0", ":var7", ":var4"),
        (val_sub, ":var7", 115),
        (val_add, ":var7", 1),
        (val_mod, ":var7", 5),
        (party_set_slot, ":var0", 109, ":var7"),
      (try_end),
    (try_end),
    (store_troop_gold, ":var8", "trp_player"),
    (store_div, ":var9", ":var8", 4),
    (store_div, ":var10", ":var8", 10),
    (store_random_in_range, ":var11", ":var10", ":var9"),
    (troop_remove_gold, "trp_player", ":var11"),
  ]),

  ("party_calculate_loot",
  [
    (store_script_param_1, ":var0"),
    (call_script, "script_calculate_main_party_shares"),
    (assign, ":var1", reg0),
    (try_for_range, ":var2", 0, 5),
      (store_add, ":var3", ":var2", 110),
      (party_get_slot, ":var4", "$g_enemy_party", ":var3"),
      (gt, ":var4", 0),
      (party_set_slot, "$g_enemy_party", ":var3", 0),
      (val_sub, ":var3", 110),
      (val_add, ":var3", 115),
      (party_get_slot, ":var5", "$g_enemy_party", ":var3"),
      (troop_add_item, "trp_temp_troop", ":var4", ":var5"),
    (try_end),
    (party_set_slot, "$g_enemy_party", 109, 0),
    (assign, ":var6", 0),
    (try_begin),
      (party_get_template_id, ":var7", "$g_enemy_party"),
      (this_or_next|eq, ":var7", "pt_stagecoach"),
      (this_or_next|party_slot_eq, "$g_enemy_party", 0, 11),
      (party_slot_eq, "$g_enemy_party", 0, 15),
      (store_mul, ":var8", 5, 30),
      (val_mul, ":var8", "$g_strength_contribution_of_player"),
      (val_div, ":var8", 100),
      (val_div, ":var8", ":var1"),
      (try_begin),
        (this_or_next|eq, ":var7", "pt_stagecoach"),
        (party_slot_eq, "$g_enemy_party", 0, 11),
        (reset_item_probabilities, 100),
        (assign, ":var9", "itm_smoked_fish"),
        (assign, ":var10", "itm_gold_bar"),
      (else_try),
        (val_div, ":var8", 2),
        (eq, ":var7", "pt_stagecoach"),
        (reset_item_probabilities, 100),
        (assign, ":var9", "itm_smoked_fish"),
        (assign, ":var10", "itm_gold_bar"),
      (else_try),
        (val_div, ":var8", 5),
        (reset_item_probabilities, 1),
        (assign, ":var9", "itm_smoked_fish"),
        (assign, ":var10", "itm_wine"),
      (try_end),
      (store_sub, ":var11", 234, "itm_smoked_fish"),
      (try_for_range, ":var12", ":var9", ":var10"),
        (store_add, ":var13", ":var12", ":var11"),
        (party_get_slot, ":var14", "$g_enemy_party", ":var13"),
        (assign, ":var15", 100),
        (val_mul, ":var15", 1000),
        (val_div, ":var15", ":var14"),
        (val_mul, ":var15", 1000),
        (val_div, ":var15", ":var14"),
        (val_mul, ":var15", 1000),
        (val_div, ":var15", ":var14"),
        (assign, reg0, ":var15"),
        (set_item_probability_in_merchandise, ":var12", ":var15"),
      (try_end),
      (troop_add_merchandise, "trp_temp_troop", itp_type_goods, ":var8"),
      (assign, reg5, ":var8"),
      (val_add, ":var6", ":var8"),
    (try_end),
    (store_mul, ":var16", 5, 3),
    (val_mul, ":var16", "$g_strength_contribution_of_player"),
    (party_get_skill_level, ":var17", "p_main_party", "skl_looting"),
    (val_add, ":var17", 10),
    (val_mul, ":var16", ":var17"),
    (val_div, ":var16", 13),
    (val_div, ":var16", ":var1"),
    (party_get_num_companion_stacks, ":var18", ":var0"),
    (try_for_range, ":var19", 0, ":var18"),
      (party_stack_get_troop_id, ":var20", ":var0", ":var19"),
      (neg|troop_is_hero, ":var20"),
      (party_stack_get_size, ":var21", ":var0", ":var19"),
      (try_for_range, ":var22", 0, ":var21"),
        (troop_clear_inventory, "trp_temp_array_a"),
        (try_for_range, ":var23", 0, 15),
          (troop_get_inventory_slot, ":var24", ":var20", ":var23"),
          (gt, ":var24", 0),
          (troop_get_inventory_slot_modifier, ":var25", ":var20", ":var23"),
          (troop_add_item, "trp_temp_array_a", ":var24", ":var25"),
        (try_end),
        (troop_loot_troop, "trp_temp_troop", "trp_temp_array_a", ":var16"),
      (try_end),
    (try_end),
    (troop_get_inventory_capacity, ":var26", "trp_temp_troop"),
    (try_for_range, ":var23", 0, ":var26"),
      (troop_get_inventory_slot, ":var24", "trp_temp_troop", ":var23"),
      (ge, ":var24", 0),
      (val_add, ":var6", 1),
    (try_end),
    (assign, reg0, ":var6"),
  ]),

  ("calculate_main_party_shares",
  [
    (assign, ":var0", 5),
    (party_get_num_companion_stacks, ":var1", "p_main_party"),
    (try_for_range, ":var2", 1, ":var1"),
      (party_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
      (try_begin),
        (neg|troop_is_hero, ":var3"),
        (party_stack_get_size, ":var4", "p_main_party", ":var2"),
        (val_add, ":var0", ":var4"),
      (else_try),
        (val_add, ":var0", 3),
      (try_end),
    (try_end),
    (assign, reg0, ":var0"),
  ]),

  ("party_give_xp_and_gold",
  [
    (store_script_param_1, ":var0"),
    (call_script, "script_calculate_main_party_shares"),
    (assign, ":var1", reg0),
    (assign, ":var2", 0),
    (party_get_num_companion_stacks, ":var3", ":var0"),
    (try_for_range, ":var4", 0, ":var3"),
      (party_stack_get_troop_id, ":var5", ":var0", ":var4"),
      (neg|troop_is_hero, ":var5"),
      (party_stack_get_size, ":var6", ":var0", ":var4"),
      (store_character_level, ":var7", ":var5"),
      (store_add, ":var8", ":var7", 10),
      (val_mul, ":var8", ":var8"),
      (val_div, ":var8", 10),
      (store_mul, ":var9", ":var8", ":var6"),
      (val_add, ":var2", ":var9"),
    (try_end),
    (val_mul, ":var2", "$g_strength_contribution_of_player"),
    (val_div, ":var2", 100),
    (val_min, ":var2", 40000),
    (assign, ":var10", ":var2"),
    (store_random_in_range, ":var11", 50, 100),
    (val_mul, ":var10", ":var11"),
    (val_div, ":var10", 100),
    (party_add_xp, "p_main_party", ":var10"),
    (store_mul, ":var12", ":var2", 5),
    (val_min, ":var12", 60000),
    (store_random_in_range, ":var11", 50, 100),
    (val_mul, ":var12", ":var11"),
    (val_div, ":var12", 100),
    (val_div, ":var12", ":var1"),
    (party_get_num_companion_stacks, ":var3", "p_main_party"),
    (try_for_range, ":var4", 0, ":var3"),
      (party_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
      (try_begin),
        (troop_is_hero, ":var5"),
        (call_script, "script_troop_add_gold", ":var5", ":var12"),
      (try_end),
    (try_end),
    (assign, ":var13", ":var2"),
    (val_div, ":var13", ":var1"),
    (call_script, "script_change_player_party_morale", ":var13"),
  ]),

  ("setup_troop_meeting",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (modify_visitors_at_site, "scn_conversation_scene"),
    (reset_visitors),
    (set_visitor, 0, "trp_player"),
    (set_visitor, 17, ":var0", ":var1"),
    (set_jump_mission, "mt_conversation_encounter"),
    (jump_to_scene, "scn_conversation_scene"),
    (change_screen_map_conversation, ":var0"),
  ]),

  ("setup_party_meeting",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (lt, "$g_encountered_party_relation", 0),
    (try_end),
    (modify_visitors_at_site, "scn_conversation_scene"),
    (reset_visitors),
    (set_visitor, 0, "trp_player"),
    (party_stack_get_troop_id, ":var1", ":var0", 0),
    (party_stack_get_troop_dna, ":var2", ":var0", 0),
    (set_visitor, 17, ":var1", ":var2"),
    (set_jump_mission, "mt_conversation_encounter"),
    (jump_to_scene, "scn_conversation_scene"),
    (change_screen_map_conversation, ":var1"),
  ]),

  ("party_remove_all_companions",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (try_for_range_backwards, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (neg|this_or_next|troop_is_hero, ":var3"),
      (eq, "$g_move_heroes", 1),
      (party_stack_get_size, ":var4", ":var0", ":var2"),
      (party_remove_members, ":var0", ":var3", ":var4"),
    (try_end),
  ]),

  ("party_remove_all_prisoners",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_prisoner_stacks, ":var1", ":var0"),
    (try_for_range_backwards, ":var2", 0, ":var1"),
      (party_prisoner_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (neg|this_or_next|troop_is_hero, ":var3"),
      (eq, "$g_move_heroes", 1),
      (party_prisoner_stack_get_size, ":var4", ":var0", ":var2"),
      (party_remove_prisoners, ":var0", ":var3", ":var4"),
    (try_end),
  ]),

  ("party_add_party_companions",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_companion_stacks, ":var2", ":var1"),
    (try_for_range, ":var3", 0, ":var2"),
      (party_stack_get_troop_id, ":var4", ":var1", ":var3"),
      (neg|this_or_next|troop_is_hero, ":var4"),
      (eq, "$g_move_heroes", 1),
      (party_stack_get_size, ":var5", ":var1", ":var3"),
      (party_add_members, ":var0", ":var4", ":var5"),
      (party_stack_get_num_wounded, ":var6", ":var1", ":var3"),
      (party_wound_members, ":var0", ":var4", ":var6"),
    (try_end),
  ]),

  ("party_add_party_prisoners",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_prisoner_stacks, ":var2", ":var1"),
    (try_for_range, ":var3", 0, ":var2"),
      (party_prisoner_stack_get_troop_id, ":var4", ":var1", ":var3"),
      (neg|this_or_next|troop_is_hero, ":var4"),
      (eq, "$g_move_heroes", 1),
      (party_prisoner_stack_get_size, ":var5", ":var1", ":var3"),
      (party_add_members, ":var0", ":var4", ":var5"),
    (try_end),
  ]),

  ("party_prisoners_add_party_companions",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_companion_stacks, ":var2", ":var1"),
    (try_for_range, ":var3", 0, ":var2"),
      (party_stack_get_troop_id, ":var4", ":var1", ":var3"),
      (neg|this_or_next|troop_is_hero, ":var4"),
      (eq, "$g_move_heroes", 1),
      (party_stack_get_size, ":var5", ":var1", ":var3"),
      (party_add_prisoners, ":var0", ":var4", ":var5"),
    (try_end),
  ]),

  ("party_prisoners_add_party_prisoners",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_prisoner_stacks, ":var2", ":var1"),
    (try_for_range, ":var3", 0, ":var2"),
      (party_prisoner_stack_get_troop_id, ":var4", ":var1", ":var3"),
      (neg|this_or_next|troop_is_hero, ":var4"),
      (eq, "$g_move_heroes", 1),
      (party_prisoner_stack_get_size, ":var5", ":var1", ":var3"),
      (party_add_prisoners, ":var0", ":var4", ":var5"),
    (try_end),
  ]),

  ("party_add_party",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (call_script, "script_party_add_party_companions", ":var0", ":var1"),
    (call_script, "script_party_prisoners_add_party_prisoners", ":var0", ":var1"),
  ]),

  ("party_copy",
  [
    (assign, "$g_move_heroes", 1),
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_clear, ":var0"),
    (call_script, "script_party_add_party", ":var0", ":var1"),
  ]),

  ("clear_party_group",
  [
    (store_script_param_1, ":var0"),
    (party_clear, ":var0"),
    (party_get_num_attached_parties, ":var1", ":var0"),
    (try_for_range, ":var2", 0, ":var1"),
      (party_get_attached_party_with_rank, ":var3", ":var0", ":var2"),
      (call_script, "script_clear_party_group", ":var3"),
    (try_end),
  ]),

  ("get_nonempty_party_in_group",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (try_begin),
      (gt, ":var1", 0),
      (assign, reg0, ":var0"),
    (else_try),
      (assign, reg0, -1),
      (party_get_num_attached_parties, ":var2", ":var0"),
      (try_for_range, ":var3", 0, ":var2"),
        (lt, reg0, 0),
        (party_get_attached_party_with_rank, ":var4", ":var0", ":var3"),
        (call_script, "script_get_nonempty_party_in_group", ":var4"),
      (try_end),
    (try_end),
  ]),

  ("collect_prisoners_from_empty_parties",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_companions, ":var2", ":var0"),
    (try_begin),
      (eq, ":var2", 0),
      (party_get_num_prisoner_stacks, ":var3", ":var0"),
      (try_for_range, ":var4", 0, ":var3"),
        (party_prisoner_stack_get_troop_id, ":var5", ":var0", ":var4"),
        (troop_is_hero, ":var5"),
        (party_add_members, ":var1", ":var5", 1),
      (try_end),
    (try_end),
    (party_get_num_attached_parties, ":var6", ":var0"),
    (try_for_range, ":var7", 0, ":var6"),
      (party_get_attached_party_with_rank, ":var8", ":var0", ":var7"),
      (call_script, "script_collect_prisoners_from_empty_parties", ":var8", ":var1"),
    (try_end),
  ]),

  ("print_casualties_to_s0",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (str_clear, s0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 0),
    (party_get_num_companion_stacks, ":var5", ":var0"),
    (try_for_range, ":var6", 0, ":var5"),
      (party_stack_get_troop_id, ":var7", ":var0", ":var6"),
      (party_stack_get_size, ":var8", ":var0", ":var6"),
      (party_stack_get_num_wounded, ":var9", ":var0", ":var6"),
      (store_sub, ":var10", ":var8", ":var9"),
      (val_add, ":var4", ":var10"),
      (val_add, ":var3", ":var9"),
      (try_begin),
        (this_or_next|gt, ":var10", 0),
        (gt, ":var9", 0),
        (store_add, reg3, ":var10", ":var9"),
        (str_store_troop_name_by_count, s1, ":var7", reg3),
        (try_begin),
          (troop_is_hero, ":var7"),
          (assign, reg3, 0),
        (try_end),
        (try_begin),
          (gt, ":var10", 0),
          (gt, ":var9", 0),
          (assign, reg4, ":var10"),
          (assign, reg5, ":var9"),
          (str_store_string, s2, "@{reg4} killed, {reg5} wounded"),
        (else_try),
          (gt, ":var10", 0),
          (str_store_string, s2, "@killed"),
        (else_try),
          (str_store_string, s2, "@wounded"),
        (try_end),
        (try_begin),
          (eq, ":var1", 1),
          (try_begin),
            (eq, ":var2", 0),
            (str_store_string, s0, "@{reg3?{reg3}:} {s1} ({s2})"),
          (else_try),
            (str_store_string, s0, "@{s0}, {reg3?{reg3}:} {s1} ({s2})"),
          (try_end),
        (else_try),
          (str_store_string, s0, "@{s0}^{reg3?{reg3}:} {s1} ({s2})"),
        (try_end),
        (val_add, ":var2", 1),
      (try_end),
    (try_end),
    (try_begin),
      (this_or_next|gt, ":var4", 0),
      (gt, ":var3", 0),
      (store_add, reg3, ":var4", ":var3"),
      (try_begin),
        (gt, ":var4", 0),
        (gt, ":var3", 0),
        (assign, reg4, ":var4"),
        (assign, reg5, ":var3"),
        (str_store_string, s2, "@{reg4} killed, {reg5} wounded"),
      (else_try),
        (gt, ":var4", 0),
        (str_store_string, s2, "@killed"),
      (else_try),
        (str_store_string, s2, "@wounded"),
      (try_end),
      (str_store_string, s0, "@{s0}^TOTAL: {reg3} ({s2})"),
    (else_try),
      (try_begin),
        (eq, ":var1", 1),
        (str_store_string, s0, "@None"),
      (else_try),
        (str_store_string, s0, "@^None"),
      (try_end),
    (try_end),
  ]),

  ("write_fit_party_members_to_stack_selection",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (party_get_num_companion_stacks, ":var2", ":var0"),
    (assign, ":var3", 2),
    (assign, ":var4", 0),
    (try_for_range, ":var5", 0, ":var2"),
      (party_stack_get_troop_id, ":var6", ":var0", ":var5"),
      (assign, ":var7", 0),
      (try_begin),
        (troop_is_hero, ":var6"),
        (try_begin),
          (neg|troop_is_wounded, ":var6"),
          (this_or_next|eq, ":var1", 0),
          (neq, ":var5", 0),
          (assign, ":var7", 1),
        (try_end),
      (else_try),
        (party_stack_get_size, ":var7", ":var0", ":var5"),
        (party_stack_get_num_wounded, ":var8", ":var0", ":var5"),
        (val_sub, ":var7", ":var8"),
      (try_end),
      (try_begin),
        (gt, ":var7", 0),
        (troop_set_slot, "trp_stack_selection_amounts", ":var3", ":var7"),
        (troop_set_slot, "trp_stack_selection_ids", ":var3", ":var6"),
        (val_add, ":var3", 1),
      (try_end),
      (val_add, ":var4", ":var7"),
    (try_end),
    (val_sub, ":var3", 2),
    (troop_set_slot, "trp_stack_selection_amounts", 0, ":var3"),
    (troop_set_slot, "trp_stack_selection_amounts", 1, ":var4"),
  ]),

  ("remove_fit_party_member_from_stack_selection",
  [
    (store_script_param, ":var0", 1),
    (val_add, ":var0", 2),
    (troop_get_slot, ":var1", "trp_stack_selection_amounts", ":var0"),
    (troop_get_slot, ":var2", "trp_stack_selection_ids", ":var0"),
    (val_sub, ":var1", 1),
    (troop_set_slot, "trp_stack_selection_amounts", ":var0", ":var1"),
    (troop_get_slot, ":var3", "trp_stack_selection_amounts", 1),
    (val_sub, ":var3", 1),
    (troop_set_slot, "trp_stack_selection_amounts", 1, ":var3"),
    (try_begin),
      (le, ":var1", 0),
      (troop_get_slot, ":var4", "trp_stack_selection_amounts", 0),
      (store_add, ":var5", ":var4", 2),
      (store_add, ":var6", ":var0", 1),
      (try_for_range, ":var7", ":var6", ":var5"),
        (store_sub, ":var8", ":var7", 1),
        (troop_get_slot, ":var9", "trp_stack_selection_amounts", ":var7"),
        (troop_set_slot, "trp_stack_selection_amounts", ":var8", ":var9"),
        (troop_get_slot, ":var9", "trp_stack_selection_ids", ":var7"),
        (troop_set_slot, "trp_stack_selection_ids", ":var8", ":var9"),
      (try_end),
      (val_sub, ":var4", 1),
      (troop_set_slot, "trp_stack_selection_amounts", 0, ":var4"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("remove_random_fit_party_member_from_stack_selection",
  [
    (troop_get_slot, ":var0", "trp_stack_selection_amounts", 1),
    (store_random_in_range, ":var1", 0, ":var0"),
    (troop_get_slot, ":var2", "trp_stack_selection_amounts", 0),
    (store_add, ":var3", ":var2", 2),
    (try_for_range, ":var4", 2, ":var3"),
      (troop_get_slot, ":var5", "trp_stack_selection_amounts", ":var4"),
      (val_sub, ":var1", ":var5"),
      (lt, ":var1", 0),
      (assign, ":var3", 0),
      (store_sub, ":var6", ":var4", 2),
    (try_end),
    (call_script, "script_remove_fit_party_member_from_stack_selection", ":var6"),
  ]),

  ("cf_training_ground_sub_routine_1_for_melee_details",
  [
    (store_script_param, ":var0", 1),
    (ge, "$temp_3", ":var0"),
    (val_add, ":var0", 1),
    (troop_get_slot, ":var1", "trp_stack_selection_ids", ":var0"),
    (str_store_troop_name, s0, ":var1"),
  ]),

  ("training_ground_sub_routine_2_for_melee_details",
  [
    (store_script_param, ":var0", 1),
    (val_sub, ":var0", 1),
    (try_begin),
      (lt, ":var0", 0),
      (call_script, "script_remove_random_fit_party_member_from_stack_selection"),
    (else_try),
      (call_script, "script_remove_fit_party_member_from_stack_selection", ":var0"),
    (try_end),
    (assign, ":var1", reg0),
    (store_sub, ":var2", "$temp_2", 1),
    (troop_set_slot, "trp_temp_array_a", ":var2", ":var1"),
    (try_begin),
      (eq, "$temp", "$temp_2"),
      (call_script, "script_start_training_at_training_ground", -1, "$temp"),
    (else_try),
      (val_add, "$temp_2", 1),
      (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
    (try_end),
  ]),

  ("cf_training_ground_sub_routine_for_training_result",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_script_param, ":var3", 4),
    (store_character_level, ":var4", ":var0"),
    (store_add, ":var5", ":var4", 5),
    (store_mul, ":var6", ":var5", 3),
    (val_min, ":var6", 100),
    (store_sub, ":var7", ":var6", "$g_training_ground_training_hardness"),
    (val_max, ":var7", 0),
    (store_sub, ":var7", 100, ":var7"),
    (val_mul, ":var7", ":var7"),
    (val_div, ":var7", 10),
    (store_mul, ":var8", ":var3", ":var7"),
    (val_div, ":var8", 1000),
    (try_begin),
      (eq, ":var0", "trp_player"),
      (val_mul, ":var8", 1),
    (else_try),
      (try_begin),
        (eq, "$g_mt_mode", 1),
        (try_begin),
          (this_or_next|troop_is_guarantee_ranged, ":var0"),
          (troop_is_guarantee_horse, ":var0"),
          (val_div, ":var8", 4),
        (try_end),
      (else_try),
        (eq, "$g_mt_mode", 3),
        (try_begin),
          (neg|troop_is_guarantee_horse, ":var0"),
          (assign, ":var8", 0),
        (try_end),
      (else_try),
        (neg|troop_is_guarantee_ranged, ":var0"),
        (assign, ":var8", 0),
      (try_end),
    (try_end),
    (val_add, ":var4", 1),
    (store_mul, ":var9", 100, ":var4"),
    (val_mul, ":var9", ":var2"),
    (val_div, ":var9", 10),
    (val_mul, ":var9", ":var8"),
    (val_div, ":var9", 500),
    (store_mul, ":var10", ":var9", 3),
    (val_div, ":var10", 2),
    (store_div, ":var11", ":var9", 2),
    (store_random_in_range, ":var12", ":var11", ":var10"),
    (gt, ":var12", 0),
    (try_begin),
      (troop_is_hero, ":var0"),
      (add_xp_to_troop, ":var12", ":var0"),
      (store_div, ":var13", ":var12", 50),
      (try_begin),
        (gt, ":var13", 0),
        (troop_raise_proficiency, ":var0", "$g_training_ground_used_weapon_proficiency", ":var13"),
      (try_end),
    (else_try),
      (party_add_xp_to_stack, "p_main_party", ":var1", ":var12"),
    (try_end),
    (assign, reg0, ":var12"),
  ]),

  ("print_troop_owned_centers_in_numbers_to_s0",
  [
    (store_script_param_1, ":var0"),
    (str_store_string, s0, "@nothing"),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (try_for_range_backwards, ":var4", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var4", 7, ":var0"),
      (try_begin),
        (party_slot_eq, ":var4", 0, 3),
        (val_add, ":var1", 1),
      (else_try),
        (party_slot_eq, ":var4", 0, 2),
        (val_add, ":var2", 1),
      (else_try),
        (val_add, ":var3", 1),
      (try_end),
    (try_end),
    (assign, ":var5", 0),
    (try_begin),
      (gt, ":var3", 0),
      (assign, reg0, ":var3"),
      (store_sub, reg1, reg0, 1),
      (str_store_string, s0, "@{reg0} village{reg1?s:}"),
      (val_add, ":var5", 1),
    (try_end),
    (try_begin),
      (gt, ":var2", 0),
      (assign, reg0, ":var2"),
      (store_sub, reg1, reg0, 1),
      (try_begin),
        (eq, ":var5", 0),
        (str_store_string, s0, "@{reg0} castle{reg1?s:}"),
      (else_try),
        (str_store_string, s0, "@{reg0} castle{reg1?s:} and {s0}"),
      (try_end),
      (val_add, ":var5", 1),
    (try_end),
    (try_begin),
      (gt, ":var1", 0),
      (assign, reg0, ":var1"),
      (store_sub, reg1, reg0, 1),
      (try_begin),
        (eq, ":var5", 0),
        (str_store_string, s0, "@{reg0} town{reg1?s:}"),
      (else_try),
        (eq, ":var5", 1),
        (str_store_string, s0, "@{reg0} town{reg1?s:} and {s0}"),
      (else_try),
        (str_store_string, s0, "@{reg0} town{reg1?s:}, {s0}"),
      (try_end),
    (try_end),
    (store_add, reg0, ":var3", ":var2"),
    (val_add, reg0, ":var1"),
  ]),

  ("get_random_melee_training_weapon",
  [
    (assign, ":var0", -1),
    (assign, ":var1", -1),
    (store_random_in_range, ":var2", 0, 3),
    (try_begin),
      (eq, ":var2", 0),
      (assign, ":var0", "itm_practice_staff"),
    (else_try),
      (eq, ":var2", 1),
      (assign, ":var0", "itm_gunclub"),
      (assign, ":var1", "itm_native_shield_b"),
    (else_try),
      (assign, ":var0", "itm_2by4"),
    (try_end),
    (assign, reg0, ":var0"),
    (assign, reg1, ":var1"),
  ]),

  ("start_training_at_training_ground",
  [
    (val_add, "$g_training_ground_training_count", 1),
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", -1),
    (assign, ":var3", -1),
    (assign, ":var4", -1),
    (assign, "$scene_num_total_gourds_destroyed", 0),
    (try_begin),
      (eq, ":var0", 8),
      (assign, "$g_training_ground_used_weapon_proficiency", 3),
      (assign, ":var2", "itm_practice_bow"),
      (try_begin),
        (eq, "$g_mt_mode", 3),
        (assign, ":var3", "itm_practice_arrows_100_amount"),
      (else_try),
        (assign, ":var3", "itm_practice_arrows_10_amount"),
      (try_end),
    (else_try),
      (eq, ":var0", 9),
      (assign, "$g_training_ground_used_weapon_proficiency", 4),
      (try_begin),
        (eq, "$g_mt_mode", 3),
        (assign, ":var2", "itm_winchester_rifle_nickel"),
        (assign, ":var3", "itm_cartridges_bolts_100"),
        (assign, ":var4", "itm_cartridges_bolts_100"),
      (else_try),
        (assign, ":var2", "itm_sharps_carbine"),
        (assign, ":var3", "itm_cartridges_bolts_10"),
      (try_end),
    (else_try),
      (eq, ":var0", 16),
      (assign, "$g_training_ground_used_weapon_proficiency", 6),
      (try_begin),
        (eq, "$g_mt_mode", 3),
        (assign, ":var2", "itm_lefau20"),
        (assign, ":var3", "itm_cartridges_100"),
        (assign, ":var4", "itm_cartridges_100"),
      (else_try),
        (assign, ":var2", "itm_rollingblock"),
        (assign, ":var3", "itm_cartridges_10"),
      (try_end),
    (else_try),
      (eq, ":var0", 10),
      (assign, "$g_training_ground_used_weapon_proficiency", 5),
      (try_begin),
        (eq, "$g_mt_mode", 3),
        (assign, ":var2", "itm_throwing_knife"),
        (assign, ":var3", "itm_throwing_knife"),
        (assign, ":var4", "itm_throwing_knife"),
      (else_try),
        (assign, ":var2", "itm_throwing_knife"),
      (try_end),
    (else_try),
      (eq, ":var0", 2),
      (assign, "$g_training_ground_used_weapon_proficiency", 0),
      (assign, ":var2", "itm_practice_sword"),
    (else_try),
      (eq, ":var0", 4),
      (assign, "$g_training_ground_used_weapon_proficiency", 2),
      (assign, ":var2", "itm_practice_lance"),
    (else_try),
      (assign, "$g_training_ground_used_weapon_proficiency", 0),
      (call_script, "script_get_random_melee_training_weapon"),
      (assign, ":var2", reg0),
      (assign, ":var3", reg1),
    (try_end),
    (try_begin),
      (eq, "$g_mt_mode", 3),
      (assign, ":var4", "itm_practice_horse"),
      (store_add, "$g_training_ground_training_scene", "scn_training_ground_horse_track_1", "$g_encountered_party"),
      (val_sub, "$g_training_ground_training_scene", "p_training_ground_1"),
    (else_try),
      (store_add, "$g_training_ground_training_scene", "scn_training_ground_ranged_melee_1", "$g_encountered_party"),
      (val_sub, "$g_training_ground_training_scene", "p_training_ground_1"),
    (try_end),
    (modify_visitors_at_site, "$g_training_ground_training_scene"),
    (reset_visitors),
    (set_visitor, 0, "trp_player"),
    (assign, ":var5", -1),
    (mission_tpl_entry_clear_override_items, "mt_training_ground_training", 0),
    (mission_tpl_entry_add_override_item, "mt_training_ground_training", 0, "itm_practice_boots"),
    (try_begin),
      (ge, ":var2", 0),
      (try_begin),
        (ge, ":var5", 0),
        (mission_tpl_entry_add_override_item, "mt_training_ground_training", 0, ":var5"),
      (else_try),
        (mission_tpl_entry_add_override_item, "mt_training_ground_training", 0, ":var2"),
      (try_end),
    (try_end),
    (try_begin),
      (ge, ":var3", 0),
      (mission_tpl_entry_add_override_item, "mt_training_ground_training", 0, ":var3"),
    (try_end),
    (try_begin),
      (ge, ":var4", 0),
      (mission_tpl_entry_add_override_item, "mt_training_ground_training", 0, ":var4"),
    (try_end),
    (assign, ":var6", 5),
    (troop_get_slot, ":var7", "trp_stack_selection_amounts", 1),
    (store_add, ":var8", 5, ":var7"),
    (val_min, ":var8", 13),
    (try_for_range, ":var6", 5, ":var8"),
      (call_script, "script_remove_random_fit_party_member_from_stack_selection"),
      (set_visitor, ":var6", reg0),
      (val_add, ":var6", 1),
    (try_end),
    (try_begin),
      (eq, "$g_mt_mode", 1),
      (assign, ":var9", 0),
      (try_for_range, ":var10", 0, ":var1"),
        (troop_get_slot, ":var11", "trp_temp_array_a", ":var10"),
        (store_add, ":var12", ":var10", 1),
        (set_visitor, ":var12", ":var11"),
        (mission_tpl_entry_clear_override_items, "mt_training_ground_training", ":var12"),
        (mission_tpl_entry_add_override_item, "mt_training_ground_training", ":var12", "itm_practice_boots"),
        (call_script, "script_get_random_melee_training_weapon"),
        (mission_tpl_entry_add_override_item, "mt_training_ground_training", ":var12", reg0),
        (try_begin),
          (ge, reg1, 0),
          (mission_tpl_entry_add_override_item, "mt_training_ground_training", ":var12", reg1),
        (try_end),
        (store_character_level, ":var13", ":var11"),
        (val_add, ":var13", 10),
        (val_mul, ":var13", ":var13"),
        (val_add, ":var9", ":var13"),
      (try_end),
      (assign, "$g_training_ground_training_num_enemies", ":var1"),
      (assign, "$g_training_ground_training_hardness", ":var9"),
      (store_add, ":var14", "$g_training_ground_training_num_enemies", 4),
      (val_mul, "$g_training_ground_training_hardness", ":var14"),
      (val_div, "$g_training_ground_training_hardness", 2400),
      (str_store_string, s0, "@Your opponents are ready for the fight."),
    (else_try),
      (eq, "$g_mt_mode", 3),
      (try_begin),
        (eq, ":var0", 8),
        (assign, "$g_training_ground_training_hardness", 350),
        (assign, "$g_training_ground_training_num_gourds_to_destroy", 30),
      (else_try),
        (eq, ":var0", 10),
        (assign, "$g_training_ground_training_hardness", 400),
        (assign, "$g_training_ground_training_num_gourds_to_destroy", 20),
        (assign, ":var2", "itm_throwing_knife"),
        (assign, ":var3", "itm_throwing_knife"),
        (assign, ":var4", "itm_throwing_knife"),
      (else_try),
        (eq, ":var0", 2),
        (assign, "$g_training_ground_training_hardness", 200),
        (assign, "$g_training_ground_training_num_gourds_to_destroy", 45),
      (else_try),
        (eq, ":var0", 4),
        (assign, "$g_training_ground_training_hardness", 280),
        (assign, "$g_training_ground_training_num_gourds_to_destroy", 35),
      (else_try),
        (eq, ":var0", 9),
        (assign, "$g_training_ground_training_hardness", 300),
        (assign, "$g_training_ground_training_num_gourds_to_destroy", 40),
      (else_try),
        (eq, ":var0", 16),
        (assign, "$g_training_ground_training_hardness", 350),
        (assign, "$g_training_ground_training_num_gourds_to_destroy", 35),
      (try_end),
      (str_store_string, s0, "@Try to destroy as many targets as you can. You have two and a half minutes to clear the track."),
    (else_try),
      (eq, "$g_mt_mode", 2),
      (store_mul, "$g_training_ground_ranged_distance", ":var1", 100),
      (assign, ":var15", ":var1"),
      (val_mul, ":var15", ":var15"),
      (try_begin),
        (eq, ":var0", 8),
        (val_mul, ":var15", 3),
        (val_div, ":var15", 2),
      (else_try),
        (eq, ":var0", 16),
        (val_mul, ":var15", 3),
        (val_div, ":var15", 2),
      (else_try),
        (eq, ":var0", 10),
        (val_mul, ":var15", 5),
        (val_div, ":var15", 2),
        (val_mul, ":var15", ":var1"),
        (val_div, ":var15", 2),
      (try_end),
      (store_mul, "$g_training_ground_training_hardness", 100, ":var15"),
      (val_div, "$g_training_ground_training_hardness", 6000),
      (str_store_string, s0, "@Stay behind the line on the ground and shoot the targets. Try not to waste any shots."),
    (try_end),
    (jump_to_menu, "mnu_training_ground_description"),
  ]),

  ("party_count_fit_regulars",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (assign, reg0, 0),
    (try_for_range, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (neg|troop_is_hero, ":var3"),
      (party_stack_get_size, ":var4", ":var0", ":var2"),
      (party_stack_get_num_wounded, ":var5", ":var0", ":var2"),
      (val_sub, ":var4", ":var5"),
      (val_add, reg0, ":var4"),
    (try_end),
  ]),

  ("party_count_fit_for_battle",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (assign, reg0, 0),
    (try_for_range, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (assign, ":var4", 0),
      (try_begin),
        (troop_is_hero, ":var3"),
        (try_begin),
          (neg|troop_is_wounded, ":var3"),
          (assign, ":var4", 1),
        (try_end),
      (else_try),
        (party_stack_get_size, ":var4", ":var0", ":var2"),
        (party_stack_get_num_wounded, ":var5", ":var0", ":var2"),
        (val_sub, ":var4", ":var5"),
      (try_end),
      (val_add, reg0, ":var4"),
    (try_end),
  ]),

  ("party_count_members_with_full_health",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (assign, reg0, 0),
    (try_for_range, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (assign, ":var4", 0),
      (try_begin),
        (troop_is_hero, ":var3"),
        (neq, ":var3", "trp_player"),
        (store_troop_health, ":var5", ":var3"),
        (try_begin),
          (ge, ":var5", 80),
          (assign, ":var4", 1),
        (try_end),
      (else_try),
        (party_stack_get_size, ":var4", ":var0", ":var2"),
        (party_stack_get_num_wounded, ":var6", ":var0", ":var2"),
        (val_sub, ":var4", ":var6"),
        (val_max, ":var4", 0),
      (try_end),
      (val_add, reg0, ":var4"),
    (try_end),
  ]),

  ("get_stack_with_rank",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_companion_stacks, ":var2", ":var0"),
    (assign, reg0, -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", 0, ":var2"),
      (eq, reg0, -1),
      (party_stack_get_troop_id, ":var5", ":var0", ":var4"),
      (neg|troop_is_hero, ":var5"),
      (party_stack_get_size, ":var6", ":var0", ":var4"),
      (party_stack_get_num_wounded, ":var7", ":var0", ":var4"),
      (val_sub, ":var6", ":var7"),
      (val_add, ":var3", ":var6"),
      (try_begin),
        (lt, ":var1", ":var3"),
        (assign, reg0, ":var4"),
      (try_end),
    (try_end),
  ]),

  ("inflict_casualties_to_party",
  [
    (party_clear, "p_temp_casualties"),
    (store_script_param_1, ":var0"),
    (call_script, "script_party_count_fit_regulars", ":var0"),
    (assign, ":var1", reg0),
    (store_script_param_2, ":var2"),
    (try_for_range, ":var3", 0, ":var2"),
      (gt, ":var1", 0),
      (store_random_in_range, ":var4", 0, ":var1"),
      (assign, reg1, ":var4"),
      (call_script, "script_get_stack_with_rank", ":var0", ":var4"),
      (assign, ":var5", reg0),
      (party_stack_get_troop_id, ":var6", ":var0", ":var5"),
      (store_character_level, ":var7", ":var6"),
      (val_add, ":var7", 5),
      (assign, ":var8", 10000),
      (val_div, ":var8", ":var7"),
      (try_begin),
        (store_random_in_range, ":var9", 0, 10000),
        (lt, ":var9", ":var8"),
        (store_random_in_range, ":var10", 0, 2),
        (try_begin),
          (troop_is_hero, ":var6"),
          (store_troop_health, ":var11", ":var6"),
          (val_sub, ":var11", 45),
          (val_max, ":var11", 1),
          (troop_set_health, ":var6", ":var11"),
        (else_try),
          (lt, ":var10", 1),
          (party_add_members, "p_temp_casualties", ":var6", 1),
          (party_wound_members, "p_temp_casualties", ":var6", 1),
          (party_wound_members, ":var0", ":var6", 1),
        (else_try),
          (party_add_members, "p_temp_casualties", ":var6", 1),
          (party_remove_members, ":var0", ":var6", 1),
        (try_end),
        (val_sub, ":var1", 1),
      (try_end),
    (try_end),
  ]),

  ("move_members_with_ratio",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_prisoner_stacks, ":var2", ":var0"),
    (try_for_range_backwards, ":var3", 0, ":var2"),
      (party_prisoner_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (party_prisoner_stack_get_size, ":var5", ":var0", ":var3"),
      (store_mul, ":var6", ":var5", "$pin_number"),
      (val_div, ":var6", 1000),
      (party_remove_prisoners, ":var0", ":var4", ":var6"),
      (assign, ":var7", reg0),
      (party_add_prisoners, ":var1", ":var4", ":var7"),
    (try_end),
    (party_get_num_companion_stacks, ":var2", ":var0"),
    (try_for_range_backwards, ":var3", 0, ":var2"),
      (party_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (party_stack_get_size, ":var5", ":var0", ":var3"),
      (store_mul, ":var6", ":var5", "$pin_number"),
      (val_div, ":var6", 1000),
      (party_remove_members, ":var0", ":var4", ":var6"),
      (assign, ":var7", reg0),
      (party_add_members, ":var1", ":var4", ":var7"),
    (try_end),
  ]),

  ("count_parties_of_faction_and_party_type",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, reg0, 0),
    (try_for_parties, ":var2"),
      (party_is_active, ":var2"),
      (party_get_slot, ":var3", ":var2", 0),
      (store_faction_of_party, ":var4", ":var2"),
      (eq, ":var3", ":var1"),
      (eq, ":var4", ":var0"),
      (val_add, reg0, 1),
    (try_end),
  ]),

  ("faction_get_number_of_armies",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (store_troop_faction, ":var3", ":var2"),
      (eq, ":var3", ":var0"),
      (troop_get_slot, ":var4", ":var2", 10),
      (ge, ":var4", 0),
      (call_script, "script_party_count_fit_regulars", ":var4"),
      (assign, ":var5", reg0),
      (call_script, "script_party_get_ideal_size", ":var4"),
      (assign, ":var6", reg0),
      (val_mul, ":var6", 60),
      (val_div, ":var6", 100),
      (gt, ":var5", ":var6"),
      (val_add, ":var1", 1),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("faction_recalculate_strength",
  [
    (store_script_param_1, ":var0"),
    (call_script, "script_faction_get_number_of_armies", ":var0"),
    (assign, ":var1", reg0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (try_begin),
        (party_slot_eq, ":var4", 0, 2),
        (val_add, ":var2", 1),
      (else_try),
        (party_slot_eq, ":var4", 0, 3),
        (val_add, ":var3", 1),
      (try_end),
    (try_end),
    (faction_set_slot, ":var0", 80, ":var1"),
    (faction_set_slot, ":var0", 81, ":var2"),
    (faction_set_slot, ":var0", 82, ":var3"),
  ]),

  ("cf_select_random_town_with_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_town_1", "p_castle_1"),
      (store_faction_of_party, ":var4", ":var3"),
      (eq, ":var4", ":var0"),
      (val_add, ":var2", 1),
    (try_end),
    (gt, ":var2", 0),
    (store_random_in_range, ":var5", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_town_1", "p_castle_1"),
      (eq, ":var1", -1),
      (store_faction_of_party, ":var4", ":var3"),
      (eq, ":var4", ":var0"),
      (val_add, ":var2", 1),
      (gt, ":var2", ":var5"),
      (assign, ":var1", ":var3"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("cf_select_random_village_with_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_village_1", "p_salt_mine"),
      (store_faction_of_party, ":var4", ":var3"),
      (eq, ":var4", ":var0"),
      (val_add, ":var2", 1),
    (try_end),
    (gt, ":var2", 0),
    (store_random_in_range, ":var5", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_village_1", "p_salt_mine"),
      (eq, ":var1", -1),
      (store_faction_of_party, ":var4", ":var3"),
      (eq, ":var4", ":var0"),
      (val_add, ":var2", 1),
      (gt, ":var2", ":var5"),
      (assign, ":var1", ":var3"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("cf_select_random_walled_center_with_faction",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "p_town_1", "p_village_1"),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (val_add, ":var3", 1),
      (eq, ":var4", ":var1"),
      (val_add, ":var3", 99),
    (try_end),
    (gt, ":var3", 0),
    (store_random_in_range, ":var6", 0, ":var3"),
    (try_for_range, ":var4", "p_town_1", "p_village_1"),
      (eq, ":var2", -1),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (val_sub, ":var6", 1),
      (try_begin),
        (eq, ":var4", ":var1"),
        (val_sub, ":var6", 99),
      (try_end),
      (lt, ":var6", 0),
      (assign, ":var2", ":var4"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("cf_select_random_walled_center_with_faction_and_owner_priority_no_siege",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "p_town_1", "p_village_1"),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (party_slot_eq, ":var4", 54, -1),
      (val_add, ":var3", 1),
      (party_slot_eq, ":var4", 7, ":var1"),
      (val_add, ":var3", 1000),
    (try_end),
    (gt, ":var3", 0),
    (store_random_in_range, ":var6", 0, ":var3"),
    (try_for_range, ":var4", "p_town_1", "p_village_1"),
      (eq, ":var2", -1),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (party_slot_eq, ":var4", 54, -1),
      (val_sub, ":var6", 1),
      (try_begin),
        (party_slot_eq, ":var4", 7, ":var1"),
        (val_sub, ":var6", 1000),
      (try_end),
      (lt, ":var6", 0),
      (assign, ":var2", ":var4"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("cf_select_random_walled_center_with_faction_and_less_strength_priority",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "p_town_1", "p_village_1"),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (party_slot_eq, ":var4", 54, -1),
      (val_add, ":var3", 1),
      (try_begin),
        (eq, ":var4", ":var1"),
        (val_add, ":var3", 99),
      (try_end),
    (try_end),
    (gt, ":var3", 0),
    (store_random_in_range, ":var6", 0, ":var3"),
    (try_for_range, ":var4", "p_town_1", "p_village_1"),
      (eq, ":var2", -1),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (party_slot_eq, ":var4", 54, -1),
      (val_sub, ":var6", 1),
      (try_begin),
        (eq, ":var4", ":var1"),
        (val_sub, ":var6", 99),
      (try_end),
      (lt, ":var6", 0),
      (assign, ":var2", ":var4"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("cf_select_random_town_at_peace_with_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_town_1", "p_castle_1"),
      (store_faction_of_party, ":var4", ":var3"),
      (store_relation, ":var5", ":var4", ":var0"),
      (ge, ":var5", 0),
      (val_add, ":var2", 1),
    (try_end),
    (gt, ":var2", 0),
    (store_random_in_range, ":var6", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_town_1", "p_castle_1"),
      (eq, ":var1", -1),
      (store_faction_of_party, ":var4", ":var3"),
      (store_relation, ":var5", ":var4", ":var0"),
      (ge, ":var5", 0),
      (val_add, ":var2", 1),
      (gt, ":var2", ":var6"),
      (assign, ":var1", ":var3"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("cf_select_random_town_at_peace_with_faction_in_trade_route",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", 190, 205),
      (party_get_slot, ":var5", ":var0", ":var4"),
      (gt, ":var5", 0),
      (store_faction_of_party, ":var6", ":var5"),
      (store_relation, ":var7", ":var6", ":var1"),
      (ge, ":var7", 0),
      (val_add, ":var3", 1),
    (try_end),
    (gt, ":var3", 0),
    (store_random_in_range, ":var8", 0, ":var3"),
    (try_for_range, ":var4", 190, 205),
      (eq, ":var2", -1),
      (party_get_slot, ":var5", ":var0", ":var4"),
      (gt, ":var5", 0),
      (store_faction_of_party, ":var6", ":var5"),
      (store_relation, ":var7", ":var6", ":var1"),
      (ge, ":var7", 0),
      (val_sub, ":var8", 1),
      (lt, ":var8", 0),
      (assign, ":var2", ":var5"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("shuffle_troop_slots",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (try_for_range, ":var3", ":var1", ":var2"),
      (store_random_in_range, ":var4", ":var1", ":var2"),
      (troop_get_slot, ":var5", ":var0", ":var3"),
      (troop_get_slot, ":var6", ":var0", ":var4"),
      (troop_set_slot, ":var0", ":var3", ":var6"),
      (troop_set_slot, ":var0", ":var4", ":var5"),
    (try_end),
  ]),

  ("get_random_quest",
  [
    (store_script_param_1, ":var0"),
    (store_character_level, ":var1", "trp_player"),
    (store_troop_faction, ":var2", ":var0"),
    (troop_get_slot, ":var3", ":var0", 10),
    (troop_get_slot, ":var4", ":var0", 52),
    (assign, ":var5", -1),
    (try_begin),
      (gt, ":var3", 0),
      (party_get_attached_to, ":var5", ":var3"),
    (else_try),
      (is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
      (assign, ":var5", "$g_encountered_party"),
    (try_end),
    (try_begin),
      (troop_slot_eq, ":var0", 2, 2),
      (try_begin),
        (ge, "$g_talk_troop_faction_relation", 0),
        (assign, ":var6", "qst_deliver_message"),
        (assign, ":var7", "qst_follow_army"),
      (else_try),
        (assign, ":var6", "qst_lend_surgeon"),
        (assign, ":var7", "qst_follow_army"),
      (try_end),
    (else_try),
      (is_between, ":var0", "trp_village_1_elder", "trp_merchants_end"),
      (assign, ":var6", "qst_deliver_grain"),
      (assign, ":var7", "qst_eliminate_bandits_infesting_village"),
    (else_try),
      (is_between, ":var0", "trp_town_1_mayor", "trp_village_1_elder"),
      (assign, ":var6", "qst_move_cattle_herd"),
      (assign, ":var7", "qst_deliver_grain"),
    (else_try),
      (assign, ":var6", "qst_rescue_lord_by_replace"),
      (assign, ":var7", "qst_move_cattle_herd"),
    (try_end),
    (assign, ":var8", -1),
    (try_for_range, ":var9", 0, 20),
      (eq, ":var8", -1),
      (assign, ":var10", -1),
      (assign, ":var11", -1),
      (assign, ":var12", -1),
      (assign, ":var13", -1),
      (assign, ":var14", -1),
      (assign, ":var15", -1),
      (assign, ":var16", -1),
      (assign, ":var17", -1),
      (assign, ":var18", -1),
      (assign, ":var19", -1),
      (assign, ":var20", -1),
      (assign, ":var21", 1),
      (assign, ":var22", 0),
      (assign, ":var23", 0),
      (assign, ":var24", 0),
      (assign, ":var25", 0),
      (assign, ":var26", 0),
      (store_random_in_range, ":var27", ":var6", ":var7"),
      (neq, ":var27", "qst_hunt_down_fugitive"),
      (neq, ":var27", "qst_persuade_lords_to_make_peace"),
      (neq, ":var27", "qst_escort_lady"),
      (neq, ":var27", "qst_bring_back_runaway_serfs"),
      (neq, ":var27", "qst_deliver_wine"),
      (neq, ":var27", "qst_raid_caravan_to_start_war"),
      (neq, ":var27", "qst_deliver_message_to_prisoner_lord"),
      (neq, ":var27", "qst_kill_local_merchant"),
      (neq, ":var27", "qst_deliver_message"),
      (neg|check_quest_active, ":var27"),
      (neg|quest_slot_ge, ":var27", 25, 1),
      (try_begin),
        (eq, ":var27", "qst_deliver_grain"),
        (try_begin),
          (is_between, ":var5", "p_village_1", "p_salt_mine"),
          (call_script, "script_get_troop_item_amount", ":var0", "itm_grain"),
          (eq, reg0, 0),
          (neg|party_slot_ge, ":var5", 50, 40),
          (assign, ":var11", ":var5"),
          (store_random_in_range, ":var18", 4, 8),
          (assign, ":var25", 30),
          (assign, ":var26", 20),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_escort_villagers"),
        (is_between, ":var5", "p_village_1", "p_salt_mine"),
        (store_random_party_in_range, ":var11", "p_town_1", "p_castle_1"),
        (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
        (assign, ":var23", ":var28"),
        (val_add, ":var23", 25),
        (val_mul, ":var23", 25),
        (val_div, ":var23", 10),
        (store_random_in_range, ":var18", 3, 6),
        (assign, "$escort_villagers_mode", 0),
        (assign, ":var26", 7),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_deliver_cattle"),
        (try_begin),
          (is_between, ":var5", "p_village_1", "p_salt_mine"),
          (party_get_slot, ":var29", ":var5", 45),
          (lt, ":var29", 50),
          (assign, ":var11", ":var5"),
          (store_random_in_range, ":var18", 5, 10),
          (assign, ":var25", 30),
          (assign, ":var26", 20),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_train_peasants_against_bandits"),
        (try_begin),
          (is_between, ":var5", "p_village_1", "p_salt_mine"),
          (store_skill_level, ":var30", "skl_trainer", "trp_player"),
          (gt, ":var30", 0),
          (store_random_in_range, ":var18", 5, 8),
          (assign, ":var11", ":var5"),
          (assign, ":var25", 20),
          (assign, ":var26", 40),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_escort_merchant_caravan"),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (store_random_party_in_range, ":var11", "p_town_1", "p_town_1b"),
        (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
        (assign, ":var23", ":var28"),
        (val_add, ":var23", 25),
        (val_mul, ":var23", 25),
        (val_div, ":var23", 5),
        (store_random_in_range, ":var18", 6, 12),
        (assign, "$escort_merchant_caravan_mode", 0),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_deliver_wine"),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (store_random_party_in_range, ":var11", "p_town_1", "p_town_1b"),
        (store_random_in_range, ":var31", 0, 2),
        (try_begin),
          (eq, ":var31", 0),
          (assign, ":var20", "itm_quest_wine"),
        (else_try),
          (assign, ":var20", "itm_quest_ale"),
        (try_end),
        (store_random_in_range, ":var18", 6, 12),
        (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
        (assign, ":var23", ":var28"),
        (val_add, ":var23", 2),
        (assign, ":var32", 5),
        (val_add, ":var32", ":var18"),
        (val_mul, ":var23", ":var32"),
        (val_div, ":var23", 100),
        (val_mul, ":var23", 20),
        (store_item_value, "$qst_deliver_wine_debt", ":var20"),
        (val_mul, "$qst_deliver_wine_debt", ":var18"),
        (val_mul, "$qst_deliver_wine_debt", 6),
        (val_div, "$qst_deliver_wine_debt", 5),
        (assign, ":var25", 7),
        (assign, ":var26", 20),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_troublesome_bandits"),
        (ge, ":var1", 10),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (store_character_level, ":var23", "trp_player"),
        (val_add, ":var23", 20),
        (val_mul, ":var23", 35),
        (val_div, ":var23", 100),
        (val_mul, ":var23", 100),
        (assign, ":var25", 30),
        (assign, ":var26", 30),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_kidnapped_girl"),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (store_random_in_range, ":var11", "p_village_1", "p_salt_mine"),
        (store_character_level, ":var18"),
        (val_add, ":var18", 15),
        (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
        (val_add, ":var28", 15),
        (val_mul, ":var28", 2),
        (val_mul, ":var18", ":var28"),
        (assign, ":var23", ":var18"),
        (val_div, ":var23", 40),
        (val_mul, ":var23", 10),
        (assign, ":var26", 30),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_move_cattle_herd"),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (call_script, "script_cf_select_random_town_at_peace_with_faction", ":var2"),
        (neq, ":var5", reg0),
        (assign, ":var11", reg0),
        (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
        (assign, ":var23", ":var28"),
        (val_add, ":var23", 25),
        (val_mul, ":var23", 50),
        (val_div, ":var23", 4),
        (assign, ":var25", 20),
        (assign, ":var26", 20),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_move_horses_herd"),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (call_script, "script_cf_select_random_town_at_peace_with_faction", ":var2"),
        (neq, ":var5", reg0),
        (assign, ":var11", reg0),
        (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
        (assign, ":var23", ":var28"),
        (val_add, ":var23", 25),
        (val_mul, ":var23", 50),
        (val_div, ":var23", 8),
        (assign, ":var25", 14),
        (assign, ":var26", 7),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_hideout"),
        (try_begin),
          (is_between, ":var1", 5, 15),
          (assign, ":var21", 1),
          (assign, ":var22", 200),
          (store_div, ":var33", 100, ":var1"),
          (assign, ":var25", ":var33"),
          (assign, ":var26", ":var1"),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_persuade_lords_to_make_peace"),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var34", ":var5"),
        (call_script, "script_cf_faction_get_random_enemy_faction", ":var34"),
        (assign, ":var35", reg0),
        (call_script, "script_cf_get_random_lord_except_king_with_faction", ":var34"),
        (assign, ":var36", reg0),
        (call_script, "script_cf_get_random_lord_except_king_with_faction", ":var35"),
        (assign, ":var10", reg0),
        (assign, ":var14", ":var36"),
        (assign, ":var12", ":var35"),
        (assign, ":var13", ":var34"),
        (assign, ":var23", 12000),
        (assign, ":var24", 7000),
        (assign, ":var25", 30),
        (assign, ":var26", 100),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_deal_with_looters"),
        (is_between, ":var1", 0, 15),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var34", ":var5"),
        (store_num_parties_destroyed_by_player, ":var37", "pt_looters"),
        (party_template_set_slot, "pt_looters", 1, ":var37"),
        (quest_set_slot, "$random_merchant_quest_no", 11, 0),
        (quest_set_slot, "$random_merchant_quest_no", 9, "pt_looters"),
        (assign, ":var23", 500),
        (assign, ":var22", 500),
        (assign, ":var25", 20),
        (assign, ":var26", 30),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_deal_with_night_bandits"),
        (is_between, ":var1", 0, 15),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (party_slot_ge, ":var5", 149, 1),
        (assign, ":var11", ":var5"),
        (assign, ":var25", 4),
        (assign, ":var26", 15),
        (assign, ":var8", ":var27"),
      (else_try),
        (eq, ":var27", "qst_rescue_lord_by_replace"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (is_between, ":var1", 5, 25),
          (troop_get_slot, ":var38", ":var0", 31),
          (try_begin),
            (eq, ":var38", 0),
            (troop_get_slot, ":var38", ":var0", 30),
          (try_end),
          (troop_slot_ge, ":var38", 8, 0),
          (call_script, "script_search_troop_prisoner_of_party", ":var38"),
          (assign, ":var39", reg0),
          (is_between, ":var39", "p_town_1", "p_castle_1"),
          (assign, ":var11", ":var39"),
          (assign, ":var10", ":var38"),
          (assign, ":var25", 30),
          (assign, ":var26", 73),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_deliver_message_to_prisoner_lord"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (is_between, ":var1", 5, 25),
          (troop_get_slot, ":var38", ":var0", 31),
          (try_begin),
            (eq, ":var38", 0),
            (troop_get_slot, ":var38", ":var0", 30),
          (try_end),
          (troop_slot_ge, ":var38", 8, 0),
          (call_script, "script_search_troop_prisoner_of_party", ":var38"),
          (assign, ":var39", reg0),
          (is_between, ":var39", "p_town_1", "p_castle_1"),
          (assign, ":var11", ":var39"),
          (assign, ":var10", ":var38"),
          (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
          (assign, ":var23", ":var28"),
          (assign, ":var25", 30),
          (assign, ":var26", 30),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_duel_for_lady"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (ge, ":var1", 10),
          (call_script, "script_cf_troop_get_random_enemy_troop_with_occupation", ":var0", 2),
          (assign, ":var38", reg0),
          (neg|troop_slot_eq, ":var0", 30, ":var38"),
          (neg|troop_slot_eq, ":var0", 31, ":var38"),
          (neg|troop_slot_ge, ":var38", 8, 0),
          (troop_slot_ge, ":var38", 10, 0),
          (neg|troop_slot_eq, ":var38", 52, 6),
          (neg|troop_slot_eq, ":var38", 52, 7),
          (assign, ":var10", ":var38"),
          (assign, ":var25", 30),
          (assign, ":var26", 50),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_lend_surgeon"),
        (try_begin),
          (eq, "$g_defending_against_siege", 0),
          (neq, ":var4", 2),
          (neq, ":var4", 5),
          (assign, ":var40", 0),
          (assign, ":var41", -1),
          (party_get_num_companion_stacks, ":var42", "p_main_party"),
          (try_for_range, ":var43", 1, ":var42"),
            (party_stack_get_troop_id, ":var44", "p_main_party", ":var43"),
            (troop_is_hero, ":var44"),
            (store_skill_level, ":var45", skl_surgery, ":var44"),
            (gt, ":var45", ":var40"),
            (assign, ":var40", ":var45"),
            (assign, ":var41", ":var44"),
          (try_end),
          (store_character_level, ":var46", "trp_player"),
          (assign, ":var47", 5),
          (val_div, ":var46", 10),
          (val_add, ":var47", ":var46"),
          (ge, ":var40", ":var47"),
          (assign, ":var14", ":var41"),
          (assign, ":var21", 1),
          (assign, ":var22", 100),
          (assign, ":var23", 1000),
          (assign, ":var26", 50),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_meet_spy_in_enemy_town"),
        (try_begin),
          (eq, "$players_kingdom", ":var2"),
          (neq, ":var4", 6),
          (call_script, "script_troop_get_player_relation", ":var0"),
          (assign, ":var48", reg0),
          (gt, ":var48", 3),
          (call_script, "script_cf_faction_get_random_enemy_faction", ":var2"),
          (assign, ":var49", reg0),
          (store_relation, ":var50", ":var49", "fac_player_supporters_faction"),
          (lt, ":var50", 0),
          (call_script, "script_cf_select_random_town_with_faction", ":var49"),
          (assign, ":var39", reg0),
          (call_script, "script_cf_center_get_free_walker", ":var39"),
          (assign, ":var11", ":var39"),
          (store_random_in_range, ":var18", "str_secret_sign_1", "str_countersign_1"),
          (assign, ":var8", ":var27"),
          (assign, ":var23", 500),
          (assign, ":var25", 30),
          (assign, ":var26", 50),
          (quest_set_slot, "qst_meet_spy_in_enemy_town", 22, 500),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_raid_caravan_to_start_war"),
        (try_begin),
          (eq, "$players_kingdom", ":var2"),
          (this_or_next|eq, ":var4", 4),
          (this_or_next|eq, ":var4", 2),
          (eq, ":var4", 5),
          (gt, ":var1", 10),
          (neg|faction_slot_eq, ":var2", 10, ":var0"),
          (call_script, "script_cf_faction_get_random_friendly_faction", ":var2"),
          (assign, ":var12", reg0),
          (store_troop_faction, ":var13", ":var0"),
          (assign, ":var17", "pt_kingdom_caravan_party"),
          (assign, ":var18", 2),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 30),
          (assign, ":var26", 100),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_deliver_message"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (gt, ":var1", 0),
          (call_script, "script_cf_get_random_lord_in_a_center_with_faction", ":var2"),
          (assign, ":var38", reg0),
          (neq, ":var38", ":var0"),
          (call_script, "script_get_troop_attached_party", ":var38"),
          (assign, ":var39", reg0),
          (neq, ":var5", ":var39"),
          (assign, ":var11", ":var39"),
          (assign, ":var10", ":var38"),
          (assign, ":var22", 50),
          (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
          (assign, ":var23", ":var28"),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 30),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_escort_lady"),
        (try_begin),
          (ge, "$g_talk_troop_relation", 10),
          (ge, "$g_talk_troop_faction_relation", 0),
          (ge, ":var1", 10),
          (troop_get_slot, ":var36", ":var0", 33),
          (store_random_in_range, ":var31", 0, 2),
          (try_begin),
            (this_or_next|eq, ":var36", 0),
            (eq, ":var31", 0),
            (troop_get_slot, ":var51", ":var0", 30),
            (gt, ":var51", 0),
            (assign, ":var36", ":var51"),
          (try_end),
          (gt, ":var36", 0),
          (troop_get_type, ":var52", ":var36"),
          (eq, ":var52", 1),
          (gt, ":var5", 0),
          (troop_slot_eq, ":var36", 12, ":var5"),
          (call_script, "script_cf_select_random_town_with_faction", ":var2"),
          (assign, ":var39", reg0),
          (neq, ":var39", ":var5"),
          (hero_can_join),
          (assign, ":var14", ":var36"),
          (assign, ":var11", ":var39"),
          (assign, ":var25", 20),
          (assign, ":var26", 30),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_bring_back_deserters"),
        (try_begin),
          (gt, ":var1", 5),
          (faction_get_slot, ":var38", ":var2", 43),
          (store_random_in_range, ":var53", 2, 7),
          (assign, ":var10", ":var38"),
          (assign, ":var18", ":var53"),
          (assign, ":var21", 1),
          (assign, ":var22", 200),
          (val_mul, ":var22", ":var53"),
          (assign, ":var23", 300),
          (val_mul, ":var23", ":var53"),
          (store_div, ":var33", 100, ":var1"),
          (assign, ":var25", ":var33"),
          (assign, ":var26", ":var1"),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_hideout2"),
        (try_begin),
          (is_between, ":var1", 5, 35),
          (assign, ":var21", 1),
          (assign, ":var22", 600),
          (store_div, ":var33", 100, ":var1"),
          (assign, ":var25", ":var33"),
          (assign, ":var26", ":var1"),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_deliver_message_to_enemy_lord"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (gt, ":var5", 0),
          (is_between, ":var1", 5, 25),
          (call_script, "script_cf_get_random_lord_from_another_faction_in_a_center", ":var2"),
          (assign, ":var38", reg0),
          (call_script, "script_get_troop_attached_party", ":var38"),
          (assign, ":var11", reg0),
          (store_distance_to_party_from_party, ":var28", ":var5", ":var11"),
          (assign, ":var10", ":var38"),
          (assign, ":var21", 1),
          (assign, ":var22", 200),
          (assign, ":var23", ":var28"),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 40),
          (assign, ":var26", 30),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_deal_with_bandits_at_lords_village"),
        (try_begin),
          (neq, ":var4", 5),
          (neq, ":var4", 2),
          (ge, "$g_talk_troop_faction_relation", 0),
          (assign, ":var54", "p_salt_mine"),
          (assign, ":var39", -1),
          (try_for_range, ":var55", "p_village_1", ":var54"),
            (party_slot_eq, ":var55", 7, ":var0"),
            (party_slot_eq, ":var55", 39, 1),
            (assign, ":var39", ":var55"),
            (assign, ":var54", 0),
          (try_end),
          (ge, ":var39", 0),
          (neg|check_quest_active, "qst_eliminate_bandits_infesting_village"),
          (assign, ":var11", ":var39"),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 30),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_raise_troops"),
        (try_begin),
          (neq, ":var4", 1),
          (neq, ":var2", "fac_player_supporters_faction"),
          (ge, "$g_talk_troop_faction_relation", 0),
          (store_character_level, ":var46", "trp_player"),
          (gt, ":var46", 5),
          (party_get_skill_level, ":var56", "p_main_party", "skl_trainer"),
          (ge, ":var56", 2),
          (store_random_in_range, ":var18", 5, 8),
          (party_get_free_companions_capacity, ":var57", "p_main_party"),
          (le, ":var18", ":var57"),
          (faction_get_slot, ":var14", ":var2", 41),
          (store_random_in_range, ":var58", 20, 40),
          (val_add, ":var58", ":var46"),
          (val_div, ":var58", 10),
          (store_mul, ":var23", ":var18", 100),
          (assign, ":var10", ":var14"),
          (try_for_range, ":var9", 0, ":var58"),
            (troop_get_upgrade_troop, ":var59", ":var10", 0),
            (gt, ":var59", 0),
            (assign, ":var10", ":var59"),
          (try_end),
          (assign, ":var22", ":var23"),
          (val_mul, ":var22", 3),
          (val_div, ":var22", 10),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 120),
          (assign, ":var26", 15),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_collect_taxes"),
        (try_begin),
          (neq, ":var4", 6),
          (neq, ":var4", 7),
          (ge, "$g_talk_troop_faction_relation", 0),
          (call_script, "script_cf_troop_get_random_leaded_town_or_village_except_center", ":var0", ":var5"),
          (assign, ":var11", reg0),
          (assign, ":var21", 1),
          (assign, ":var23", 0),
          (assign, ":var22", 100),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 50),
          (assign, ":var26", 20),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_hunt_down_fugitive"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (call_script, "script_cf_select_random_village_with_faction", ":var2"),
          (assign, ":var11", reg0),
          (store_random_in_range, ":var19", 0, 1000000),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 30),
          (assign, ":var26", 30),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_kill_local_merchant"),
        (try_begin),
          (this_or_next|eq, ":var4", 2),
          (this_or_next|eq, ":var4", 4),
          (eq, ":var4", 5),
          (neg|faction_slot_eq, ":var2", 10, ":var0"),
          (ge, "$g_talk_troop_faction_relation", 0),
          (gt, ":var1", 5),
          (is_between, ":var5", "p_town_1", "p_castle_1"),
          (assign, ":var21", 1),
          (assign, ":var22", 300),
          (assign, ":var23", 1000),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 10),
          (assign, ":var26", 30),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_bring_back_runaway_serfs"),
        (try_begin),
          (neq, ":var4", 6),
          (neq, ":var4", 7),
          (ge, "$g_talk_troop_faction_relation", 0),
          (ge, ":var1", 5),
          (gt, ":var5", 0),
          (eq, "$g_defending_against_siege", 0),
          (assign, ":var60", -1),
          (try_for_range, ":var55", "p_village_1", "p_salt_mine"),
            (party_slot_eq, ":var55", 7, ":var0"),
            (store_distance_to_party_from_party, ":var28", ":var55", ":var5"),
            (lt, ":var28", 25),
            (assign, ":var60", ":var55"),
          (try_end),
          (ge, ":var60", 0),
          (call_script, "script_cf_select_random_town_with_faction", ":var2"),
          (assign, ":var39", reg0),
          (neq, ":var39", ":var5"),
          (store_distance_to_party_from_party, ":var28", ":var39", ":var5"),
          (ge, ":var28", 20),
          (assign, ":var17", "pt_runaway_serfs"),
          (assign, ":var15", ":var60"),
          (assign, ":var11", ":var39"),
          (assign, ":var21", 1),
          (assign, ":var22", 200),
          (assign, ":var23", 500),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 30),
          (assign, ":var26", 20),
          (assign, "$qst_bring_back_runaway_serfs_num_parties_returned", 0),
          (assign, "$qst_bring_back_runaway_serfs_num_parties_fleed", 0),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_follow_spy"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (neq, ":var4", 6),
          (party_get_skill_level, ":var61", "p_main_party", "skl_tracking"),
          (ge, ":var61", 2),
          (ge, ":var1", 10),
          (eq, "$g_defending_against_siege", 0),
          (gt, ":var3", 0),
          (gt, ":var5", 0),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (party_get_position, pos2, "p_main_party"),
          (assign, ":var62", 99999),
          (try_for_range, ":var63", 0, 10),
            (call_script, "script_cf_get_random_enemy_center", ":var3"),
            (assign, ":var64", reg0),
            (party_get_position, pos3, ":var64"),
            (map_get_random_position_around_position, pos4, pos3, 6),
            (get_distance_between_positions, ":var65", pos2, pos4),
            (lt, ":var65", ":var62"),
            (assign, ":var62", ":var65"),
            (assign, ":var60", ":var64"),
            (copy_position, pos63, pos4),
          (try_end),
          (gt, ":var60", 0),
          (assign, ":var15", ":var60"),
          (assign, ":var26", 50),
          (assign, ":var8", ":var27"),
          (assign, "$qst_follow_spy_run_away", 0),
          (assign, "$qst_follow_spy_meeting_state", 0),
          (assign, "$qst_follow_spy_meeting_counter", 0),
          (assign, "$qst_follow_spy_spy_back_in_town", 0),
          (assign, "$qst_follow_spy_partner_back_in_town", 0),
          (assign, "$qst_follow_spy_no_active_parties", 0),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_capture_enemy_hero"),
        (try_begin),
          (eq, "$players_kingdom", ":var2"),
          (neg|faction_slot_eq, "$players_kingdom", 7, "trp_player"),
          (ge, ":var1", 15),
          (call_script, "script_cf_faction_get_random_enemy_faction", ":var2"),
          (assign, ":var12", reg0),
          (assign, ":var25", 30),
          (assign, ":var26", 80),
          (assign, ":var23", 2000),
          (assign, ":var8", ":var27"),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_lend_companion"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (assign, ":var66", 0),
          (party_get_num_companion_stacks, ":var42", "p_main_party"),
          (try_for_range, ":var43", 0, ":var42"),
            (party_stack_get_troop_id, ":var44", "p_main_party", ":var43"),
            (troop_is_hero, ":var44"),
            (is_between, ":var44", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
            (store_character_level, ":var67", ":var44"),
            (ge, ":var67", 15),
            (assign, ":var68", 0),
            (try_for_range, ":var69", 0, "qst_quests_end"),
              (check_quest_active, ":var69"),
              (this_or_next|quest_slot_eq, ":var69", 2, ":var44"),
              (quest_slot_eq, ":var69", 4, ":var44"),
              (assign, ":var68", 1),
            (try_end),
            (eq, ":var68", 0),
            (val_add, ":var66", 1),
          (try_end),
          (gt, ":var66", 0),
          (store_random_in_range, ":var70", 0, ":var66"),
          (assign, ":var66", 0),
          (assign, ":var38", -1),
          (try_for_range, ":var43", 0, ":var42"),
            (eq, ":var38", -1),
            (party_stack_get_troop_id, ":var44", "p_main_party", ":var43"),
            (troop_is_hero, ":var44"),
            (neq, ":var44", "trp_player"),
            (store_character_level, ":var67", ":var44"),
            (ge, ":var67", 15),
            (assign, ":var68", 0),
            (try_for_range, ":var69", 0, "qst_quests_end"),
              (check_quest_active, ":var69"),
              (this_or_next|quest_slot_eq, ":var69", 2, ":var44"),
              (quest_slot_eq, ":var69", 4, ":var44"),
              (assign, ":var68", 1),
            (try_end),
            (eq, ":var68", 0),
            (val_add, ":var66", 1),
            (gt, ":var66", ":var70"),
            (assign, ":var38", ":var44"),
          (try_end),
          (assign, ":var10", ":var38"),
          (store_current_day, ":var18"),
          (val_add, ":var18", 8),
          (assign, ":var21", 1),
          (assign, ":var22", 300),
          (assign, ":var23", 400),
          (assign, ":var8", ":var27"),
          (assign, ":var26", 30),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_collect_debt"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (call_script, "script_cf_get_random_lord_in_a_center_with_faction", ":var2"),
          (assign, ":var10", reg0),
          (neq, ":var10", ":var0"),
          (call_script, "script_get_troop_attached_party", ":var10"),
          (assign, ":var11", reg0),
          (neq, ":var5", ":var11"),
          (assign, ":var22", 30),
          (assign, ":var23", 40),
          (assign, ":var8", ":var27"),
          (store_random_in_range, ":var18", 6, 9),
          (val_mul, ":var18", 500),
          (store_div, ":var24", ":var18", 5),
          (assign, ":var25", 90),
          (assign, ":var26", 20),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_incriminate_loyal_commander"),
        (try_begin),
          (neq, ":var4", 7),
          (neq, ":var4", 6),
          (eq, "$players_kingdom", ":var2"),
          (ge, ":var1", 10),
          (faction_slot_eq, ":var2", 10, ":var0"),
          (assign, ":var71", 1),
          (assign, ":var72", 0),
          (try_for_range, ":var9", 0, ":var71"),
            (call_script, "script_cf_faction_get_random_enemy_faction", ":var2"),
            (assign, ":var35", reg0),
            (faction_get_slot, ":var38", ":var35", 10),
            (assign, ":var73", 0),
            (try_for_range, ":var74", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
              (troop_slot_eq, ":var74", 2, 2),
              (neg|troop_slot_ge, ":var74", 8, 0),
              (neq, ":var38", ":var74"),
              (store_troop_faction, ":var75", ":var74"),
              (eq, ":var35", ":var75"),
              (val_add, ":var73", 1),
            (try_end),
            (gt, ":var73", 0),
            (assign, ":var36", -1),
            (store_random_in_range, ":var76", 0, ":var73"),
            (try_for_range, ":var74", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
              (eq, ":var36", -1),
              (troop_slot_eq, ":var74", 2, 2),
              (neq, ":var38", ":var74"),
              (store_troop_faction, ":var75", ":var74"),
              (eq, ":var35", ":var75"),
              (val_sub, ":var76", 1),
              (lt, ":var76", 0),
              (assign, ":var36", ":var74"),
            (try_end),
            (assign, ":var39", -1),
            (call_script, "script_get_troop_attached_party", ":var38"),
            (is_between, reg0, "p_town_1", "p_castle_1"),
            (party_slot_eq, reg0, 7, ":var38"),
            (assign, ":var39", reg0),
            (assign, ":var71", -1),
            (assign, ":var72", 1),
          (try_end),
          (eq, ":var72", 1),
          (assign, "$incriminate_quest_sacrificed_troop", 0),
          (party_get_num_companion_stacks, ":var42", "p_main_party"),
          (try_for_range, ":var43", 1, ":var42"),
            (eq, "$incriminate_quest_sacrificed_troop", 0),
            (party_stack_get_troop_id, ":var44", "p_main_party", ":var43"),
            (neg|troop_is_hero, ":var44"),
            (store_character_level, ":var77", ":var44"),
            (ge, ":var77", 25),
            (assign, "$incriminate_quest_sacrificed_troop", ":var44"),
          (try_end),
          (gt, "$incriminate_quest_sacrificed_troop", 0),
          (assign, ":var10", ":var38"),
          (assign, ":var14", ":var36"),
          (assign, ":var11", ":var39"),
          (assign, ":var12", ":var35"),
          (assign, ":var21", 1),
          (assign, ":var22", 700),
          (assign, ":var23", 1000),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 30),
          (assign, ":var26", 180),
        (try_end),
      (else_try),
        (eq, ":var27", "qst_capture_prisoners"),
        (try_begin),
          (eq, "$players_kingdom", ":var2"),
          (call_script, "script_cf_faction_get_random_enemy_faction", ":var2"),
          (assign, ":var35", reg0),
          (store_add, ":var78", 45, 1),
          (store_random_in_range, ":var79", 42, ":var78"),
          (faction_get_slot, ":var38", ":var35", ":var79"),
          (gt, ":var38", 0),
          (store_random_in_range, ":var18", 3, 7),
          (assign, ":var10", ":var38"),
          (assign, ":var12", ":var35"),
          (assign, ":var21", 1),
          (store_character_level, ":var23", ":var38"),
          (val_add, ":var23", 5),
          (val_mul, ":var23", ":var23"),
          (val_div, ":var23", 5),
          (val_mul, ":var23", ":var18"),
          (assign, ":var22", ":var23"),
          (assign, ":var8", ":var27"),
          (assign, ":var25", 90),
          (assign, ":var26", 20),
        (try_end),
      (try_end),
    (try_end),
    (try_begin),
      (neq, ":var8", -1),
      (try_begin),
        (ge, ":var11", 0),
        (store_faction_of_party, ":var12", ":var11"),
      (try_end),
      (quest_set_slot, ":var8", 2, ":var10"),
      (quest_set_slot, ":var8", 1, ":var11"),
      (quest_set_slot, ":var8", 4, ":var14"),
      (quest_set_slot, ":var8", 3, ":var12"),
      (quest_set_slot, ":var8", 15, ":var13"),
      (quest_set_slot, ":var8", 7, ":var15"),
      (quest_set_slot, ":var8", 8, ":var16"),
      (quest_set_slot, ":var8", 9, ":var17"),
      (quest_set_slot, ":var8", 10, ":var18"),
      (quest_set_slot, ":var8", 20, ":var21"),
      (quest_set_slot, ":var8", 21, ":var22"),
      (quest_set_slot, ":var8", 22, ":var23"),
      (quest_set_slot, ":var8", 19, ":var24"),
      (quest_set_slot, ":var8", 23, ":var25"),
      (quest_set_slot, ":var8", 24, ":var26"),
      (quest_set_slot, ":var8", 11, 0),
      (quest_set_slot, ":var8", 6, ":var0"),
      (quest_set_slot, ":var8", 12, ":var5"),
      (quest_set_slot, ":var8", 13, ":var19"),
      (quest_set_slot, ":var8", 14, ":var20"),
    (try_end),
    (assign, reg0, ":var8"),
  ]),

  ("cf_get_random_enemy_center_within_range",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (store_faction_of_party, ":var3", ":var0"),
    (try_for_range, ":var4", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var5", ":var4"),
      (store_relation, ":var6", ":var3", ":var5"),
      (lt, ":var6", 0),
      (store_distance_to_party_from_party, ":var7", ":var0", ":var4"),
      (le, ":var7", ":var1"),
      (val_add, ":var2", 1),
    (try_end),
    (gt, ":var2", 0),
    (store_random_in_range, ":var8", 0, ":var2"),
    (assign, ":var9", "p_salt_mine"),
    (try_for_range, ":var4", "p_town_1", ":var9"),
      (store_faction_of_party, ":var5", ":var4"),
      (store_relation, ":var6", ":var3", ":var5"),
      (lt, ":var6", 0),
      (store_distance_to_party_from_party, ":var7", ":var0", ":var4"),
      (le, ":var7", ":var1"),
      (val_sub, ":var8", 1),
      (lt, ":var8", 0),
      (assign, ":var10", ":var4"),
      (assign, ":var9", 0),
    (try_end),
    (assign, reg0, ":var10"),
  ]),

  ("cf_faction_get_random_enemy_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var3", 21, 0),
      (store_relation, ":var4", ":var0", ":var3"),
      (le, ":var4", -1),
      (val_add, ":var2", 1),
    (try_end),
    (store_random_in_range, ":var5", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (eq, ":var1", -1),
      (faction_slot_eq, ":var3", 21, 0),
      (store_relation, ":var4", ":var0", ":var3"),
      (le, ":var4", -1),
      (val_add, ":var2", 1),
      (gt, ":var2", ":var5"),
      (assign, ":var1", ":var3"),
    (try_end),
    (neq, ":var1", -1),
    (assign, reg0, ":var1"),
  ]),

  ("cf_faction_get_random_friendly_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var3", 21, 0),
      (neq, ":var3", ":var0"),
      (store_relation, ":var4", ":var0", ":var3"),
      (ge, ":var4", 0),
      (faction_get_slot, ":var5", ":var3", 100),
      (val_add, ":var5", 101),
      (faction_slot_eq, ":var0", ":var5", 1),
      (val_add, ":var2", 1),
    (try_end),
    (store_random_in_range, ":var6", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (eq, ":var1", -1),
      (faction_slot_eq, ":var3", 21, 0),
      (neq, ":var3", ":var0"),
      (store_relation, ":var4", ":var0", ":var3"),
      (ge, ":var4", 0),
      (faction_get_slot, ":var5", ":var3", 100),
      (val_add, ":var5", 101),
      (faction_slot_eq, ":var0", ":var5", 1),
      (val_add, ":var2", 1),
      (gt, ":var2", ":var6"),
      (assign, ":var1", ":var3"),
    (try_end),
    (neq, ":var1", -1),
    (assign, reg0, ":var1"),
  ]),

  ("cf_troop_get_random_enemy_troop_with_occupation",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", 40, 45),
      (troop_get_slot, ":var5", ":var0", ":var4"),
      (gt, ":var5", 0),
      (troop_slot_eq, ":var5", 2, ":var1"),
      (val_add, ":var3", 1),
    (try_end),
    (store_random_in_range, ":var6", 0, ":var3"),
    (assign, ":var3", 0),
    (try_for_range, ":var4", 40, 45),
      (eq, ":var2", -1),
      (troop_get_slot, ":var5", ":var0", ":var4"),
      (gt, ":var5", 0),
      (troop_slot_eq, ":var5", 2, ":var1"),
      (val_add, ":var3", 1),
      (gt, ":var3", ":var6"),
      (assign, ":var2", ":var5"),
    (try_end),
    (neq, ":var2", -1),
    (assign, reg0, ":var2"),
  ]),

  ("cf_get_random_kingdom_hero_as_lover",
  [
    (assign, ":var0", -1),
    (assign, ":var1", 0),
    (try_for_range, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var2", 36, 0),
      (troop_slot_eq, ":var2", 30, 0),
      (val_add, ":var1", 1),
    (try_end),
    (store_random_in_range, ":var3", 0, ":var1"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (eq, ":var0", -1),
      (troop_slot_eq, ":var2", 36, 0),
      (troop_slot_eq, ":var2", 30, 0),
      (val_add, ":var1", 1),
      (gt, ":var1", ":var3"),
      (assign, ":var0", ":var2"),
    (try_end),
    (neq, ":var0", -1),
    (assign, reg0, ":var0"),
  ]),

  ("cf_get_random_lord_in_a_center_with_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "trp_kingdom_1_lord", "trp_heroes_end"),
      (store_troop_faction, ":var4", ":var3"),
      (eq, ":var0", ":var4"),
      (troop_slot_eq, ":var3", 2, 2),
      (neg|troop_slot_ge, ":var3", 8, 0),
      (troop_get_slot, ":var5", ":var3", 10),
      (ge, ":var5", 0),
      (party_get_attached_to, ":var6", ":var5"),
      (is_between, ":var6", "p_town_1", "p_salt_mine"),
      (val_add, ":var2", 1),
    (try_end),
    (store_random_in_range, ":var7", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "trp_kingdom_1_lord", "trp_heroes_end"),
      (eq, ":var1", -1),
      (store_troop_faction, ":var4", ":var3"),
      (eq, ":var0", ":var4"),
      (troop_slot_eq, ":var3", 2, 2),
      (neg|troop_slot_ge, ":var3", 8, 0),
      (troop_get_slot, ":var5", ":var3", 10),
      (ge, ":var5", 0),
      (party_get_attached_to, ":var6", ":var5"),
      (is_between, ":var6", "p_town_1", "p_salt_mine"),
      (val_add, ":var2", 1),
      (lt, ":var7", ":var2"),
      (assign, ":var1", ":var3"),
    (try_end),
    (neq, ":var1", -1),
    (assign, reg0, ":var1"),
  ]),

  ("cf_get_random_lord_except_king_with_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "trp_kingdom_1_lord", "trp_heroes_end"),
      (store_troop_faction, ":var4", ":var3"),
      (eq, ":var0", ":var4"),
      (neg|faction_slot_eq, ":var0", 10, ":var3"),
      (troop_slot_eq, ":var3", 2, 2),
      (neg|troop_slot_ge, ":var3", 8, 0),
      (troop_get_slot, ":var5", ":var3", 10),
      (ge, ":var5", 0),
      (val_add, ":var2", 1),
    (try_end),
    (store_random_in_range, ":var6", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "trp_kingdom_1_lord", "trp_heroes_end"),
      (eq, ":var1", -1),
      (store_troop_faction, ":var4", ":var3"),
      (eq, ":var0", ":var4"),
      (neg|faction_slot_eq, ":var0", 10, ":var3"),
      (troop_slot_eq, ":var3", 2, 2),
      (neg|troop_slot_ge, ":var3", 8, 0),
      (troop_get_slot, ":var5", ":var3", 10),
      (ge, ":var5", 0),
      (val_add, ":var2", 1),
      (lt, ":var6", ":var2"),
      (assign, ":var1", ":var3"),
    (try_end),
    (neq, ":var1", -1),
    (assign, reg0, ":var1"),
  ]),

  ("cf_get_random_lord_from_another_faction_in_a_center",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "trp_kingdom_1_lord", "trp_heroes_end"),
      (store_troop_faction, ":var4", ":var3"),
      (neq, ":var4", ":var0"),
      (store_relation, ":var5", ":var4", "fac_player_supporters_faction"),
      (store_relation, ":var6", ":var4", ":var0"),
      (lt, ":var6", 0),
      (ge, ":var5", 0),
      (troop_slot_eq, ":var3", 2, 2),
      (neg|troop_slot_ge, ":var3", 8, 0),
      (troop_get_slot, ":var7", ":var3", 10),
      (ge, ":var7", 0),
      (party_get_attached_to, ":var8", ":var7"),
      (is_between, ":var8", "p_town_1", "p_salt_mine"),
      (val_add, ":var2", 1),
    (try_end),
    (store_random_in_range, ":var9", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "trp_kingdom_1_lord", "trp_heroes_end"),
      (eq, ":var1", -1),
      (store_troop_faction, ":var4", ":var3"),
      (neq, ":var4", ":var0"),
      (store_relation, ":var5", ":var4", "fac_player_supporters_faction"),
      (store_relation, ":var6", ":var4", ":var0"),
      (lt, ":var6", 0),
      (ge, ":var5", 0),
      (troop_slot_eq, ":var3", 2, 2),
      (neg|troop_slot_ge, ":var3", 8, 0),
      (troop_get_slot, ":var7", ":var3", 10),
      (ge, ":var7", 0),
      (party_get_attached_to, ":var8", ":var7"),
      (is_between, ":var8", "p_town_1", "p_salt_mine"),
      (val_add, ":var2", 1),
      (lt, ":var9", ":var2"),
      (assign, ":var1", ":var3"),
    (try_end),
    (neq, ":var1", -1),
    (assign, reg0, ":var1"),
  ]),

  ("get_closest_walled_center",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 9999999),
    (assign, reg0, -1),
    (try_for_range, ":var2", "p_town_1", "p_village_1"),
      (store_distance_to_party_from_party, ":var3", ":var0", ":var2"),
      (lt, ":var3", ":var1"),
      (assign, ":var1", ":var3"),
      (assign, reg0, ":var2"),
    (try_end),
  ]),

  ("get_closest_center",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 9999999),
    (assign, reg0, -1),
    (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
      (store_distance_to_party_from_party, ":var3", ":var0", ":var2"),
      (lt, ":var3", ":var1"),
      (assign, ":var1", ":var3"),
      (assign, reg0, ":var2"),
    (try_end),
  ]),

  ("get_closest_center_of_faction",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 99999),
    (assign, ":var3", -1),
    (try_for_range, ":var4", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var1"),
      (store_distance_to_party_from_party, ":var6", ":var0", ":var4"),
      (lt, ":var6", ":var2"),
      (assign, ":var2", ":var6"),
      (assign, ":var3", ":var4"),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("get_closest_walled_center_of_faction",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 99999),
    (assign, ":var3", -1),
    (try_for_range, ":var4", "p_town_1", "p_village_1"),
      (store_faction_of_party, ":var5", ":var4"),
      (eq, ":var5", ":var1"),
      (store_distance_to_party_from_party, ":var6", ":var0", ":var4"),
      (lt, ":var6", ":var2"),
      (assign, ":var2", ":var6"),
      (assign, ":var3", ":var4"),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("let_nearby_parties_join_current_battle",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 5),
    (try_begin),
      (is_currently_night),
      (assign, ":var2", 3),
    (try_end),
    (try_for_parties, ":var3"),
      (party_get_battle_opponent, ":var4", ":var3"),
      (lt, ":var4", 0),
      (party_get_attached_to, ":var5", ":var3"),
      (lt, ":var5", 0),
      (get_party_ai_behavior, ":var6", ":var3"),
      (neq, ":var6", 8),
      (store_distance_to_party_from_party, ":var7", ":var3", "p_main_party"),
      (lt, ":var7", ":var2"),
      (store_faction_of_party, ":var8", ":var3"),
      (store_faction_of_party, ":var9", "$g_enemy_party"),
      (try_begin),
        (eq, ":var8", "fac_player_supporters_faction"),
        (assign, ":var10", 100),
      (else_try),
        (store_relation, ":var10", ":var8", "fac_player_supporters_faction"),
      (try_end),
      (try_begin),
        (eq, ":var8", ":var9"),
        (assign, ":var11", 100),
      (else_try),
        (store_relation, ":var11", ":var8", ":var9"),
      (try_end),
      (assign, ":var12", 1),
      (try_begin),
        (neq, "$g_enemy_party", "$g_encountered_party"),
        (assign, ":var12", 2),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (lt, ":var10", 0),
        (gt, ":var11", 0),
        (party_get_slot, ":var13", ":var3"),
        (eq, ":var13", 13),
        (get_party_ai_behavior, ":var14", ":var3"),
        (neq, ":var14", 5),
        (party_quick_attach_to_current_battle, ":var3", ":var12"),
        (str_store_party_name, s1, ":var3"),
        (display_message, "str_s1_joined_battle_enemy"),
      (else_try),
        (eq, ":var1", 0),
        (gt, ":var10", 0),
        (lt, ":var11", 0),
        (assign, ":var15", 1),
        (try_begin),
          (eq, ":var0", 1),
          (assign, ":var15", 0),
          (eq, ":var8", "$players_kingdom"),
          (faction_slot_eq, "$players_kingdom", 7, "trp_player"),
          (assign, ":var15", 1),
        (try_end),
        (eq, ":var15", 1),
        (party_get_slot, ":var13", ":var3"),
        (eq, ":var13", 13),
        (party_stack_get_troop_id, ":var16", ":var3", 0),
        (call_script, "script_troop_get_player_relation", ":var16"),
        (assign, ":var17", reg0),
        (ge, ":var17", 0),
        (party_quick_attach_to_current_battle, ":var3", 0),
        (str_store_party_name, s1, ":var3"),
        (display_message, "str_s1_joined_battle_friend"),
      (try_end),
    (try_end),
  ]),

  ("party_wound_all_members_aux",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (try_for_range, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (try_begin),
        (neg|troop_is_hero, ":var3"),
        (party_stack_get_size, ":var4", ":var0", ":var2"),
        (party_wound_members, ":var0", ":var3", ":var4"),
      (else_try),
        (troop_set_health, ":var3", 0),
      (try_end),
    (try_end),
    (party_get_num_attached_parties, ":var5", ":var0"),
    (try_for_range, ":var6", 0, ":var5"),
      (party_get_attached_party_with_rank, ":var7", ":var0", ":var6"),
      (call_script, "script_party_wound_all_members_aux", ":var7"),
    (try_end),
  ]),

  ("party_wound_all_members",
  [
    (store_script_param_1, ":var0"),
    (call_script, "script_party_wound_all_members_aux", ":var0"),
  ]),

  ("calculate_battle_advantage",
  [
    (call_script, "script_party_count_fit_for_battle", "p_collective_friends"),
    (assign, ":var0", reg0),
    (party_get_skill_level, ":var1", "p_main_party", skl_tactics),
    (party_get_skill_level, ":var2", "p_collective_friends", skl_tactics),
    (val_max, ":var1", ":var2"),
    (call_script, "script_party_count_fit_for_battle", "p_collective_enemy"),
    (assign, ":var3", reg0),
    (party_get_skill_level, ":var4", "p_collective_enemy", skl_tactics),
    (val_add, ":var0", 1),
    (val_add, ":var3", 1),
    (try_begin),
      (ge, ":var0", ":var3"),
      (val_mul, ":var0", 100),
      (store_div, ":var5", ":var0", ":var3"),
      (store_sub, ":var6", ":var5", 100),
    (else_try),
      (val_mul, ":var3", 100),
      (store_div, ":var5", ":var3", ":var0"),
      (store_sub, ":var6", 100, ":var5"),
    (try_end),
    (val_mul, ":var6", 2),
    (val_mul, ":var1", 30),
    (val_mul, ":var4", 30),
    (val_add, ":var6", ":var1"),
    (val_sub, ":var6", ":var4"),
    (val_div, ":var6", 100),
    (assign, reg0, ":var6"),
    (display_message, "@Battle Advantage = {reg0}.", 0xFFFFFFFF),
  ]),

  ("cf_check_enemies_nearby",
  [
    (get_player_agent_no, ":var0"),
    (agent_is_alive, ":var0"),
    (agent_get_position, pos1, ":var0"),
    (assign, ":var1", 0),
    (set_fixed_point_multiplier, 100),
    (try_for_agents, ":var2"),
      (neq, ":var2", ":var0"),
      (agent_is_alive, ":var2"),
      (agent_is_human, ":var2"),
      (neg|agent_is_ally, ":var2"),
      (agent_get_position, pos2, ":var2"),
      (get_distance_between_positions, ":var3", pos1, pos2),
      (le, ":var3", 1500),
      (assign, ":var1", 1),
    (try_end),
    (eq, ":var1", 0),
  ]),

  ("get_heroes_attached_to_center_aux",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_companion_stacks, ":var2", ":var0"),
    (try_for_range, ":var3", 0, ":var2"),
      (party_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (troop_is_hero, ":var4"),
      (party_add_members, ":var1", ":var4", 1),
    (try_end),
    (party_get_num_attached_parties, ":var5", ":var0"),
    (try_for_range, ":var6", 0, ":var5"),
      (party_get_attached_party_with_rank, ":var7", ":var0", ":var6"),
      (call_script, "script_get_heroes_attached_to_center_aux", ":var7", ":var1"),
    (try_end),
  ]),

  ("get_heroes_attached_to_center",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_clear, ":var1"),
    (call_script, "script_get_heroes_attached_to_center_aux", ":var0", ":var1"),
    (try_for_range, ":var2", 0, 0),
      (neq, ":var2", "$supported_pretender"),
      (troop_slot_eq, ":var2", 12, ":var0"),
      (party_add_members, ":var1", ":var2", 1),
    (try_end),
  ]),

  ("get_heroes_attached_to_center_as_prisoner_aux",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_num_prisoner_stacks, ":var2", ":var0"),
    (try_for_range, ":var3", 0, ":var2"),
      (party_prisoner_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (troop_is_hero, ":var4"),
      (party_add_members, ":var1", ":var4", 1),
    (try_end),
    (party_get_num_attached_parties, ":var5", ":var0"),
    (try_for_range, ":var6", 0, ":var5"),
      (party_get_attached_party_with_rank, ":var7", ":var0", ":var6"),
      (call_script, "script_get_heroes_attached_to_center_as_prisoner_aux", ":var7", ":var1"),
    (try_end),
  ]),

  ("get_heroes_attached_to_center_as_prisoner",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_clear, ":var1"),
    (call_script, "script_get_heroes_attached_to_center_as_prisoner_aux", ":var0", ":var1"),
  ]),

  ("give_center_to_faction",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (check_quest_active, "qst_join_siege_with_army"),
      (quest_slot_eq, "qst_join_siege_with_army", 1, ":var0"),
      (call_script, "script_abort_quest", "qst_join_siege_with_army", 0),
      (faction_get_slot, ":var2", "$players_kingdom", 7),
      (str_store_troop_name_link, s9, ":var2"),
      (setup_quest_text, "qst_follow_army"),
      (str_store_string, s2, "@{s9} wants you to resume following his army until further notice."),
      (call_script, "script_start_quest", "qst_follow_army", ":var2"),
      (assign, "$g_player_follow_army_warnings", 0),
    (try_end),
    (store_faction_of_party, ":var3", ":var0"),
    (call_script, "script_give_center_to_faction_aux", ":var0", ":var1"),
    (call_script, "script_update_village_market_towns"),
    (try_for_range, ":var4", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (call_script, "script_faction_recalculate_strength", ":var4"),
    (try_end),
    (assign, "$g_recalculate_ais", 1),
    (call_script, "script_activate_deactivate_player_faction", ":var3"),
    (try_begin),
      (eq, ":var1", "fac_player_supporters_faction"),
      (faction_slot_eq, "fac_player_supporters_faction", 10, "trp_player"),
      (call_script, "script_give_center_to_lord", ":var0", "trp_player", 0),
      (try_for_range, ":var5", "p_village_1", "p_salt_mine"),
        (store_faction_of_party, ":var6", ":var5"),
        (eq, ":var6", "fac_player_supporters_faction"),
        (neg|party_slot_eq, ":var5", 7, "trp_player"),
        (call_script, "script_give_center_to_lord", ":var5", "trp_player", 0),
      (try_end),
    (try_end),
  ]),

  ("give_center_to_faction_aux",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (store_faction_of_party, ":var2", ":var0"),
    (party_set_slot, ":var0", 62, ":var2"),
    (party_set_faction, ":var0", ":var1"),
    (try_begin),
      (party_slot_eq, ":var0", 0, 4),
      (party_get_slot, ":var3", ":var0", 122),
      (gt, ":var3", 0),
      (party_is_active, ":var3"),
      (party_set_faction, ":var3", ":var1"),
    (try_end),
    (party_get_slot, ":var4", ":var0", 7),
    (party_set_slot, ":var0", 7, -1),
    (party_set_banner_icon, ":var0", icon_player),
    (faction_get_slot, ":var5", ":var1", 9),
    (party_set_slot, ":var0", 19, ":var5"),
    (call_script, "script_update_faction_notes", ":var2"),
    (call_script, "script_update_faction_notes", ":var1"),
    (call_script, "script_update_center_notes", ":var0"),
    (try_begin),
      (ge, ":var4", 0),
      (call_script, "script_update_troop_notes", ":var4"),
    (try_end),
    (try_for_range, ":var6", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var6", 120, ":var0"),
      (call_script, "script_give_center_to_faction_aux", ":var6", ":var1"),
    (try_end),
  ]),

  ("change_troop_faction",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neg|faction_slot_eq, ":var1", 21, 0),
      (faction_set_slot, ":var1", 21, 0),
      (call_script, "script_store_average_center_value_per_faction"),
    (try_end),
    (troop_set_faction, ":var0", ":var1"),
    (try_for_range, ":var2", "p_town_1", "p_village_1"),
      (party_slot_eq, ":var2", 7, ":var0"),
      (party_set_faction, ":var2", ":var1"),
      (try_for_range, ":var3", "p_village_1", "p_salt_mine"),
        (party_slot_eq, ":var3", 120, ":var2"),
        (party_set_faction, ":var3", ":var1"),
        (party_get_slot, ":var4", ":var3", 122),
        (try_begin),
          (gt, ":var4", 0),
          (party_is_active, ":var4"),
          (party_set_faction, ":var4", ":var1"),
        (try_end),
        (try_begin),
          (party_get_slot, ":var5", ":var3", 7),
          (neq, ":var5", ":var0"),
          (party_set_slot, ":var3", 7, -1),
        (try_end),
      (try_end),
    (try_end),
    (try_for_range, ":var3", "p_village_1", "p_salt_mine"),
      (party_slot_eq, ":var3", 7, ":var0"),
      (store_faction_of_party, ":var6", ":var3"),
      (try_begin),
        (neq, ":var6", ":var1"),
        (party_set_slot, ":var3", 7, -1),
      (try_end),
    (try_end),
    (try_begin),
      (troop_get_slot, ":var7", ":var0", 10),
      (ge, ":var7", 1),
      (party_set_faction, ":var7", ":var1"),
      (party_get_num_prisoner_stacks, ":var8", ":var7"),
      (try_for_range_backwards, ":var9", 0, ":var8"),
        (party_prisoner_stack_get_troop_id, ":var10", ":var7", ":var9"),
        (store_troop_faction, ":var11", ":var10"),
        (troop_is_hero, ":var10"),
        (eq, ":var11", ":var1"),
        (call_script, "script_remove_troop_from_prison", ":var10"),
        (party_remove_prisoners, ":var7", ":var10", 1),
      (try_end),
    (try_end),
    (call_script, "script_update_all_notes"),
    (call_script, "script_update_village_market_towns"),
    (assign, "$g_recalculate_ais", 1),
  ]),

  ("give_center_to_lord",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (party_get_slot, ":var3", ":var0", 7),
    (store_troop_faction, ":var4", ":var1"),
    (try_begin),
      (eq, ":var1", "trp_player"),
      (gt, "$players_kingdom", 0),
      (party_set_faction, ":var0", "$players_kingdom"),
    (else_try),
      (eq, ":var1", "trp_player"),
      (le, "$players_kingdom", 0),
      (party_set_faction, ":var0", "fac_player_supporters_faction"),
    (else_try),
      (party_set_faction, ":var0", ":var4"),
    (try_end),
    (party_set_slot, ":var0", 7, ":var1"),
    (try_begin),
      (party_slot_eq, ":var0", 0, 4),
      (party_get_slot, ":var5", ":var0", 122),
      (gt, ":var5", 0),
      (party_is_active, ":var5"),
      (store_faction_of_party, ":var6", ":var0"),
      (party_set_faction, ":var5", ":var6"),
    (try_end),
    (try_begin),
      (this_or_next|party_slot_eq, ":var0", 0, 3),
      (party_slot_eq, ":var0", 0, 2),
      (troop_get_slot, ":var7", ":var1", 13),
      (gt, ":var7", 0),
      (val_sub, ":var7", "spr_banner_a"),
      (val_add, ":var7", "icon_banner_01"),
      (party_set_banner_icon, ":var0", ":var7"),
    (try_end),
    (try_begin),
      (eq, ":var1", "trp_player"),
      (neq, ":var3", "trp_player"),
      (party_get_slot, ":var8", ":var0", 26),
      (is_between, ":var8", -4, 5),
      (call_script, "script_change_player_relation_with_center", ":var0", 5),
      (gt, ":var3", 0),
      (call_script, "script_change_player_relation_with_troop", ":var3", -25),
    (try_end),
    (call_script, "script_update_troop_notes", ":var1"),
    (call_script, "script_update_center_notes", ":var0"),
    (call_script, "script_update_faction_notes", ":var4"),
    (try_begin),
      (ge, ":var3", 0),
      (call_script, "script_update_troop_notes", ":var3"),
      (store_troop_faction, ":var9", ":var3"),
      (call_script, "script_update_faction_notes", ":var9"),
    (try_end),
    (try_begin),
      (eq, ":var2", 1),
      (this_or_next|party_slot_eq, ":var0", 0, 3),
      (party_slot_eq, ":var0", 0, 2),
      (assign, ":var10", 4),
      (try_begin),
        (party_slot_eq, ":var0", 0, 3),
        (try_begin),
          (is_between, ":var0", "p_town_1b", "p_castle_1"),
          (assign, ":var10", 4),
        (else_try),
          (assign, ":var10", 10),
        (try_end),
      (try_end),
      (try_for_range, ":var11", 0, ":var10"),
        (call_script, "script_cf_reinforce_party", ":var0"),
      (try_end),
      (try_for_range, ":var11", 0, 7),
        (store_random_in_range, ":var12", 1500, 2000),
        (party_upgrade_with_xp, ":var0", ":var12", 0),
      (try_end),
    (try_end),
    (try_begin),
      (party_slot_eq, ":var0", 0, 2),
      (try_for_range, ":var13", "p_village_1", "p_salt_mine"),
        (party_slot_eq, ":var13", 120, ":var0"),
        (call_script, "script_give_center_to_lord", ":var13", ":var1", 0),
      (try_end),
    (try_end),
  ]),

  ("get_number_of_hero_centers",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var2", 7, ":var0"),
      (val_add, ":var1", 1),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("cf_get_random_enemy_center",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (assign, ":var2", 0),
    (store_faction_of_party, ":var3", ":var0"),
    (try_for_range, ":var4", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var5", ":var4"),
      (store_relation, ":var6", ":var5", ":var3"),
      (lt, ":var6", 0),
      (val_add, ":var2", 1),
    (try_end),
    (gt, ":var2", 0),
    (store_random_in_range, ":var7", 0, ":var2"),
    (assign, ":var2", 0),
    (try_for_range, ":var4", "p_town_1", "p_salt_mine"),
      (eq, ":var1", -1),
      (store_faction_of_party, ":var5", ":var4"),
      (store_relation, ":var6", ":var5", ":var3"),
      (lt, ":var6", 0),
      (val_sub, ":var7", 1),
      (lt, ":var7", 0),
      (assign, ":var1", ":var4"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("find_travel_location",
  [
    (store_script_param_1, ":var0"),
    (store_faction_of_party, ":var1", ":var0"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_town_1", "p_salt_mine"),
      (neq, ":var0", ":var3"),
      (store_faction_of_party, ":var4", ":var3"),
      (eq, ":var1", ":var4"),
      (store_distance_to_party_from_party, ":var5", ":var0", ":var3"),
      (val_add, ":var5", 1),
      (assign, ":var6", 100000),
      (val_div, ":var6", ":var5"),
      (val_add, ":var2", ":var6"),
    (try_end),
    (assign, reg0, -1),
    (try_begin),
      (eq, ":var2", 0),
    (else_try),
      (store_random_in_range, ":var7", 0, ":var2"),
      (assign, ":var2", 0),
      (assign, ":var8", 0),
      (try_for_range, ":var3", "p_town_1", "p_salt_mine"),
        (eq, ":var8", 0),
        (neq, ":var0", ":var3"),
        (store_faction_of_party, ":var4", ":var3"),
        (eq, ":var1", ":var4"),
        (store_distance_to_party_from_party, ":var5", ":var0", ":var3"),
        (val_add, ":var5", 1),
        (assign, ":var6", 100000),
        (val_div, ":var6", ":var5"),
        (val_add, ":var2", ":var6"),
        (lt, ":var7", ":var2"),
        (assign, reg0, ":var3"),
        (assign, ":var8", 1),
      (try_end),
    (try_end),
  ]),

  ("get_relation_between_parties",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (store_faction_of_party, ":var2", ":var0"),
    (store_faction_of_party, ":var3", ":var1"),
    (try_begin),
      (eq, ":var2", ":var3"),
      (assign, reg0, 100),
    (else_try),
      (store_relation, ":var4", ":var2", ":var3"),
      (assign, reg0, ":var4"),
    (try_end),
  ]),

  ("calculate_weekly_party_wage",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (party_get_num_companion_stacks, ":var2", ":var0"),
    (try_for_range, ":var3", 0, ":var2"),
      (party_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (party_stack_get_size, ":var5", ":var0", ":var3"),
      (call_script, "script_npc_get_troop_wage", ":var4", ":var0"),
      (assign, ":var6", reg0),
      (val_mul, ":var6", ":var5"),
      (val_add, ":var1", ":var6"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("calculate_player_faction_wage",
  [
    (assign, ":var0", 0),
    (assign, ":var1", 0),
    (try_for_parties, ":var2"),
      (assign, ":var3", 0),
      (try_begin),
        (this_or_next|party_slot_eq, ":var2", 0, 3),
        (party_slot_eq, ":var2", 0, 2),
        (party_slot_eq, ":var2", 7, "trp_player"),
        (assign, ":var3", 1),
      (try_end),
      (this_or_next|eq, ":var2", "p_main_party"),
      (eq, ":var3", 1),
      (party_get_num_companion_stacks, ":var4", ":var2"),
      (try_for_range, ":var5", 0, ":var4"),
        (party_stack_get_troop_id, ":var6", ":var2", ":var5"),
        (party_stack_get_size, ":var7", ":var2", ":var5"),
        (call_script, "script_game_get_troop_wage", ":var6", ":var2"),
        (assign, ":var8", reg0),
        (val_mul, ":var8", ":var7"),
        (try_begin),
          (eq, ":var3", 1),
          (val_add, ":var1", ":var8"),
        (else_try),
          (val_add, ":var0", ":var8"),
        (try_end),
      (try_end),
    (try_end),
    (val_div, ":var1", 2),
    (store_sub, ":var9", 14, "$g_cur_week_half_daily_wage_payments"),
    (val_mul, ":var0", ":var9"),
    (val_div, ":var0", 14),
    (store_add, reg0, ":var0", ":var1"),
  ]),

  ("calculate_hero_weekly_net_income_and_add_to_wealth",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 10),
    (troop_get_slot, ":var2", ":var0", 11),
    (assign, ":var3", 750),
    (store_character_level, ":var4", ":var0"),
    (store_mul, ":var5", ":var4", 10),
    (val_add, ":var3", ":var5"),
    (store_troop_faction, ":var6", ":var0"),
    (try_begin),
      (faction_slot_eq, ":var6", 10, ":var0"),
      (val_add, ":var3", 1500),
    (try_end),
    (assign, ":var7", 0),
    (try_begin),
      (gt, ":var1", 0),
      (call_script, "script_calculate_weekly_party_wage", ":var1"),
      (assign, ":var7", reg0),
    (try_end),
    (val_sub, ":var3", ":var7"),
    (val_add, ":var2", ":var3"),
    (val_max, ":var2", 0),
    (troop_set_slot, ":var0", 11, ":var2"),
  ]),

  ("cf_reinforce_party",
  [
    (store_script_param_1, ":var0"),
    (store_faction_of_party, ":var1", ":var0"),
    (party_get_slot, ":var2", ":var0", 0),
    (try_begin),
      (eq, ":var2", 13),
      (party_stack_get_troop_id, ":var3", ":var0"),
      (troop_get_slot, ":var1", ":var3", 14),
    (try_end),
    (try_begin),
      (eq, ":var1", "fac_player_supporters_faction"),
      (party_get_slot, ":var4", ":var0", 7),
      (try_begin),
        (gt, ":var4", 0),
        (troop_get_slot, ":var1", ":var4", 14),
      (else_try),
        (party_get_slot, ":var1", ":var0", 61),
      (try_end),
    (try_end),
    (faction_get_slot, ":var5", ":var1", 77),
    (faction_get_slot, ":var6", ":var1", 78),
    (faction_get_slot, ":var7", ":var1", 79),
    (faction_get_slot, ":var8", ":var1", 76),
    (assign, ":var9", 0),
    (store_random_in_range, ":var10", 0, 100),
    (try_begin),
      (party_slot_eq, ":var0", 54, -1),
      (this_or_next|eq, ":var2", 3),
      (eq, ":var2", 2),
      (try_begin),
        (lt, ":var10", 25),
        (assign, ":var9", ":var8"),
      (else_try),
        (lt, ":var10", 65),
        (assign, ":var9", ":var5"),
      (else_try),
        (assign, ":var9", ":var6"),
      (try_end),
    (else_try),
      (eq, ":var2", 13),
      (try_begin),
        (lt, ":var10", 50),
        (assign, ":var9", ":var5"),
      (else_try),
        (lt, ":var10", 75),
        (assign, ":var9", ":var6"),
      (else_try),
        (assign, ":var9", ":var7"),
      (try_end),
    (else_try),
    (try_end),
    (try_begin),
      (gt, ":var9", 0),
      (party_add_template, ":var0", ":var9"),
    (try_end),
  ]),

  ("hire_men_to_kingdom_hero_party",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 10),
    (troop_get_slot, ":var2", ":var0", 11),
    (assign, ":var3", ":var2"),
    (val_mul, ":var3", 3),
    (val_div, ":var3", 4),
    (assign, ":var4", 1),
    (call_script, "script_party_get_ideal_size", ":var1"),
    (assign, ":var5", reg0),
    (store_mul, ":var6", ":var5", 3),
    (val_div, ":var6", 2),
    (party_get_num_companions, ":var7", ":var1"),
    (try_for_range, ":var8", 0, ":var4"),
      (try_begin),
        (lt, ":var7", ":var5"),
        (gt, ":var3", 400),
        (gt, ":var1", 0),
        (call_script, "script_cf_reinforce_party", ":var1"),
        (val_sub, ":var2", 400),
        (troop_set_slot, ":var0", 11, ":var2"),
      (else_try),
        (gt, ":var7", ":var6"),
        (store_troop_faction, ":var9", ":var0"),
        (party_get_num_companion_stacks, ":var10", ":var1"),
        (assign, ":var11", 0),
        (assign, ":var12", 0),
        (try_for_range_backwards, ":var13", 0, ":var10"),
          (party_stack_get_troop_id, ":var14", ":var1", ":var13"),
          (neg|troop_is_hero, ":var14"),
          (party_stack_get_size, ":var15", ":var1", ":var13"),
          (store_character_level, ":var16", ":var14"),
          (store_troop_faction, ":var17", ":var14"),
          (try_begin),
            (eq, ":var9", ":var17"),
            (val_mul, ":var16", 3),
          (try_end),
          (val_mul, ":var16", ":var15"),
          (val_add, ":var11", ":var15"),
          (val_add, ":var12", ":var16"),
        (try_end),
        (gt, ":var11", 0),
        (store_div, ":var18", ":var12", ":var11"),
        (try_for_range_backwards, ":var13", 0, ":var10"),
          (party_stack_get_troop_id, ":var14", ":var1", ":var13"),
          (neg|troop_is_hero, ":var14"),
          (party_stack_get_size, ":var15", ":var1", ":var13"),
          (store_character_level, ":var16", ":var14"),
          (store_troop_faction, ":var17", ":var14"),
          (try_begin),
            (eq, ":var9", ":var17"),
            (val_mul, ":var16", 3),
          (try_end),
          (store_sub, ":var19", ":var18", ":var16"),
          (val_div, ":var19", 3),
          (store_add, ":var20", 10, ":var19"),
          (gt, ":var20", 0),
          (call_script, "script_get_percentage_with_randomized_round", ":var15", ":var20"),
          (gt, reg0, 0),
          (party_remove_members, ":var1", ":var14", reg0),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("get_percentage_with_randomized_round",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_mul, ":var2", ":var0", ":var1"),
    (val_div, ":var2", 100),
    (store_mul, ":var3", ":var2", 100),
    (val_div, ":var3", ":var1"),
    (store_sub, ":var4", ":var0", ":var3"),
    (try_begin),
      (gt, ":var4", 0),
      (store_mul, ":var5", ":var4", ":var1"),
      (store_random_in_range, ":var6", 0, 100),
      (lt, ":var6", ":var5"),
      (val_add, ":var2", 1),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("create_cattle_herd",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", -1),
    (set_spawn_radius, 1),
    (spawn_around_party, ":var0", "pt_cattle_herd"),
    (assign, ":var2", reg0),
    (party_get_position, pos1, ":var0"),
    (call_script, "script_map_get_random_position_around_position_within_range", 1, 2),
    (party_set_position, ":var2", pos2),
    (party_set_slot, ":var2", 0, 17),
    (party_set_slot, ":var2", 4, -1),
    (party_set_ai_behavior, ":var2", ai_bhvr_hold),
    (party_set_slot, ":var2", 30, -1),
    (try_begin),
      (gt, ":var1", 0),
      (party_clear, ":var2"),
      (party_add_members, ":var2", "trp_cattle", ":var1"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("create_horses_herd",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", -1),
    (set_spawn_radius, 1),
    (spawn_around_party, ":var0", "pt_horses_herd"),
    (assign, ":var2", reg0),
    (party_get_position, pos1, ":var0"),
    (call_script, "script_map_get_random_position_around_position_within_range", 1, 2),
    (party_set_position, ":var2", pos2),
    (party_set_slot, ":var2", 0, 20),
    (party_set_slot, ":var2", 4, -1),
    (party_set_ai_behavior, ":var2", ai_bhvr_hold),
    (party_set_slot, ":var2", 30, -1),
    (try_begin),
      (gt, ":var1", 0),
      (party_clear, ":var2"),
      (party_add_members, ":var2", "trp_horses", ":var1"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("buy_cattle_from_village",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (try_for_range, ":var3", 0, ":var1"),
      (call_script, "script_game_event_buy_item", "itm_cattle_meat", 0),
      (call_script, "script_game_event_buy_item", "itm_cattle_meat", 0),
    (try_end),
    (party_get_slot, ":var4", ":var0", 45),
    (val_sub, ":var4", ":var1"),
    (party_set_slot, ":var0", 45, ":var4"),
    (store_mul, ":var5", ":var2", ":var1"),
    (troop_remove_gold, "trp_player", ":var5"),
    (assign, ":var6", 1),
    (try_for_parties, ":var7"),
      (eq, ":var6", 1),
      (party_slot_eq, ":var7", 0, 17),
      (store_distance_to_party_from_party, ":var8", ":var0", ":var7"),
      (lt, ":var8", 6),
      (assign, ":var9", 1),
      (try_begin),
        (check_quest_active, "qst_move_cattle_herd"),
        (quest_slot_eq, "qst_move_cattle_herd", 8, ":var7"),
        (assign, ":var9", 0),
      (try_end),
      (eq, ":var9", 1),
      (party_add_members, ":var7", "trp_cattle", ":var1"),
      (assign, ":var6", 0),
      (assign, reg0, ":var7"),
    (try_end),
    (try_begin),
      (eq, ":var6", 1),
      (call_script, "script_create_cattle_herd", ":var0", ":var1"),
    (try_end),
  ]),

  ("kill_cattle_from_herd",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (troop_clear_inventory, "trp_temp_troop"),
    (store_mul, ":var2", ":var1", 2),
    (troop_add_items, "trp_temp_troop", "itm_cattle_meat", ":var2"),
    (troop_get_inventory_capacity, ":var3", "trp_temp_troop"),
    (try_for_range, ":var4", 0, ":var3"),
      (troop_get_inventory_slot, ":var5", "trp_temp_troop", ":var4"),
      (eq, ":var5", "itm_cattle_meat"),
      (troop_set_inventory_slot_modifier, "trp_temp_troop", ":var4", 37),
    (try_end),
    (party_get_num_companions, ":var6", ":var0"),
    (try_begin),
      (ge, ":var1", ":var6"),
      (remove_party, ":var0"),
    (else_try),
      (party_remove_members, ":var0", "trp_cattle", ":var1"),
    (try_end),
  ]),

  ("create_kingdom_hero_party",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_troop_faction, ":var2", ":var0"),
    (assign, "$pout_party", -1),
    (set_spawn_radius, 0),
    (spawn_around_party, ":var1", "pt_kingdom_hero_party"),
    (assign, "$pout_party", reg0),
    (party_set_faction, "$pout_party", ":var2"),
    (party_set_slot, "$pout_party", 0, 13),
    (call_script, "script_party_set_ai_state", "$pout_party", -1, -1),
    (troop_set_slot, ":var0", 10, "$pout_party"),
    (party_add_leader, "$pout_party", ":var0"),
    (str_store_troop_name, s5, ":var0"),
    (party_set_name, "$pout_party", "str_s5_s_party"),
    (try_begin),
      (eq, ":var0", "trp_duvalle_1"),
      (party_add_members, "$pout_party", "trp_duvalle_2", 1),
      (party_add_members, "$pout_party", "trp_duvalle_3", 1),
      (party_add_members, "$pout_party", "trp_duvalle_4", 1),
      (party_add_members, "$pout_party", "trp_duvalle_5", 1),
      (party_set_name, "$pout_party", "@The Duvalle Gang"),
    (try_end),
    (party_set_slot, "$pout_party", 30, -1),
    (troop_get_slot, ":var3", ":var0", 13),
    (try_begin),
      (gt, ":var3", 0),
      (val_sub, ":var3", "spr_banner_a"),
      (val_add, ":var3", "icon_banner_01"),
      (party_set_banner_icon, "$pout_party", ":var3"),
    (try_end),
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (try_begin),
        (faction_slot_eq, ":var2", 9, "fac_culture_1"),
        (party_set_icon, "$pout_party", "icon_usa_soldier"),
      (else_try),
        (faction_slot_eq, ":var2", 9, "fac_culture_2"),
        (party_set_icon, "$pout_party", "icon_mexico_soldier"),
      (else_try),
        (faction_slot_eq, ":var2", 9, "fac_culture_3"),
        (party_set_icon, "$pout_party", "icon_apache_soldier"),
      (else_try),
        (faction_slot_eq, ":var2", 9, "fac_culture_4"),
        (party_set_icon, "$pout_party", "icon_comanche_soldier"),
      (else_try),
        (faction_slot_eq, ":var2", 9, "fac_culture_5"),
        (party_set_icon, "$pout_party", "icon_bandit_soldier"),
      (else_try),
        (faction_slot_eq, ":var2", 9, "fac_culture_6"),
        (party_set_icon, "$pout_party", "icon_lawman_soldier"),
      (else_try),
        (faction_slot_eq, ":var2", 9, "fac_culture_7"),
        (party_set_icon, "$pout_party", "icon_outlaw_soldier"),
      (try_end),
    (try_end),
    (try_begin),
      (troop_slot_eq, ":var0", 28, 0),
      (troop_set_slot, ":var0", 28, 1),
      (assign, ":var4", 20),
      (try_begin),
        (store_troop_faction, ":var5", ":var0"),
        (faction_slot_eq, ":var5", 10, ":var0"),
        (assign, ":var4", 50),
      (try_end),
      (try_for_range, ":var6", 0, ":var4"),
        (call_script, "script_hire_men_to_kingdom_hero_party", ":var0"),
      (try_end),
      (store_random_in_range, ":var7", 2, 6),
      (troop_get_slot, ":var8", ":var0", 7),
      (store_div, ":var9", ":var8", 100),
      (val_add, ":var7", ":var9"),
      (try_for_range, ":var6", 0, ":var7"),
        (call_script, "script_upgrade_hero_party", "$pout_party", 4000),
      (try_end),
    (try_end),
  ]),

  ("create_kingdom_party_if_below_limit",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (call_script, "script_count_parties_of_faction_and_party_type", ":var0", ":var1"),
    (assign, ":var2", reg0),
    (assign, ":var3", 0),
    (try_begin),
      (eq, ":var1", 11),
      (assign, ":var3", 5),
    (try_end),
    (assign, reg0, -1),
    (try_begin),
      (lt, ":var2", ":var3"),
      (call_script, "script_cf_create_kingdom_party", ":var0", ":var1"),
    (try_end),
  ]),

  ("cf_create_kingdom_party",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (str_store_faction_name, s7, ":var0"),
    (assign, ":var2", "str_no_string"),
    (faction_get_slot, ":var3", ":var0", 78),
    (try_begin),
      (eq, ":var1", 15),
      (assign, ":var4", "pt_village_farmers"),
    (else_try),
      (eq, ":var1", 11),
      (assign, ":var4", "pt_kingdom_caravan_party"),
    (else_try),
      (eq, ":var1", 14),
      (assign, ":var4", "pt_stagecoach"),
    (try_end),
    (assign, ":var5", -1),
    (try_begin),
      (try_begin),
        (eq, ":var1", 11),
        (call_script, "script_cf_select_random_town_with_faction", ":var0", -1),
        (set_spawn_radius, 0),
      (else_try),
        (call_script, "script_cf_select_random_walled_center_with_faction", ":var0", -1),
        (set_spawn_radius, 1),
      (try_end),
      (assign, ":var6", reg0),
      (is_between, ":var6", "p_town_1", "p_salt_mine"),
      (spawn_around_party, ":var6", ":var4"),
      (assign, ":var5", reg0),
      (party_set_faction, ":var5", ":var0"),
      (try_begin),
        (eq, ":var1", 11),
        (party_set_slot, ":var5", 123, ":var6"),
      (try_end),
      (party_set_slot, ":var5", 0, ":var1"),
      (party_set_slot, ":var5", 4, -1),
      (try_begin),
        (neq, ":var2", "str_no_string"),
        (party_set_name, ":var5", ":var2"),
      (try_end),
      (try_begin),
        (eq, ":var1", 11),
        (party_add_template, ":var5", ":var3"),
        (party_add_template, ":var5", ":var3"),
        (party_set_ai_behavior, ":var5", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var5", ":var6"),
        (party_set_flags, ":var5", 65536, 1),
        (store_sub, ":var7", 234, "itm_smoked_fish"),
        (try_for_range, ":var8", "itm_smoked_fish", "itm_gold_bar"),
          (store_add, ":var9", ":var8", ":var7"),
          (party_set_slot, ":var5", ":var9", 1000),
        (try_end),
      (try_end),
    (try_end),
    (ge, ":var5", 0),
    (assign, reg0, ":var5"),
  ]),

  ("get_troop_attached_party",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 10),
    (assign, ":var2", -1),
    (try_begin),
      (ge, ":var1", 0),
      (party_get_attached_to, ":var2", ":var1"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("center_get_food_consumption",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_begin),
      (party_slot_eq, ":var0", 0, 3),
      (assign, ":var1", 500),
    (else_try),
      (party_slot_eq, ":var0", 0, 2),
      (assign, ":var1", 50),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("center_get_food_store_limit",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_begin),
      (party_slot_eq, ":var0", 0, 3),
      (assign, ":var1", 50000),
    (else_try),
      (party_slot_eq, ":var0", 0, 2),
      (assign, ":var1", 1500),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("refresh_village_merchant_inventory",
  [
    (store_script_param_1, ":var0"),
    (party_get_slot, ":var1", ":var0", 25),
    (reset_item_probabilities, 0),
    (store_sub, ":var2", 234, "itm_smoked_fish"),
    (try_for_range, ":var3", "itm_smoked_fish", "itm_gold_bar"),
      (store_add, ":var4", ":var3", ":var2"),
      (party_get_slot, ":var5", ":var0", ":var4"),
      (assign, ":var6", 100),
      (val_mul, ":var6", 1000),
      (val_div, ":var6", ":var5"),
      (val_mul, ":var6", 1000),
      (val_div, ":var6", ":var5"),
      (val_mul, ":var6", 1000),
      (val_div, ":var6", ":var5"),
      (val_mul, ":var6", 1000),
      (val_div, ":var6", ":var5"),
      (set_item_probability_in_merchandise, ":var3", ":var6"),
    (try_end),
    (set_item_probability_in_merchandise, "itm_spice", 0),
    (set_item_probability_in_merchandise, "itm_velvet", 0),
    (try_begin),
      (neg|troop_slot_eq, "trp_party_type_2", ":var0", 1),
      (troop_add_merchandise, ":var1", itp_type_goods, 3),
    (else_try),
      (store_random_in_range, ":var7", 0, 5),
      (troop_add_items, ":var1", "itm_gold_bar", ":var7"),
      (store_random_in_range, ":var7", 0, 7),
      (troop_add_items, ":var1", "itm_silver_bar", ":var7"),
    (try_end),
    (troop_ensure_inventory_space, ":var1", 80),
    (store_troop_gold, ":var8", ":var1"),
    (try_begin),
      (gt, ":var8", 3500),
      (store_div, ":var9", ":var8", 3000),
      (store_mul, ":var10", ":var9", 3000),
      (troop_remove_gold, ":var1", ":var10"),
      (call_script, "script_change_center_prosperity", ":var0", ":var9"),
    (try_end),
  ]),

  ("refresh_village_defenders",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 30),
    (try_begin),
      (party_get_num_companions, ":var2", ":var0"),
      (lt, ":var2", ":var1"),
      (store_faction_of_party, ":var3", ":var0"),
      (try_begin),
        (eq, ":var3", "fac_kingdom_3"),
        (party_add_template, ":var0", "pt_apache_defenders"),
      (else_try),
        (eq, ":var3", "fac_kingdom_4"),
        (party_add_template, ":var0", "pt_comanche_defenders"),
      (else_try),
        (troop_slot_ge, "trp_party_custom_reinforcements", ":var0", 1),
        (troop_get_slot, ":var4", "trp_party_custom_reinforcements", ":var0"),
        (party_add_template, ":var0", ":var4"),
      (else_try),
        (party_add_template, ":var0", "pt_village_defenders"),
      (try_end),
    (try_end),
  ]),

  ("village_set_state",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (eq, ":var1", 0),
      (party_set_extra_text, ":var0", "str_empty_string"),
      (party_set_slot, ":var0", 34, -1),
    (else_try),
      (eq, ":var1", 1),
      (party_set_extra_text, ":var0", "@(Being Raided)"),
    (else_try),
      (eq, ":var1", 2),
      (party_set_extra_text, ":var0", "@(Looted)"),
      (party_set_slot, ":var0", 34, -1),
      (call_script, "script_change_center_prosperity", ":var0", -30),
    (else_try),
      (eq, ":var1", 5),
      (party_set_extra_text, ":var0", "@(Under Siege)"),
    (try_end),
    (party_set_slot, ":var0", 35, ":var1"),
  ]),

  ("process_village_raids",
  [
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 36),
      (try_begin),
        (party_slot_eq, ":var0", 35, 0),
        (val_sub, ":var1", 5),
        (val_max, ":var1", 0),
        (party_set_slot, ":var0", 36, ":var1"),
      (else_try),
        (party_slot_eq, ":var0", 35, 1),
        (assign, ":var2", 1),
        (party_get_slot, ":var3", ":var0", 34),
        (try_begin),
          (ge, ":var3", 0),
          (party_is_active, ":var3"),
          (this_or_next|neq, ":var3", "p_main_party"),
          (eq, "$g_player_is_captive", 0),
          (store_distance_to_party_from_party, ":var4", ":var0", ":var3"),
          (lt, ":var4", 4),
          (assign, ":var2", 0),
        (try_end),
        (try_begin),
          (eq, ":var2", 1),
          (call_script, "script_village_set_state", ":var0", 0),
          (party_set_slot, ":var0", 38, 0),
          (party_clear_particle_systems, ":var0"),
        (else_try),
          (assign, ":var5", 11),
          (party_get_slot, ":var6", ":var0", 34),
          (try_begin),
            (party_get_skill_level, ":var7", ":var6", "skl_looting"),
            (val_add, ":var5", ":var7"),
          (try_end),
          (try_begin),
            (party_slot_eq, ":var0", 140, 1),
            (val_mul, ":var5", 75),
            (val_div, ":var5", 100),
          (try_end),
          (val_add, ":var1", ":var5"),
          (party_set_slot, ":var0", 36, ":var1"),
          (try_begin),
            (ge, ":var1", 50),
            (party_slot_eq, ":var0", 38, 0),
            (party_add_particle_system, ":var0", "psys_map_village_fire"),
            (party_add_particle_system, ":var0", "psys_map_village_fire_smoke"),
            (party_set_slot, ":var0", 38, 1),
          (try_end),
          (try_begin),
            (gt, ":var1", 100),
            (str_store_party_name_link, s1, ":var0"),
            (party_stack_get_troop_id, ":var8", ":var6"),
            (ge, ":var8", 0),
            (str_store_party_name, s2, ":var6"),
            (display_log_message, "@The village of {s1} has been looted by {s2}."),
            (call_script, "script_village_set_state", ":var0", 2),
            (party_set_slot, ":var0", 36, 0),
            (party_set_slot, ":var0", 37, 0),
            (try_begin),
              (store_faction_of_party, ":var9", ":var0"),
              (this_or_next|party_slot_eq, ":var0", 7, "trp_player"),
              (eq, ":var9", "fac_player_supporters_faction"),
              (call_script, "script_add_notification_menu", "mnu_notification_village_raided", ":var0", ":var8"),
            (try_end),
            (call_script, "script_add_log_entry", 1, ":var8", ":var0", -1, -1),
          (try_end),
        (try_end),
      (else_try),
        (party_slot_eq, ":var0", 35, 2),
        (party_get_slot, ":var10", ":var0", 37),
        (val_add, ":var10", 1),
        (party_set_slot, ":var0", 37, ":var10"),
        (try_begin),
          (ge, ":var10", 10),
          (party_slot_eq, ":var0", 38, 1),
          (party_clear_particle_systems, ":var0"),
          (party_add_particle_system, ":var0", "psys_map_village_looted_smoke"),
          (party_set_slot, ":var0", 38, 2),
        (try_end),
        (try_begin),
          (gt, ":var10", 50),
          (party_slot_eq, ":var0", 38, 2),
          (party_clear_particle_systems, ":var0"),
          (party_set_slot, ":var0", 38, 3),
        (try_end),
        (try_begin),
          (gt, ":var10", 100),
          (call_script, "script_village_set_state", ":var0", 0),
          (party_set_slot, ":var0", 37, 0),
          (party_clear_particle_systems, ":var0"),
          (party_set_slot, ":var0", 38, 0),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("process_sieges",
  [
    (try_for_range, ":var0", "p_town_1", "p_village_1"),
      (party_get_slot, ":var1", ":var0", 65),
      (val_sub, ":var1", 20),
      (val_max, ":var1", 0),
      (party_set_slot, ":var0", 65, ":var1"),
      (party_get_slot, ":var2", ":var0", 53),
      (call_script, "script_center_get_food_store_limit", ":var0"),
      (assign, ":var3", reg0),
      (try_begin),
        (party_get_slot, ":var4", ":var0", 54),
        (ge, ":var4", 0),
        (try_begin),
          (store_random_in_range, ":var5", 0, 3),
          (eq, ":var5", 0),
          (call_script, "script_change_center_prosperity", ":var0", -1),
        (try_end),
        (store_faction_of_party, ":var6", ":var0"),
        (assign, ":var7", 0),
        (try_begin),
          (try_begin),
            (neg|party_is_active, ":var4"),
            (assign, ":var7", 1),
          (else_try),
            (store_distance_to_party_from_party, ":var8", ":var0", ":var4"),
            (gt, ":var8", 5),
            (assign, ":var7", 1),
          (try_end),
          (eq, ":var7", 1),
          (try_for_range, ":var9", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
            (troop_slot_eq, ":var9", 2, 2),
            (troop_get_slot, ":var10", ":var9", 10),
            (ge, ":var10", 0),
            (party_is_active, ":var10"),
            (store_faction_of_party, ":var11", ":var10"),
            (store_relation, ":var12", ":var11", ":var6"),
            (lt, ":var12", 0),
            (store_distance_to_party_from_party, ":var13", ":var0", ":var10"),
            (lt, ":var13", 4),
            (assign, ":var4", ":var10"),
            (party_set_slot, ":var0", 54, ":var10"),
            (assign, ":var7", 0),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var7", 1),
          (call_script, "script_lift_siege", ":var0", 1),
        (else_try),
          (call_script, "script_center_get_food_consumption", ":var0"),
          (assign, ":var14", reg0),
          (val_sub, ":var2", ":var14"),
          (try_begin),
            (le, ":var2", 0),
            (store_random_in_range, ":var15", 0, 100),
            (lt, ":var15", 10),
            (call_script, "script_party_wound_all_members", ":var0"),
          (try_end),
        (try_end),
      (else_try),
        (val_add, ":var2", 30),
      (try_end),
      (val_min, ":var2", ":var3"),
      (val_max, ":var2", 0),
      (party_set_slot, ":var0", 53, ":var2"),
    (try_end),
  ]),

  ("lift_siege",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (party_set_slot, ":var0", 54, -1),
    (call_script, "script_village_set_state", ":var0", 0),
    (try_begin),
      (eq, ":var0", "$g_player_besiege_town"),
      (assign, "$g_siege_method", 0),
    (try_end),
    (try_begin),
      (eq, ":var1", 1),
      (str_store_party_name_link, s3, ":var0"),
      (display_message, "@{s3} is no longer under siege."),
    (try_end),
  ]),

  ("process_alarms",
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (party_set_slot, ":var0", 55, -1),
    (try_end),
    (assign, ":var1", 2),
    (try_begin),
      (is_currently_night),
      (assign, ":var1", 1),
    (try_end),
    (try_begin),
      (party_slot_eq, ":var0", 140, 1),
      (val_mul, ":var1", 2),
    (try_end),
    (try_for_parties, ":var2"),
      (party_slot_eq, ":var2", 0, 13),
      (neg|party_is_in_any_town, ":var2"),
      (store_faction_of_party, ":var3", ":var2"),
      (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
        (store_distance_to_party_from_party, ":var4", ":var2", ":var0"),
        (le, ":var4", ":var1"),
        (store_faction_of_party, ":var5", ":var0"),
        (store_relation, ":var6", ":var5", ":var3"),
        (lt, ":var6", 0),
        (party_set_slot, ":var0", 55, ":var2"),
      (try_end),
    (try_end),
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var5", ":var0"),
      (this_or_next|party_slot_eq, ":var0", 7, "trp_player"),
      (eq, ":var5", "$players_kingdom"),
      (party_get_slot, ":var7", ":var0", 55),
      (ge, ":var7", 0),
      (store_distance_to_party_from_party, ":var8", "p_main_party", ":var0"),
      (assign, ":var9", 0),
      (try_begin),
        (this_or_next|party_slot_eq, ":var0", 7, "trp_player"),
        (eq, ":var5", "fac_player_supporters_faction"),
        (party_slot_eq, ":var0", 142, 1),
        (assign, ":var9", 1),
      (try_end),
      (this_or_next|lt, ":var8", 30),
      (eq, ":var9", 1),
      (str_store_party_name_link, s1, ":var0"),
      (display_message, "@Enemies spotted near {s1}."),
    (try_end),
  ]),

  ("party_set_ai_state",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (party_get_slot, ":var3", ":var0", 4),
    (party_get_slot, ":var4", ":var0", 5),
    (party_get_attached_to, ":var5", ":var0"),
    (assign, ":var6", 0),
    (try_begin),
      (is_between, ":var5", "p_town_1", "p_salt_mine"),
      (assign, ":var6", ":var5"),
    (try_end),
    (party_set_slot, ":var0", 63, 0),
    (try_begin),
      (eq, ":var3", ":var1"),
      (eq, ":var4", ":var2"),
    (else_try),
      (try_begin),
        (eq, ":var1", 11),
        (party_set_ai_behavior, ":var0", ai_bhvr_escort_party),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_flags, ":var0", 65536, 0),
        (try_begin),
          (gt, ":var6", 0),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", 1),
        (party_get_position, pos1, ":var2"),
        (map_get_random_position_around_position, pos2, pos1, 2),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_point),
        (party_set_ai_target_position, ":var0", pos2),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_flags, ":var0", 65536, 0),
        (party_set_slot, ":var0", 63, 1),
        (party_set_slot, ":var0", 8, 0),
        (try_begin),
          (gt, ":var6", 0),
          (neq, ":var6", ":var2"),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", 7),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_flags, ":var0", 65536, 0),
        (try_begin),
          (gt, ":var6", 0),
          (neq, ":var6", ":var2"),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", 4),
        (party_get_position, pos1, ":var2"),
        (map_get_random_position_around_position, pos2, pos1, 1),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_point),
        (party_set_ai_target_position, ":var0", pos2),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_ai_patrol_radius, ":var0", 5),
        (party_set_flags, ":var0", 65536, 0),
        (party_set_slot, ":var0", 63, 1),
        (party_set_slot, ":var0", 8, 0),
        (try_begin),
          (gt, ":var6", 0),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", 16),
        (party_get_position, pos1, ":var2"),
        (map_get_random_position_around_position, pos2, pos1, 2),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_point),
        (party_set_ai_target_position, ":var0", pos2),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_flags, ":var0", 65536, 0),
        (party_set_slot, ":var0", 8, 0),
        (try_begin),
          (gt, ":var6", 0),
          (neq, ":var6", ":var2"),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", 5),
        (party_get_position, pos1, ":var2"),
        (map_get_random_position_around_position, pos2, pos1, 1),
        (party_set_ai_behavior, ":var0", ai_bhvr_patrol_location),
        (party_set_ai_patrol_radius, ":var0", 10),
        (party_set_ai_target_position, ":var0", pos2),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_flags, ":var0", 65536, 0),
        (party_set_slot, ":var0", 63, 1),
        (party_set_slot, ":var0", 8, 0),
        (try_begin),
          (gt, ":var6", 0),
          (neq, ":var6", ":var2"),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", 10),
        (party_set_ai_behavior, ":var0", ai_bhvr_attack_party),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_flags, ":var0", 65536, 0),
        (try_begin),
          (gt, ":var6", 0),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", 14),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var2"),
        (party_set_flags, ":var0", 65536, 1),
        (party_set_slot, ":var0", 30, -1),
        (try_begin),
          (gt, ":var6", 0),
          (neq, ":var6", ":var2"),
          (party_detach, ":var0"),
        (try_end),
      (else_try),
        (eq, ":var1", -1),
        (party_set_ai_behavior, ":var0", ai_bhvr_hold),
        (party_set_flags, ":var0", 65536, 0),
      (try_end),
    (try_end),
    (party_set_slot, ":var0", 4, ":var1"),
    (party_set_slot, ":var0", 5, ":var2"),
  ]),

  ("decide_kingdom_party_ais",
  [
    (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (neq, ":var0", "fac_player_supporters_faction"),
      (faction_get_slot, ":var1", ":var0", 4),
      (neq, ":var1", 0),
      (faction_get_slot, ":var2", ":var0", 5),
      (faction_get_slot, ":var3", ":var0", 7),
      (gt, ":var3", 0),
      (neq, ":var3", "trp_player"),
      (troop_get_slot, ":var4", ":var3", 10),
      (gt, ":var4", 0),
      (try_begin),
        (eq, ":var1", 1),
        (call_script, "script_party_set_ai_state", ":var4", -1, -1),
        (party_set_ai_initiative, ":var4", 100),
      (else_try),
        (eq, ":var1", 2),
        (call_script, "script_party_set_ai_state", ":var4", 1, ":var2"),
        (party_set_ai_initiative, ":var4", 50),
      (else_try),
        (eq, ":var1", 3),
        (call_script, "script_party_set_ai_state", ":var4", 5, ":var2"),
        (party_set_ai_initiative, ":var4", 50),
      (else_try),
        (eq, ":var1", 5),
        (call_script, "script_party_set_ai_state", ":var4", 4, ":var2"),
        (party_set_ai_initiative, ":var4", 50),
      (else_try),
        (eq, ":var1", 4),
        (call_script, "script_party_set_ai_state", ":var4", 10, ":var2"),
        (party_set_ai_initiative, ":var4", 50),
      (try_end),
      (party_set_slot, ":var4", 30, -1),
    (try_end),
    (try_for_range, ":var5", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (try_begin),
        (store_troop_faction, ":var6", ":var5"),
        (neg|faction_slot_eq, ":var6", 7, ":var5"),
        (troop_get_slot, ":var7", ":var5", 10),
        (gt, ":var7", 0),
        (party_is_active, ":var7"),
        (party_set_ai_initiative, ":var7", 100),
      (try_end),
      (call_script, "script_calculate_troop_ai", ":var5"),
    (try_end),
    (try_for_range, ":var5", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (call_script, "script_calculate_troop_ai_under_command", ":var5"),
    (try_end),
  ]),

  ("party_decide_next_ai_state_under_command",
  [
    (store_script_param_1, ":var0"),
    (party_get_slot, ":var1", ":var0", 30),
    (try_begin),
      (party_is_active, ":var1"),
      (party_get_slot, ":var2", ":var1", 4),
      (party_get_slot, ":var3", ":var1", 5),
      (store_faction_of_party, ":var4", ":var0"),
      (store_distance_to_party_from_party, ":var5", ":var0", ":var1"),
      (try_begin),
        (gt, ":var5", 5),
        (call_script, "script_party_set_ai_state", ":var0", 11, ":var1"),
      (else_try),
        (try_begin),
          (eq, ":var1", "p_main_party"),
          (call_script, "script_party_set_ai_state", ":var0", 11, "p_main_party"),
        (else_try),
          (eq, ":var2", 1),
          (store_distance_to_party_from_party, ":var6", ":var0", ":var3"),
          (le, ":var6", 5),
          (call_script, "script_party_set_ai_state", ":var0", 1, ":var3"),
        (else_try),
          (party_get_attached_to, ":var7", ":var1"),
          (assign, ":var8", 0),
          (try_begin),
            (lt, ":var7", 0),
            (party_get_cur_town, ":var7", ":var1"),
          (try_end),
          (try_begin),
            (eq, ":var2", 7),
            (call_script, "script_party_set_ai_state", ":var0", 7, ":var3"),
            (assign, ":var8", 1),
          (else_try),
            (eq, ":var2", -1),
            (is_between, ":var7", "p_town_1", "p_salt_mine"),
            (call_script, "script_party_set_ai_state", ":var0", 7, ":var7"),
            (assign, ":var8", 1),
          (try_end),
          (eq, ":var8", 1),
        (else_try),
          (faction_get_slot, ":var9", ":var4", 7),
          (ge, ":var9", 0),
          (troop_slot_eq, ":var9", 10, ":var1"),
          (call_script, "script_party_set_ai_state", ":var0", 11, ":var1"),
        (else_try),
          (this_or_next|eq, ":var2", 4),
          (this_or_next|eq, ":var2", 5),
          (eq, ":var2", 10),
          (call_script, "script_party_set_ai_state", ":var0", 11, ":var1"),
        (else_try),
          (call_script, "script_party_set_ai_state", ":var0", -1, -1),
          (party_set_slot, ":var0", 30, -1),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("kingdom_hero_decide_next_ai_state_follow_or_not",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 10),
    (try_begin),
      (party_get_slot, ":var2", ":var1", 4),
      (assign, ":var3", 0),
      (try_begin),
        (eq, ":var2", 14),
        (neg|party_is_in_any_town, ":var1"),
        (assign, ":var3", 1),
      (try_end),
      (eq, ":var3", 0),
      (party_get_slot, ":var4", ":var1", 56),
      (store_div, ":var5", ":var4", 2),
      (assign, ":var6", 0),
      (party_get_attached_to, ":var7", ":var1"),
      (try_begin),
        (lt, ":var7", 0),
        (party_get_cur_town, ":var7", ":var1"),
      (try_end),
      (try_begin),
        (neg|is_between, ":var7", "p_town_1", "p_salt_mine"),
        (assign, ":var7", -1),
        (assign, ":var8", 0),
        (store_sub, ":var9", 1000000),
      (else_try),
        (party_get_slot, ":var8", ":var7", 57),
        (store_sub, ":var9", ":var8", ":var4"),
        (party_get_slot, ":var10", ":var7", 54),
        (gt, ":var10", 0),
        (party_is_active, ":var10"),
        (assign, ":var6", 1),
      (try_end),
      (store_troop_faction, ":var11", ":var0"),
      (faction_get_slot, ":var12", ":var11", 4),
      (party_get_slot, ":var13", ":var1", 30),
      (try_begin),
        (ge, ":var13", 0),
        (try_begin),
          (party_is_active, ":var13"),
          (try_begin),
            (store_faction_of_party, ":var14", ":var13"),
            (neq, ":var11", ":var14"),
            (assign, ":var15", 0),
            (try_begin),
              (neq, ":var13", "p_main_party"),
              (assign, ":var15", 1),
            (else_try),
              (neq, "$players_kingdom", ":var11"),
              (assign, ":var15", 1),
            (try_end),
            (eq, ":var15", 1),
            (assign, ":var13", -1),
          (try_end),
        (else_try),
          (assign, ":var13", -1),
        (try_end),
      (try_end),
      (faction_get_slot, ":var16", ":var11", 82),
      (store_mul, ":var17", ":var16", 2),
      (faction_get_slot, ":var18", ":var11", 81),
      (val_add, ":var17", ":var18"),
      (val_mul, ":var17", 10),
      (val_max, ":var17", 5),
      (troop_get_slot, ":var19", ":var0", 57),
      (assign, ":var20", 0),
      (assign, ":var21", -1),
      (try_begin),
        (eq, ":var6", 0),
        (ge, ":var9", ":var5"),
        (assign, ":var15", 0),
        (try_begin),
          (ge, ":var13", 0),
          (gt, "$party_relative_strength", 30),
          (assign, ":var15", 1),
        (else_try),
          (gt, "$party_relative_strength", 50),
          (lt, "$ratio_of_prisoners", 50),
          (assign, ":var15", 1),
        (try_end),
        (eq, ":var15", 1),
        (try_begin),
          (eq, ":var11", "fac_player_supporters_faction"),
          (neg|troop_slot_eq, ":var0", 16, -1),
          (assign, ":var15", 0),
        (try_end),
        (eq, ":var15", 1),
        (faction_get_slot, ":var22", ":var11", 7),
        (ge, ":var22", 0),
        (neg|troop_slot_ge, ":var22", 8, 0),
        (troop_get_slot, ":var23", ":var22", 10),
        (neq, ":var22", ":var0"),
        (ge, ":var23", 0),
        (try_begin),
          (eq, ":var12", 1),
          (assign, ":var24", -1),
          (try_begin),
            (ge, ":var13", 0),
            (assign, ":var24", ":var13"),
          (try_end),
          (assign, ":var15", 0),
          (try_begin),
            (ge, ":var19", 60),
            (assign, ":var15", 1),
          (else_try),
            (ge, ":var19", 10),
            (eq, ":var24", ":var23"),
            (assign, ":var15", 1),
          (try_end),
          (try_begin),
            (eq, ":var15", 1),
            (store_distance_to_party_from_party, ":var25", ":var23", ":var1"),
            (store_sub, ":var26", 120, ":var25"),
            (val_min, ":var26", 100),
            (val_max, ":var26", 20),
            (store_sub, ":var27", "$g_average_center_value_per_faction", ":var17"),
            (val_mul, ":var27", 2),
            (val_add, ":var26", ":var27"),
            (val_max, ":var26", 10),
            (assign, ":var21", ":var23"),
            (assign, ":var20", ":var26"),
            (try_begin),
              (eq, ":var24", ":var21"),
              (val_mul, ":var20", 1000),
            (try_end),
          (try_end),
        (else_try),
          (this_or_next|eq, ":var12", 2),
          (this_or_next|eq, ":var12", 3),
          (this_or_next|eq, ":var12", 5),
          (eq, ":var12", 4),
          (eq, ":var13", ":var23"),
          (ge, ":var19", 10),
          (assign, ":var21", ":var23"),
          (assign, ":var20", 100000),
        (try_end),
      (try_end),
      (try_begin),
        (le, ":var20", 0),
        (eq, ":var6", 0),
        (ge, ":var9", ":var5"),
        (assign, ":var15", 0),
        (try_begin),
          (ge, ":var13", 0),
          (gt, "$party_relative_strength", 40),
          (assign, ":var15", 1),
        (else_try),
          (gt, "$party_relative_strength", 75),
          (lt, "$ratio_of_prisoners", 50),
          (assign, ":var15", 1),
        (try_end),
        (eq, ":var15", 1),
        (try_begin),
          (eq, ":var11", "fac_player_supporters_faction"),
          (neg|troop_slot_eq, ":var0", 16, -1),
          (neg|troop_slot_eq, ":var0", 16, 11),
          (assign, ":var15", 0),
        (try_end),
        (eq, ":var15", 1),
        (neg|faction_slot_eq, ":var11", 10, ":var0"),
        (assign, ":var24", -1),
        (try_begin),
          (ge, ":var13", 0),
          (assign, ":var24", ":var13"),
        (try_end),
        (troop_get_slot, ":var28", ":var0", 7),
        (assign, ":var29", 0),
        (try_begin),
          (eq, "p_main_party", ":var24"),
          (val_add, ":var29", 1),
          (eq, "p_main_party", ":var24"),
          (val_add, ":var29", 999),
        (try_end),
        (try_for_range, ":var30", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
          (neq, ":var30", ":var0"),
          (store_troop_faction, ":var31", ":var30"),
          (eq, ":var31", ":var11"),
          (troop_get_slot, ":var32", ":var30", 10),
          (ge, ":var32", 0),
          (troop_get_slot, ":var33", ":var30", 7),
          (lt, ":var28", ":var33"),
          (neg|party_slot_ge, ":var32", 30, 0),
          (store_distance_to_party_from_party, ":var25", ":var32", ":var1"),
          (lt, ":var25", 25),
          (party_slot_eq, ":var32", 63, 1),
          (val_add, ":var29", 1),
          (eq, ":var32", ":var24"),
          (val_add, ":var29", 999),
        (try_end),
        (gt, ":var29", 0),
        (store_random_in_range, ":var34", 0, ":var29"),
        (try_begin),
          (eq, "p_main_party", ":var24"),
          (val_sub, ":var34", 1),
          (try_begin),
            (eq, "p_main_party", ":var24"),
            (val_sub, ":var34", 999),
          (try_end),
          (lt, ":var34", 0),
          (store_mul, ":var26", 100, "$g_average_center_value_per_faction"),
          (val_div, ":var26", ":var17"),
          (val_max, ":var26", 10),
          (assign, ":var20", ":var26"),
          (val_mul, ":var20", 2),
          (assign, ":var21", "p_main_party"),
          (eq, ":var24", ":var21"),
          (val_mul, ":var20", 100),
        (try_end),
        (try_for_range, ":var30", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
          (eq, ":var21", -1),
          (neq, ":var30", ":var0"),
          (store_troop_faction, ":var31", ":var30"),
          (eq, ":var31", ":var11"),
          (troop_get_slot, ":var32", ":var30", 10),
          (ge, ":var32", 0),
          (troop_get_slot, ":var33", ":var30", 7),
          (lt, ":var28", ":var33"),
          (neg|party_slot_ge, ":var32", 30, 0),
          (store_distance_to_party_from_party, ":var25", ":var32", ":var1"),
          (lt, ":var25", 25),
          (party_slot_eq, ":var32", 63, 1),
          (val_sub, ":var34", 1),
          (try_begin),
            (eq, ":var32", ":var24"),
            (val_sub, ":var34", 999),
          (try_end),
          (lt, ":var34", 0),
          (store_mul, ":var26", 100, "$g_average_center_value_per_faction"),
          (val_div, ":var26", ":var17"),
          (val_max, ":var26", 10),
          (assign, ":var20", ":var26"),
          (try_begin),
            (faction_slot_eq, ":var11", 10, ":var30"),
            (val_mul, ":var20", 2),
          (try_end),
          (assign, ":var21", ":var32"),
          (eq, ":var24", ":var21"),
          (val_mul, ":var20", 100),
        (try_end),
      (try_end),
      (assign, ":var35", ":var20"),
      (val_add, ":var35", 600),
      (store_random_in_range, ":var36", 0, ":var35"),
      (try_begin),
        (val_sub, ":var36", ":var20"),
        (lt, ":var36", 0),
        (party_set_slot, ":var1", 30, ":var21"),
      (else_try),
        (party_set_slot, ":var1", 30, -1),
      (try_end),
    (try_end),
  ]),

  ("kingdom_hero_decide_next_ai_state",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 10),
    (try_begin),
      (party_get_slot, ":var2", ":var1", 56),
      (store_div, ":var3", ":var2", 2),
      (party_get_slot, ":var4", ":var1", 59),
      (store_troop_faction, ":var5", ":var0"),
      (assign, ":var6", -1),
      (party_get_attached_to, ":var7", ":var1"),
      (try_begin),
        (lt, ":var7", 0),
        (party_get_cur_town, ":var7", ":var1"),
      (try_end),
      (try_begin),
        (neg|is_between, ":var7", "p_town_1", "p_salt_mine"),
        (assign, ":var7", -1),
        (assign, ":var8", 0),
        (store_sub, ":var9", 1000000),
      (else_try),
        (party_get_slot, ":var8", ":var7", 57),
        (store_sub, ":var9", ":var8", ":var2"),
        (party_get_slot, ":var6", ":var7", 54),
        (try_begin),
          (neg|party_is_active, ":var6"),
          (assign, ":var6", -1),
        (try_end),
        (store_faction_of_party, ":var10", ":var7"),
        (store_relation, ":var11", ":var10", ":var5"),
      (try_end),
      (party_get_slot, ":var12", ":var1", 4),
      (party_get_slot, ":var13", ":var1", 5),
      (assign, ":var14", 0),
      (try_begin),
        (eq, ":var12", 14),
        (neg|party_is_in_any_town, ":var1"),
        (assign, ":var14", 1),
      (try_end),
      (eq, ":var14", 0),
      (faction_get_slot, ":var15", ":var5", 82),
      (store_mul, ":var16", ":var15", 2),
      (faction_get_slot, ":var17", ":var5", 81),
      (val_add, ":var16", ":var17"),
      (val_mul, ":var16", 10),
      (val_max, ":var16", 5),
      (assign, ":var18", 0),
      (assign, ":var19", -1),
      (assign, ":var20", 0),
      (assign, ":var21", -1),
      (assign, ":var22", 0),
      (assign, ":var23", -1),
      (assign, ":var24", 0),
      (assign, ":var25", -1),
      (assign, ":var26", 0),
      (assign, ":var27", -1),
      (assign, ":var28", 0),
      (assign, ":var29", -1),
      (try_begin),
        (eq, ":var6", -1),
        (assign, ":var30", -1),
        (try_begin),
          (eq, ":var12", 7),
          (assign, ":var30", ":var13"),
        (try_end),
        (try_begin),
          (is_between, ":var7", "p_town_1", "p_salt_mine"),
          (party_slot_eq, ":var7", 7, ":var0"),
          (assign, ":var19", ":var7"),
          (assign, ":var18", 100),
        (try_end),
        (try_begin),
          (eq, ":var19", -1),
          (this_or_next|gt, "$party_relative_strength", 20),
          (eq, ":var7", -1),
          (ge, ":var9", ":var3"),
          (call_script, "script_cf_troop_get_random_leaded_walled_center_with_less_strength_priority", ":var0", ":var30"),
          (assign, ":var19", reg0),
          (assign, ":var18", 50),
          (try_begin),
            (eq, ":var30", ":var19"),
            (val_mul, ":var18", 100),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (try_begin),
          (ge, ":var6", 0),
          (ge, ":var11", 0),
          (assign, ":var20", 50000),
          (assign, ":var21", ":var7"),
        (else_try),
          (assign, ":var31", -1),
          (try_begin),
            (eq, ":var12", 7),
            (assign, ":var31", ":var13"),
          (try_end),
          (try_begin),
            (eq, ":var21", -1),
            (try_begin),
              (this_or_next|le, "$party_relative_strength", 20),
              (lt, ":var9", ":var3"),
              (is_between, ":var7", "p_town_1", "p_salt_mine"),
              (ge, ":var11", 0),
              (assign, ":var20", 500),
              (assign, ":var21", ":var7"),
            (else_try),
              (call_script, "script_cf_select_random_walled_center_with_faction_and_less_strength_priority", ":var5", ":var31"),
              (assign, ":var21", reg0),
              (assign, ":var20", 10),
              (party_get_slot, ":var32", ":var21", 7),
              (try_begin),
                (call_script, "script_cf_troop_check_troop_is_enemy", ":var0", ":var32"),
                (assign, ":var20", 1),
              (try_end),
              (try_begin),
                (eq, ":var31", ":var21"),
                (val_mul, ":var20", 1000),
              (try_end),
            (try_end),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (lt, "$party_relative_strength", 50),
        (store_sub, ":var33", 100, "$party_relative_strength"),
        (try_begin),
          (gt, ":var18", 0),
          (val_mul, ":var18", 200),
          (val_div, ":var18", ":var33"),
        (else_try),
          (val_mul, ":var20", 200),
          (val_div, ":var20", ":var33"),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$ratio_of_prisoners", 50),
        (try_begin),
          (gt, ":var18", 0),
          (val_mul, ":var18", 2),
        (else_try),
          (val_mul, ":var20", 2),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var6", -1),
        (ge, ":var9", ":var3"),
        (assign, ":var34", -1),
        (try_begin),
          (eq, ":var12", 16),
          (assign, ":var34", ":var13"),
        (try_end),
        (troop_get_slot, ":var35", ":var0", 14),
        (faction_get_slot, ":var36", ":var35", 9),
        (assign, ":var37", 0),
        (try_for_range, ":var38", "p_village_1", "p_salt_mine"),
          (store_faction_of_party, ":var39", ":var38"),
          (store_relation, ":var40", ":var39", ":var5"),
          (this_or_next|ge, ":var40", 0),
          (party_slot_eq, ":var38", 19, ":var36"),
          (assign, ":var41", 1),
          (try_begin),
            (eq, ":var39", ":var5"),
            (assign, ":var41", 20),
          (try_end),
          (assign, ":var42", 1),
          (party_get_slot, ":var43", ":var38", 91),
          (try_begin),
            (gt, ":var43", 0),
            (val_add, ":var43", 5),
            (val_add, ":var42", ":var43"),
          (try_end),
          (store_distance_to_party_from_party, ":var44", ":var38", ":var1"),
          (store_sub, ":var45", 100, ":var44"),
          (val_max, ":var45", 10),
          (assign, ":var46", 100),
          (try_begin),
            (party_slot_eq, ":var38", 35, 1),
            (assign, ":var46", 1),
          (try_end),
          (store_mul, ":var47", ":var41", ":var45"),
          (val_mul, ":var47", ":var46"),
          (val_mul, ":var47", ":var42"),
          (try_begin),
            (eq, ":var38", ":var34"),
            (val_mul, ":var47", 100),
          (try_end),
          (val_add, ":var37", ":var47"),
        (try_end),
        (gt, ":var37", 0),
        (store_random_in_range, ":var48", 0, ":var37"),
        (try_for_range, ":var38", "p_village_1", "p_salt_mine"),
          (eq, ":var29", -1),
          (store_faction_of_party, ":var39", ":var38"),
          (store_relation, ":var40", ":var39", ":var5"),
          (this_or_next|ge, ":var40", 0),
          (party_slot_eq, ":var38", 19, ":var36"),
          (assign, ":var41", 1),
          (try_begin),
            (eq, ":var39", ":var5"),
            (assign, ":var41", 20),
          (try_end),
          (assign, ":var42", 1),
          (party_get_slot, ":var43", ":var38", 91),
          (try_begin),
            (gt, ":var43", 0),
            (val_add, ":var43", 5),
            (val_add, ":var42", ":var43"),
          (try_end),
          (store_distance_to_party_from_party, ":var44", ":var38", ":var1"),
          (store_sub, ":var45", 100, ":var44"),
          (val_max, ":var45", 10),
          (assign, ":var46", 100),
          (try_begin),
            (party_slot_eq, ":var38", 35, 1),
            (assign, ":var46", 1),
          (try_end),
          (store_mul, ":var47", ":var41", ":var45"),
          (val_mul, ":var47", ":var46"),
          (val_mul, ":var47", ":var42"),
          (try_begin),
            (eq, ":var38", ":var34"),
            (val_mul, ":var47", 100),
          (try_end),
          (val_sub, ":var48", ":var47"),
          (lt, ":var48", 0),
          (assign, ":var29", ":var38"),
          (assign, ":var28", 3),
          (try_begin),
            (eq, ":var34", ":var29"),
            (val_mul, ":var28", 1000),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var6", -1),
        (ge, ":var9", ":var3"),
        (gt, "$party_relative_strength", 75),
        (lt, "$ratio_of_prisoners", 50),
        (assign, ":var49", -1),
        (try_begin),
          (eq, ":var12", 5),
          (assign, ":var49", ":var13"),
        (try_end),
        (assign, ":var37", 0),
        (try_for_range, ":var50", "p_village_1", "p_salt_mine"),
          (call_script, "script_get_center_faction_relation_including_player", ":var50", ":var5"),
          (lt, reg0, 0),
          (assign, ":var51", 0),
          (try_begin),
            (party_slot_eq, ":var50", 35, 1),
            (party_slot_eq, ":var50", 34, ":var1"),
            (assign, ":var51", 1),
          (try_end),
          (this_or_next|party_slot_eq, ":var50", 35, 0),
          (eq, ":var51", 1),
          (store_distance_to_party_from_party, ":var44", ":var50", ":var1"),
          (store_sub, ":var45", 75, ":var44"),
          (val_max, ":var45", 3),
          (val_add, ":var37", ":var45"),
          (eq, ":var50", ":var49"),
          (val_add, ":var37", 10000),
        (try_end),
        (gt, ":var37", 0),
        (store_random_in_range, ":var48", 0, ":var37"),
        (try_for_range, ":var50", "p_village_1", "p_salt_mine"),
          (eq, ":var27", -1),
          (call_script, "script_get_center_faction_relation_including_player", ":var50", ":var5"),
          (lt, reg0, 0),
          (assign, ":var51", 0),
          (try_begin),
            (party_slot_eq, ":var50", 35, 1),
            (party_slot_eq, ":var50", 34, ":var1"),
            (assign, ":var51", 1),
          (try_end),
          (this_or_next|party_slot_eq, ":var50", 35, 0),
          (eq, ":var51", 1),
          (store_distance_to_party_from_party, ":var44", ":var50", ":var1"),
          (store_sub, ":var45", 75, ":var44"),
          (val_max, ":var45", 3),
          (val_sub, ":var48", ":var45"),
          (try_begin),
            (eq, ":var50", ":var49"),
            (val_sub, ":var48", 10000),
          (try_end),
          (lt, ":var48", 0),
          (assign, ":var27", ":var50"),
          (assign, ":var26", 30),
          (try_begin),
            (eq, ":var49", ":var27"),
            (val_mul, ":var26", 100),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var6", -1),
        (ge, ":var9", ":var3"),
        (assign, ":var52", 0),
        (try_begin),
          (eq, ":var12", 1),
          (gt, "$party_relative_strength", 30),
          (assign, ":var52", 1),
        (else_try),
          (gt, "$party_relative_strength", 75),
          (lt, "$ratio_of_prisoners", 50),
          (assign, ":var52", 1),
        (try_end),
        (eq, ":var52", 1),
        (assign, ":var53", ":var4"),
        (val_add, ":var53", ":var2"),
        (assign, ":var54", -1),
        (try_begin),
          (eq, ":var12", 1),
          (assign, ":var54", ":var13"),
        (try_end),
        (assign, ":var55", -1),
        (assign, ":var56", 0),
        (try_for_range, ":var57", "p_town_1", "p_village_1"),
          (party_get_slot, ":var58", ":var57", 54),
          (assign, ":var59", 0),
          (try_begin),
            (ge, ":var58", 0),
            (party_is_active, ":var58"),
            (store_faction_of_party, ":var60", ":var58"),
            (eq, ":var60", ":var5"),
            (assign, ":var59", 1),
          (try_end),
          (this_or_next|eq, ":var58", -1),
          (eq, ":var59", 1),
          (call_script, "script_get_center_faction_relation_including_player", ":var57", ":var5"),
          (assign, ":var40", reg0),
          (lt, ":var40", 0),
          (val_mul, ":var40", -1),
          (val_add, ":var40", 50),
          (store_distance_to_party_from_party, ":var44", ":var57", ":var1"),
          (store_sub, ":var45", 75, ":var44"),
          (val_max, ":var45", 3),
          (party_get_slot, ":var61", ":var57", 56),
          (party_get_slot, ":var62", ":var57", 57),
          (val_add, ":var61", ":var62"),
          (store_mul, ":var63", ":var61", 100),
          (val_div, ":var63", ":var53"),
          (store_sub, ":var64", 1000, ":var63"),
          (val_max, ":var64", 1),
          (val_mul, ":var64", ":var40"),
          (val_mul, ":var64", ":var45"),
          (try_begin),
            (party_slot_eq, ":var57", 7, "trp_player"),
            (call_script, "script_troop_get_player_relation", ":var0"),
            (assign, ":var65", reg0),
            (lt, ":var65", 0),
            (store_sub, ":var66", 50, ":var65"),
            (val_mul, ":var64", ":var66"),
            (val_div, ":var64", 50),
          (try_end),
          (try_begin),
            (eq, ":var57", ":var54"),
            (val_mul, ":var64", 100),
          (try_end),
          (try_begin),
            (gt, ":var64", ":var56"),
            (assign, ":var56", ":var64"),
            (assign, ":var55", ":var57"),
          (try_end),
        (try_end),
        (ge, ":var55", 0),
        (assign, ":var22", 20),
        (assign, ":var23", ":var55"),
        (try_begin),
          (eq, ":var54", ":var23"),
          (val_mul, ":var22", 100),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var6", -1),
        (ge, ":var9", ":var3"),
        (ge, "$party_relative_strength", 60),
        (try_begin),
          (party_slot_eq, ":var1", 4, 4),
          (party_get_slot, ":var25", ":var1", 5),
        (try_end),
        (assign, ":var67", -1),
        (try_begin),
          (eq, ":var12", 4),
          (assign, ":var67", ":var13"),
        (try_end),
        (assign, ":var68", 0),
        (assign, ":var69", -1),
        (try_for_range, ":var70", "p_town_1", "p_salt_mine"),
          (store_faction_of_party, ":var71", ":var70"),
          (eq, ":var71", ":var5"),
          (store_distance_to_party_from_party, ":var72", ":var1", ":var70"),
          (store_sub, ":var73", 100, ":var72"),
          (val_max, ":var73", 1),
          (try_begin),
            (party_slot_ge, ":var70", 55, 0),
            (val_mul, ":var73", 100),
          (try_end),
          (try_begin),
            (party_slot_eq, ":var70", 7, ":var0"),
            (val_mul, ":var73", 2),
          (try_end),
          (try_begin),
            (eq, ":var70", ":var67"),
            (val_mul, ":var73", 1000),
          (try_end),
          (try_begin),
            (gt, ":var73", ":var68"),
            (assign, ":var68", ":var73"),
            (assign, ":var69", ":var70"),
          (try_end),
        (try_end),
        (try_begin),
          (gt, ":var68", 0),
          (assign, ":var25", ":var69"),
        (try_end),
        (try_begin),
          (is_between, ":var25", "p_town_1", "p_salt_mine"),
          (assign, ":var24", 80),
        (try_end),
        (try_begin),
          (troop_slot_ge, ":var0", 55, 1),
          (val_mul, ":var24", 10),
        (try_end),
        (try_begin),
          (eq, ":var67", ":var25"),
          (val_mul, ":var24", 100),
        (try_end),
      (try_end),
      (assign, ":var74", ":var18"),
      (val_add, ":var74", ":var20"),
      (val_add, ":var74", ":var28"),
      (val_add, ":var74", ":var26"),
      (val_add, ":var74", ":var22"),
      (val_add, ":var74", ":var24"),
      (val_max, ":var74", 1),
      (store_random_in_range, ":var75", 0, ":var74"),
      (try_begin),
        (val_sub, ":var75", ":var18"),
        (lt, ":var75", 0),
        (call_script, "script_party_set_ai_state", ":var1", 7, ":var19"),
        (party_set_flags, ":var1", 65536, 1),
        (party_set_slot, ":var1", 30, -1),
      (else_try),
        (val_sub, ":var75", ":var20"),
        (lt, ":var75", 0),
        (call_script, "script_party_set_ai_state", ":var1", 7, ":var21"),
        (party_set_slot, ":var1", 30, -1),
      (else_try),
        (val_sub, ":var75", ":var28"),
        (lt, ":var75", 0),
        (call_script, "script_party_set_ai_state", ":var1", 16, ":var29"),
        (party_set_slot, ":var1", 30, -1),
      (else_try),
        (val_sub, ":var75", ":var26"),
        (lt, ":var75", 0),
        (call_script, "script_party_set_ai_state", ":var1", 5, ":var27"),
        (party_set_slot, ":var1", 30, -1),
      (else_try),
        (val_sub, ":var75", ":var22"),
        (lt, ":var75", 0),
        (call_script, "script_party_set_ai_state", ":var1", 1, ":var23"),
      (else_try),
        (val_sub, ":var75", ":var24"),
        (lt, ":var75", 0),
        (call_script, "script_party_set_ai_state", ":var1", 4, ":var25"),
        (party_set_slot, ":var1", 30, -1),
      (else_try),
        (call_script, "script_party_set_ai_state", ":var1", -1, -1),
        (party_set_slot, ":var1", 30, -1),
      (try_end),
    (try_end),
  ]),

  ("process_kingdom_parties_ai",
  [
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 2, 2),
      (neg|troop_slot_ge, ":var0", 8, 0),
      (troop_get_slot, ":var1", ":var0", 10),
      (gt, ":var1", 0),
      (call_script, "script_process_hero_ai", ":var0"),
    (try_end),
  ]),

  ("process_hero_ai",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 10),
    (store_faction_of_party, ":var2", ":var1"),
    (party_get_slot, ":var3", ":var1", 4),
    (party_get_slot, ":var4", ":var1", 5),
    (try_begin),
      (eq, ":var3", 1),
      (try_begin),
        (party_slot_eq, ":var4", 54, -1),
        (store_distance_to_party_from_party, ":var5", ":var1", ":var4"),
        (lt, ":var5", 3),
        (try_begin),
          (party_slot_ge, ":var1", 30, 0),
          (party_get_slot, ":var6", ":var1", 30),
          (party_set_slot, ":var4", 54, ":var6"),
        (else_try),
          (party_set_slot, ":var4", 54, ":var1"),
        (try_end),
        (store_current_hours, ":var7"),
        (party_set_slot, ":var4", 64, ":var7"),
        (str_store_party_name_link, s1, ":var4"),
        (str_store_troop_name_link, s2, ":var0"),
        (str_store_faction_name_link, s3, ":var2"),
        (display_log_message, "@{s1} has been besieged by {s2} of {s3}."),
        (try_begin),
          (store_faction_of_party, ":var8", ":var4"),
          (this_or_next|party_slot_eq, ":var4", 7, "trp_player"),
          (eq, ":var8", "fac_player_supporters_faction"),
          (call_script, "script_add_notification_menu", "mnu_notification_center_under_siege", ":var4", ":var0"),
        (try_end),
        (call_script, "script_village_set_state", ":var4", 5),
        (assign, "$g_recalculate_ais", 1),
      (try_end),
    (else_try),
      (eq, ":var3", 16),
      (try_begin),
        (store_distance_to_party_from_party, ":var5", ":var1", ":var4"),
        (lt, ":var5", 3),
        (store_current_hours, ":var7"),
        (party_get_slot, ":var9", ":var1", 8),
        (val_add, ":var9", 1),
        (party_set_slot, ":var1", 8, ":var9"),
        (try_begin),
          (ge, ":var9", 4),
          (party_set_slot, ":var1", 8, ":var7"),
          (call_script, "script_party_set_ai_state", ":var1", -1, -1),
          (party_set_flags, ":var1", 65536, 0),
          (party_set_slot, ":var1", 30, -1),
          (party_get_slot, ":var10", ":var4", 90),
          (party_get_slot, ":var11", ":var4", 91),
          (party_set_slot, ":var4", 91, -1),
          (party_add_members, ":var1", ":var10", ":var11"),
        (try_end),
      (try_end),
    (else_try),
      (eq, ":var3", 5),
      (party_slot_eq, ":var1", 8, 0),
      (assign, ":var12", 0),
      (try_for_range, ":var13", "p_village_1", "p_salt_mine"),
        (eq, ":var12", 0),
        (store_faction_of_party, ":var14", ":var13"),
        (try_begin),
          (party_slot_eq, ":var13", 7, "trp_player"),
          (store_relation, ":var15", "fac_player_supporters_faction", ":var2"),
        (else_try),
          (store_relation, ":var15", ":var14", ":var2"),
        (try_end),
        (lt, ":var15", 0),
        (store_distance_to_party_from_party, ":var16", ":var13", ":var1"),
        (lt, ":var16", 15),
        (party_slot_eq, ":var13", 35, 0),
        (assign, ":var12", ":var13"),
      (try_end),
      (try_begin),
        (eq, ":var12", 0),
        (is_between, ":var4", "p_village_1", "p_salt_mine"),
        (assign, ":var12", ":var4"),
      (try_end),
      (try_begin),
        (gt, ":var12", 0),
        (call_script, "script_party_set_ai_state", ":var1", 5, ":var12"),
        (try_begin),
          (faction_slot_eq, ":var2", 7, ":var0"),
          (faction_slot_eq, ":var2", 4, 3),
          (faction_set_slot, ":var2", 5, ":var12"),
        (try_end),
        (party_get_position, pos1, ":var12"),
        (map_get_random_position_around_position, pos2, pos1, 1),
        (party_set_ai_behavior, ":var1", ai_bhvr_travel_to_point),
        (party_set_ai_target_position, ":var1", pos2),
        (party_set_ai_object, ":var1", ":var12"),
        (party_set_slot, ":var1", 8, 1),
      (try_end),
    (else_try),
      (eq, ":var3", 5),
      (try_begin),
        (store_distance_to_party_from_party, ":var5", ":var1", ":var4"),
        (lt, ":var5", 2),
        (try_begin),
          (party_slot_eq, ":var4", 35, 0),
          (call_script, "script_village_set_state", ":var4", 1),
          (party_set_slot, ":var4", 34, ":var1"),
          (try_begin),
            (store_faction_of_party, ":var17", ":var4"),
            (this_or_next|party_slot_eq, ":var4", 7, "trp_player"),
            (eq, ":var17", "fac_player_supporters_faction"),
            (store_distance_to_party_from_party, ":var16", "p_main_party", ":var4"),
            (this_or_next|lt, ":var16", 30),
            (party_slot_eq, ":var4", 142, 1),
            (call_script, "script_add_notification_menu", "mnu_notification_village_raid_started", ":var4", ":var0"),
          (try_end),
        (else_try),
          (party_slot_eq, ":var4", 35, 1),
        (else_try),
          (party_set_slot, ":var1", 8, 0),
        (try_end),
      (try_end),
    (else_try),
      (eq, ":var3", 14),
      (try_begin),
        (party_get_battle_opponent, ":var18", ":var1"),
        (ge, ":var18", 0),
        (call_script, "script_party_set_ai_state", ":var1", -1, -1),
        (party_set_flags, ":var1", 65536, 0),
        (party_set_slot, ":var1", 30, -1),
      (try_end),
    (else_try),
      (eq, ":var3", 4),
      (try_begin),
        (party_slot_eq, ":var1", 8, 0),
        (store_distance_to_party_from_party, ":var5", ":var1", ":var4"),
        (lt, ":var5", 3),
        (party_set_slot, ":var1", 8, 1),
        (party_set_ai_behavior, ":var1", ai_bhvr_patrol_party),
        (party_set_ai_object, ":var1", ":var4"),
      (try_end),
    (else_try),
      (eq, ":var3", 7),
      (party_get_attached_to, ":var19", ":var1"),
      (try_begin),
        (is_between, ":var19", "p_town_1", "p_village_1"),
        (assign, ":var20", 50),
        (try_begin),
          (party_get_attached_to, ":var19", ":var1"),
          (party_slot_ge, ":var1", 54, 0),
          (assign, ":var20", 5),
        (try_end),
        (store_random_in_range, ":var21", 0, 100),
        (lt, ":var21", ":var20"),
        (assign, ":var22", 0),
        (call_script, "script_party_calculate_regular_strength", ":var1"),
        (assign, ":var23", reg0),
        (try_for_range, ":var24", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var25", ":var24"),
          (store_relation, ":var15", ":var25", ":var2"),
          (lt, ":var15", 0),
          (troop_get_slot, ":var18", ":var24", 10),
          (gt, ":var18", 0),
          (party_is_active, ":var18"),
          (store_distance_to_party_from_party, ":var16", ":var18", ":var1"),
          (lt, ":var16", 7),
          (call_script, "script_party_calculate_regular_strength", "p_collective_enemy"),
          (gt, reg0, ":var23"),
          (assign, ":var22", 1),
        (try_end),
        (eq, ":var22", 0),
        (party_set_ai_behavior, ":var1", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var1", ":var4"),
        (party_set_flags, ":var1", 65536, 0),
        (party_detach, ":var1"),
      (try_end),
    (try_end),
  ]),

  ("select_faction_marshall",
  [
    (store_script_param_1, ":var0"),
    (faction_get_slot, ":var1", ":var0", 10),
    (faction_get_slot, ":var2", ":var0", 7),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "trp_kingdom_heroes_including_player_begin", "trp_knight_1_1_wife"),
      (assign, ":var5", ":var4"),
      (assign, ":var6", 0),
      (try_begin),
        (eq, ":var4", "trp_kingdom_heroes_including_player_begin"),
        (assign, ":var5", "trp_player"),
        (try_begin),
          (eq, ":var0", "$players_kingdom"),
          (assign, ":var6", 1),
        (try_end),
      (else_try),
        (troop_slot_eq, ":var5", 2, 2),
        (store_troop_faction, ":var7", ":var5"),
        (eq, ":var7", ":var0"),
        (troop_get_slot, ":var8", ":var5", 10),
        (gt, ":var8", 0),
        (party_is_active, ":var8"),
        (call_script, "script_party_count_fit_for_battle", ":var8"),
        (assign, ":var9", reg0),
        (call_script, "script_party_get_ideal_size", ":var8"),
        (assign, ":var10", reg0),
        (store_mul, ":var11", ":var9", 100),
        (val_div, ":var11", ":var10"),
        (ge, ":var11", 25),
        (assign, ":var6", 1),
      (try_end),
      (eq, ":var6", 1),
      (troop_get_slot, ":var12", ":var5", 7),
      (try_begin),
        (eq, ":var5", "trp_player"),
        (neq, ":var2", "trp_player"),
        (assign, ":var12", 0),
      (try_end),
      (try_begin),
        (eq, ":var5", ":var1"),
        (val_mul, ":var12", 3),
        (val_div, ":var12", 4),
      (try_end),
      (try_begin),
        (eq, ":var5", ":var2"),
        (val_mul, ":var12", 1000),
      (try_end),
      (val_add, ":var3", ":var12"),
    (try_end),
    (assign, ":var13", -1),
    (try_begin),
      (gt, ":var3", 0),
      (store_random_in_range, ":var14", 0, ":var3"),
      (try_for_range, ":var4", "trp_kingdom_heroes_including_player_begin", "trp_knight_1_1_wife"),
        (eq, ":var13", -1),
        (assign, ":var5", ":var4"),
        (assign, ":var6", 0),
        (try_begin),
          (eq, ":var4", "trp_kingdom_heroes_including_player_begin"),
          (assign, ":var5", "trp_player"),
          (try_begin),
            (eq, ":var0", "$players_kingdom"),
            (assign, ":var6", 1),
          (try_end),
        (else_try),
          (troop_slot_eq, ":var5", 2, 2),
          (store_troop_faction, ":var7", ":var5"),
          (eq, ":var7", ":var0"),
          (troop_get_slot, ":var8", ":var5", 10),
          (gt, ":var8", 0),
          (party_is_active, ":var8"),
          (call_script, "script_party_count_fit_for_battle", ":var8"),
          (assign, ":var9", reg0),
          (call_script, "script_party_get_ideal_size", ":var8"),
          (assign, ":var10", reg0),
          (store_mul, ":var11", ":var9", 100),
          (val_div, ":var11", ":var10"),
          (ge, ":var11", 25),
          (assign, ":var6", 1),
        (try_end),
        (eq, ":var6", 1),
        (troop_get_slot, ":var12", ":var5", 7),
        (try_begin),
          (eq, ":var5", "trp_player"),
          (neq, ":var2", "trp_player"),
          (assign, ":var12", 0),
        (try_end),
        (try_begin),
          (eq, ":var5", ":var1"),
          (val_mul, ":var12", 3),
          (val_div, ":var12", 4),
        (try_end),
        (try_begin),
          (eq, ":var5", ":var2"),
          (val_mul, ":var12", 1000),
        (try_end),
        (val_sub, ":var14", ":var12"),
        (lt, ":var14", 0),
        (assign, ":var13", ":var5"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (ge, ":var13", 0),
      (str_store_troop_name, s1, ":var13"),
      (str_store_faction_name, s2, ":var0"),
      (display_message, "@{s1} is chosen as the marshall of {s2}."),
    (try_end),
    (assign, reg0, ":var13"),
  ]),

  ("get_center_faction_relation_including_player",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_faction_of_party, ":var2", ":var0"),
    (store_relation, ":var3", ":var2", ":var1"),
    (try_begin),
      (party_slot_eq, ":var0", 7, "trp_player"),
      (store_relation, ":var3", "fac_player_supporters_faction", ":var1"),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("decide_faction_ai",
  [
    (store_script_param_1, ":var0"),
    (faction_get_slot, ":var1", ":var0", 4),
    (faction_get_slot, ":var2", ":var0", 5),
    (faction_get_slot, ":var3", ":var0", 6),
    (assign, ":var4", -1),
    (assign, ":var5", 1),
    (assign, ":var6", 1),
    (call_script, "script_select_faction_marshall", ":var0"),
    (assign, ":var7", reg0),
    (assign, ":var8", 0),
    (try_begin),
      (neg|faction_slot_eq, ":var0", 7, ":var7"),
      (assign, ":var8", 1),
      (eq, "$players_kingdom", ":var0"),
      (str_store_troop_name_link, s1, ":var7"),
      (str_store_faction_name_link, s2, ":var0"),
      (display_message, "@{s1} is the new marshall of {s2}."),
      (call_script, "script_check_and_finish_active_army_quests_for_faction", ":var0"),
    (try_end),
    (faction_set_slot, ":var0", 7, ":var7"),
    (try_begin),
      (gt, ":var7", 0),
      (troop_get_slot, ":var4", ":var7", 10),
      (gt, ":var4", 0),
      (party_get_slot, ":var5", ":var4", 56),
      (party_get_slot, ":var9", ":var4", 59),
      (val_add, ":var5", ":var9"),
      (try_for_range, ":var10", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var10", 2, 2),
        (troop_get_slot, ":var11", ":var10", 10),
        (gt, ":var11", 0),
        (party_is_active, ":var11"),
        (party_slot_eq, ":var11", 30, ":var4"),
        (val_add, ":var6", 1),
      (try_end),
    (try_end),
    (faction_get_slot, ":var12", ":var0", 8),
    (val_max, ":var12", 1),
    (store_mul, ":var13", ":var6", 100),
    (val_mul, ":var13", ":var6"),
    (val_div, ":var13", ":var12"),
    (val_div, ":var13", ":var12"),
    (val_min, ":var13", 100),
    (faction_get_slot, ":var14", ":var0", 80),
    (faction_get_slot, ":var15", ":var0", 81),
    (faction_get_slot, ":var16", ":var0", 82),
    (store_current_hours, ":var17"),
    (store_sub, ":var18", ":var17", ":var3"),
    (assign, ":var19", 0),
    (try_for_range, ":var20", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var20", 21, 0),
      (store_relation, ":var21", ":var20", ":var0"),
      (lt, ":var21", 0),
      (val_add, ":var19", 1),
    (try_end),
    (assign, ":var22", 0),
    (assign, ":var23", 0),
    (assign, ":var24", 0),
    (assign, ":var25", 0),
    (assign, ":var26", 0),
    (assign, ":var27", 0),
    (assign, ":var28", -1),
    (assign, ":var29", -1),
    (assign, ":var30", -1),
    (assign, ":var31", -1),
    (try_begin),
      (eq, ":var1", 0),
      (assign, ":var22", 100),
    (else_try),
      (eq, ":var1", 1),
      (gt, ":var18", 180),
      (assign, ":var22", 10000),
    (else_try),
      (store_div, ":var22", ":var18", 10),
      (store_mul, ":var32", ":var8", 300),
      (val_add, ":var22", ":var32"),
    (try_end),
    (try_begin),
      (eq, ":var1", 0),
      (gt, ":var4", 0),
      (try_begin),
        (gt, ":var19", 0),
        (store_mul, ":var33", ":var19", 20),
        (val_add, ":var23", ":var33"),
        (store_sub, ":var34", ":var18", 96),
        (val_min, ":var34", 200),
        (val_add, ":var23", ":var34"),
        (store_mul, ":var35", ":var16", 2),
        (val_add, ":var35", ":var15"),
        (val_mul, ":var35", 10),
        (val_max, ":var35", 5),
        (store_sub, ":var36", "$g_average_center_value_per_faction", ":var35"),
        (val_add, ":var23", ":var36"),
        (store_mul, ":var37", ":var14", 4),
        (store_sub, ":var37", 80, ":var37"),
        (val_add, ":var23", ":var37"),
        (assign, ":var38", 0),
        (try_for_range, ":var39", "p_town_1", "p_village_1"),
          (party_slot_ge, ":var39", 54, 0),
          (store_faction_of_party, ":var40", ":var39"),
          (eq, ":var40", ":var0"),
          (val_add, ":var38", 1),
        (try_end),
        (store_mul, ":var41", ":var38", 100),
        (val_add, ":var23", ":var41"),
      (try_end),
    (else_try),
      (eq, ":var1", 1),
      (this_or_next|lt, ":var18", 60),
      (lt, ":var6", 4),
      (assign, ":var23", 3000),
    (try_end),
    (try_begin),
      (neq, ":var1", 0),
      (gt, ":var4", 0),
      (assign, ":var42", -1),
      (try_begin),
        (eq, ":var1", 2),
        (assign, ":var42", ":var2"),
      (try_end),
      (assign, ":var43", -1),
      (assign, ":var44", 0),
      (try_for_range, ":var45", "p_town_1", "p_village_1"),
        (party_get_slot, ":var46", ":var45", 54),
        (assign, ":var47", 0),
        (try_begin),
          (ge, ":var46", 0),
          (party_is_active, ":var46"),
          (store_faction_of_party, ":var48", ":var46"),
          (eq, ":var48", ":var0"),
          (assign, ":var47", 1),
        (try_end),
        (this_or_next|eq, ":var46", -1),
        (eq, ":var47", 1),
        (call_script, "script_get_center_faction_relation_including_player", ":var45", ":var0"),
        (assign, ":var21", reg0),
        (lt, ":var21", 0),
        (val_mul, ":var21", -1),
        (val_add, ":var21", 50),
        (store_distance_to_party_from_party, ":var49", ":var45", ":var4"),
        (val_add, ":var49", 20),
        (party_get_slot, ":var50", ":var45", 56),
        (party_get_slot, ":var51", ":var45", 57),
        (val_add, ":var50", ":var51"),
        (val_add, ":var50", 1),
        (store_mul, ":var52", 1000, ":var5"),
        (val_div, ":var52", ":var50"),
        (gt, ":var52", 1500),
        (val_min, ":var52", 20000),
        (try_begin),
          (party_slot_eq, ":var45", 7, "trp_player"),
          (call_script, "script_troop_get_player_relation", ":var7"),
          (assign, ":var53", reg0),
          (lt, ":var53", 0),
          (store_sub, ":var54", 50, ":var53"),
          (val_mul, ":var52", ":var54"),
          (val_div, ":var52", 50),
        (try_end),
        (try_begin),
          (party_slot_eq, ":var45", 61, ":var0"),
          (val_mul, ":var52", 2),
        (try_end),
        (try_begin),
          (party_slot_eq, ":var45", 62, ":var0"),
          (val_mul, ":var52", 2),
        (try_end),
        (val_mul, ":var52", ":var21"),
        (val_div, ":var52", ":var49"),
        (try_begin),
          (eq, ":var45", ":var42"),
          (val_mul, ":var52", 100),
        (try_end),
        (try_begin),
          (gt, ":var52", ":var44"),
          (assign, ":var44", ":var52"),
          (assign, ":var43", ":var45"),
        (try_end),
      (try_end),
      (ge, ":var43", 0),
      (store_div, ":var24", ":var44", 15),
      (val_min, ":var24", 1000),
      (assign, ":var28", ":var43"),
      (try_begin),
        (eq, ":var42", ":var28"),
        (val_mul, ":var24", 100),
      (try_end),
      (val_mul, ":var24", ":var13"),
      (val_div, ":var24", 100),
    (try_end),
    (try_begin),
      (neq, ":var1", 0),
      (gt, ":var4", 0),
      (assign, ":var55", -1),
      (try_begin),
        (eq, ":var1", 3),
        (assign, ":var55", ":var2"),
      (try_end),
      (assign, ":var56", 0),
      (try_for_range, ":var57", "p_village_1", "p_salt_mine"),
        (call_script, "script_get_center_faction_relation_including_player", ":var57", ":var0"),
        (lt, reg0, 0),
        (store_distance_to_party_from_party, ":var49", ":var57", ":var4"),
        (lt, ":var49", 120),
        (this_or_next|party_slot_eq, ":var57", 35, 0),
        (party_slot_eq, ":var57", 35, 1),
        (store_sub, ":var58", 150, ":var49"),
        (val_add, ":var56", ":var58"),
        (eq, ":var57", ":var55"),
        (val_add, ":var56", 10000),
      (try_end),
      (gt, ":var56", 0),
      (store_random_in_range, ":var59", 0, ":var56"),
      (try_for_range, ":var57", "p_village_1", "p_salt_mine"),
        (eq, ":var29", -1),
        (call_script, "script_get_center_faction_relation_including_player", ":var57", ":var0"),
        (lt, reg0, 0),
        (store_distance_to_party_from_party, ":var49", ":var57", ":var4"),
        (lt, ":var49", 120),
        (this_or_next|party_slot_eq, ":var57", 35, 0),
        (party_slot_eq, ":var57", 35, 1),
        (store_sub, ":var58", 150, ":var49"),
        (val_sub, ":var59", ":var58"),
        (try_begin),
          (eq, ":var57", ":var55"),
          (val_sub, ":var59", 10000),
        (try_end),
        (lt, ":var59", 0),
        (assign, ":var29", ":var57"),
        (assign, ":var25", 20),
        (try_begin),
          (eq, ":var55", ":var29"),
          (val_mul, ":var25", 100),
        (try_end),
        (val_mul, ":var25", ":var13"),
        (val_div, ":var25", 100),
      (try_end),
    (try_end),
    (try_begin),
      (neq, ":var1", 0),
      (gt, ":var4", 0),
      (assign, ":var60", -1),
      (try_begin),
        (eq, ":var1", 4),
        (assign, ":var60", ":var2"),
      (try_end),
      (assign, ":var61", -1),
      (assign, ":var62", 0),
      (try_for_range, ":var20", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var20", 21, 0),
        (faction_get_slot, ":var63", ":var20", 7),
        (ge, ":var63", 0),
        (troop_slot_eq, ":var63", 2, 2),
        (troop_get_slot, ":var64", ":var63", 10),
        (ge, ":var64", 0),
        (party_is_active, ":var64"),
        (store_troop_faction, ":var65", ":var63"),
        (store_relation, ":var66", ":var65", ":var0"),
        (lt, ":var66", 0),
        (this_or_next|faction_slot_eq, ":var65", 4, 2),
        (faction_slot_eq, ":var65", 4, 3),
        (party_get_slot, ":var67", ":var64", 59),
        (party_get_slot, ":var68", ":var64", 56),
        (val_add, ":var68", ":var67"),
        (store_mul, ":var69", ":var68", 1000),
        (val_div, ":var69", ":var5"),
        (try_begin),
          (gt, ":var69", 850),
          (store_sub, ":var69", 1700, ":var69"),
        (try_end),
        (gt, ":var69", 0),
        (val_mul, ":var69", 2),
        (try_begin),
          (faction_slot_eq, ":var65", 4, 2),
          (val_mul, ":var69", 10),
        (else_try),
          (faction_slot_eq, ":var65", 4, 3),
          (val_mul, ":var69", 3),
        (try_end),
        (try_begin),
          (eq, ":var60", ":var64"),
          (val_mul, ":var69", 100),
        (try_end),
        (store_distance_to_party_from_party, ":var49", ":var64", ":var4"),
        (val_add, ":var49", 20),
        (val_div, ":var69", ":var49"),
        (gt, ":var69", ":var62"),
        (assign, ":var61", ":var64"),
        (assign, ":var62", ":var69"),
      (try_end),
      (ge, ":var61", 0),
      (store_mul, ":var26", ":var62", 2),
      (val_min, ":var26", 1500),
      (assign, ":var30", ":var61"),
      (try_begin),
        (eq, ":var60", ":var30"),
        (val_mul, ":var26", 100),
      (try_end),
      (val_mul, ":var26", ":var13"),
      (val_div, ":var26", 100),
    (try_end),
    (try_begin),
      (neq, ":var1", 0),
      (gt, ":var4", 0),
      (assign, ":var70", -1),
      (try_begin),
        (eq, ":var1", 5),
        (assign, ":var70", ":var2"),
      (try_end),
      (assign, ":var71", -1),
      (assign, ":var62", 0),
      (try_for_range, ":var72", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var40", ":var72"),
        (eq, ":var40", ":var0"),
        (party_get_slot, ":var73", ":var72", 58),
        (store_mul, ":var69", ":var73", 1000),
        (val_div, ":var69", ":var5"),
        (try_begin),
          (gt, ":var69", 850),
          (store_sub, ":var69", 1700, ":var69"),
        (try_end),
        (gt, ":var69", 0),
        (val_mul, ":var69", 4),
        (try_begin),
          (party_slot_eq, ":var72", 0, 4),
          (try_begin),
            (party_slot_eq, ":var72", 35, 1),
            (val_mul, ":var69", 3),
          (try_end),
        (else_try),
          (try_begin),
            (party_slot_ge, ":var72", 54, 0),
            (val_mul, ":var69", 10),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var70", ":var72"),
          (val_mul, ":var69", 100),
        (try_end),
        (store_distance_to_party_from_party, ":var49", ":var72", ":var4"),
        (val_add, ":var49", 20),
        (val_div, ":var69", ":var49"),
        (gt, ":var69", ":var62"),
        (assign, ":var71", ":var72"),
        (assign, ":var62", ":var69"),
      (try_end),
      (ge, ":var71", 0),
      (store_mul, ":var27", ":var62", 2),
      (val_min, ":var27", 2000),
      (assign, ":var31", ":var71"),
      (try_begin),
        (eq, ":var70", ":var31"),
        (val_mul, ":var27", 1000),
      (try_end),
      (val_mul, ":var27", ":var13"),
      (val_div, ":var27", 100),
      (try_begin),
        (gt, ":var27", ":var26"),
        (assign, ":var74", "fac_kingdoms_end"),
        (try_for_range, ":var20", "fac_player_supporters_faction", ":var74"),
          (faction_slot_eq, ":var20", 21, 0),
          (faction_get_slot, ":var63", ":var20", 7),
          (ge, ":var63", 0),
          (troop_slot_eq, ":var63", 2, 2),
          (troop_get_slot, ":var64", ":var63", 10),
          (ge, ":var64", 0),
          (party_is_active, ":var64"),
          (store_troop_faction, ":var65", ":var63"),
          (store_relation, ":var66", ":var65", ":var0"),
          (lt, ":var66", 0),
          (store_distance_to_party_from_party, ":var75", ":var64", ":var31"),
          (lt, ":var75", 10),
          (assign, ":var26", ":var27"),
          (assign, ":var30", ":var64"),
          (assign, ":var27", 0),
          (assign, ":var31", -1),
          (assign, ":var74", 0),
        (try_end),
      (try_end),
    (try_end),
    (assign, ":var76", 0),
    (val_add, ":var76", ":var22"),
    (val_add, ":var76", ":var23"),
    (val_add, ":var76", ":var24"),
    (val_add, ":var76", ":var25"),
    (val_add, ":var76", ":var26"),
    (val_add, ":var76", ":var27"),
    (store_random_in_range, ":var77", 0, ":var76"),
    (val_sub, ":var77", ":var22"),
    (try_begin),
      (lt, ":var77", 0),
      (faction_set_slot, ":var0", 4, 0),
      (faction_set_slot, ":var0", 5, -1),
      (try_begin),
        (neq, ":var1", 0),
        (call_script, "script_check_and_finish_active_army_quests_for_faction", ":var0"),
        (faction_set_slot, ":var0", 6, ":var17"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_faction_name, s1, ":var0"),
        (display_message, "@{s1} decided to do nothing."),
      (try_end),
    (else_try),
      (val_sub, ":var77", ":var23"),
      (lt, ":var77", 0),
      (faction_set_slot, ":var0", 4, 1),
      (faction_set_slot, ":var0", 5, -1),
      (try_begin),
        (neq, ":var1", 1),
        (faction_set_slot, ":var0", 6, ":var17"),
        (faction_set_slot, ":var0", 8, 1),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_faction_name, s1, ":var0"),
        (display_message, "@{s1} decided to gather army."),
      (try_end),
    (else_try),
      (val_sub, ":var77", ":var24"),
      (lt, ":var77", 0),
      (faction_set_slot, ":var0", 4, 2),
      (faction_set_slot, ":var0", 5, ":var28"),
      (try_begin),
        (gt, ":var6", ":var12"),
        (faction_set_slot, ":var0", 8, ":var6"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_faction_name, s1, ":var0"),
        (str_store_party_name, s2, ":var28"),
        (display_message, "@{s1} decided to besiege {s2}."),
      (try_end),
    (else_try),
      (val_sub, ":var77", ":var25"),
      (lt, ":var77", 0),
      (faction_set_slot, ":var0", 4, 3),
      (faction_set_slot, ":var0", 5, ":var29"),
      (try_begin),
        (gt, ":var6", ":var12"),
        (faction_set_slot, ":var0", 8, ":var6"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_faction_name, s1, ":var0"),
        (str_store_party_name, s2, ":var29"),
        (display_message, "@{s1} decided to raid {s2}."),
      (try_end),
    (else_try),
      (val_sub, ":var77", ":var26"),
      (lt, ":var77", 0),
      (faction_set_slot, ":var0", 4, 4),
      (faction_set_slot, ":var0", 5, ":var30"),
      (try_begin),
        (gt, ":var6", ":var12"),
        (faction_set_slot, ":var0", 8, ":var6"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_faction_name, s1, ":var0"),
        (str_store_party_name, s2, ":var30"),
        (display_message, "@{s1} decided to attack {s2}."),
      (try_end),
    (else_try),
      (val_sub, ":var77", ":var27"),
      (lt, ":var77", 0),
      (faction_set_slot, ":var0", 4, 5),
      (faction_set_slot, ":var0", 5, ":var31"),
      (try_begin),
        (gt, ":var6", ":var12"),
        (faction_set_slot, ":var0", 8, ":var6"),
      (try_end),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_faction_name, s1, ":var0"),
        (str_store_party_name, s2, ":var31"),
        (display_message, "@{s1} decided to attack enemies around {s2}."),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$players_kingdom", ":var0"),
      (neg|faction_slot_eq, ":var0", 4, 2),
      (check_quest_active, "qst_join_siege_with_army"),
      (call_script, "script_abort_quest", "qst_join_siege_with_army", 0),
    (try_end),
  ]),

  ("check_and_finish_active_army_quests_for_faction",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (eq, "$players_kingdom", ":var0"),
      (try_begin),
        (check_quest_active, "qst_report_to_army"),
        (call_script, "script_cancel_quest", "qst_report_to_army"),
      (try_end),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "qst_deliver_cattle_to_army", "qst_rescue_lord_by_replace"),
        (check_quest_active, ":var2"),
        (call_script, "script_cancel_quest", ":var2"),
        (assign, ":var1", 1),
      (try_end),
      (try_begin),
        (check_quest_active, "qst_follow_army"),
        (assign, ":var1", 1),
        (call_script, "script_end_quest", "qst_follow_army"),
      (try_end),
      (eq, ":var1", 1),
      (faction_get_slot, ":var3", ":var0", 6),
      (store_current_hours, ":var4"),
      (store_sub, ":var5", ":var4", ":var3"),
      (store_mul, ":var6", ":var5", 5),
      (val_div, ":var6", 50),
      (val_mul, ":var6", 50),
      (val_add, ":var6", 50),
      (add_xp_as_reward, ":var6"),
    (try_end),
  ]),

  ("troop_get_player_relation",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 52),
    (troop_get_slot, ":var2", ":var0", 22),
    (assign, ":var3", 0),
    (try_begin),
      (eq, ":var1", 2),
      (val_add, ":var2", -3),
    (try_end),
    (try_begin),
      (ge, "$player_honor", 0),
      (try_begin),
        (this_or_next|eq, ":var1", 7),
        (eq, ":var1", 6),
        (store_div, ":var3", "$player_honor", 3),
      (try_end),
    (try_end),
    (try_begin),
      (lt, "$player_honor", 0),
      (try_begin),
        (this_or_next|eq, ":var1", 7),
        (eq, ":var1", 6),
        (store_div, ":var3", "$player_honor", 3),
      (else_try),
        (eq, ":var1", 1),
        (store_div, ":var3", "$player_honor", 5),
      (try_end),
    (try_end),
    (val_add, ":var2", ":var3"),
    (assign, reg0, ":var2"),
  ]),

  ("change_troop_renown",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (troop_get_slot, ":var2", ":var0", 7),
    (store_add, ":var3", ":var2", ":var1"),
    (val_max, ":var3", 0),
    (troop_set_slot, ":var0", 7, ":var3"),
    (try_begin),
      (eq, ":var0", "trp_player"),
      (str_store_troop_name, s1, ":var0"),
      (assign, reg12, ":var1"),
      (val_abs, reg12),
      (try_begin),
        (gt, ":var1", 0),
        (display_message, "@You gained {reg12} renown."),
      (else_try),
        (lt, ":var1", 0),
        (display_message, "@You lose {reg12} renown."),
      (try_end),
    (try_end),
    (call_script, "script_update_troop_notes", ":var0"),
  ]),

  ("change_player_relation_with_troop",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (neq, ":var0", "trp_player"),
      (neg|is_between, ":var0", "trp_recruit", "trp_town_walker_1"),
      (neq, ":var1", 0),
      (call_script, "script_troop_get_player_relation", ":var0"),
      (assign, ":var2", reg0),
      (troop_get_slot, ":var3", ":var0", 22),
      (val_add, ":var3", ":var1"),
      (val_clamp, ":var3", -100, 101),
      (try_begin),
        (troop_set_slot, ":var0", 22, ":var3"),
        (str_store_troop_name_link, s1, ":var0"),
        (call_script, "script_troop_get_player_relation", ":var0"),
        (assign, ":var4", reg0),
        (neq, ":var2", ":var4"),
        (assign, reg1, ":var2"),
        (assign, reg2, ":var4"),
        (try_begin),
          (gt, ":var1", 0),
          (display_message, "str_troop_relation_increased"),
        (else_try),
          (lt, ":var1", 0),
          (display_message, "str_troop_relation_detoriated"),
        (try_end),
        (try_begin),
          (eq, ":var0", "$g_talk_troop"),
          (assign, "$g_talk_troop_relation", ":var4"),
          (call_script, "script_setup_talk_info"),
        (try_end),
        (call_script, "script_update_troop_notes", ":var0"),
      (try_end),
    (try_end),
  ]),

  ("change_player_relation_with_center",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (party_get_slot, ":var2", ":var0", 26),
    (assign, reg1, ":var2"),
    (val_add, ":var2", ":var1"),
    (val_clamp, ":var2", -100, 100),
    (assign, reg2, ":var2"),
    (party_set_slot, ":var0", 26, ":var2"),
    (str_store_party_name_link, s1, ":var0"),
    (try_begin),
      (gt, ":var1", 0),
      (display_message, "@Your relation with {s1} has improved."),
    (else_try),
      (lt, ":var1", 0),
      (display_message, "@Your relation with {s1} has deteriorated."),
    (try_end),
    (try_begin),
      (party_slot_eq, ":var0", 0, 4),
      (call_script, "script_update_volunteer_troops_in_village", ":var0"),
    (try_end),
    (try_begin),
      (this_or_next|is_between, "$g_talk_troop", "trp_village_1_elder", "trp_merchants_end"),
      (is_between, "$g_talk_troop", "trp_town_1_mayor", "trp_village_1_elder"),
      (assign, "$g_talk_troop_relation", ":var2"),
      (call_script, "script_setup_talk_info"),
    (try_end),
  ]),

  ("change_player_relation_with_faction",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (store_relation, ":var2", ":var0", "fac_player_supporters_faction"),
    (assign, reg1, ":var2"),
    (val_add, ":var2", ":var1"),
    (assign, reg2, ":var2"),
    (set_relation, ":var0", "fac_player_faction", ":var2"),
    (set_relation, ":var0", "fac_player_supporters_faction", ":var2"),
    (str_store_faction_name_link, s1, ":var0"),
    (try_begin),
      (gt, ":var1", 0),
      (display_message, "str_faction_relation_increased"),
    (else_try),
      (lt, ":var1", 0),
      (display_message, "str_faction_relation_detoriated"),
    (try_end),
    (call_script, "script_update_all_notes"),
  ]),

  ("set_player_relation_with_faction",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (store_relation, ":var2", ":var0", "fac_player_supporters_faction"),
    (store_sub, ":var3", ":var1", ":var2"),
    (call_script, "script_change_player_relation_with_faction", ":var0", ":var3"),
  ]),

  ("change_player_relation_with_faction_ex",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (store_relation, ":var2", ":var0", "fac_player_supporters_faction"),
    (assign, reg1, ":var2"),
    (val_add, ":var2", ":var1"),
    (assign, reg2, ":var2"),
    (set_relation, ":var0", "fac_player_faction", ":var2"),
    (set_relation, ":var0", "fac_player_supporters_faction", ":var2"),
    (str_store_faction_name_link, s1, ":var0"),
    (try_begin),
      (gt, ":var1", 0),
      (display_message, "str_faction_relation_increased"),
    (else_try),
      (lt, ":var1", 0),
      (display_message, "str_faction_relation_detoriated"),
    (try_end),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var3", 21, 0),
      (neq, ":var0", ":var3"),
      (store_relation, ":var4", ":var0", ":var3"),
      (store_relation, ":var2", ":var3", "fac_player_supporters_faction"),
      (store_mul, ":var5", ":var1", ":var4"),
      (val_div, ":var5", 100),
      (val_add, ":var2", ":var5"),
      (set_relation, ":var3", "fac_player_faction", ":var2"),
      (set_relation, ":var3", "fac_player_supporters_faction", ":var2"),
    (try_end),
    (try_begin),
      (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
      (try_for_range, ":var6", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var6", 21, 0),
        (call_script, "script_update_faction_notes", ":var6"),
      (try_end),
    (try_end),
  ]),

  ("cf_get_random_active_faction_except_player_faction_and_faction",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, ":var2", "fac_player_supporters_faction"),
      (neq, ":var2", ":var0"),
      (faction_slot_eq, ":var2", 21, 0),
      (val_add, ":var1", 1),
    (try_end),
    (gt, ":var1", 0),
    (assign, ":var3", -1),
    (store_random_in_range, ":var4", 0, ":var1"),
    (try_for_range, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (ge, ":var4", 0),
      (neq, ":var2", "fac_player_supporters_faction"),
      (neq, ":var2", ":var0"),
      (faction_slot_eq, ":var2", 21, 0),
      (val_sub, ":var4", 1),
      (lt, ":var4", 0),
      (assign, ":var3", ":var2"),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("make_kingdom_hostile_to_player",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (lt, ":var1", 0),
      (store_relation, ":var2", ":var0", "fac_player_supporters_faction"),
      (val_min, ":var2", 0),
      (val_add, ":var2", ":var1"),
      (call_script, "script_set_player_relation_with_faction", ":var0", ":var2"),
    (try_end),
  ]),

  ("change_player_honor",
  [
    (store_script_param_1, ":var0"),
    (val_add, "$player_honor", ":var0"),
    (try_begin),
      (gt, ":var0", 0),
      (display_message, "@You gain honour."),
    (else_try),
      (lt, ":var0", 0),
      (display_message, "@You lose honour."),
    (try_end),
  ]),

  ("change_player_party_morale",
  [
    (store_script_param_1, ":var0"),
    (party_get_morale, ":var1", "p_main_party"),
    (store_add, ":var2", ":var1", ":var0"),
    (val_clamp, ":var2", 0, 100),
    (party_set_morale, "p_main_party", ":var2"),
    (try_begin),
      (lt, ":var2", ":var1"),
      (store_sub, reg1, ":var1", ":var2"),
      (display_message, "str_party_lost_morale"),
    (else_try),
      (gt, ":var2", ":var1"),
      (store_sub, reg1, ":var2", ":var1"),
      (display_message, "str_party_gained_morale"),
    (try_end),
  ]),

  ("cf_player_has_item_without_modifier",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (player_has_item, ":var0"),
    (assign, ":var2", 0),
    (troop_get_inventory_capacity, ":var3", "trp_player"),
    (try_for_range, ":var4", 0, ":var3"),
      (troop_get_inventory_slot, ":var5", "trp_player", ":var4"),
      (eq, ":var5", ":var0"),
      (troop_get_inventory_slot_modifier, ":var6", "trp_player", ":var4"),
      (neq, ":var6", ":var1"),
      (assign, ":var2", 1),
      (assign, ":var3", 0),
    (try_end),
    (eq, ":var2", 1),
  ]),

  ("get_player_party_morale_values",
  [
    (party_get_num_companion_stacks, ":var0", "p_main_party"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 1, ":var0"),
      (party_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
      (try_begin),
        (troop_is_hero, ":var3"),
        (val_add, ":var1", 3),
      (else_try),
        (party_stack_get_size, ":var4", "p_main_party", ":var2"),
        (val_add, ":var1", ":var4"),
      (try_end),
    (try_end),
    (assign, "$g_player_party_morale_modifier_party_size", ":var1"),
    (store_skill_level, ":var5", "skl_leadership", "trp_player"),
    (store_mul, "$g_player_party_morale_modifier_leadership", ":var5", 7),
    (assign, ":var6", "$g_player_party_morale_modifier_leadership"),
    (val_sub, ":var6", "$g_player_party_morale_modifier_party_size"),
    (val_add, ":var6", 50),
    (assign, "$g_player_party_morale_modifier_food", 0),
    (try_for_range, ":var7", "itm_smoked_fish", "itm_wine"),
      (call_script, "script_cf_player_has_item_without_modifier", ":var7", 41),
      (item_get_slot, ":var8", ":var7", 1),
      (val_add, "$g_player_party_morale_modifier_food", ":var8"),
    (try_end),
    (val_add, ":var6", "$g_player_party_morale_modifier_food"),
    (try_begin),
      (eq, "$g_player_party_morale_modifier_food", 0),
      (assign, "$g_player_party_morale_modifier_no_food", 30),
      (val_sub, ":var6", "$g_player_party_morale_modifier_no_food"),
    (else_try),
      (assign, "$g_player_party_morale_modifier_no_food", 0),
    (try_end),
    (assign, "$g_player_party_morale_modifier_debt", 0),
    (try_begin),
      (gt, "$g_player_debt_to_party_members", 0),
      (call_script, "script_calculate_player_faction_wage"),
      (assign, ":var9", reg0),
      (store_mul, "$g_player_party_morale_modifier_debt", "$g_player_debt_to_party_members", 10),
      (val_div, "$g_player_party_morale_modifier_debt", ":var9"),
      (val_clamp, "$g_player_party_morale_modifier_debt", 1, 31),
      (val_sub, ":var6", "$g_player_party_morale_modifier_debt"),
    (try_end),
    (val_clamp, ":var6", 0, 100),
    (assign, reg0, ":var6"),
  ]),

  ("diplomacy_start_war_between_kingdoms",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_relation, ":var3", ":var0", ":var1"),
    (val_min, ":var3", -10),
    (val_add, ":var3", -30),
    (set_relation, ":var0", ":var1", ":var3"),
    (try_begin),
      (eq, "$players_kingdom", ":var0"),
      (store_relation, ":var3", "fac_player_supporters_faction", ":var1"),
      (val_min, ":var3", -30),
      (call_script, "script_set_player_relation_with_faction", ":var1", ":var3"),
    (else_try),
      (eq, "$players_kingdom", ":var1"),
      (store_relation, ":var3", "fac_player_supporters_faction", ":var0"),
      (val_min, ":var3", -30),
      (call_script, "script_set_player_relation_with_faction", ":var0", ":var3"),
    (try_end),
    (try_begin),
      (eq, ":var2", 1),
      (try_begin),
        (store_random_in_range, ":var4", 0, 2),
        (this_or_next|eq, ":var0", "fac_player_supporters_faction"),
        (eq, ":var4", 0),
        (assign, ":var5", ":var0"),
        (assign, ":var0", ":var1"),
        (assign, ":var1", ":var5"),
      (try_end),
      (str_store_faction_name_link, s1, ":var0"),
      (str_store_faction_name_link, s2, ":var1"),
      (display_log_message, "@{s1} declared war against {s2}."),
      (call_script, "script_add_notification_menu", "mnu_notification_war_declared", ":var0", ":var1"),
      (call_script, "script_update_faction_notes", ":var0"),
      (call_script, "script_update_faction_notes", ":var1"),
      (assign, "$g_recalculate_ais", 1),
    (try_end),
  ]),

  ("party_calculate_and_set_nearby_friend_strength",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (store_faction_of_party, ":var4", ":var0"),
    (store_add, ":var5", "trp_knight_1_1_wife", 1),
    (try_for_range, ":var6", "trp_kingdom_1_lord", ":var5"),
      (try_begin),
        (eq, ":var6", "trp_knight_1_1_wife"),
        (assign, ":var7", "trp_player"),
      (else_try),
        (assign, ":var7", ":var6"),
      (try_end),
      (troop_slot_eq, ":var7", 2, 2),
      (troop_get_slot, ":var8", ":var7", 10),
      (ge, ":var8", 0),
      (party_is_active, ":var8"),
      (neq, ":var0", ":var8"),
      (party_get_slot, ":var9", ":var8", 56),
      (try_begin),
        (party_get_slot, ":var10", ":var8", 30),
        (eq, ":var10", ":var0"),
        (val_add, ":var1", ":var9"),
      (try_end),
      (store_distance_to_party_from_party, ":var11", ":var8", ":var0"),
      (lt, ":var11", 10),
      (store_troop_faction, ":var12", ":var7"),
      (store_relation, ":var13", ":var12", ":var4"),
      (try_begin),
        (this_or_next|eq, ":var12", ":var4"),
        (gt, ":var13", 0),
        (val_add, ":var2", ":var9"),
      (else_try),
        (lt, ":var13", 0),
        (val_add, ":var3", ":var9"),
      (try_end),
    (try_end),
    (party_set_slot, ":var0", 59, ":var1"),
    (party_set_slot, ":var0", 57, ":var2"),
    (party_set_slot, ":var0", 58, ":var3"),
  ]),

  ("init_ai_calculation",
  [
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_heroes_end"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (ge, ":var1", 0),
      (call_script, "script_party_calculate_strength", ":var1", 0),
    (try_end),
    (call_script, "script_party_calculate_strength", "p_main_party", 0),
    (try_for_range, ":var2", "p_town_1", "p_village_1"),
      (call_script, "script_party_calculate_strength", ":var2", 0),
    (try_end),
    (try_for_range, ":var2", "p_town_1", "p_village_1"),
      (call_script, "script_party_calculate_and_set_nearby_friend_strength", ":var2"),
    (try_end),
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_heroes_end"),
      (troop_get_slot, ":var3", ":var0", 10),
      (gt, ":var3", 0),
      (call_script, "script_party_calculate_and_set_nearby_friend_strength", ":var3"),
    (try_end),
    (call_script, "script_party_calculate_and_set_nearby_friend_strength", "p_main_party"),
  ]),

  ("recalculate_ais",
  [
    (call_script, "script_init_ai_calculation"),
    (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (neg|faction_slot_eq, ":var0", 7, "trp_player"),
      (call_script, "script_decide_faction_ai", ":var0"),
    (try_end),
    (call_script, "script_decide_kingdom_party_ais"),
  ]),

  ("recalculate_ai_for_troop",
  [
    (store_script_param, ":var0", 1),
    (call_script, "script_init_ai_calculation"),
    (call_script, "script_calculate_troop_ai", ":var0"),
    (call_script, "script_calculate_troop_ai_under_command", ":var0"),
  ]),

  ("calculate_troop_ai",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (troop_slot_eq, ":var0", 2, 2),
      (neg|troop_slot_ge, ":var0", 8, 0),
      (troop_get_slot, ":var1", ":var0", 10),
      (gt, ":var1", 0),
      (party_slot_eq, ":var1", 31, 0),
      (store_faction_of_party, ":var2", ":var1"),
      (assign, ":var3", 1),
      (try_begin),
        (faction_slot_eq, ":var2", 7, ":var0"),
        (neg|faction_slot_eq, ":var2", 4, 0),
        (assign, ":var3", 0),
      (try_end),
      (eq, ":var3", 1),
      (call_script, "script_party_count_fit_for_battle", ":var1"),
      (assign, ":var4", reg0),
      (call_script, "script_party_get_ideal_size", ":var1"),
      (assign, ":var5", reg0),
      (store_mul, "$party_relative_strength", ":var4", 100),
      (val_div, "$party_relative_strength", ":var5"),
      (try_begin),
        (faction_slot_eq, ":var2", 82, 0),
        (faction_slot_eq, ":var2", 81, 0),
        (assign, "$ratio_of_prisoners", 0),
      (else_try),
        (party_get_num_prisoners, ":var6", ":var1"),
        (store_div, "$ratio_of_prisoners", ":var6", ":var4"),
      (try_end),
      (call_script, "script_kingdom_hero_decide_next_ai_state_follow_or_not", ":var0"),
      (party_slot_eq, ":var1", 30, -1),
      (call_script, "script_kingdom_hero_decide_next_ai_state", ":var0"),
    (try_end),
  ]),

  ("calculate_troop_ai_under_command",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (troop_slot_eq, ":var0", 2, 2),
      (neg|troop_slot_ge, ":var0", 8, 0),
      (troop_get_slot, ":var1", ":var0", 10),
      (gt, ":var1", 0),
      (party_slot_ge, ":var1", 30, 0),
      (party_set_ai_initiative, ":var1", 50),
      (call_script, "script_party_decide_next_ai_state_under_command", ":var1"),
    (try_end),
  ]),

  ("diplomacy_start_peace_between_kingdoms",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_relation, ":var3", ":var0", ":var1"),
    (val_max, ":var3", 0),
    (set_relation, ":var0", ":var1", ":var3"),
    (call_script, "script_exchange_prisoners_between_factions", ":var0", ":var1"),
    (try_begin),
      (eq, "$players_kingdom", ":var0"),
      (store_relation, ":var3", "fac_player_supporters_faction", ":var1"),
      (val_max, ":var3", 0),
      (call_script, "script_set_player_relation_with_faction", ":var1", ":var3"),
      (call_script, "script_event_kingdom_make_peace_with_kingdom", ":var1", "fac_player_supporters_faction"),
    (else_try),
      (eq, "$players_kingdom", ":var1"),
      (store_relation, ":var3", "fac_player_supporters_faction", ":var0"),
      (val_max, ":var3", 0),
      (call_script, "script_set_player_relation_with_faction", ":var0", ":var3"),
      (call_script, "script_event_kingdom_make_peace_with_kingdom", ":var0", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (eq, ":var2", 1),
      (str_store_faction_name_link, s1, ":var0"),
      (str_store_faction_name_link, s2, ":var1"),
      (display_log_message, "@{s1} and {s2} have made peace with each other."),
      (call_script, "script_update_faction_notes", ":var0"),
      (call_script, "script_update_faction_notes", ":var1"),
      (call_script, "script_add_notification_menu", "mnu_notification_peace_declared", ":var0", ":var1"),
      (call_script, "script_event_kingdom_make_peace_with_kingdom", ":var0", ":var1"),
      (call_script, "script_event_kingdom_make_peace_with_kingdom", ":var1", ":var0"),
      (assign, "$g_recalculate_ais", 1),
    (try_end),
  ]),

  ("event_kingdom_make_peace_with_kingdom",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (try_begin),
      (this_or_next|check_quest_active, "qst_capture_prisoners"),
      (check_quest_active, "qst_capture_enemy_hero"),
      (try_begin),
        (eq, "$players_kingdom", ":var0"),
        (try_begin),
          (quest_slot_eq, "qst_capture_prisoners", 3, ":var1"),
          (call_script, "script_cancel_quest", "qst_capture_prisoners"),
        (else_try),
          (quest_slot_eq, "qst_capture_enemy_hero", 3, ":var1"),
          (call_script, "script_cancel_quest", "qst_capture_enemy_hero"),
        (try_end),
      (else_try),
        (eq, "$players_kingdom", ":var1"),
        (try_begin),
          (quest_slot_eq, "qst_capture_prisoners", 3, ":var0"),
          (call_script, "script_cancel_quest", "qst_capture_prisoners"),
        (else_try),
          (quest_slot_eq, "qst_capture_enemy_hero", 3, ":var0"),
          (call_script, "script_cancel_quest", "qst_capture_enemy_hero"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("randomly_start_war_peace",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var3", 21, 0),
      (val_add, ":var2", 1),
      (faction_get_slot, ":var4", ":var3", 82),
      (store_mul, ":var5", ":var4", 2),
      (faction_get_slot, ":var6", ":var3", 81),
      (val_add, ":var5", ":var6"),
      (val_mul, ":var5", 10),
      (val_max, ":var5", 1),
      (val_mul, ":var5", 1000),
      (faction_get_slot, ":var7", ":var3", 80),
      (val_max, ":var7", 1),
      (val_div, ":var5", ":var7"),
      (val_add, ":var1", ":var5"),
    (try_end),
    (val_max, ":var2", 1),
    (store_div, ":var8", ":var1", ":var2"),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var3", 21, 0),
      (assign, ":var9", 0),
      (try_for_range, ":var10", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var10", 21, 0),
        (store_relation, ":var11", ":var3", ":var10"),
        (lt, ":var11", 0),
        (val_add, ":var9", 1),
      (try_end),
      (faction_get_slot, ":var4", ":var3", 82),
      (store_mul, ":var12", ":var4", 2),
      (faction_get_slot, ":var6", ":var3", 81),
      (val_add, ":var12", ":var6"),
      (val_mul, ":var12", 10),
      (val_max, ":var12", 1),
      (val_mul, ":var12", 1000),
      (faction_get_slot, ":var7", ":var3", 80),
      (val_max, ":var7", 1),
      (val_div, ":var12", ":var7"),
      (store_add, ":var13", ":var3", 1),
      (try_for_range, ":var14", ":var13", "fac_kingdoms_end"),
        (faction_slot_eq, ":var14", 21, 0),
        (faction_get_slot, ":var15", ":var14", 100),
        (val_add, ":var15", 101),
        (faction_slot_eq, ":var3", ":var15", 1),
        (assign, ":var16", 0),
        (try_for_range, ":var10", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (faction_slot_eq, ":var10", 21, 0),
          (store_relation, ":var11", ":var14", ":var10"),
          (lt, ":var11", 0),
          (val_add, ":var16", 1),
        (try_end),
        (store_add, ":var17", ":var9", ":var16"),
        (faction_get_slot, ":var4", ":var14", 82),
        (store_mul, ":var18", ":var4", 2),
        (faction_get_slot, ":var6", ":var14", 81),
        (val_add, ":var18", ":var6"),
        (val_mul, ":var18", 10),
        (val_max, ":var18", 1),
        (val_mul, ":var18", 1000),
        (faction_get_slot, ":var7", ":var14", 80),
        (val_max, ":var7", 1),
        (val_div, ":var18", ":var7"),
        (assign, ":var19", ":var12"),
        (val_max, ":var19", ":var18"),
        (val_mul, ":var19", 100),
        (val_div, ":var19", ":var8"),
        (assign, ":var20", -1),
        (try_begin),
          (eq, ":var3", "fac_player_supporters_faction"),
          (faction_get_slot, ":var20", ":var14", 10),
          (assign, ":var21", reg0),
          (store_sub, ":var22", 200, ":var21"),
          (val_mul, ":var12", ":var22"),
          (val_div, ":var12", 200),
        (else_try),
          (eq, ":var14", "fac_player_supporters_faction"),
          (faction_get_slot, ":var20", ":var3", 10),
        (try_end),
        (try_begin),
          (ge, ":var20", 0),
          (call_script, "script_troop_get_player_relation", ":var20"),
          (assign, ":var21", reg0),
          (store_sub, ":var22", 200, ":var21"),
          (val_mul, ":var19", ":var22"),
          (val_div, ":var19", 200),
        (try_end),
        (val_clamp, ":var19", 20, 500),
        (store_random_in_range, ":var23", 0, 10000),
        (store_relation, ":var21", ":var3", ":var14"),
        (try_begin),
          (lt, ":var21", 0),
          (store_mul, ":var24", ":var17", 50),
          (val_mul, ":var24", 100),
          (val_div, ":var24", ":var19"),
          (try_begin),
            (this_or_next|eq, ":var3", "fac_player_supporters_faction"),
            (eq, ":var14", "fac_player_supporters_faction"),
            (assign, ":var25", 0),
            (try_begin),
              (gt, "$supported_pretender", 0),
              (this_or_next|eq, ":var3", "$supported_pretender_old_faction"),
              (eq, ":var14", "$supported_pretender_old_faction"),
              (assign, ":var25", 1),
            (else_try),
              (is_between, "$players_oath_renounced_against_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
              (this_or_next|eq, ":var3", "$players_oath_renounced_against_kingdom"),
              (eq, ":var14", "$players_oath_renounced_against_kingdom"),
              (assign, ":var25", 1),
            (try_end),
            (eq, ":var25", 1),
            (assign, ":var24", 0),
          (try_end),
          (try_begin),
            (lt, ":var23", ":var24"),
            (assign, ":var25", 1),
            (try_begin),
              (check_quest_active, "qst_persuade_lords_to_make_peace"),
              (quest_get_slot, ":var26", "qst_persuade_lords_to_make_peace", 3),
              (quest_get_slot, ":var27", "qst_persuade_lords_to_make_peace", 15),
              (this_or_next|eq, ":var3", ":var26"),
              (eq, ":var3", ":var27"),
              (this_or_next|eq, ":var14", ":var26"),
              (eq, ":var14", ":var27"),
              (assign, ":var25", 0),
            (try_end),
            (eq, ":var25", 1),
            (try_begin),
              (eq, ":var3", "fac_player_supporters_faction"),
              (call_script, "script_add_notification_menu", "mnu_question_peace_offer", ":var14", 0),
            (else_try),
              (eq, ":var14", "fac_player_supporters_faction"),
              (call_script, "script_add_notification_menu", "mnu_question_peace_offer", ":var3", 0),
            (else_try),
              (call_script, "script_diplomacy_start_peace_between_kingdoms", ":var3", ":var14", ":var0"),
            (try_end),
          (try_end),
        (else_try),
          (assign, ":var28", 6),
          (val_sub, ":var28", ":var17"),
          (val_mul, ":var28", 50),
          (val_mul, ":var28", ":var19"),
          (val_div, ":var28", 100),
          (try_begin),
            (lt, ":var23", ":var28"),
            (assign, ":var25", 1),
            (try_begin),
              (check_quest_active, "qst_raid_caravan_to_start_war"),
              (quest_get_slot, ":var26", "qst_raid_caravan_to_start_war", 3),
              (quest_get_slot, ":var27", "qst_raid_caravan_to_start_war", 15),
              (this_or_next|eq, ":var3", ":var26"),
              (eq, ":var3", ":var27"),
              (this_or_next|eq, ":var14", ":var26"),
              (eq, ":var14", ":var27"),
              (assign, ":var25", 0),
            (try_end),
            (eq, ":var25", 1),
            (call_script, "script_diplomacy_start_war_between_kingdoms", ":var3", ":var14", ":var0"),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("exchange_prisoners_between_factions",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", -1),
    (assign, ":var3", -1),
    (try_begin),
      (this_or_next|eq, "$players_kingdom", ":var0"),
      (eq, "$players_kingdom", ":var1"),
      (assign, ":var2", "fac_player_faction"),
      (assign, ":var3", "fac_player_supporters_faction"),
    (try_end),
    (try_for_parties, ":var4"),
      (store_faction_of_party, ":var5", ":var4"),
      (this_or_next|eq, ":var5", ":var0"),
      (this_or_next|eq, ":var5", ":var1"),
      (this_or_next|eq, ":var5", ":var2"),
      (eq, ":var5", ":var3"),
      (party_get_num_prisoner_stacks, ":var6", ":var4"),
      (try_for_range_backwards, ":var7", 0, ":var6"),
        (party_prisoner_stack_get_troop_id, ":var8", ":var4", ":var7"),
        (store_troop_faction, ":var9", ":var8"),
        (this_or_next|eq, ":var9", ":var0"),
        (this_or_next|eq, ":var9", ":var1"),
        (this_or_next|eq, ":var9", ":var2"),
        (eq, ":var9", ":var3"),
        (try_begin),
          (troop_is_hero, ":var8"),
          (call_script, "script_remove_troop_from_prison", ":var8"),
        (try_end),
        (party_prisoner_stack_get_size, ":var10", ":var4", ":var7"),
        (party_remove_prisoners, ":var4", ":var8", ":var10"),
      (try_end),
    (try_end),
  ]),

  ("add_notification_menu",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (assign, ":var3", 1),
    (try_for_range, ":var4", 0, ":var3"),
      (try_begin),
        (troop_slot_ge, "trp_notification_menu_types", ":var4", 1),
        (val_add, ":var3", 1),
      (else_try),
        (troop_set_slot, "trp_notification_menu_types", ":var4", ":var0"),
        (troop_set_slot, "trp_notification_menu_var1", ":var4", ":var1"),
        (troop_set_slot, "trp_notification_menu_var2", ":var4", ":var2"),
      (try_end),
    (try_end),
  ]),

  ("finish_quest",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (quest_get_slot, ":var2", ":var0", 6),
    (quest_get_slot, ":var3", ":var0", 20),
    (quest_get_slot, ":var4", ":var0", 21),
    (quest_get_slot, ":var5", ":var0", 22),
    (try_begin),
      (lt, ":var1", 100),
      (val_mul, ":var4", ":var1"),
      (val_div, ":var4", 100),
      (val_mul, ":var5", ":var1"),
      (val_div, ":var5", 100),
      (assign, ":var6", ":var1"),
      (val_sub, ":var6", 75),
      (val_mul, ":var3", ":var6"),
      (val_div, ":var3", 100),
    (else_try),
      (val_div, ":var3", 4),
      (val_add, ":var3", 1),
      (call_script, "script_change_player_relation_with_troop", ":var2", ":var3"),
    (try_end),
    (add_xp_as_reward, ":var4"),
    (call_script, "script_troop_add_gold", "trp_player", ":var5"),
    (call_script, "script_end_quest", ":var0"),
  ]),

  ("get_information_about_troops_position",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, reg3),
    (troop_get_type, reg4, ":var0"),
    (call_script, "script_troop_get_gender_to_reg18", ":var0"),
    (str_store_troop_name, s2, ":var0"),
    (assign, ":var1", 0),
    (troop_get_slot, ":var2", ":var0", 12),
    (try_begin),
      (gt, ":var2", 0),
      (is_between, ":var2", "p_town_1", "p_salt_mine"),
      (str_store_party_name_link, s3, ":var2"),
      (str_store_string, s1, "@{s2} {reg3?was:is currently} at {s3}."),
      (assign, ":var1", 1),
    (else_try),
      (troop_get_slot, ":var3", ":var0", 10),
      (gt, ":var3", 0),
      (call_script, "script_get_troop_attached_party", ":var0"),
      (assign, ":var2", reg0),
      (try_begin),
        (is_between, ":var2", "p_town_1", "p_salt_mine"),
        (str_store_party_name_link, s3, ":var2"),
        (str_store_string, s1, "@{s2} {reg3?was:is currently} at {s3}."),
        (assign, ":var1", 1),
      (else_try),
        (get_party_ai_behavior, ":var4", ":var3"),
        (eq, ":var4", 1),
        (get_party_ai_object, ":var5", ":var3"),
        (is_between, ":var5", "p_town_1", "p_salt_mine"),
        (call_script, "script_get_closest_center", ":var3"),
        (str_store_party_name_link, s4, reg0),
        (str_store_party_name_link, s3, ":var5"),
        (str_store_string, s1, "@{s2} {reg3?was:is} travelling to {s3} and {reg18?she:he} {reg3?was:should be} close to {s4}{reg3?: at the moment}."),
        (assign, ":var1", 1),
      (else_try),
        (call_script, "script_get_closest_center", ":var3"),
        (str_store_party_name_link, s3, reg0),
        (str_store_string, s1, "@{s2} {reg3?was:is} in wilderness and {reg18?she:he} {reg3?was:should be} close to {s3}{reg3?: at the moment}."),
        (assign, ":var1", 1),
      (try_end),
    (else_try),
      (troop_slot_ge, ":var0", 8, 0),
      (try_for_range, ":var2", "p_town_1", "p_village_1"),
        (party_count_prisoners_of_type, ":var6", ":var2", ":var0"),
        (gt, ":var6", 0),
        (assign, ":var1", 1),
        (str_store_party_name_link, s3, ":var2"),
        (str_store_string, s1, "@{s2} {reg3?was:is} being held captive at {s3}."),
      (try_end),
      (try_begin),
        (eq, ":var1", 0),
        (str_store_string, s1, "@{s2} {reg3?was:has been} taken captive by {reg18?her:his} enemies."),
        (assign, ":var1", 1),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var1", 0),
      (str_store_string, s1, "@{reg3?{s2}'s location was unknown:I don't know where {s2} is}."),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("recruit_troop_as_companion",
  [
    (store_script_param_1, ":var0"),
    (troop_set_slot, ":var0", 2, 3),
    (troop_set_slot, ":var0", 12, -1),
    (troop_set_auto_equip, ":var0", 0),
    (party_add_members, "p_main_party", ":var0", 1),
    (str_store_troop_name, s6, ":var0"),
    (display_message, "@{s6} has joined your party"),
  ]),

  ("setup_random_scene",
  [
    (store_script_param_1, ":var0"),
    (party_get_current_terrain, ":var1", "p_main_party"),
    (assign, reg0, ":var1"),
    (str_store_string, s0, "@default"),
    (try_begin),
      (ge, ":var0", 1),
      (str_store_string, s1, "@small"),
      (try_begin),
        (eq, ":var1", 2),
        (assign, ":var2", "scn_random_scene_steppe_small"),
        (str_store_string, s0, "@steppe"),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", "scn_random_scene_plain_small"),
        (str_store_string, s0, "@plain"),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", "scn_random_scene_desert_small"),
        (str_store_string, s0, "@snow - using desert"),
      (else_try),
        (eq, ":var1", 5),
        (assign, ":var2", "scn_random_scene_desert_small"),
        (str_store_string, s0, "@desert"),
      (else_try),
        (eq, ":var1", 10),
        (assign, ":var2", "scn_random_scene_steppe_forest_small"),
        (str_store_string, s0, "@steppe forest"),
      (else_try),
        (eq, ":var1", 11),
        (assign, ":var2", "scn_random_scene_plain_forest_small"),
        (str_store_string, s0, "@plain forest (forest)"),
      (else_try),
        (eq, ":var1", 12),
        (assign, ":var2", "scn_random_scene_steppe_forest_small"),
        (str_store_string, s0, "@snow forest - using steppe forest"),
      (try_end),
    (else_try),
      (str_store_string, s1, "@regular"),
      (assign, ":var2", "scn_random_scene"),
      (try_begin),
        (eq, ":var1", 2),
        (assign, ":var2", "scn_random_scene_steppe"),
        (str_store_string, s0, "@steppe"),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", "scn_random_scene_plain"),
        (str_store_string, s0, "@plain"),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", "scn_random_scene_desert_forest"),
        (str_store_string, s0, "@snow - using desert forest"),
      (else_try),
        (eq, ":var1", 5),
        (assign, ":var2", "scn_random_scene_desert"),
        (str_store_string, s0, "@desert"),
      (else_try),
        (eq, ":var1", 10),
        (assign, ":var2", "scn_random_scene_steppe_forest"),
        (str_store_string, s0, "@steppe forest"),
      (else_try),
        (eq, ":var1", 11),
        (assign, ":var2", "scn_random_scene_plain_forest"),
        (str_store_string, s0, "@plain forest (forest)"),
      (else_try),
        (eq, ":var1", 12),
        (assign, ":var2", "scn_random_scene_desert_forest"),
        (str_store_string, s0, "@snow forest - using desert forest"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (display_message, "@DEBUG: Terrain Type: {reg0} - {s0} - {s1}"),
    (try_end),
    (jump_to_scene, ":var2"),
  ]),

  ("enter_dungeon",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (set_jump_mission, ":var1"),
    (party_get_slot, ":var2", ":var0", 12),
    (modify_visitors_at_site, ":var2"),
    (reset_visitors),
    (assign, ":var3", 16),
    (call_script, "script_get_heroes_attached_to_center_as_prisoner", ":var0", "p_temp_party"),
    (party_get_num_companion_stacks, ":var4", "p_temp_party"),
    (try_for_range, ":var5", 0, ":var4"),
      (party_stack_get_troop_id, ":var6", "p_temp_party", ":var5"),
      (lt, ":var3", 32),
      (set_visitor, ":var3", ":var6"),
      (val_add, ":var3", 1),
    (try_end),
    (set_jump_entry, 0),
    (jump_to_scene, ":var2"),
    (scene_set_slot, ":var2", 0, 1),
    (change_screen_mission),
  ]),

  ("enter_court",
  [
    (store_script_param_1, ":var0"),
    (assign, "$talk_context", 1),
    (set_jump_mission, "mt_visit_town_castle"),
    (party_get_slot, ":var1", ":var0", 11),
    (modify_visitors_at_site, ":var1"),
    (reset_visitors),
    (store_faction_of_party, ":var2", ":var0"),
    (faction_get_slot, ":var3", ":var2", 49),
    (try_begin),
      (le, ":var3", 0),
      (assign, ":var3", "trp_ranger"),
    (try_end),
    (set_visitor, 6, ":var3"),
    (set_visitor, 7, ":var3"),
    (assign, ":var4", 16),
    (call_script, "script_get_heroes_attached_to_center", ":var0", "p_temp_party"),
    (party_get_num_companion_stacks, ":var5", "p_temp_party"),
    (try_for_range, ":var6", 0, ":var5"),
      (party_stack_get_troop_id, ":var7", "p_temp_party", ":var6"),
      (lt, ":var4", 32),
      (set_visitor, ":var4", ":var7"),
      (val_add, ":var4", 1),
    (try_end),
    (try_for_range, ":var8", "trp_kingdom_1_lord", "trp_heroes_end"),
      (troop_slot_eq, ":var8", 2, 4),
      (troop_slot_eq, ":var8", 12, ":var0"),
      (lt, ":var4", 32),
      (set_visitor, ":var4", ":var8"),
      (val_add, ":var4", 1),
    (try_end),
    (jump_to_scene, ":var1"),
    (scene_set_slot, ":var1", 0, 1),
    (change_screen_mission),
  ]),

  ("find_high_ground_around_pos1",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (val_mul, ":var1", 100),
    (get_scene_boundaries, pos10, pos11),
    (team_get_leader, ":var2", ":var0"),
    (agent_get_position, pos1, ":var2"),
    (set_fixed_point_multiplier, 100),
    (position_get_x, ":var3", pos1),
    (position_get_y, ":var4", pos1),
    (store_sub, ":var5", ":var3", ":var1"),
    (store_sub, ":var6", ":var4", ":var1"),
    (store_add, ":var7", ":var3", ":var1"),
    (store_add, ":var8", ":var4", ":var1"),
    (position_get_x, ":var9", pos10),
    (position_get_x, ":var10", pos11),
    (position_get_y, ":var11", pos10),
    (position_get_y, ":var12", pos11),
    (val_max, ":var5", ":var9"),
    (val_max, ":var6", ":var11"),
    (val_min, ":var7", ":var10"),
    (val_min, ":var8", ":var12"),
    (store_div, ":var13", ":var5", 100),
    (store_div, ":var14", ":var6", 100),
    (store_div, ":var15", ":var7", 100),
    (store_div, ":var16", ":var8", 100),
    (assign, ":var17", -10000),
    (copy_position, pos52, pos1),
    (init_position, pos15),
    (try_for_range, ":var18", ":var13", ":var15"),
      (store_mul, ":var19", ":var18", 100),
      (try_for_range, ":var20", ":var14", ":var16"),
        (store_mul, ":var21", ":var20", 100),
        (position_set_x, pos15, ":var19"),
        (position_set_y, pos15, ":var21"),
        (position_set_z, pos15, 10000),
        (position_set_z_to_ground_level, pos15),
        (position_get_z, ":var22", pos15),
        (try_begin),
          (gt, ":var22", ":var17"),
          (copy_position, pos52, pos15),
          (assign, ":var17", ":var22"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("select_battle_tactic",
  [
    (assign, "$ai_team_1_battle_tactic", 0),
    (get_player_agent_no, ":var0"),
    (agent_get_team, ":var1", ":var0"),
    (try_begin),
      (num_active_teams_le, 2),
      (try_begin),
        (eq, ":var1", 0),
        (assign, "$ai_team_1", 1),
      (else_try),
        (assign, "$ai_team_1", 0),
      (try_end),
      (assign, "$ai_team_2", -1),
    (else_try),
      (try_begin),
        (eq, ":var1", 0),
        (assign, "$ai_team_1", 1),
      (else_try),
        (assign, "$ai_team_1", 0),
      (try_end),
      (store_add, "$ai_team_2", ":var1", 2),
    (try_end),
    (call_script, "script_select_battle_tactic_aux", "$ai_team_1"),
    (assign, "$ai_team_1_battle_tactic", reg0),
    (try_begin),
      (ge, "$ai_team_2", 0),
      (call_script, "script_select_battle_tactic_aux", "$ai_team_2"),
      (assign, "$ai_team_2_battle_tactic", reg0),
    (try_end),
  ]),

  ("select_battle_tactic_aux",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (get_player_agent_no, ":var3"),
    (agent_get_team, ":var4", ":var3"),
    (try_begin),
      (eq, "$cant_leave_encounter", 1),
      (teams_are_enemies, ":var0", ":var4"),
      (assign, ":var2", 1),
    (try_end),
    (call_script, "script_team_get_class_percentages", ":var0", 0),
    (assign, ":var5", reg1),
    (assign, ":var6", reg2),
    (call_script, "script_team_get_class_percentages", ":var0", 1),
    (store_random_in_range, ":var7", 0, 100),
    (try_begin),
      (this_or_next|lt, ":var7", 20),
      (assign, ":var8", 0),
      (try_begin),
        (teams_are_enemies, ":var0", ":var4"),
        (party_slot_eq, "$g_enemy_party", 0, 13),
        (assign, ":var8", 1),
      (else_try),
        (neg|teams_are_enemies, ":var0", ":var4"),
        (gt, "$g_ally_party", 0),
        (party_slot_eq, "$g_ally_party", 0, 13),
        (assign, ":var8", 1),
      (try_end),
      (eq, ":var8", 1),
      (try_begin),
        (eq, ":var2", 0),
        (gt, ":var5", 50),
        (lt, ":var6", 35),
        (assign, ":var1", 1),
      (else_try),
        (gt, ":var6", 50),
        (assign, ":var1", 3),
      (else_try),
        (lt, ":var7", 80),
        (assign, ":var1", 2),
      (try_end),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("battle_tactic_init",
  [
    (call_script, "script_battle_tactic_init_aux", "$ai_team_1", "$ai_team_1_battle_tactic"),
    (try_begin),
      (ge, "$ai_team_2", 0),
      (call_script, "script_battle_tactic_init_aux", "$ai_team_2", "$ai_team_2_battle_tactic"),
    (try_end),
  ]),

  ("battle_tactic_init_aux",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (team_get_leader, ":var2", ":var0"),
    (try_begin),
      (eq, ":var1", 1),
      (agent_get_position, pos1, ":var2"),
      (call_script, "script_find_high_ground_around_pos1", ":var0", 30),
      (copy_position, pos1, pos52),
      (call_script, "script_find_high_ground_around_pos1", ":var0", 30),
      (copy_position, pos1, pos52),
      (call_script, "script_find_high_ground_around_pos1", ":var0", 30),
      (team_give_order, ":var0", 10, 0),
      (team_set_order_position, ":var0", 10, pos52),
      (team_give_order, ":var0", 1, 5),
      (team_give_order, ":var0", 1, 5),
    (else_try),
      (eq, ":var1", 2),
      (team_get_leader, ":var2", ":var0"),
      (agent_set_speed_limit, ":var2", 8),
      (agent_get_position, pos60, ":var2"),
      (team_give_order, ":var0", 10, 0),
      (team_set_order_position, ":var0", 10, pos60),
    (else_try),
      (eq, ":var1", 3),
      (set_show_messages, 0),
      (team_give_order, "$attacker_team", 10, 2),
      (set_show_messages, 1),
    (try_end),
  ]),

  ("battle_tactic_apply",
  [
    (call_script, "script_battle_tactic_apply_aux", "$ai_team_1", "$ai_team_1_battle_tactic"),
    (assign, "$ai_team_1_battle_tactic", reg0),
    (try_begin),
      (ge, "$ai_team_2", 0),
      (call_script, "script_battle_tactic_apply_aux", "$ai_team_2", "$ai_team_2_battle_tactic"),
      (assign, "$ai_team_2_battle_tactic", reg0),
    (try_end),
  ]),

  ("battle_tactic_apply_aux",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_mission_timer_a, ":var2"),
    (try_begin),
      (eq, ":var1", 1),
      (copy_position, pos1, pos52),
      (call_script, "script_get_closest3_distance_of_enemies_at_pos1", ":var0", 1),
      (assign, ":var3", reg0),
      (assign, ":var4", reg1),
      (try_begin),
        (this_or_next|lt, ":var4", 1000),
        (lt, ":var3", 4000),
        (assign, ":var1", 0),
        (team_give_order, ":var0", 10, 2),
      (try_end),
    (else_try),
      (eq, ":var1", 2),
      (team_get_leader, ":var5", ":var0"),
      (agent_set_speed_limit, ":var5", 9),
      (call_script, "script_team_get_average_position_of_enemies", ":var0"),
      (copy_position, pos60, pos0),
      (agent_get_position, pos61, ":var5"),
      (position_transform_position_to_local, pos62, pos61, pos60),
      (position_normalize_origin, ":var6", pos62),
      (convert_from_fixed_point, ":var6"),
      (assign, reg17, ":var6"),
      (position_get_x, ":var7", pos62),
      (position_get_y, ":var8", pos62),
      (val_mul, ":var7", 23),
      (val_mul, ":var8", 23),
      (position_set_x, pos62, ":var7"),
      (position_set_y, pos62, ":var8"),
      (position_transform_position_to_parent, pos63, pos61, pos62),
      (position_set_z_to_ground_level, pos63),
      (team_give_order, ":var0", 10, 0),
      (team_set_order_position, ":var0", 10, pos63),
      (agent_get_position, pos1, ":var5"),
      (try_begin),
        (lt, ":var6", 50),
        (ge, ":var2", 30),
        (assign, ":var1", 0),
        (team_give_order, ":var0", 10, 2),
        (agent_set_speed_limit, ":var5", 60),
      (try_end),
    (try_end),
    (try_begin),
      (neq, ":var1", 0),
      (ge, ":var2", 300),
      (assign, ":var1", 0),
      (team_give_order, ":var0", 10, 2),
      (team_get_leader, ":var5", ":var0"),
      (agent_set_speed_limit, ":var5", 60),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("team_get_class_percentages",
  [
    (assign, ":var0", 0),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (store_script_param, ":var4", 1),
    (store_script_param, ":var5", 2),
    (try_for_agents, ":var6"),
      (agent_is_alive, ":var6"),
      (agent_is_human, ":var6"),
      (agent_get_team, ":var7", ":var6"),
      (assign, ":var8", 0),
      (try_begin),
        (eq, ":var5", 1),
        (teams_are_enemies, ":var7", ":var4"),
        (assign, ":var8", 1),
      (else_try),
        (eq, ":var7", ":var4"),
        (assign, ":var8", 1),
      (try_end),
      (eq, ":var8", 1),
      (val_add, ":var3", 1),
      (agent_get_class, ":var9", ":var6"),
      (try_begin),
        (eq, ":var9", 0),
        (val_add, ":var0", 1),
      (else_try),
        (eq, ":var9", 1),
        (val_add, ":var1", 1),
      (else_try),
        (eq, ":var9", 2),
        (val_add, ":var2", 1),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var3", 0),
      (assign, ":var3", 1),
    (try_end),
    (store_mul, ":var10", ":var0", 100),
    (val_div, ":var10", ":var3"),
    (store_mul, ":var11", ":var1", 100),
    (val_div, ":var11", ":var3"),
    (store_mul, ":var12", ":var2", 100),
    (val_div, ":var12", ":var3"),
    (assign, reg0, ":var10"),
    (assign, reg1, ":var11"),
    (assign, reg2, ":var12"),
  ]),

  ("get_closest3_distance_of_enemies_at_pos1",
  [
    (assign, ":var0", 100000),
    (assign, ":var1", 100000),
    (assign, ":var2", 100000),
    (store_script_param, ":var3", 1),
    (try_for_agents, ":var4"),
      (agent_is_alive, ":var4"),
      (agent_is_human, ":var4"),
      (agent_get_team, ":var5", ":var4"),
      (teams_are_enemies, ":var5", ":var3"),
      (agent_get_position, pos2, ":var4"),
      (get_distance_between_positions, ":var6", pos2, pos1),
      (try_begin),
        (lt, ":var6", ":var0"),
        (assign, ":var2", ":var1"),
        (assign, ":var1", ":var0"),
        (assign, ":var0", ":var6"),
      (else_try),
        (lt, ":var6", ":var1"),
        (assign, ":var2", ":var1"),
        (assign, ":var1", ":var6"),
      (else_try),
        (lt, ":var6", ":var2"),
        (assign, ":var2", ":var6"),
      (try_end),
    (try_end),
    (assign, ":var7", 0),
    (assign, ":var8", 0),
    (try_begin),
      (lt, ":var0", 100000),
      (val_add, ":var7", ":var0"),
      (val_add, ":var8", 1),
    (try_end),
    (try_begin),
      (lt, ":var1", 100000),
      (val_add, ":var7", ":var1"),
      (val_add, ":var8", 1),
    (try_end),
    (try_begin),
      (lt, ":var2", 100000),
      (val_add, ":var7", ":var2"),
      (val_add, ":var8", 1),
    (try_end),
    (assign, ":var9", 100000),
    (try_begin),
      (gt, ":var8", 0),
      (store_div, ":var9", ":var7", ":var8"),
    (try_end),
    (assign, reg0, ":var9"),
    (assign, reg1, ":var0"),
    (assign, reg2, ":var1"),
    (assign, reg3, ":var2"),
  ]),

  ("team_get_average_position_of_enemies",
  [
    (store_script_param_1, ":var0"),
    (init_position, pos0),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 0),
    (try_for_agents, ":var5"),
      (agent_is_alive, ":var5"),
      (agent_is_human, ":var5"),
      (agent_get_team, ":var6", ":var5"),
      (teams_are_enemies, ":var0", ":var6"),
      (agent_get_position, pos62, ":var5"),
      (position_get_x, ":var7", pos62),
      (position_get_y, ":var8", pos62),
      (position_get_z, ":var9", pos62),
      (val_add, ":var2", ":var7"),
      (val_add, ":var3", ":var8"),
      (val_add, ":var4", ":var9"),
      (val_add, ":var1", 1),
    (try_end),
    (store_div, ":var10", ":var2", ":var1"),
    (store_div, ":var11", ":var3", ":var1"),
    (store_div, ":var12", ":var4", ":var1"),
    (position_set_x, pos0, ":var10"),
    (position_set_y, pos0, ":var11"),
    (position_set_z, pos0, ":var12"),
    (assign, reg0, ":var1"),
  ]),

  ("search_troop_prisoner_of_party",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (try_for_parties, ":var2"),
      (eq, ":var1", -1),
      (this_or_next|eq, ":var2", "p_main_party"),
      (ge, ":var2", "p_town_1"),
      (party_count_prisoners_of_type, ":var3", ":var2", ":var0"),
      (gt, ":var3", 0),
      (assign, ":var1", ":var2"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("change_debt_to_troop",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (troop_get_slot, ":var2", ":var0", 21),
    (assign, reg1, ":var2"),
    (val_add, ":var2", ":var1"),
    (assign, reg2, ":var2"),
    (troop_set_slot, ":var0", 21, ":var2"),
    (str_store_troop_name_link, s1, ":var0"),
    (display_message, "@You now owe {reg2} cents to {s1}."),
  ]),

  ("abort_quest",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", -1),
    (assign, ":var3", -2),
    (try_begin),
      (this_or_next|eq, ":var0", "qst_deliver_message"),
      (eq, ":var0", "qst_deliver_message_to_enemy_lord"),
      (assign, ":var2", -2),
      (assign, ":var3", -3),
    (else_try),
      (eq, ":var0", "qst_escort_lady"),
      (quest_get_slot, ":var4", "qst_escort_lady", 4),
      (party_remove_members, "p_main_party", ":var4", 1),
      (assign, ":var2", -2),
      (assign, ":var3", -3),
    (else_try),
      (eq, ":var0", "qst_raise_troops"),
      (quest_get_slot, ":var5", ":var0", 6),
      (call_script, "script_change_debt_to_troop", ":var5", 100),
      (assign, ":var2", -4),
      (assign, ":var3", -5),
    (else_try),
      (eq, ":var0", "qst_deal_with_looters"),
      (try_for_parties, ":var6"),
        (party_get_template_id, ":var7", ":var6"),
        (eq, ":var7", "pt_looters"),
        (party_set_flags, ":var6", 262144, 0),
      (try_end),
      (assign, ":var2", -4),
      (assign, ":var3", -5),
    (else_try),
      (eq, ":var0", "qst_hideout"),
      (assign, ":var2", -1),
      (assign, ":var3", -3),
      (party_set_flags, "p_target", 256, 1),
    (else_try),
      (eq, ":var0", "qst_deal_with_bandits_at_lords_village"),
      (quest_get_slot, ":var5", ":var0", 6),
      (call_script, "script_change_debt_to_troop", ":var5", 200),
      (assign, ":var2", -5),
      (assign, ":var3", -6),
    (else_try),
      (eq, ":var0", "qst_collect_taxes"),
      (quest_get_slot, ":var8", ":var0", 22),
      (quest_set_slot, ":var0", 22, 0),
      (quest_get_slot, ":var5", ":var0", 6),
      (call_script, "script_change_debt_to_troop", ":var5", ":var8"),
      (assign, ":var2", -4),
      (assign, ":var3", -6),
    (else_try),
      (eq, ":var0", "qst_bring_back_deserters"),
      (assign, ":var2", -1),
      (assign, ":var3", -2),
    (else_try),
      (eq, ":var0", "qst_hideout2"),
      (assign, ":var2", -1),
      (assign, ":var3", -3),
      (party_set_flags, "p_target", 256, 1),
    (else_try),
      (eq, ":var0", "qst_hunt_down_fugitive"),
      (assign, ":var2", -3),
      (assign, ":var3", -4),
    (else_try),
      (eq, ":var0", "qst_kill_local_merchant"),
    (else_try),
      (eq, ":var0", "qst_bring_back_runaway_serfs"),
      (assign, ":var2", -1),
      (assign, ":var3", -1),
    (else_try),
      (eq, ":var0", "qst_lend_companion"),
    (else_try),
      (eq, ":var0", "qst_collect_debt"),
      (try_begin),
        (quest_slot_eq, "qst_collect_debt", 11, 1),
        (quest_get_slot, ":var9", "qst_collect_debt", 10),
        (quest_get_slot, ":var10", "qst_collect_debt", 6),
        (call_script, "script_change_debt_to_troop", ":var10", ":var9"),
        (assign, ":var2", -3),
        (assign, ":var3", -6),
      (else_try),
        (assign, ":var2", -3),
        (assign, ":var3", -4),
      (try_end),
    (else_try),
      (eq, ":var0", "qst_deal_with_bandits_at_lords_village"),
      (assign, ":var2", -6),
      (assign, ":var3", -6),
    (else_try),
      (eq, ":var0", "qst_raid_caravan_to_start_war"),
      (assign, ":var2", -10),
      (assign, ":var3", -13),
    (else_try),
      (eq, ":var0", "qst_persuade_lords_to_make_peace"),
      (assign, ":var2", -10),
      (assign, ":var3", -13),
    (else_try),
      (eq, ":var0", "qst_deal_with_night_bandits"),
      (assign, ":var2", -1),
      (assign, ":var3", -1),
    (else_try),
      (eq, ":var0", "qst_follow_spy"),
      (assign, ":var2", -2),
      (assign, ":var3", -3),
      (try_begin),
        (party_is_active, "$qst_follow_spy_spy_party"),
        (remove_party, "$qst_follow_spy_spy_party"),
      (try_end),
      (try_begin),
        (party_is_active, "$qst_follow_spy_spy_partners_party"),
        (remove_party, "$qst_follow_spy_spy_partners_party"),
      (try_end),
    (else_try),
      (eq, ":var0", "qst_capture_enemy_hero"),
      (assign, ":var2", -3),
      (assign, ":var3", -4),
    (else_try),
      (eq, ":var0", "qst_incriminate_loyal_commander"),
      (assign, ":var2", -5),
      (assign, ":var3", -6),
    (else_try),
      (eq, ":var0", "qst_lend_surgeon"),
    (else_try),
      (eq, ":var0", "qst_rescue_lord_by_replace"),
      (assign, ":var2", -1),
      (assign, ":var3", -1),
    (else_try),
      (eq, ":var0", "qst_deliver_message_to_prisoner_lord"),
      (assign, ":var2", 0),
      (assign, ":var3", -1),
    (else_try),
      (eq, ":var0", "qst_duel_for_lady"),
      (assign, ":var2", -1),
      (assign, ":var3", -1),
    (else_try),
      (eq, ":var0", "qst_follow_army"),
      (assign, ":var2", -4),
      (assign, ":var3", -5),
    (else_try),
      (eq, ":var0", "qst_deliver_cattle_to_army"),
      (assign, ":var2", -1),
      (assign, ":var3", -2),
    (else_try),
      (eq, ":var0", "qst_join_siege_with_army"),
      (assign, ":var2", -1),
      (assign, ":var3", -2),
    (else_try),
      (eq, ":var0", "qst_scout_waypoints"),
      (assign, ":var2", -1),
      (assign, ":var3", -2),
    (else_try),
      (eq, ":var0", "qst_deliver_grain"),
      (assign, ":var2", -6),
      (assign, ":var3", -7),
    (else_try),
      (eq, ":var0", "qst_escort_villagers"),
      (assign, ":var2", -5),
      (assign, ":var3", -5),
    (else_try),
      (eq, ":var0", "qst_deliver_cattle"),
      (assign, ":var2", -3),
      (assign, ":var3", -4),
    (else_try),
      (eq, ":var0", "qst_train_peasants_against_bandits"),
      (assign, ":var2", -4),
      (assign, ":var3", -5),
    (else_try),
      (eq, ":var0", "qst_deliver_wine"),
      (assign, ":var2", -1),
      (assign, ":var3", -3),
      (val_add, "$debt_to_merchants_guild", "$qst_deliver_wine_debt"),
    (else_try),
      (eq, ":var0", "qst_move_cattle_herd"),
      (assign, ":var2", -1),
      (assign, ":var3", -3),
    (else_try),
      (eq, ":var0", "qst_move_horses_herd"),
      (assign, ":var2", -2),
      (assign, ":var3", -3),
    (else_try),
      (eq, ":var0", "qst_escort_merchant_caravan"),
      (assign, ":var2", -1),
      (assign, ":var3", -3),
    (else_try),
      (eq, ":var0", "qst_troublesome_bandits"),
      (assign, ":var2", -1),
      (assign, ":var3", -2),
    (else_try),
      (eq, ":var0", "qst_join_faction"),
      (assign, ":var2", -3),
      (assign, ":var3", -3),
      (try_begin),
        (call_script, "script_get_number_of_hero_centers", "trp_player"),
        (gt, reg0, 0),
        (call_script, "script_change_player_relation_with_faction", "$g_invite_faction", -10),
      (try_end),
      (assign, "$g_invite_faction", 0),
      (assign, "$g_invite_faction_lord", 0),
      (assign, "$g_invite_offered_center", 0),
    (else_try),
      (eq, ":var0", "qst_eliminate_bandits_infesting_village"),
      (assign, ":var2", -3),
      (assign, ":var3", -3),
    (try_end),
    (try_begin),
      (gt, ":var1", 0),
      (quest_get_slot, ":var10", ":var0", 6),
      (assign, ":var11", ":var2"),
      (try_begin),
        (eq, ":var1", 2),
        (assign, ":var11", ":var3"),
      (try_end),
      (try_begin),
        (this_or_next|is_between, ":var10", "trp_village_1_elder", "trp_merchants_end"),
        (is_between, ":var10", "trp_town_1_mayor", "trp_village_1_elder"),
        (quest_get_slot, ":var12", ":var0", 12),
        (call_script, "script_change_player_relation_with_center", ":var12", ":var11"),
      (else_try),
        (call_script, "script_change_player_relation_with_troop", ":var10", ":var11"),
      (try_end),
    (try_end),
    (fail_quest, ":var0"),
    (try_begin),
      (gt, ":var1", 0),
      (call_script, "script_objectionable_action", 4, "str_fail_quest"),
    (try_end),
    (call_script, "script_end_quest", ":var0"),
  ]),

  ("cf_is_quest_troop",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 0, "qst_quests_end"),
      (check_quest_active, ":var2"),
      (quest_get_slot, ":var3", ":var2", 2),
      (quest_get_slot, ":var4", ":var2", 4),
      (quest_get_slot, ":var5", ":var2", 6),
      (this_or_next|eq, ":var3", ":var0"),
      (this_or_next|eq, ":var4", ":var0"),
      (eq, ":var5", ":var0"),
      (assign, ":var1", 1),
    (try_end),
    (eq, ":var1", 1),
  ]),

  ("check_friendly_kills",
  [
    (get_player_agent_own_troop_kill_count, ":var0"),
    (try_begin),
      (neq, "$g_player_current_own_troop_kills", ":var0"),
      (val_sub, ":var0", "$g_player_current_own_troop_kills"),
      (val_add, "$g_player_current_own_troop_kills", ":var0"),
      (val_mul, ":var0", -1),
      (call_script, "script_change_player_party_morale", ":var0"),
    (try_end),
  ]),

  ("simulate_retreat",
  [
    (call_script, "script_music_set_situation_with_culture", 32768),
    (set_show_messages, 0),
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 1),
    (try_begin),
      (try_for_agents, ":var5"),
        (agent_is_human, ":var5"),
        (agent_is_alive, ":var5"),
        (agent_set_slot, ":var5", 3, 1),
        (agent_get_troop_id, ":var6", ":var5"),
        (store_character_level, ":var7", ":var6"),
        (val_add, ":var7", 5),
        (try_begin),
          (troop_is_hero, ":var6"),
          (val_add, ":var7", 5),
        (try_end),
        (try_begin),
          (agent_is_ally, ":var5"),
          (val_add, ":var2", ":var7"),
        (else_try),
          (val_add, ":var3", ":var7"),
        (try_end),
      (try_end),
      (eq, "$pin_player_fallen", 0),
      (lt, ":var3", ":var2"),
      (assign, ":var4", 0),
    (try_end),
    (try_begin),
      (eq, ":var4", 1),
      (assign, "$g_last_mission_player_damage", 0),
      (party_clear, "p_temp_party"),
      (party_clear, "p_temp_party_2"),
      (call_script, "script_simulate_battle_with_agents_aux", 0, ":var0"),
      (call_script, "script_simulate_battle_with_agents_aux", 1, ":var1"),
      (assign, ":var8", 0),
      (try_begin),
        (gt, "$g_last_mission_player_damage", 0),
        (assign, ":var8", 1),
        (assign, reg1, "$g_last_mission_player_damage"),
        (str_store_string, s12, "str_casualty_display_hp"),
      (else_try),
        (str_clear, s12),
      (try_end),
      (call_script, "script_print_casualties_to_s0", "p_temp_party", 1),
      (try_begin),
        (party_get_num_companion_stacks, ":var9", "p_temp_party"),
        (gt, ":var9", 0),
        (assign, ":var8", 1),
      (try_end),
      (str_store_string_reg, s10, s0),
      (call_script, "script_print_casualties_to_s0", "p_temp_party_2", 1),
      (try_begin),
        (party_get_num_companion_stacks, ":var9", "p_temp_party_2"),
        (gt, ":var9", 0),
        (assign, ":var8", 1),
      (try_end),
      (str_store_string_reg, s11, s0),
      (try_begin),
        (eq, ":var8", 1),
        (dialog_box, "str_casualty_display", s5),
      (try_end),
    (try_end),
    (set_show_messages, 1),
    (assign, ":var10", 0),
    (assign, ":var11", 0),
    (assign, ":var12", 0),
    (try_for_agents, ":var5"),
      (agent_is_human, ":var5"),
      (try_begin),
        (agent_is_ally, ":var5"),
        (val_add, ":var12", 1),
        (try_begin),
          (neg|agent_is_alive, ":var5"),
          (val_add, ":var10", 1),
        (try_end),
      (else_try),
        (neg|agent_is_alive, ":var5"),
        (val_add, ":var11", 1),
      (try_end),
    (try_end),
    (store_add, ":var13", ":var10", ":var11"),
    (try_begin),
      (gt, ":var13", 0),
      (store_mul, ":var14", ":var10", 100),
      (val_div, ":var14", ":var13"),
      (val_mul, ":var14", ":var10"),
      (val_div, ":var14", ":var12"),
      (val_mul, ":var14", -30),
      (val_div, ":var14", 100),
      (call_script, "script_change_player_party_morale", ":var14"),
    (try_end),
  ]),

  ("simulate_battle_with_agents_aux",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (get_player_agent_no, ":var2"),
    (try_for_agents, ":var3"),
      (neq, ":var2", ":var3"),
      (agent_is_human, ":var3"),
      (agent_slot_eq, ":var3", 3, 1),
      (try_begin),
        (agent_is_ally, ":var3"),
        (assign, ":var4", 0),
      (else_try),
        (assign, ":var4", 1),
      (try_end),
      (eq, ":var4", ":var0"),
      (agent_get_position, pos2, ":var3"),
      (assign, ":var5", -1),
      (assign, ":var6", 100000),
      (try_for_agents, ":var7"),
        (agent_is_human, ":var7"),
        (agent_is_alive, ":var7"),
        (try_begin),
          (agent_is_ally, ":var7"),
          (assign, ":var8", 0),
        (else_try),
          (assign, ":var8", 1),
        (try_end),
        (this_or_next|neq, ":var7", ":var2"),
        (eq, "$pin_player_fallen", 0),
        (neq, ":var0", ":var8"),
        (agent_get_position, pos3, ":var7"),
        (get_distance_between_positions, ":var9", pos2, pos3),
        (lt, ":var9", ":var6"),
        (assign, ":var6", ":var9"),
        (assign, ":var5", ":var7"),
      (try_end),
      (ge, ":var5", 0),
      (agent_get_class, ":var10", ":var3"),
      (assign, ":var11", 1),
      (assign, ":var12", 0),
      (try_begin),
        (eq, ":var10", 1),
        (assign, ":var12", 2),
      (else_try),
        (eq, ":var10", 2),
        (assign, ":var11", 2),
      (try_end),
      (agent_get_class, ":var10", ":var5"),
      (assign, ":var13", 1),
      (try_begin),
        (eq, ":var10", 2),
        (assign, ":var13", 2),
      (try_end),
      (assign, ":var14", 18000),
      (val_add, ":var6", 3000),
      (val_div, ":var14", ":var6"),
      (val_mul, ":var14", 2),
      (val_mul, ":var14", ":var11"),
      (val_div, ":var14", ":var13"),
      (val_add, ":var14", ":var12"),
      (assign, ":var15", ":var1"),
      (agent_get_troop_id, ":var16", ":var5"),
      (agent_get_troop_id, ":var17", ":var3"),
      (store_character_level, ":var18", ":var16"),
      (store_character_level, ":var19", ":var17"),
      (store_sub, ":var20", ":var19", ":var18"),
      (val_div, ":var20", 5),
      (val_add, ":var15", ":var20"),
      (try_begin),
        (eq, ":var5", ":var2"),
        (val_div, ":var15", 2),
        (store_agent_hit_points, ":var21", ":var2", 1),
      (try_end),
      (try_for_range, ":var22", 0, ":var14"),
        (store_random_in_range, ":var23", 0, 100),
        (lt, ":var23", ":var15"),
        (agent_deliver_damage_to_agent, ":var3", ":var5"),
      (try_end),
      (try_begin),
        (eq, ":var5", ":var2"),
        (store_agent_hit_points, ":var24", ":var2", 1),
        (store_sub, ":var25", ":var21", ":var24"),
        (val_add, "$g_last_mission_player_damage", ":var25"),
      (try_end),
      (neg|agent_is_alive, ":var5"),
      (try_begin),
        (eq, ":var0", 1),
        (party_add_members, "p_temp_party", ":var16", 1),
        (try_begin),
          (agent_is_wounded, ":var5"),
          (party_wound_members, "p_temp_party", ":var16", 1),
        (try_end),
      (else_try),
        (party_add_members, "p_temp_party_2", ":var16", 1),
        (try_begin),
          (agent_is_wounded, ":var5"),
          (party_wound_members, "p_temp_party_2", ":var16", 1),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("map_get_random_position_around_position_within_range",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (val_mul, ":var0", 100),
    (assign, ":var2", 1),
    (try_for_range, ":var3", 0, 20),
      (eq, ":var2", 1),
      (map_get_random_position_around_position, pos2, pos1, ":var1"),
      (get_distance_between_positions, ":var4", pos2, pos1),
      (ge, ":var4", ":var0"),
      (assign, ":var2", 0),
    (try_end),
  ]),

  ("get_number_of_unclaimed_centers_by_player",
  [
    (assign, ":var0", 0),
    (assign, reg1, -1),
    (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var2", ":var1"),
      (eq, ":var2", "fac_player_supporters_faction"),
      (party_slot_eq, ":var1", 9, 0),
      (party_get_num_companion_stacks, ":var3", ":var1"),
      (ge, ":var3", 1),
      (assign, reg1, ":var1"),
      (val_add, ":var0", 1),
    (try_end),
    (assign, reg0, ":var0"),
  ]),

  ("troop_count_number_of_enemy_troops",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 40, 45),
      (troop_slot_ge, ":var0", ":var2", 1),
      (val_add, ":var1", 1),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("cf_troop_check_troop_is_enemy",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", 40, 45),
      (troop_slot_eq, ":var0", ":var3", ":var1"),
      (assign, ":var2", 1),
    (try_end),
    (eq, ":var2", 1),
  ]),

  ("troop_get_leaded_center_with_index",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", -1),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "p_town_1", "p_salt_mine"),
      (eq, ":var2", -1),
      (party_slot_eq, ":var4", 7, ":var0"),
      (val_add, ":var3", 1),
      (gt, ":var3", ":var1"),
      (assign, ":var2", ":var4"),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("cf_troop_get_random_leaded_walled_center_with_less_strength_priority",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_town_1", "p_village_1"),
      (party_slot_eq, ":var3", 7, ":var0"),
      (party_slot_eq, ":var3", 54, -1),
      (val_add, ":var2", 1),
      (try_begin),
        (eq, ":var3", ":var1"),
        (val_add, ":var2", 99),
      (try_end),
    (try_end),
    (gt, ":var2", 0),
    (store_random_in_range, ":var4", 0, ":var2"),
    (assign, ":var5", -1),
    (try_for_range, ":var3", "p_town_1", "p_village_1"),
      (eq, ":var5", -1),
      (party_slot_eq, ":var3", 7, ":var0"),
      (party_slot_eq, ":var3", 54, -1),
      (val_sub, ":var4", 1),
      (try_begin),
        (eq, ":var3", ":var1"),
        (val_sub, ":var4", 99),
      (try_end),
      (lt, ":var4", 0),
      (assign, ":var5", ":var3"),
    (try_end),
    (assign, reg0, ":var5"),
  ]),

  ("cf_troop_get_random_leaded_town_or_village_except_center",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "p_town_1", "p_salt_mine"),
      (neg|party_slot_eq, ":var3", 0, 2),
      (party_slot_eq, ":var3", 7, ":var0"),
      (neq, ":var3", ":var1"),
      (val_add, ":var2", 1),
    (try_end),
    (gt, ":var2", 0),
    (store_random_in_range, ":var4", 0, ":var2"),
    (assign, ":var5", "p_salt_mine"),
    (try_for_range, ":var3", "p_town_1", ":var5"),
      (neg|party_slot_eq, ":var3", 0, 2),
      (party_slot_eq, ":var3", 7, ":var0"),
      (neq, ":var3", ":var1"),
      (val_sub, ":var4", 1),
      (lt, ":var4", 0),
      (assign, ":var6", ":var3"),
      (assign, ":var5", 0),
    (try_end),
    (assign, reg0, ":var6"),
  ]),

  ("troop_write_owned_centers_to_s2",
  [
    (store_script_param_1, ":var0"),
    (call_script, "script_get_number_of_hero_centers", ":var0"),
    (assign, ":var1", reg0),
    (str_store_troop_name, s5, ":var0"),
    (try_begin),
      (gt, ":var1", 1),
      (try_for_range, ":var2", 1, ":var1"),
        (call_script, "script_troop_get_leaded_center_with_index", ":var0", ":var2"),
        (str_store_party_name_link, s50, reg0),
        (try_begin),
          (eq, ":var2", 1),
          (call_script, "script_troop_get_leaded_center_with_index", ":var0", 0),
          (str_store_party_name_link, s51, reg0),
          (str_store_string, s51, "str_s50_and_s51"),
        (else_try),
          (str_store_string, s51, "str_s50_comma_s51"),
        (try_end),
      (try_end),
      (str_store_string, s2, "str_s5_is_the_ruler_of_s51"),
    (else_try),
      (eq, ":var1", 1),
      (call_script, "script_troop_get_leaded_center_with_index", ":var0", 0),
      (str_store_party_name_link, s51, reg0),
      (str_store_string, s2, "str_s5_is_the_ruler_of_s51"),
    (else_try),
      (store_troop_faction, ":var3", ":var0"),
      (str_store_faction_name_link, s6, ":var3"),
      (str_store_string, s2, "str_s5_is_a_nobleman_of_s6"),
    (try_end),
  ]),

  ("troop_write_family_relations_to_s1",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 30, 36),
      (troop_slot_ge, ":var0", ":var2", 1),
      (val_add, ":var1", 1),
    (try_end),
    (call_script, "script_troop_get_gender_to_reg18", ":var0"),
    (assign, ":var3", reg18),
    (try_begin),
      (eq, ":var3", 0),
      (str_store_string, s5, "str_he"),
    (else_try),
      (str_store_string, s5, "str_she"),
    (try_end),
    (try_begin),
      (gt, ":var1", 1),
      (try_for_range, ":var4", 1, ":var1"),
        (call_script, "script_write_family_relation_as_s3s_s2_to_s4", ":var0", ":var4"),
        (str_store_string_reg, s50, s4),
        (try_begin),
          (eq, ":var4", 1),
          (call_script, "script_write_family_relation_as_s3s_s2_to_s4", ":var0", 0),
          (str_store_string_reg, s51, s4),
          (str_store_string, s51, "str_s50_and_s51"),
        (else_try),
          (str_store_string, s51, "str_s50_comma_s51"),
        (try_end),
      (try_end),
      (str_store_string, s1, "str_s5_is_s51"),
    (else_try),
      (eq, ":var1", 1),
      (call_script, "script_write_family_relation_as_s3s_s2_to_s4", ":var0", 0),
      (str_store_string_reg, s51, s4),
      (str_store_string, s1, "str_s5_is_s51"),
    (else_try),
      (str_store_string, s1, "str_blank_string"),
    (try_end),
  ]),

  ("write_family_relation_as_s3s_s2_to_s4",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (call_script, "script_troop_get_gender_to_reg18", ":var0"),
    (assign, ":var2", reg18),
    (assign, ":var3", 30),
    (try_for_range, ":var4", 30, 36),
      (this_or_next|gt, ":var1", 0),
      (troop_slot_eq, ":var0", ":var3", 0),
      (try_begin),
        (troop_slot_ge, ":var0", ":var3", 1),
        (val_sub, ":var1", 1),
      (try_end),
      (val_add, ":var3", 1),
    (try_end),
    (try_begin),
      (eq, ":var3", 30),
      (try_begin),
        (eq, ":var2", 0),
        (str_store_string, s2, "str_husband"),
      (else_try),
        (str_store_string, s2, "str_wife"),
      (try_end),
    (else_try),
      (this_or_next|eq, ":var3", 34),
      (eq, ":var3", 33),
      (try_begin),
        (eq, ":var2", 0),
        (str_store_string, s2, "str_father"),
      (else_try),
        (str_store_string, s2, "str_mother"),
      (try_end),
    (else_try),
      (this_or_next|eq, ":var3", 31),
      (eq, ":var3", 32),
      (try_begin),
        (eq, ":var2", 0),
        (str_store_string, s2, "str_son"),
      (else_try),
        (str_store_string, s2, "str_daughter"),
      (try_end),
    (else_try),
      (eq, ":var3", 35),
      (try_begin),
        (eq, ":var2", 0),
        (str_store_string, s2, "str_brother"),
      (else_try),
        (str_store_string, s2, "str_sister"),
      (try_end),
    (try_end),
    (troop_get_slot, ":var5", ":var0", ":var3"),
    (str_store_troop_name_link, s3, ":var5"),
    (str_store_string, s4, "str_s3s_s2"),
  ]),

  ("complete_family_relations",
  [
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_heroes_end"),
      (call_script, "script_troop_get_gender_to_reg18", ":var0"),
      (assign, ":var1", reg18),
      (try_begin),
        (troop_get_slot, ":var2", ":var0", 30),
        (gt, ":var2", 0),
        (troop_set_slot, ":var2", 30, ":var0"),
        (troop_get_slot, ":var3", ":var0", 33),
        (troop_get_slot, ":var4", ":var0", 34),
        (try_begin),
          (gt, ":var3", 0),
          (troop_set_slot, ":var2", 33, ":var3"),
        (try_end),
        (try_begin),
          (gt, ":var4", 0),
          (troop_set_slot, ":var2", 34, ":var4"),
        (try_end),
        (troop_get_slot, ":var3", ":var2", 33),
        (troop_get_slot, ":var4", ":var2", 34),
        (try_begin),
          (gt, ":var3", 0),
          (troop_set_slot, ":var0", 33, ":var3"),
        (try_end),
        (try_begin),
          (gt, ":var4", 0),
          (troop_set_slot, ":var0", 34, ":var4"),
        (try_end),
      (try_end),
      (try_begin),
        (troop_get_slot, ":var5", ":var0", 35),
        (gt, ":var5", 0),
        (troop_set_slot, ":var5", 35, ":var0"),
        (troop_get_slot, ":var6", ":var0", 32),
        (troop_get_slot, ":var7", ":var0", 31),
        (try_begin),
          (gt, ":var6", 0),
          (troop_set_slot, ":var5", 32, ":var6"),
        (try_end),
        (try_begin),
          (gt, ":var7", 0),
          (troop_set_slot, ":var5", 31, ":var7"),
        (try_end),
        (troop_get_slot, ":var6", ":var5", 32),
        (troop_get_slot, ":var7", ":var5", 31),
        (try_begin),
          (gt, ":var6", 0),
          (troop_set_slot, ":var0", 32, ":var6"),
        (try_end),
        (try_begin),
          (gt, ":var7", 0),
          (troop_set_slot, ":var0", 31, ":var7"),
        (try_end),
      (try_end),
      (try_begin),
        (troop_get_slot, ":var8", ":var0", 34),
        (gt, ":var8", 0),
        (try_begin),
          (eq, ":var1", 0),
          (troop_set_slot, ":var8", 31, ":var0"),
        (else_try),
          (troop_set_slot, ":var8", 32, ":var0"),
        (try_end),
        (troop_get_slot, ":var9", ":var0", 30),
        (troop_get_slot, ":var5", ":var0", 33),
        (try_begin),
          (gt, ":var9", 0),
          (try_begin),
            (eq, ":var1", 1),
            (troop_set_slot, ":var8", 31, ":var9"),
          (else_try),
            (troop_set_slot, ":var8", 32, ":var9"),
          (try_end),
        (try_end),
        (try_begin),
          (gt, ":var5", 0),
          (troop_set_slot, ":var8", 35, ":var5"),
        (try_end),
        (try_begin),
          (eq, ":var1", 0),
          (troop_get_slot, ":var2", ":var8", 32),
        (else_try),
          (troop_get_slot, ":var2", ":var8", 31),
        (try_end),
        (troop_get_slot, ":var3", ":var8", 35),
        (try_begin),
          (gt, ":var2", 0),
          (troop_set_slot, ":var0", 30, ":var2"),
        (try_end),
        (try_begin),
          (gt, ":var3", 0),
          (troop_set_slot, ":var0", 33, ":var3"),
        (try_end),
      (try_end),
      (try_begin),
        (troop_get_slot, ":var8", ":var0", 33),
        (gt, ":var8", 0),
        (try_begin),
          (eq, ":var1", 0),
          (troop_set_slot, ":var8", 31, ":var0"),
        (else_try),
          (troop_set_slot, ":var8", 32, ":var0"),
        (try_end),
        (troop_get_slot, ":var9", ":var0", 30),
        (troop_get_slot, ":var5", ":var0", 34),
        (try_begin),
          (gt, ":var9", 0),
          (try_begin),
            (eq, ":var1", 1),
            (troop_set_slot, ":var8", 31, ":var9"),
          (else_try),
            (troop_set_slot, ":var8", 32, ":var9"),
          (try_end),
        (try_end),
        (try_begin),
          (gt, ":var5", 0),
          (troop_set_slot, ":var8", 35, ":var5"),
        (try_end),
        (try_begin),
          (eq, ":var1", 0),
          (troop_get_slot, ":var2", ":var8", 32),
        (else_try),
          (troop_get_slot, ":var2", ":var8", 31),
        (try_end),
        (troop_get_slot, ":var4", ":var8", 35),
        (try_begin),
          (gt, ":var2", 0),
          (troop_set_slot, ":var0", 30, ":var2"),
        (try_end),
        (try_begin),
          (gt, ":var4", 0),
          (troop_set_slot, ":var0", 34, ":var4"),
        (try_end),
      (try_end),
      (try_begin),
        (troop_get_slot, ":var7", ":var0", 31),
        (gt, ":var7", 0),
        (try_begin),
          (eq, ":var1", 0),
          (troop_set_slot, ":var7", 34, ":var0"),
        (else_try),
          (troop_set_slot, ":var7", 33, ":var0"),
        (try_end),
        (troop_get_slot, ":var2", ":var0", 32),
        (troop_get_slot, ":var10", ":var0", 35),
        (try_begin),
          (gt, ":var2", 0),
          (troop_set_slot, ":var7", 30, ":var2"),
        (try_end),
        (try_begin),
          (gt, ":var10", 0),
          (try_begin),
            (eq, ":var1", 0),
            (troop_set_slot, ":var7", 33, ":var10"),
          (else_try),
            (troop_set_slot, ":var7", 34, ":var10"),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var1", 0),
          (troop_get_slot, ":var5", ":var7", 33),
        (else_try),
          (troop_get_slot, ":var5", ":var7", 34),
        (try_end),
        (troop_get_slot, ":var6", ":var7", 30),
        (try_begin),
          (gt, ":var5", 0),
          (troop_set_slot, ":var0", 35, ":var5"),
        (try_end),
        (try_begin),
          (gt, ":var6", 0),
          (troop_set_slot, ":var0", 32, ":var6"),
        (try_end),
      (try_end),
      (try_begin),
        (troop_get_slot, ":var6", ":var0", 32),
        (gt, ":var6", 0),
        (try_begin),
          (eq, ":var1", 0),
          (troop_set_slot, ":var6", 34, ":var0"),
        (else_try),
          (troop_set_slot, ":var6", 33, ":var0"),
        (try_end),
        (troop_get_slot, ":var2", ":var0", 31),
        (troop_get_slot, ":var10", ":var0", 35),
        (try_begin),
          (gt, ":var2", 0),
          (troop_set_slot, ":var6", 30, ":var2"),
        (try_end),
        (try_begin),
          (gt, ":var10", 0),
          (try_begin),
            (eq, ":var1", 0),
            (troop_set_slot, ":var6", 33, ":var10"),
          (else_try),
            (troop_set_slot, ":var6", 34, ":var10"),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var1", 0),
          (troop_get_slot, ":var5", ":var6", 33),
        (else_try),
          (troop_get_slot, ":var5", ":var6", 34),
        (try_end),
        (troop_get_slot, ":var7", ":var6", 30),
        (try_begin),
          (gt, ":var5", 0),
          (troop_set_slot, ":var0", 35, ":var5"),
        (try_end),
        (try_begin),
          (gt, ":var7", 0),
          (troop_set_slot, ":var0", 31, ":var7"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("collect_friendly_parties",
  [
    (party_collect_attachments_to_party, "p_main_party", "p_collective_friends"),
    (try_begin),
      (gt, "$g_ally_party", 0),
      (party_collect_attachments_to_party, "$g_ally_party", "p_temp_party"),
      (assign, "$g_move_heroes", 1),
      (call_script, "script_party_add_party", "p_collective_friends", "p_temp_party"),
    (try_end),
  ]),

  ("encounter_calculate_fit",
  [
    (call_script, "script_party_count_fit_for_battle", "p_main_party"),
    (call_script, "script_collect_friendly_parties"),
    (call_script, "script_party_count_fit_for_battle", "p_collective_friends"),
    (assign, "$g_friend_fit_for_battle", reg0),
    (party_clear, "p_collective_ally"),
    (try_begin),
      (gt, "$g_ally_party", 0),
      (party_is_active, "$g_ally_party"),
      (party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),
    (try_end),
    (party_clear, "p_collective_enemy"),
    (try_begin),
      (party_is_active, "$g_enemy_party"),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
    (try_end),
    (call_script, "script_party_count_fit_for_battle", "p_collective_enemy"),
    (assign, "$g_enemy_fit_for_battle", reg0),
    (assign, reg11, "$g_enemy_fit_for_battle"),
    (assign, reg10, "$g_friend_fit_for_battle"),
  ]),

  ("encounter_init_variables",
  [
    (assign, "$capture_screen_shown", 0),
    (assign, "$loot_screen_shown", 0),
    (assign, "$thanked_by_ally_leader", 0),
    (assign, "$g_battle_result", 0),
    (assign, "$cant_leave_encounter", 0),
    (assign, "$cant_talk_to_enemy", 0),
    (assign, "$last_defeated_hero", 0),
    (assign, "$last_freed_hero", 0),
    (call_script, "script_encounter_calculate_fit"),
    (call_script, "script_party_copy", "p_main_party_backup", "p_main_party"),
    (call_script, "script_party_calculate_strength", "p_main_party", 0),
    (assign, "$g_starting_strength_main_party", reg0),
    (call_script, "script_party_copy", "p_encountered_party_backup", "p_collective_enemy"),
    (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
    (assign, "$g_starting_strength_enemy_party", reg0),
    (assign, "$g_strength_contribution_of_player", 100),
    (call_script, "script_party_copy", "p_collective_friends_backup", "p_collective_friends"),
    (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
    (assign, "$g_starting_strength_friends", reg0),
    (store_mul, "$g_strength_contribution_of_player", "$g_starting_strength_main_party", 100),
    (val_div, "$g_strength_contribution_of_player", "$g_starting_strength_friends"),
  ]),

  ("calculate_renown_value",
  [
    (call_script, "script_party_calculate_strength", "p_main_party", 0),
    (assign, ":var0", reg0),
    (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
    (assign, ":var1", reg0),
    (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
    (assign, ":var2", reg0),
    (val_add, ":var2", 1),
    (store_mul, ":var3", ":var1", 100),
    (val_div, ":var3", ":var2"),
    (assign, ":var4", ":var1"),
    (val_mul, ":var4", ":var3"),
    (val_div, ":var4", 100),
    (val_mul, ":var4", ":var0"),
    (val_div, ":var4", ":var2"),
    (store_div, "$battle_renown_value", ":var4", 5),
    (val_min, "$battle_renown_value", 2500),
    (convert_to_fixed_point, "$battle_renown_value"),
    (store_sqrt, "$battle_renown_value", "$battle_renown_value"),
    (convert_from_fixed_point, "$battle_renown_value"),
    (assign, reg8, "$battle_renown_value"),
    (display_message, "@Renown value for this battle is {reg8}.", 0xFFFFFFFF),
  ]),

  ("cf_get_first_agent_with_troop_id",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", -1),
    (try_for_agents, ":var2"),
      (eq, ":var1", -1),
      (agent_get_troop_id, ":var3", ":var2"),
      (eq, ":var3", ":var0"),
      (assign, ":var1", ":var2"),
    (try_end),
    (assign, reg0, ":var1"),
    (neq, reg0, -1),
  ]),

  ("cf_team_get_average_position_of_agents_with_type_to_pos1",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 0),
    (assign, ":var5", 0),
    (set_fixed_point_multiplier, 100),
    (try_for_agents, ":var6"),
      (agent_is_alive, ":var6"),
      (agent_is_human, ":var6"),
      (agent_get_team, ":var7", ":var6"),
      (eq, ":var7", ":var0"),
      (agent_get_class, ":var8", ":var6"),
      (this_or_next|eq, ":var1", 10),
      (eq, ":var1", ":var8"),
      (agent_get_position, pos1, ":var6"),
      (position_get_x, ":var9", pos1),
      (val_add, ":var2", ":var9"),
      (position_get_y, ":var10", pos1),
      (val_add, ":var3", ":var10"),
      (position_get_z, ":var11", pos1),
      (val_add, ":var4", ":var11"),
      (val_add, ":var5", 1),
    (try_end),
    (gt, ":var5", 1),
    (val_div, ":var2", ":var5"),
    (val_div, ":var3", ":var5"),
    (val_div, ":var4", ":var5"),
    (init_position, pos1),
    (position_move_x, pos1, ":var2"),
    (position_move_y, pos1, ":var3"),
    (position_move_z, pos1, ":var4"),
  ]),

  ("cf_turn_windmill_fans",
  [
    (store_script_param_1, ":var0"),
    (scene_prop_get_instance, ":var1", "spr_windmill_a_fan", ":var0"),
    (ge, ":var1", 0),
    (prop_instance_get_position, pos1, ":var1"),
    (position_rotate_x, pos1, 10),
    (prop_instance_animate_to_position, ":var1", pos1, 50),
    (val_add, ":var0", 1),
    (call_script, "script_cf_turn_windmill_fans", ":var0"),
  ]),

  ("cf_train_heist",
  [
    (store_script_param_1, ":var0"),
    (scene_prop_get_instance, ":var1", "spr_train_a", ":var0"),
    (ge, ":var1", 0),
    (prop_instance_get_position, pos1, ":var1"),
    (position_move_x, pos1, -200),
    (prop_instance_animate_to_position, ":var1", pos1, 50),
    (val_add, ":var0", 1),
    (call_script, "script_cf_train_heist", ":var0"),
  ]),

  ("cf_train_heist2",
  [
    (store_script_param_1, ":var0"),
    (scene_prop_get_instance, ":var1", "spr_traincar", ":var0"),
    (ge, ":var1", 0),
    (prop_instance_get_position, pos1, ":var1"),
    (position_move_x, pos1, -200),
    (prop_instance_animate_to_position, ":var1", pos1, 50),
    (val_add, ":var0", 1),
    (call_script, "script_cf_train_heist2", ":var0"),
  ]),

  ("cf_train_heist3",
  [
    (store_script_param_1, ":var0"),
    (scene_prop_get_instance, ":var1", "spr_chest_c", ":var0"),
    (ge, ":var1", 0),
    (prop_instance_get_position, pos1, ":var1"),
    (position_move_y, pos1, -200),
    (prop_instance_animate_to_position, ":var1", pos1, 50),
    (val_add, ":var0", 1),
    (call_script, "script_cf_train_heist3", ":var0"),
  ]),

  ("cf_steamboat_heist",
  [
    (store_script_param_1, ":var0"),
    (scene_prop_get_instance, ":var1", "spr_steamboat", ":var0"),
    (ge, ":var1", 0),
    (prop_instance_get_position, pos1, ":var1"),
    (position_move_y, pos1, 16000),
    (prop_instance_animate_to_position, ":var1", pos1, 5000),
  ]),

  ("print_party_members",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (try_for_range, ":var2", 0, ":var1"),
      (party_stack_get_troop_id, ":var3", ":var0", ":var2"),
      (troop_is_hero, ":var3"),
      (try_begin),
        (eq, ":var2", 0),
        (str_store_troop_name, s51, ":var3"),
      (try_end),
      (str_store_troop_name, s50, ":var3"),
      (try_begin),
        (eq, ":var2", 1),
        (str_store_string, s51, "str_s50_and_s51"),
      (else_try),
        (gt, ":var2", 1),
        (str_store_string, s51, "str_s50_comma_s51"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var1", 0),
      (str_store_string, s51, "str_noone"),
    (try_end),
  ]),

  ("round_value",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (lt, ":var0", 100),
      (neq, ":var0", 0),
      (val_add, ":var0", 5),
      (val_div, ":var0", 10),
      (val_mul, ":var0", 10),
      (try_begin),
        (eq, ":var0", 0),
        (assign, ":var0", 5),
      (try_end),
    (else_try),
      (lt, ":var0", 300),
      (val_add, ":var0", 25),
      (val_div, ":var0", 50),
      (val_mul, ":var0", 50),
    (else_try),
      (val_add, ":var0", 50),
      (val_div, ":var0", 100),
      (val_mul, ":var0", 100),
    (try_end),
    (assign, reg0, ":var0"),
  ]),

  ("change_banners_and_chest",
  [
    (party_get_slot, ":var0", "$g_encountered_party", 7),
    (try_begin),
      (ge, ":var0", 0),
      (troop_get_slot, ":var1", ":var0", 13),
      (gt, ":var1", 0),
      (replace_scene_props, "spr_banner_a", ":var1"),
    (else_try),
      (replace_scene_props, "spr_banner_a", "spr_empty"),
    (try_end),
    (try_begin),
      (neq, ":var0", "trp_player"),
      (replace_scene_props, "spr_player_chest", "spr_locked_player_chest"),
    (try_end),
  ]),

  ("remove_siege_objects",
  [
    (replace_scene_props, "spr_battlement_a_destroyed", "spr_battlement_a"),
    (replace_scene_props, "spr_snowy_castle_battlement_a_destroyed", "spr_snowy_castle_battlement_a"),
    (replace_scene_props, "spr_castle_e_battlement_a_destroyed", "spr_castle_e_battlement_a"),
    (replace_scene_props, "spr_castle_battlement_a_destroyed", "spr_castle_battlement_a"),
    (replace_scene_props, "spr_castle_battlement_b_destroyed", "spr_castle_battlement_b"),
    (replace_scene_props, "spr_earth_wall_a2", "spr_earth_wall_a"),
    (replace_scene_props, "spr_earth_wall_b2", "spr_earth_wall_b"),
    (replace_scene_props, "spr_belfry_platform_b", "spr_empty"),
    (replace_scene_props, "spr_belfry_platform_a", "spr_empty"),
    (replace_scene_props, "spr_belfry_a", "spr_empty"),
    (replace_scene_props, "spr_belfry_wheel", "spr_empty"),
    (replace_scene_props, "spr_siege_ladder_12m", "spr_empty"),
    (replace_scene_props, "spr_siege_ladder_14m", "spr_empty"),
    (replace_scene_props, "spr_mangonel", "spr_empty"),
    (replace_scene_props, "spr_trebuchet_old", "spr_empty"),
    (replace_scene_props, "spr_trebuchet_new", "spr_empty"),
    (replace_scene_props, "spr_stone_ball", "spr_empty"),
    (replace_scene_props, "spr_Village_fire_big", "spr_empty"),
    (replace_scene_props, "spr_arena_spectator_a", "spr_empty"),
    (replace_scene_props, "spr_arena_spectator_b", "spr_empty"),
    (replace_scene_props, "spr_arena_spectator_sitting_b", "spr_empty"),
    (replace_scene_props, "spr_cannon_a", "spr_empty"),
  ]),

  ("describe_relation_to_s63",
  [
    (store_script_param_1, ":var0"),
    (store_add, ":var1", ":var0", 100),
    (val_add, ":var1", 5),
    (store_div, ":var2", ":var1", 10),
    (val_clamp, ":var2", 0, 20),
    (store_add, ":var3", "str_relation_mnus_100", ":var2"),
    (str_store_string, s63, ":var3"),
  ]),

  ("describe_center_relation_to_s3",
  [
    (store_script_param_1, ":var0"),
    (store_add, ":var1", ":var0", 100),
    (val_add, ":var1", 5),
    (store_div, ":var2", ":var1", 10),
    (val_clamp, ":var2", 0, 20),
    (store_add, ":var3", "str_center_relation_mnus_100", ":var2"),
    (str_store_string, s3, ":var3"),
  ]),

  ("center_ambiance_sounds",
  [
    (assign, ":var0", -1),
    (assign, ":var1", -1),
    (assign, ":var2", -1),
    (assign, ":var3", -1),
    (assign, ":var4", -1),
    (try_begin),
      (party_slot_eq, "$g_encountered_party", 0, 4),
      (try_begin),
        (neg|is_currently_night),
        (assign, ":var2", "snd_distant_dog_bark"),
        (assign, ":var2", "snd_distant_chicken"),
      (else_try),
        (assign, ":var0", "snd_distant_dog_bark"),
        (assign, ":var1", "snd_distant_owl"),
      (try_end),
    (else_try),
      (party_slot_eq, "$g_encountered_party", 0, 3),
      (try_begin),
        (neg|is_currently_night),
        (assign, ":var0", "snd_distant_carpenter"),
        (assign, ":var1", "snd_distant_blacksmith"),
        (assign, ":var2", "snd_distant_dog_bark"),
      (else_try),
        (assign, ":var0", "snd_distant_dog_bark"),
      (try_end),
    (try_end),
    (try_begin),
      (store_random_in_range, ":var5", 0, 7),
      (try_begin),
        (eq, ":var5", 1),
        (ge, ":var0", 0),
        (play_sound, ":var0"),
      (else_try),
        (eq, ":var5", 2),
        (ge, ":var1", 0),
        (play_sound, ":var1"),
      (else_try),
        (eq, ":var5", 3),
        (ge, ":var2", 0),
        (play_sound, ":var2"),
      (else_try),
        (eq, ":var5", 4),
        (ge, ":var3", 0),
        (play_sound, ":var3"),
      (else_try),
        (eq, ":var5", 5),
        (ge, ":var4", 0),
        (play_sound, ":var4"),
      (try_end),
    (try_end),
  ]),

  ("center_set_walker_to_type",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_faction_of_party, ":var3", "$current_town"),
    (store_add, ":var4", 180, ":var1"),
    (party_set_slot, ":var0", ":var4", ":var2"),
    (try_begin),
      (eq, ":var0", "p_town_3"),
      (try_begin),
        (eq, ":var1", 0),
        (assign, ":var5", "trp_benjamin_cooper"),
      (else_try),
        (eq, ":var1", 1),
        (assign, ":var5", "trp_alice_saunders"),
      (else_try),
        (store_random_in_range, ":var5", "trp_town_walker_1", "trp_village_walker_1"),
      (try_end),
    (else_try),
      (party_slot_eq, ":var0", 0, 4),
      (try_begin),
        (this_or_next|eq, ":var3", "fac_kingdom_3"),
        (eq, ":var3", "fac_kingdom_4"),
        (assign, ":var5", "trp_village_walker_3"),
      (else_try),
        (eq, ":var3", "fac_kingdom_2"),
        (assign, ":var5", "trp_village_walker_4"),
      (else_try),
        (store_random_in_range, ":var5", "trp_village_walker_1", "trp_spy_walker_1"),
      (try_end),
    (else_try),
      (store_random_in_range, ":var5", "trp_town_walker_1", "trp_village_walker_1"),
    (try_end),
    (try_begin),
      (eq, ":var2", 3),
      (assign, ":var6", ":var5"),
      (val_add, ":var5", 4),
      (try_for_range, ":var7", "itm_horse_meat", "itm_wooden_stick"),
        (store_item_kind_count, ":var8", ":var7", ":var6"),
        (ge, ":var8", 1),
        (store_item_kind_count, ":var8", ":var7", ":var5"),
        (lt, ":var8", 1),
        (troop_add_items, ":var5", ":var7", 1),
      (try_end),
      (store_random_in_range, ":var9", 12, 15),
      (assign, ":var10", 0),
      (try_for_range, ":var7", "itm_horse_meat", "itm_wooden_stick"),
        (store_item_kind_count, ":var8", ":var7", ":var5"),
        (ge, ":var8", 1),
        (item_get_type, ":var11", ":var7"),
        (eq, ":var11", ":var9"),
        (val_add, ":var10", 1),
        (troop_remove_items, ":var5", ":var7", ":var8"),
      (try_end),
      (store_random_in_range, ":var12", 0, ":var10"),
      (assign, ":var10", -1),
      (try_for_range, ":var7", "itm_horse_meat", "itm_wooden_stick"),
        (store_item_kind_count, ":var8", ":var7", ":var6"),
        (ge, ":var8", 1),
        (item_get_type, ":var11", ":var7"),
        (eq, ":var11", ":var9"),
        (val_add, ":var10", 1),
        (eq, ":var10", ":var12"),
        (troop_add_items, ":var5", ":var7", 1),
        (assign, ":var13", ":var7"),
      (try_end),
      (assign, "$spy_item_worn", ":var13"),
      (assign, "$spy_quest_troop", ":var5"),
      (troop_equip_items, ":var5"),
    (try_end),
    (store_add, ":var14", 160, ":var1"),
    (party_set_slot, ":var0", ":var14", ":var5"),
    (store_random_in_range, ":var15", 0, 1000000),
    (store_add, ":var16", 170, ":var1"),
    (party_set_slot, ":var0", ":var16", ":var15"),
  ]),

  ("cf_center_get_free_walker",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 0, 8),
      (this_or_next|neq, ":var0", "p_town_3"),
      (neq, ":var2", 0),
      (this_or_next|neq, ":var0", "p_town_3"),
      (neq, ":var2", 1),
      (store_add, ":var3", 180, ":var2"),
      (party_slot_eq, ":var0", ":var3", 0),
      (val_add, ":var1", 1),
    (try_end),
    (gt, ":var1", 0),
    (assign, reg0, -1),
    (store_random_in_range, ":var4", 0, ":var1"),
    (try_for_range, ":var2", 0, 8),
      (store_add, ":var3", 180, ":var2"),
      (party_slot_eq, ":var0", ":var3", 0),
      (this_or_next|neq, ":var0", "p_town_3"),
      (neq, ":var2", 0),
      (this_or_next|neq, ":var0", "p_town_3"),
      (neq, ":var2", 1),
      (val_sub, ":var1", 1),
      (eq, ":var1", ":var4"),
      (assign, reg0, ":var2"),
    (try_end),
  ]),

  ("center_remove_walker_type_from_walkers",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (try_for_range, ":var2", 0, 8),
      (store_add, ":var3", 180, ":var2"),
      (party_slot_eq, ":var0", ":var3", ":var1"),
      (call_script, "script_center_set_walker_to_type", ":var0", ":var2", 0),
    (try_end),
  ]),

  ("init_town_walkers",
  [
    (try_begin),
      (eq, "$town_nighttime", 0),
      (try_for_range, ":var0", 0, 8),
        (store_add, ":var1", 160, ":var0"),
        (party_get_slot, ":var2", "$current_town", ":var1"),
        (gt, ":var2", 0),
        (store_add, ":var3", 32, ":var0"),
        (set_visitor, ":var3", ":var2"),
      (try_end),
  ]),

  ("cf_enter_center_location_bandit_check",
  [
    (party_get_slot, ":var0", "$current_town", 149),
    (gt, ":var0", 0),
    (this_or_next|neq, "$town_nighttime", 0),
    (is_between, ":var0", "trp_county_militia", "trp_gambler"),
    (eq, "$g_defending_against_siege", 0),
    (eq, "$sneaked_into_town", 0),
    (try_begin),
      (party_slot_eq, "$current_town", 0, 4),
      (party_get_slot, ":var1", "$current_town", 10),
    (else_try),
      (party_get_slot, ":var1", "$current_town", 10),
    (try_end),
    (modify_visitors_at_site, ":var1"),
    (reset_visitors),
    (party_get_slot, ":var2", "$current_town", 149),
    (store_character_level, ":var3", "trp_player"),
    (set_jump_mission, "mt_bandits_at_night"),
    (try_begin),
      (party_slot_eq, "$current_town", 0, 4),
      (assign, ":var4", 2),
      (store_div, ":var5", ":var3", 10),
      (val_add, ":var4", ":var5"),
      (try_for_range, ":var6", 0, 3),
        (gt, ":var3", 10),
        (store_random_in_range, ":var7", 0, 100),
        (lt, ":var7", ":var3"),
        (val_add, ":var4", 1),
      (try_end),
      (set_visitors, 4, ":var2", ":var4"),
      (assign, "$num_center_bandits", ":var4"),
      (set_jump_entry, 2),
    (else_try),
      (assign, ":var4", 1),
      (assign, "$num_center_bandits", 0),
      (try_begin),
        (gt, ":var3", 15),
        (store_random_in_range, ":var7", 0, 100),
        (lt, ":var7", ":var3"),
        (assign, ":var4", 2),
      (try_end),
      (val_add, "$num_center_bandits", ":var4"),
      (set_visitors, 11, ":var2", ":var4"),
      (assign, ":var4", 1),
      (try_begin),
        (gt, ":var3", 20),
        (store_random_in_range, ":var7", 0, 100),
        (lt, ":var7", ":var3"),
        (assign, ":var4", 2),
      (try_end),
      (set_visitors, 27, ":var2", ":var4"),
      (val_add, "$num_center_bandits", ":var4"),
      (try_begin),
        (gt, ":var3", 9),
        (assign, ":var4", 1),
        (try_begin),
          (gt, ":var3", 25),
          (store_random_in_range, ":var7", 0, 100),
          (lt, ":var7", ":var3"),
          (assign, ":var4", 2),
        (try_end),
        (set_visitors, 28, ":var2", ":var4"),
        (val_add, "$num_center_bandits", ":var4"),
      (try_end),
      (assign, "$town_entered", 1),
      (assign, "$all_doors_locked", 1),
    (try_end),
    (try_begin),
      (eq, ":var2", "trp_county_militia"),
      (display_message, "@You have run into a trap!", 0xFFFF2222),
      (display_message, "@Some angry farmer grab their weapons and attack you!", 0xFFFF2222),
    (else_try),
      (eq, ":var2", "trp_state_militia"),
      (display_message, "@You have run into a trap!", 0xFFFF2222),
      (display_message, "@Some civilists of this town attack you!", 0xFFFF2222),
    (else_try),
      (eq, ":var2", "trp_pinkerton_agent"),
      (display_message, "@You have run into a trap!", 0xFFFF2222),
      (display_message, "@You are ambushed by Pinkerton agents!", 0xFFFF2222),
    (else_try),
      (display_message, "@You have run into a trap!", 0xFFFF2222),
      (display_message, "@You are attacked by a group of bandits!", 0xFFFF2222),
    (try_end),
    (jump_to_scene, ":var1"),
    (change_screen_mission),
  ]),

  ("init_town_agent",
  [
    (store_script_param, ":var0", 1),
    (agent_get_troop_id, ":var1", ":var0"),
    (set_fixed_point_multiplier, 100),
    (assign, ":var2", -1),
    (try_begin),
      (this_or_next|is_between, ":var1", "trp_town_1_armorer", "trp_town_1_weaponsmith"),
      (is_between, ":var1", "trp_town_1_weaponsmith", "trp_town_1_tavernkeeper"),
      (try_begin),
        (call_script, "script_troop_get_gender_to_reg18", ":var1"),
        (assign, ":var3", reg18),
        (eq, ":var3", 0),
        (agent_set_animation, ":var0", "anim_stand_townguard"),
      (else_try),
        (agent_set_animation, ":var0", "anim_stand_townguard"),
      (try_end),
    (else_try),
      (is_between, ":var1", "trp_knight_1_1_wife", "trp_heroes_end"),
      (assign, ":var2", "anim_stand_lady"),
    (else_try),
      (is_between, ":var1", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (assign, ":var2", "anim_stand_lord"),
    (else_try),
      (is_between, ":var1", "trp_recruit", "trp_town_walker_1"),
      (assign, ":var2", "anim_stand_townguard"),
    (try_end),
    (try_begin),
      (ge, ":var2", 0),
      (agent_set_stand_animation, ":var0", ":var2"),
      (agent_set_animation, ":var0", ":var2"),
      (store_random_in_range, ":var4", 0, 100),
      (agent_set_animation_progress, ":var0", ":var4"),
    (try_end),
  ]),

  ("init_town_walker_agents",
  [
    (assign, ":var0", 0),
    (try_for_agents, ":var1"),
      (agent_get_troop_id, ":var2", ":var1"),
      (is_between, ":var2", "trp_town_walker_1", "trp_tournament_master"),
      (val_add, ":var0", 1),
      (agent_get_position, pos1, ":var1"),
      (try_for_range, ":var3", 9, 40),
        (entry_point_get_position, pos2, ":var3"),
        (get_distance_between_positions, ":var4", pos1, pos2),
        (lt, ":var4", 200),
        (agent_set_slot, ":var1", 0, ":var3"),
      (try_end),
      (call_script, "script_set_town_walker_destination", ":var1"),
    (try_end),
  ]),

  ("agent_get_town_walker_details",
  [
    (store_script_param, ":var0", 1),
    (agent_get_entry_no, ":var1", ":var0"),
    (store_sub, ":var2", ":var1", 32),
    (store_add, ":var3", 180, ":var2"),
    (party_get_slot, ":var4", "$current_town", ":var3"),
    (store_add, ":var5", 170, ":var2"),
    (party_get_slot, ":var6", "$current_town", ":var5"),
    (assign, reg0, ":var4"),
    (assign, reg1, ":var6"),
    (assign, reg2, ":var2"),
  ]),

  ("tick_town_walkers",
  [
    (try_for_agents, ":var0"),
      (neg|agent_slot_eq, ":var0", 22, 1),
      (agent_get_troop_id, ":var1", ":var0"),
      (is_between, ":var1", "trp_town_walker_1", "trp_tournament_master"),
      (agent_get_slot, ":var2", ":var0", 0),
      (entry_point_get_position, pos1, ":var2"),
      (try_begin),
        (lt, ":var2", 32),
        (init_position, pos2),
        (position_set_y, pos2, 250),
        (position_transform_position_to_parent, pos1, pos1, pos2),
      (try_end),
      (agent_get_position, pos2, ":var0"),
      (get_distance_between_positions, ":var3", pos1, pos2),
      (lt, ":var3", 400),
      (assign, ":var4", 0),
      (try_begin),
        (lt, ":var2", 32),
        (store_random_in_range, ":var4", 0, 100),
      (try_end),
      (lt, ":var4", 20),
      (call_script, "script_set_town_walker_destination", ":var0"),
    (try_end),
  ]),

  ("set_town_walker_destination",
  [
    (store_script_param_1, ":var0"),
    (assign, reg0, 9),
    (assign, reg1, 10),
    (assign, reg2, 12),
    (assign, reg3, 32),
    (assign, reg4, 33),
    (assign, reg5, 34),
    (assign, reg6, 35),
    (assign, reg7, 36),
    (assign, reg8, 37),
    (assign, reg9, 38),
    (assign, reg10, 39),
    (try_for_agents, ":var1"),
      (agent_get_troop_id, ":var2", ":var1"),
      (is_between, ":var2", "trp_town_walker_1", "trp_tournament_master"),
      (agent_get_slot, ":var3", ":var1", 0),
      (try_begin),
        (eq, ":var3", 9),
        (assign, reg0, 0),
      (else_try),
        (eq, ":var3", 10),
        (assign, reg1, 0),
      (else_try),
        (eq, ":var3", 12),
        (assign, reg2, 0),
      (else_try),
        (eq, ":var3", 32),
        (assign, reg3, 0),
      (else_try),
        (eq, ":var3", 33),
        (assign, reg4, 0),
      (else_try),
        (eq, ":var3", 34),
        (assign, reg5, 0),
      (else_try),
        (eq, ":var3", 35),
        (assign, reg6, 0),
      (else_try),
        (eq, ":var3", 36),
        (assign, reg7, 0),
      (else_try),
        (eq, ":var3", 37),
        (assign, reg8, 0),
      (else_try),
        (eq, ":var3", 38),
        (assign, reg9, 0),
      (else_try),
        (eq, ":var3", 39),
        (assign, reg10, 0),
      (try_end),
    (try_end),
    (assign, ":var4", 100),
    (assign, ":var3", 0),
    (try_for_range, ":var5", 0, ":var4"),
      (shuffle_range, 0, 11),
      (gt, reg0, 0),
      (assign, ":var3", reg0),
      (assign, ":var4", 0),
    (try_end),
    (try_begin),
      (gt, ":var3", 0),
      (agent_set_slot, ":var0", 0, ":var3"),
      (entry_point_get_position, pos1, ":var3"),
      (try_begin),
        (lt, ":var3", 32),
        (init_position, pos2),
        (position_set_y, pos2, 250),
        (position_transform_position_to_parent, pos1, pos1, pos2),
      (try_end),
      (agent_clear_scripted_mode, ":var0"),
      (agent_set_scripted_destination, ":var0", pos1, 0),
      (agent_set_speed_limit, ":var0", 5),
    (try_end),
  ]),

  ("town_init_doors",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (assign, ":var1", 0),
      (try_begin),
        (eq, ":var0", 1),
        (assign, ":var1", 1),
      (else_try),
        (eq, ":var0", 0),
        (eq, "$town_nighttime", 0),
        (assign, ":var1", 1),
      (try_end),
      (eq, ":var1", 1),
      (assign, ":var2", 1),
      (try_for_range, ":var3", 0, ":var2"),
        (scene_prop_get_instance, ":var4", "spr_towngate_door_left", ":var3"),
        (ge, ":var4", 0),
        (val_add, ":var2", 1),
        (prop_instance_get_position, pos1, ":var4"),
        (position_rotate_z, pos1, -100),
        (prop_instance_animate_to_position, ":var4", pos1, 1),
      (try_end),
      (assign, ":var2", 1),
      (try_for_range, ":var3", 0, ":var2"),
        (scene_prop_get_instance, ":var4", "spr_towngate_rectangle_door_left", ":var3"),
        (ge, ":var4", 0),
        (val_add, ":var2", 1),
        (prop_instance_get_position, pos1, ":var4"),
        (position_rotate_z, pos1, -80),
        (prop_instance_animate_to_position, ":var4", pos1, 1),
      (try_end),
      (assign, ":var2", 1),
      (try_for_range, ":var3", 0, ":var2"),
        (scene_prop_get_instance, ":var4", "spr_towngate_door_right", ":var3"),
        (ge, ":var4", 0),
        (val_add, ":var2", 1),
        (prop_instance_get_position, pos1, ":var4"),
        (position_rotate_z, pos1, 100),
        (prop_instance_animate_to_position, ":var4", pos1, 1),
      (try_end),
      (assign, ":var2", 1),
      (try_for_range, ":var3", 0, ":var2"),
        (scene_prop_get_instance, ":var4", "spr_towngate_rectangle_door_right", ":var3"),
        (ge, ":var4", 0),
        (val_add, ":var2", 1),
        (prop_instance_get_position, pos1, ":var4"),
        (position_rotate_z, pos1, 80),
        (prop_instance_animate_to_position, ":var4", pos1, 1),
      (try_end),
    (try_end),
  ]),

  ("siege_init_ai_and_belfry",
  [
    (assign, "$cur_belfry_pos", 50),
    (assign, ":var0", 10),
    (store_current_scene, ":var1"),
    (try_for_range, ":var2", 0, 3),
      (scene_prop_get_instance, ":var3", "spr_belfry_a", ":var2"),
      (ge, ":var3", 0),
      (scene_set_slot, ":var1", ":var0", ":var3"),
      (val_add, ":var0", 1),
    (try_end),
    (try_for_range, ":var2", 0, 3),
      (scene_prop_get_instance, ":var3", "spr_belfry_platform_a", ":var2"),
      (ge, ":var3", 0),
      (scene_set_slot, ":var1", ":var0", ":var3"),
      (val_add, ":var0", 1),
    (try_end),
    (try_for_range, ":var2", 0, 3),
      (scene_prop_get_instance, ":var3", "spr_belfry_platform_b", ":var2"),
      (ge, ":var3", 0),
      (scene_set_slot, ":var1", ":var0", ":var3"),
      (val_add, ":var0", 1),
    (try_end),
    (assign, "$belfry_rotating_objects_begin", ":var0"),
    (try_for_range, ":var2", 0, 5),
      (scene_prop_get_instance, ":var3", "spr_belfry_wheel", ":var2"),
      (ge, ":var3", 0),
      (scene_set_slot, ":var1", ":var0", ":var3"),
      (val_add, ":var0", 1),
    (try_end),
    (assign, "$last_belfry_object_pos", ":var0"),
    (scene_prop_get_instance, ":var4", "spr_belfry_platform_a", 0),
    (entry_point_get_position, pos1, 55),
    (entry_point_get_position, pos3, 50),
    (try_for_range, ":var5", 10, "$last_belfry_object_pos"),
      (assign, ":var6", 64),
      (val_add, ":var6", ":var5"),
      (val_sub, ":var6", 10),
      (scene_get_slot, ":var7", ":var1", ":var5"),
      (prop_instance_get_position, pos2, ":var7"),
      (try_begin),
        (eq, ":var7", ":var4"),
        (position_rotate_x, pos2, 90),
      (try_end),
      (position_transform_position_to_local, ":var6", pos1, pos2),
      (position_transform_position_to_parent, pos4, pos3, ":var6"),
      (prop_instance_animate_to_position, ":var7", pos4, 1),
    (try_end),
    (assign, "$belfry_positioned", 0),
    (assign, "$belfry_num_slots_positioned", 0),
    (assign, "$belfry_num_men_pushing", 0),
  ]),

  ("cf_siege_move_belfry",
  [
    (neq, "$last_belfry_object_pos", 10),
    (entry_point_get_position, pos1, 50),
    (entry_point_get_position, pos4, 55),
    (get_distance_between_positions, ":var0", pos4, pos1),
    (store_current_scene, ":var1"),
    (scene_get_slot, ":var2", ":var1", 10),
    (prop_instance_get_position, pos2, ":var2"),
    (entry_point_get_position, pos1, "$cur_belfry_pos"),
    (position_transform_position_to_parent, pos3, pos1, pos_belfry_begin),
    (position_transform_position_to_parent, pos5, pos4, pos_belfry_begin),
    (get_distance_between_positions, ":var3", pos2, pos3),
    (get_distance_between_positions, ":var4", pos2, pos5),
    (try_begin),
      (le, ":var3", 10),
      (val_add, "$cur_belfry_pos", 1),
      (entry_point_get_position, pos1, "$cur_belfry_pos"),
      (position_transform_position_to_parent, pos3, pos1, pos_belfry_begin),
      (get_distance_between_positions, ":var3", pos2, pos3),
    (try_end),
    (neq, "$cur_belfry_pos", 50),
    (assign, ":var5", 20),
    (store_div, ":var6", ":var0", 60),
    (store_sub, ":var7", ":var0", ":var4"),
    (try_begin),
      (lt, ":var7", ":var6"),
      (store_mul, ":var5", ":var7", -60),
      (val_div, ":var5", ":var6"),
      (val_add, ":var5", 80),
    (else_try),
      (lt, ":var4", ":var6"),
      (store_mul, ":var5", ":var4", -60),
      (val_div, ":var5", ":var6"),
      (val_add, ":var5", 80),
    (try_end),
    (store_mul, ":var8", ":var3", ":var5"),
    (try_begin),
      (eq, "$belfry_num_men_pushing", 0),
      (assign, ":var8", 1000000),
    (else_try),
      (val_div, ":var8", "$belfry_num_men_pushing"),
    (try_end),
    (try_begin),
      (le, "$cur_belfry_pos", 55),
      (init_position, pos3),
      (position_rotate_x, pos3, ":var7"),
      (scene_get_slot, ":var9", ":var1", 10),
      (prop_instance_get_position, pos4, ":var9"),
      (entry_point_get_position, pos1, "$cur_belfry_pos"),
      (try_for_range, ":var10", 10, "$last_belfry_object_pos"),
        (scene_get_slot, ":var11", ":var1", ":var10"),
        (try_begin),
          (ge, ":var10", "$belfry_rotating_objects_begin"),
          (prop_instance_get_starting_position, pos5, ":var9"),
          (prop_instance_get_starting_position, pos6, ":var11"),
          (position_transform_position_to_local, pos7, pos5, pos6),
          (position_transform_position_to_parent, pos5, pos4, pos7),
          (position_transform_position_to_parent, pos6, pos5, pos3),
          (prop_instance_set_position, ":var11", pos6),
        (else_try),
          (assign, ":var12", 64),
          (val_add, ":var12", ":var10"),
          (val_sub, ":var12", 10),
          (position_transform_position_to_parent, pos2, pos1, ":var12"),
          (prop_instance_animate_to_position, ":var11", pos2, ":var8"),
        (try_end),
      (try_end),
    (try_end),
    (gt, "$cur_belfry_pos", 55),
    (assign, "$belfry_positioned", 1),
  ]),

  ("cf_siege_rotate_belfry_platform",
  [
    (eq, "$belfry_positioned", 1),
    (scene_prop_get_instance, ":var0", "spr_belfry_platform_a", 0),
    (prop_instance_get_position, pos1, ":var0"),
    (position_rotate_x, pos1, -90),
    (prop_instance_animate_to_position, ":var0", pos1, 400),
    (assign, "$belfry_positioned", 2),
  ]),

  ("cf_siege_assign_men_to_belfry",
  [
    (store_mission_timer_a, ":var0"),
    (neq, "$last_belfry_object_pos", 10),
    (assign, ":var1", 0),
    (try_begin),
      (lt, "$belfry_positioned", 3),
      (get_player_agent_no, ":var2"),
      (store_current_scene, ":var3"),
      (scene_get_slot, ":var4", ":var3", 10),
      (prop_instance_get_position, pos2, ":var4"),
      (assign, ":var5", 0),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (assign, ":var8", 0),
      (assign, ":var9", 0),
      (assign, ":var10", 0),
      (assign, "$belfry_num_slots_positioned", 0),
      (assign, "$belfry_num_men_pushing", 0),
      (try_for_agents, ":var11"),
        (agent_is_alive, ":var11"),
        (agent_is_human, ":var11"),
        (try_begin),
          (agent_get_slot, ":var12", ":var11", 1),
          (neq, ":var12", 0),
          (agent_get_slot, ":var13", ":var11", 2),
          (try_begin),
            (eq, ":var12", -600),
            (try_begin),
              (eq, ":var13", 0),
              (assign, ":var5", 1),
            (else_try),
              (eq, ":var13", -200),
              (assign, ":var6", 1),
            (else_try),
              (assign, ":var7", 1),
            (try_end),
          (else_try),
            (try_begin),
              (eq, ":var13", 0),
              (assign, ":var8", 1),
            (else_try),
              (eq, ":var13", -200),
              (assign, ":var9", 1),
            (else_try),
              (assign, ":var10", 1),
            (try_end),
          (try_end),
          (val_add, "$belfry_num_slots_positioned", 1),
          (init_position, pos1),
          (position_move_x, pos1, ":var12"),
          (position_move_y, pos1, ":var13"),
          (init_position, pos3),
          (position_move_x, pos3, ":var12"),
          (position_move_y, pos3, -1000),
          (position_transform_position_to_parent, pos4, pos2, pos1),
          (position_transform_position_to_parent, pos5, pos2, pos3),
          (agent_get_position, pos6, ":var11"),
          (get_distance_between_positions, ":var14", pos6, pos4),
          (get_distance_between_positions, ":var15", pos6, pos5),
          (try_begin),
            (this_or_next|lt, ":var14", ":var15"),
            (lt, ":var15", 600),
            (agent_set_scripted_destination, ":var11", pos4, 1),
          (else_try),
            (agent_set_scripted_destination, ":var11", pos5, 1),
          (try_end),
          (try_begin),
            (le, ":var14", 300),
            (val_add, "$belfry_num_men_pushing", 1),
          (try_end),
        (else_try),
          (agent_get_team, ":var16", ":var11"),
          (this_or_next|eq, "$attacker_team", ":var16"),
          (eq, "$attacker_team_2", ":var16"),
          (try_begin),
            (gt, ":var0", 20),
            (agent_get_position, pos1, ":var11"),
            (agent_set_scripted_destination, ":var11", pos1, 0),
          (else_try),
            (try_begin),
              (team_get_movement_order, ":var17", "$attacker_team", 0),
              (team_get_movement_order, ":var18", "$attacker_team", 2),
              (team_get_movement_order, ":var19", "$attacker_team", 1),
              (this_or_next|neq, ":var17", 11),
              (this_or_next|neq, ":var18", 11),
              (neq, ":var19", 11),
              (set_show_messages, 0),
              (team_give_order, "$attacker_team", 10, 11),
              (set_show_messages, 1),
            (try_end),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (lt, "$belfry_num_slots_positioned", 6),
        (try_for_agents, ":var11"),
          (agent_is_alive, ":var11"),
          (agent_get_team, ":var16", ":var11"),
          (this_or_next|eq, "$attacker_team", ":var16"),
          (eq, "$attacker_team_2", ":var16"),
          (neq, ":var2", ":var11"),
          (agent_get_class, ":var20", ":var11"),
          (this_or_next|eq, ":var20", 0),
          (eq, ":var20", 2),
          (agent_get_slot, ":var12", ":var11", 1),
          (eq, ":var12", 0),
          (assign, ":var13", 0),
          (try_begin),
            (eq, ":var5", 0),
            (assign, ":var12", -600),
            (assign, ":var13", 0),
            (val_add, ":var5", 1),
          (else_try),
            (eq, ":var6", 0),
            (assign, ":var12", -600),
            (assign, ":var13", -200),
            (val_add, ":var6", 1),
          (else_try),
            (eq, ":var7", 0),
            (assign, ":var12", -600),
            (assign, ":var13", -400),
            (val_add, ":var7", 1),
          (else_try),
            (eq, ":var8", 0),
            (assign, ":var12", 600),
            (assign, ":var13", 0),
            (val_add, ":var8", 1),
          (else_try),
            (eq, ":var9", 0),
            (assign, ":var12", 600),
            (assign, ":var13", -200),
            (val_add, ":var9", 1),
          (else_try),
            (eq, ":var10", 0),
            (assign, ":var12", 600),
            (assign, ":var13", -400),
            (val_add, ":var10", 1),
          (try_end),
          (val_add, "$belfry_num_slots_positioned", 1),
          (agent_set_slot, ":var11", 1, ":var12"),
          (agent_set_slot, ":var11", 2, ":var13"),
        (try_end),
      (try_end),
      (try_begin),
        (store_mission_timer_a, ":var21"),
        (gt, ":var21", 20),
        (lt, "$belfry_num_slots_positioned", 6),
        (try_for_agents, ":var11"),
          (agent_is_alive, ":var11"),
          (agent_get_team, ":var16", ":var11"),
          (this_or_next|eq, "$attacker_team", ":var16"),
          (eq, "$attacker_team_2", ":var16"),
          (neq, ":var2", ":var11"),
          (agent_get_slot, ":var12", ":var11", 1),
          (eq, ":var12", 0),
          (assign, ":var13", 0),
          (try_begin),
            (eq, ":var5", 0),
            (assign, ":var12", -600),
            (assign, ":var13", 0),
            (val_add, ":var5", 1),
          (else_try),
            (eq, ":var6", 0),
            (assign, ":var12", -600),
            (assign, ":var13", -200),
            (val_add, ":var6", 1),
          (else_try),
            (eq, ":var7", 0),
            (assign, ":var12", -600),
            (assign, ":var13", -400),
            (val_add, ":var7", 1),
          (else_try),
            (eq, ":var8", 0),
            (assign, ":var12", 600),
            (assign, ":var13", 0),
            (val_add, ":var8", 1),
          (else_try),
            (eq, ":var9", 0),
            (assign, ":var12", 600),
            (assign, ":var13", -200),
            (val_add, ":var9", 1),
          (else_try),
            (eq, ":var10", 0),
            (assign, ":var12", 600),
            (assign, ":var13", -400),
            (val_add, ":var10", 1),
          (try_end),
          (val_add, "$belfry_num_slots_positioned", 1),
          (agent_set_slot, ":var11", 1, ":var12"),
          (agent_set_slot, ":var11", 2, ":var13"),
        (try_end),
      (try_end),
    (else_try),
      (assign, ":var1", 1),
      (try_for_agents, ":var11"),
        (agent_clear_scripted_mode, ":var11"),
      (try_end),
      (set_show_messages, 0),
      (team_give_order, "$attacker_team", 10, 2),
      (set_show_messages, 1),
    (try_end),
    (eq, ":var1", 1),
  ]),

  ("siege_move_archers_to_archer_positions",
  [
    (try_for_agents, ":var0"),
      (agent_is_alive, ":var0"),
      (agent_slot_eq, ":var0", 5, 0),
      (agent_is_defender, ":var0"),
      (agent_get_class, ":var1", ":var0"),
      (agent_get_troop_id, ":var2", ":var0"),
      (eq, ":var1", 1),
      (try_begin),
        (agent_slot_eq, ":var0", 11, 0),
        (store_random_in_range, ":var3", 40, 44),
        (agent_set_slot, ":var0", 11, ":var3"),
      (try_end),
      (try_begin),
        (agent_get_position, pos0, ":var0"),
        (entry_point_get_position, pos1, ":var3"),
        (get_distance_between_positions, ":var4", pos0, pos1),
        (lt, ":var4", 300),
        (agent_clear_scripted_mode, ":var0"),
        (agent_set_slot, ":var0", 4, 0),
        (agent_set_slot, ":var0", 5, 1),
        (str_store_troop_name, s1, ":var2"),
        (assign, reg0, ":var0"),
      (else_try),
        (agent_get_simple_behavior, ":var5", ":var0"),
        (agent_get_combat_state, ":var6", ":var0"),
        (this_or_next|eq, ":var5", 5),
        (eq, ":var5", 1),
        (eq, ":var6", 7),
        (try_begin),
          (agent_slot_eq, ":var0", 4, 0),
          (agent_set_scripted_destination, ":var0", pos1, 0),
          (agent_set_slot, ":var0", 4, 1),
          (str_store_troop_name, s1, ":var2"),
          (assign, reg0, ":var0"),
        (try_end),
      (else_try),
        (try_begin),
          (agent_slot_eq, ":var0", 4, 1),
          (agent_clear_scripted_mode, ":var0"),
          (agent_set_slot, ":var0", 4, 0),
          (str_store_troop_name, s1, ":var2"),
          (assign, reg0, ":var0"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("store_movement_order_name_to_s1",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (team_get_movement_order, ":var2", ":var0", ":var1"),
    (try_begin),
      (eq, ":var2", 0),
      (str_store_string, s1, "@Holding"),
    (else_try),
      (eq, ":var2", 1),
      (str_store_string, s1, "@Following"),
    (else_try),
      (eq, ":var2", 2),
      (str_store_string, s1, "@Charging"),
    (else_try),
      (eq, ":var2", 5),
      (str_store_string, s1, "@Advancing"),
    (else_try),
      (eq, ":var2", 6),
      (str_store_string, s1, "@Falling Back"),
    (else_try),
      (eq, ":var2", 7),
      (str_store_string, s1, "@Standing closer"),
    (else_try),
      (eq, ":var2", 8),
      (str_store_string, s1, "@Spreading Out"),
    (else_try),
      (eq, ":var2", 11),
      (str_store_string, s1, "@Standing"),
    (else_try),
      (str_store_string, s1, "@N/A"),
    (try_end),
  ]),

  ("store_riding_order_name_to_s1",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (team_get_riding_order, ":var2", ":var0", ":var1"),
    (try_begin),
      (eq, ":var2", 0),
      (str_store_string, s1, "@Free"),
    (else_try),
      (eq, ":var2", 1),
      (str_store_string, s1, "@mount"),
    (else_try),
      (eq, ":var2", 2),
      (str_store_string, s1, "@dismount"),
    (else_try),
      (str_store_string, s1, "@N/A"),
    (try_end),
  ]),

  ("store_weapon_usage_order_name_to_s1",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (team_get_weapon_usage_order, ":var2", ":var0", ":var1"),
    (team_get_hold_fire_order, ":var3", ":var0", ":var1"),
    (try_begin),
      (eq, ":var2", 0),
      (eq, ":var3", 0),
      (str_store_string, s1, "@Any Weapon"),
    (else_try),
      (eq, ":var2", 1),
      (eq, ":var3", 0),
      (str_store_string, s1, "@Blunt Weapons"),
    (else_try),
      (eq, ":var2", 0),
      (eq, ":var3", 1),
      (str_store_string, s1, "str_hold_fire"),
    (else_try),
      (eq, ":var2", 1),
      (eq, ":var3", 1),
      (str_store_string, s1, "str_blunt_hold_fire"),
    (else_try),
      (str_store_string, s1, "@N/A"),
    (try_end),
  ]),

  ("team_give_order_from_order_panel",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (agent_get_team, ":var2", ":var0"),
    (set_show_messages, 0),
    (try_begin),
      (eq, "$g_formation_infantry_selected", 1),
      (team_give_order, ":var2", 0, ":var1"),
    (try_end),
    (try_begin),
      (eq, "$g_formation_archers_selected", 1),
      (team_give_order, ":var2", 1, ":var1"),
    (try_end),
    (try_begin),
      (eq, "$g_formation_cavalry_selected", 1),
      (team_give_order, ":var2", 2, ":var1"),
    (try_end),
    (try_begin),
      (eq, ":var1", 0),
      (agent_get_position, pos1, ":var0"),
      (try_begin),
        (eq, "$g_formation_infantry_selected", 1),
        (team_set_order_position, ":var2", 0, pos1),
      (try_end),
      (try_begin),
        (eq, "$g_formation_archers_selected", 1),
        (team_set_order_position, ":var2", 1, pos1),
      (try_end),
      (try_begin),
        (eq, "$g_formation_cavalry_selected", 1),
        (team_set_order_position, ":var2", 2, pos1),
      (try_end),
    (try_end),
    (set_show_messages, 1),
  ]),

  ("update_order_panel",
  [
    (store_script_param_1, ":var0"),
    (set_fixed_point_multiplier, 1000),
    (assign, ":var1", 0),
    (try_begin),
      (class_is_listening_order, ":var0", 0),
      (assign, ":var1", 1),
    (try_end),
    (assign, ":var2", 0),
    (try_begin),
      (class_is_listening_order, ":var0", 1),
      (assign, ":var2", 1),
    (try_end),
    (assign, ":var3", 0),
    (try_begin),
      (class_is_listening_order, ":var0", 2),
      (assign, ":var3", 1),
    (try_end),
    (call_script, "script_store_movement_order_name_to_s1", ":var0", 0),
    (overlay_set_text, "$g_presentation_infantry_movement", s1),
    (call_script, "script_store_riding_order_name_to_s1", ":var0", 0),
    (overlay_set_text, "$g_presentation_infantry_riding", s1),
    (call_script, "script_store_weapon_usage_order_name_to_s1", ":var0", 0),
    (overlay_set_text, "$g_presentation_infantry_weapon_usage", s1),
    (call_script, "script_store_movement_order_name_to_s1", ":var0", 1),
    (overlay_set_text, "$g_presentation_archers_movement", s1),
    (call_script, "script_store_riding_order_name_to_s1", ":var0", 1),
    (overlay_set_text, "$g_presentation_archers_riding", s1),
    (call_script, "script_store_weapon_usage_order_name_to_s1", ":var0", 1),
    (overlay_set_text, "$g_presentation_archers_weapon_usage", s1),
    (call_script, "script_store_movement_order_name_to_s1", ":var0", 2),
    (overlay_set_text, "$g_presentation_cavalry_movement", s1),
    (call_script, "script_store_riding_order_name_to_s1", ":var0", 2),
    (overlay_set_text, "$g_presentation_cavalry_riding", s1),
    (call_script, "script_store_weapon_usage_order_name_to_s1", ":var0", 2),
    (overlay_set_text, "$g_presentation_cavalry_weapon_usage", s1),
    (try_begin),
      (eq, ":var1", 1),
      (eq, ":var2", 1),
      (eq, ":var3", 1),
      (team_set_order_listener, ":var0", 10),
    (else_try),
      (eq, ":var1", 1),
      (team_set_order_listener, ":var0", 0),
    (else_try),
      (eq, ":var2", 1),
      (team_set_order_listener, ":var0", 1),
    (else_try),
      (eq, ":var3", 1),
      (team_set_order_listener, ":var0", 2),
    (try_end),
    (position_set_y, pos1, 660),
    (position_set_x, pos1, 250),
    (overlay_set_position, "$g_presentation_infantry_movement", pos1),
    (position_set_x, pos1, 400),
    (overlay_set_position, "$g_presentation_infantry_riding", pos1),
    (position_set_x, pos1, 550),
    (overlay_set_position, "$g_presentation_infantry_weapon_usage", pos1),
    (position_set_y, pos1, 620),
    (position_set_x, pos1, 250),
    (overlay_set_position, "$g_presentation_archers_movement", pos1),
    (position_set_x, pos1, 400),
    (overlay_set_position, "$g_presentation_archers_riding", pos1),
    (position_set_x, pos1, 550),
    (overlay_set_position, "$g_presentation_archers_weapon_usage", pos1),
    (position_set_y, pos1, 580),
    (position_set_x, pos1, 250),
    (overlay_set_position, "$g_presentation_cavalry_movement", pos1),
    (position_set_x, pos1, 400),
    (overlay_set_position, "$g_presentation_cavalry_riding", pos1),
    (position_set_x, pos1, 550),
    (overlay_set_position, "$g_presentation_cavalry_weapon_usage", pos1),
  ]),

  ("update_agent_position_on_map",
  [
    (store_script_param_1, ":var0"),
    (agent_get_slot, ":var1", ":var0", 10),
    (get_player_agent_no, ":var2"),
    (try_begin),
      (le, ":var1", 0),
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (eq, ":var0", ":var2"),
        (create_mesh_overlay, reg1, "mesh_player_dot"),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 500),
        (overlay_set_size, reg1, pos1),
      (else_try),
        (create_mesh_overlay, reg1, "mesh_white_dot"),
        (position_set_x, pos1, 200),
        (position_set_y, pos1, 200),
        (overlay_set_size, reg1, pos1),
      (try_end),
      (overlay_set_alpha, reg1, 0x88),
      (agent_set_slot, ":var0", 10, reg1),
      (assign, ":var1", reg1),
    (try_end),
    (try_begin),
      (neq, ":var0", ":var2"),
      (agent_get_party_id, ":var3", ":var0"),
      (try_begin),
        (eq, ":var3", "p_main_party"),
        (agent_get_class, ":var4", ":var0"),
        (try_begin),
          (eq, ":var4", 1),
          (overlay_set_color, ":var1", 3458788),
        (else_try),
          (eq, ":var4", 2),
          (overlay_set_color, ":var1", 5674521),
        (else_try),
          (overlay_set_color, ":var1", 9261600),
        (try_end),
      (else_try),
        (agent_is_ally, ":var0"),
        (overlay_set_color, ":var1", 5592575),
      (else_try),
        (overlay_set_color, ":var1", 16711680),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var0", ":var2"),
      (agent_get_look_position, pos1, ":var0"),
      (position_get_rotation_around_z, ":var5", pos1),
      (init_position, pos10),
      (position_rotate_z, pos10, ":var5"),
      (overlay_set_mesh_rotation, ":var1", pos10),
      (call_script, "script_convert_3d_pos_to_map_pos"),
    (else_try),
      (agent_get_position, pos1, ":var0"),
      (call_script, "script_convert_3d_pos_to_map_pos"),
    (try_end),
    (overlay_set_position, ":var1", pos0),
  ]),

  ("convert_3d_pos_to_map_pos",
  [
    (set_fixed_point_multiplier, 1000),
    (position_transform_position_to_local, pos3, pos2, pos1),
    (position_get_x, ":var0", pos3),
    (position_get_y, ":var1", pos3),
    (val_div, ":var0", "$g_battle_map_scale"),
    (val_div, ":var1", "$g_battle_map_scale"),
    (set_fixed_point_multiplier, 1000),
    (store_sub, ":var2", 980, "$g_battle_map_width"),
    (store_sub, ":var3", 730, "$g_battle_map_height"),
    (val_add, ":var0", ":var2"),
    (val_add, ":var1", ":var3"),
    (position_set_x, pos0, ":var0"),
    (position_set_y, pos0, ":var1"),
  ]),

  ("update_order_flags_on_map",
  [
    (set_fixed_point_multiplier, 1000),
    (get_player_agent_no, ":var0"),
    (agent_get_team, ":var1", ":var0"),
    (assign, ":var2", 0),
    (try_begin),
      (class_is_listening_order, ":var1", 0),
      (assign, ":var2", 1),
    (try_end),
    (assign, ":var3", 0),
    (try_begin),
      (class_is_listening_order, ":var1", 1),
      (assign, ":var3", 1),
    (try_end),
    (assign, ":var4", 0),
    (try_begin),
      (class_is_listening_order, ":var1", 2),
      (assign, ":var4", 1),
    (try_end),
    (get_scene_boundaries, pos2, pos3),
    (team_get_movement_order, ":var5", ":var1", 0),
    (try_begin),
      (eq, ":var5", 0),
      (team_get_order_position, pos1, ":var1", 0),
      (call_script, "script_convert_3d_pos_to_map_pos"),
      (overlay_set_alpha, "$g_battle_map_infantry_order_flag", 0xFF),
      (overlay_set_position, "$g_battle_map_infantry_order_flag", pos0),
    (else_try),
      (overlay_set_alpha, "$g_battle_map_infantry_order_flag", 0x00),
    (try_end),
    (team_get_movement_order, ":var5", ":var1", 1),
    (try_begin),
      (eq, ":var5", 0),
      (team_get_order_position, pos1, ":var1", 1),
      (call_script, "script_convert_3d_pos_to_map_pos"),
      (overlay_set_alpha, "$g_battle_map_archers_order_flag", 0xFF),
      (overlay_set_position, "$g_battle_map_archers_order_flag", pos0),
    (else_try),
      (overlay_set_alpha, "$g_battle_map_archers_order_flag", 0x00),
    (try_end),
    (team_get_movement_order, ":var5", ":var1", 2),
    (try_begin),
      (eq, ":var5", 0),
      (team_get_order_position, pos1, ":var1", 2),
      (call_script, "script_convert_3d_pos_to_map_pos"),
      (overlay_set_alpha, "$g_battle_map_cavalry_order_flag", 0xFF),
      (overlay_set_position, "$g_battle_map_cavalry_order_flag", pos0),
    (else_try),
      (overlay_set_alpha, "$g_battle_map_cavalry_order_flag", 0x00),
    (try_end),
    (try_begin),
      (eq, ":var2", 1),
      (eq, ":var3", 1),
      (eq, ":var4", 1),
      (team_set_order_listener, ":var1", 10),
    (else_try),
      (eq, ":var2", 1),
      (team_set_order_listener, ":var1", 0),
    (else_try),
      (eq, ":var3", 1),
      (team_set_order_listener, ":var1", 1),
    (else_try),
      (eq, ":var4", 1),
      (team_set_order_listener, ":var1", 2),
    (try_end),
  ]),

  ("update_order_panel_checked_classes",
  [
    (get_player_agent_no, ":var0"),
    (agent_get_team, ":var1", ":var0"),
    (try_begin),
      (class_is_listening_order, ":var1", 0),
      (overlay_set_val, "$g_presentation_obj_4", 1),
      (assign, "$g_formation_infantry_selected", 1),
      (overlay_animate_to_alpha, "$g_presentation_obj_1", 250, 68),
    (else_try),
      (overlay_set_val, "$g_presentation_obj_4", 0),
      (assign, "$g_formation_infantry_selected", 0),
      (overlay_animate_to_alpha, "$g_presentation_obj_1", 250, 0),
    (try_end),
    (try_begin),
      (class_is_listening_order, ":var1", 1),
      (overlay_set_val, "$g_presentation_obj_5", 1),
      (assign, "$g_formation_archers_selected", 1),
      (overlay_animate_to_alpha, "$g_presentation_obj_2", 250, 68),
    (else_try),
      (overlay_set_val, "$g_presentation_obj_5", 0),
      (assign, "$g_formation_archers_selected", 0),
      (overlay_animate_to_alpha, "$g_presentation_obj_2", 250, 0),
    (try_end),
    (try_begin),
      (class_is_listening_order, ":var1", 2),
      (overlay_set_val, "$g_presentation_obj_6", 1),
      (assign, "$g_formation_cavalry_selected", 1),
      (overlay_animate_to_alpha, "$g_presentation_obj_3", 250, 68),
    (else_try),
      (overlay_set_val, "$g_presentation_obj_6", 0),
      (assign, "$g_formation_cavalry_selected", 0),
      (overlay_animate_to_alpha, "$g_presentation_obj_3", 250, 0),
    (try_end),
  ]),

  ("update_order_panel_statistics_and_map",
  [
    (set_fixed_point_multiplier, 1000),
    (assign, ":var0", 0),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 0),
    (assign, ":var5", 0),
    (assign, ":var6", 0),
    (assign, ":var7", 0),
    (assign, ":var8", 0),
    (assign, ":var9", 0),
    (assign, ":var10", 0),
    (assign, ":var11", 0),
    (assign, ":var12", 0),
    (assign, ":var13", 0),
    (assign, ":var14", 0),
    (get_player_agent_no, ":var15"),
    (agent_get_team, ":var16", ":var15"),
    (assign, ":var17", 0),
    (try_begin),
      (class_is_listening_order, ":var16", 0),
      (assign, ":var17", 1),
    (try_end),
    (assign, ":var18", 0),
    (try_begin),
      (class_is_listening_order, ":var16", 1),
      (assign, ":var18", 1),
    (try_end),
    (assign, ":var19", 0),
    (try_begin),
      (class_is_listening_order, ":var16", 2),
      (assign, ":var19", 1),
    (try_end),
    (get_scene_boundaries, pos2, pos3),
    (try_for_agents, ":var20"),
      (agent_is_human, ":var20"),
      (agent_get_class, ":var21", ":var20"),
      (agent_get_party_id, ":var22", ":var20"),
      (agent_get_slot, ":var23", ":var20", 10),
      (try_begin),
        (eq, ":var22", "p_main_party"),
        (try_begin),
          (agent_is_alive, ":var20"),
          (call_script, "script_update_agent_position_on_map", ":var20"),
          (try_begin),
            (eq, ":var21", 1),
            (val_add, ":var1", 1),
          (else_try),
            (eq, ":var21", 2),
            (val_add, ":var2", 1),
          (else_try),
            (val_add, ":var0", 1),
          (try_end),
        (else_try),
          (overlay_set_alpha, ":var23", 0x00),
          (agent_is_wounded, ":var20"),
          (try_begin),
            (eq, ":var21", 1),
            (val_add, ":var4", 1),
          (else_try),
            (eq, ":var21", 2),
            (val_add, ":var5", 1),
          (else_try),
            (val_add, ":var3", 1),
          (try_end),
        (else_try),
          (try_begin),
            (eq, ":var21", 1),
            (val_add, ":var7", 1),
          (else_try),
            (eq, ":var21", 2),
            (val_add, ":var8", 1),
          (else_try),
            (val_add, ":var6", 1),
          (try_end),
        (try_end),
      (else_try),
        (agent_is_ally, ":var20"),
        (try_begin),
          (agent_is_alive, ":var20"),
          (call_script, "script_update_agent_position_on_map", ":var20"),
          (val_add, ":var9", 1),
        (else_try),
          (overlay_set_alpha, ":var23", 0x00),
          (agent_is_wounded, ":var20"),
          (val_add, ":var10", 1),
        (else_try),
          (val_add, ":var11", 1),
        (try_end),
      (else_try),
        (try_begin),
          (agent_is_alive, ":var20"),
          (call_script, "script_update_agent_position_on_map", ":var20"),
          (val_add, ":var12", 1),
        (else_try),
          (overlay_set_alpha, ":var23", 0x00),
          (agent_is_wounded, ":var20"),
          (val_add, ":var13", 1),
        (else_try),
          (val_add, ":var14", 1),
        (try_end),
      (try_end),
    (try_end),
    (assign, reg1, ":var0"),
    (assign, reg2, ":var1"),
    (assign, reg3, ":var2"),
    (store_add, ":var24", ":var0", ":var1"),
    (val_add, ":var24", ":var2"),
    (store_add, ":var25", ":var3", ":var4"),
    (val_add, ":var25", ":var5"),
    (store_add, ":var26", ":var6", ":var7"),
    (val_add, ":var26", ":var8"),
    (assign, reg4, ":var24"),
    (assign, reg5, ":var25"),
    (assign, reg6, ":var26"),
    (assign, reg7, ":var9"),
    (assign, reg8, ":var10"),
    (assign, reg9, ":var11"),
    (assign, reg10, ":var12"),
    (assign, reg11, ":var13"),
    (assign, reg12, ":var14"),
    (overlay_set_text, "$g_presentation_obj_7", "@Infantry ({reg1})"),
    (overlay_set_text, "$g_presentation_obj_8", "@Archers ({reg2})"),
    (overlay_set_text, "$g_presentation_obj_9", "@Cavalry ({reg3})"),
    (overlay_set_text, "$g_battle_us_ready", "@{reg4}"),
    (overlay_set_text, "$g_battle_us_wounded", "@{reg5}"),
    (overlay_set_text, "$g_battle_us_dead", "@{reg6}"),
    (overlay_set_text, "$g_battle_allies_ready", "@{reg7}"),
    (overlay_set_text, "$g_battle_allies_wounded", "@{reg8}"),
    (overlay_set_text, "$g_battle_allies_dead", "@{reg9}"),
    (overlay_set_text, "$g_battle_enemies_ready", "@{reg10}"),
    (overlay_set_text, "$g_battle_enemies_wounded", "@{reg11}"),
    (overlay_set_text, "$g_battle_enemies_dead", "@{reg12}"),
    (assign, ":var27", 100),
    (assign, ":var28", 100),
    (val_add, ":var27", 150),
    (val_add, ":var28", 80),
    (position_set_x, pos1, ":var27"),
    (position_set_y, pos1, ":var28"),
    (overlay_set_position, "$g_battle_us_ready", pos1),
    (val_add, ":var27", 150),
    (position_set_x, pos1, ":var27"),
    (overlay_set_position, "$g_battle_us_wounded", pos1),
    (val_add, ":var27", 150),
    (position_set_x, pos1, ":var27"),
    (overlay_set_position, "$g_battle_us_dead", pos1),
    (val_add, ":var27", -300),
    (val_add, ":var28", -40),
    (position_set_x, pos1, ":var27"),
    (position_set_y, pos1, ":var28"),
    (overlay_set_position, "$g_battle_allies_ready", pos1),
    (val_add, ":var27", 150),
    (position_set_x, pos1, ":var27"),
    (overlay_set_position, "$g_battle_allies_wounded", pos1),
    (val_add, ":var27", 150),
    (position_set_x, pos1, ":var27"),
    (overlay_set_position, "$g_battle_allies_dead", pos1),
    (val_add, ":var27", -300),
    (val_add, ":var28", -40),
    (position_set_x, pos1, ":var27"),
    (position_set_y, pos1, ":var28"),
    (overlay_set_position, "$g_battle_enemies_ready", pos1),
    (val_add, ":var27", 150),
    (position_set_x, pos1, ":var27"),
    (overlay_set_position, "$g_battle_enemies_wounded", pos1),
    (val_add, ":var27", 150),
    (position_set_x, pos1, ":var27"),
    (overlay_set_position, "$g_battle_enemies_dead", pos1),
    (call_script, "script_update_order_flags_on_map"),
    (try_begin),
      (eq, ":var17", 1),
      (eq, ":var18", 1),
      (eq, ":var19", 1),
      (team_set_order_listener, ":var16", 10),
    (else_try),
      (eq, ":var17", 1),
      (team_set_order_listener, ":var16", 0),
    (else_try),
      (eq, ":var18", 1),
      (team_set_order_listener, ":var16", 1),
    (else_try),
      (eq, ":var19", 1),
      (team_set_order_listener, ":var16", 2),
    (try_end),
  ]),

  ("consume_food",
  [
    (store_script_param, ":var0", 1),
    (troop_get_inventory_capacity, ":var1", "trp_player"),
    (try_for_range, ":var2", 0, ":var1"),
      (troop_get_inventory_slot, ":var3", "trp_player", ":var2"),
      (is_between, ":var3", "itm_smoked_fish", "itm_wine"),
      (troop_get_inventory_slot_modifier, ":var4", "trp_player", ":var2"),
      (neq, ":var4", 41),
      (item_slot_eq, ":var3", 0, 0),
      (item_set_slot, ":var3", 0, 1),
      (val_sub, ":var0", 1),
      (lt, ":var0", 0),
      (assign, ":var1", 0),
      (troop_inventory_slot_get_item_amount, ":var5", "trp_player", ":var2"),
      (val_sub, ":var5", 1),
      (troop_inventory_slot_set_item_amount, "trp_player", ":var2", ":var5"),
    (try_end),
  ]),

  ("calculate_troop_score_for_center",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 1),
    (try_for_range, ":var3", "p_town_1", "p_salt_mine"),
      (assign, ":var4", 0),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (party_slot_eq, ":var3", 7, -2),
        (assign, ":var4", 1),
      (try_end),
      (this_or_next|party_slot_eq, ":var3", 7, ":var0"),
      (eq, ":var4", 1),
      (try_begin),
        (party_slot_eq, ":var3", 0, 3),
        (val_add, ":var2", 4),
      (else_try),
        (party_slot_eq, ":var3", 0, 2),
        (val_add, ":var2", 2),
      (else_try),
        (val_add, ":var2", 1),
      (try_end),
    (try_end),
    (troop_get_slot, ":var5", ":var0", 7),
    (store_add, ":var6", 500, ":var5"),
    (val_div, ":var6", ":var2"),
    (store_random_in_range, ":var7", 50, 100),
    (val_mul, ":var6", ":var7"),
    (try_begin),
      (party_slot_eq, ":var1", 28, ":var0"),
      (val_mul, ":var6", 3),
      (val_div, ":var6", 2),
    (try_end),
    (try_begin),
      (eq, ":var0", "trp_player"),
      (faction_get_slot, ":var8", "$players_kingdom"),
      (call_script, "script_troop_get_player_relation", ":var8"),
      (assign, ":var9", reg0),
      (val_mul, ":var9", 2),
      (val_add, ":var6", ":var9"),
    (try_end),
    (assign, reg0, ":var6"),
  ]),

  ("assign_lords_to_empty_centers",
  [
    (try_for_range, ":var0", "p_town_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 7),
      (this_or_next|eq, ":var1", -1),
      (eq, ":var1", -3),
      (store_faction_of_party, ":var2", ":var0"),
      (is_between, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neg|faction_slot_eq, ":var2", 10, "trp_player"),
      (assign, ":var3", -1),
      (assign, ":var4", -1),
      (try_begin),
        (eq, ":var1", -1),
        (try_begin),
          (eq, "$players_kingdom", ":var2"),
          (eq, "$player_has_homage", 1),
          (assign, ":var3", -2),
          (call_script, "script_calculate_troop_score_for_center", "trp_player", ":var0"),
          (assign, ":var4", reg0),
        (try_end),
      (try_end),
      (try_for_range, ":var5", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var5", 2, 2),
        (store_troop_faction, ":var6", ":var5"),
        (eq, ":var6", ":var2"),
        (call_script, "script_calculate_troop_score_for_center", ":var5", ":var0"),
        (assign, ":var7", reg0),
        (gt, ":var7", ":var4"),
        (assign, ":var4", ":var7"),
        (assign, ":var3", ":var5"),
      (try_end),
      (try_begin),
        (ge, ":var3", 0),
        (call_script, "script_give_center_to_lord", ":var0", ":var3", 1),
      (else_try),
        (eq, ":var3", -2),
        (party_set_slot, ":var0", 7, -2),
        (try_begin),
          (party_slot_eq, ":var0", 0, 2),
          (try_for_range, ":var8", "p_village_1", "p_salt_mine"),
            (party_slot_eq, ":var8", 120, ":var0"),
            (party_set_slot, ":var8", 7, -2),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("create_village_farmer_party",
  [
    (store_script_param, ":var0", 1),
    (party_get_slot, ":var1", ":var0", 121),
    (store_faction_of_party, ":var2", ":var1"),
    (set_spawn_radius, 0),
    (spawn_around_party, ":var0", "pt_village_farmers"),
    (assign, ":var3", reg0),
    (party_set_faction, ":var3", ":var2"),
    (party_set_slot, ":var3", 123, ":var0"),
    (party_set_slot, ":var3", 0, 15),
    (party_set_slot, ":var3", 4, 13),
    (party_set_slot, ":var3", 5, ":var1"),
    (party_set_ai_behavior, ":var3", ai_bhvr_travel_to_party),
    (party_set_ai_object, ":var3", ":var1"),
    (party_set_flags, ":var3", 65536, 0),
    (store_sub, ":var4", 234, "itm_smoked_fish"),
    (try_for_range, ":var5", "itm_smoked_fish", "itm_gold_bar"),
      (store_add, ":var6", ":var5", ":var4"),
      (party_get_slot, ":var7", ":var0", ":var6"),
      (party_set_slot, ":var3", ":var6", ":var7"),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("do_party_center_trade",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (assign, ":var3", 0),
    (store_sub, ":var4", 234, "itm_smoked_fish"),
    (try_for_range, ":var5", "itm_smoked_fish", "itm_gold_bar"),
      (store_add, ":var6", ":var5", ":var4"),
      (party_get_slot, ":var7", ":var0", ":var6"),
      (party_get_slot, ":var8", ":var1", ":var6"),
      (store_sub, ":var9", ":var7", ":var8"),
      (assign, ":var10", ":var9"),
      (val_abs, ":var10"),
      (val_add, ":var3", ":var10"),
      (val_mul, ":var10", ":var2"),
      (val_div, ":var10", 100),
      (try_begin),
        (lt, ":var9", 0),
        (val_mul, ":var10", -1),
      (try_end),
      (val_add, ":var8", ":var10"),
      (party_set_slot, ":var1", ":var6", ":var8"),
      (party_set_slot, ":var0", ":var6", ":var8"),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("player_join_faction",
  [
    (store_script_param, ":var0", 1),
    (assign, "$players_kingdom", ":var0"),
    (faction_set_slot, "fac_player_supporters_faction", 4, 0),
    (assign, "$players_oath_renounced_against_kingdom", 0),
    (assign, "$players_oath_renounced_given_center", 0),
    (assign, "$players_oath_renounced_begin_time", 0),
    (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var1", 21, 0),
      (neq, ":var1", "fac_player_supporters_faction"),
      (try_begin),
        (neq, ":var1", ":var0"),
        (store_relation, ":var2", ":var1", ":var0"),
      (else_try),
        (store_relation, ":var2", "fac_player_supporters_faction", ":var1"),
        (val_max, ":var2", 12),
      (try_end),
      (call_script, "script_set_player_relation_with_faction", ":var1", ":var2"),
    (try_end),
    (try_for_range, ":var3", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var3", 7, "trp_player"),
      (party_set_faction, ":var3", ":var0"),
    (try_end),
    (try_for_range, ":var4", "qst_deliver_message", "qst_follow_army"),
      (check_quest_active, ":var4"),
      (quest_get_slot, ":var5", ":var4", 6),
      (store_troop_faction, ":var6", ":var5"),
      (store_relation, ":var7", "fac_player_supporters_faction", ":var6"),
      (lt, ":var7", 0),
      (call_script, "script_abort_quest", ":var4", 0),
    (try_end),
    (try_begin),
      (neq, ":var0", "fac_player_supporters_faction"),
      (faction_set_slot, "fac_player_supporters_faction", 21, 2),
      (faction_set_slot, "fac_player_supporters_faction", 10, "trp_player"),
    (try_end),
    (call_script, "script_store_average_center_value_per_faction"),
    (call_script, "script_update_all_notes"),
    (assign, "$g_recalculate_ais", 1),
  ]),

  ("player_leave_faction",
  [
    (store_script_param, ":var0", 1),
    (call_script, "script_check_and_finish_active_army_quests_for_faction", "$players_kingdom"),
    (assign, ":var1", "$players_kingdom"),
    (assign, ":var2", "$player_has_homage"),
    (assign, "$players_kingdom", 0),
    (assign, "$player_has_homage", 0),
    (try_begin),
      (neq, ":var0", 0),
      (try_for_range, ":var3", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var3", 7, "trp_player"),
        (call_script, "script_give_center_to_faction", ":var3", ":var1"),
      (try_end),
    (else_try),
      (try_for_range, ":var3", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var3", 7, "trp_player"),
        (call_script, "script_give_center_to_faction", ":var3", "fac_player_supporters_faction"),
      (try_end),
      (try_for_range, ":var3", "p_village_1", "p_salt_mine"),
        (party_get_slot, ":var4", ":var3", 120),
        (party_slot_eq, ":var3", 7, "trp_player"),
        (neg|party_slot_eq, ":var4", 7, "trp_player"),
        (call_script, "script_give_center_to_faction", ":var3", ":var1"),
      (try_end),
      (store_relation, ":var5", "fac_player_supporters_faction", ":var1"),
      (store_sub, ":var6", -40, ":var5"),
      (call_script, "script_change_player_relation_with_faction", ":var1", ":var6"),
    (try_end),
    (try_begin),
      (eq, ":var2", 1),
      (faction_get_slot, ":var7", ":var1", 10),
      (call_script, "script_change_player_relation_with_troop", ":var7", -20),
    (try_end),
    (call_script, "script_update_all_notes"),
    (assign, "$g_recalculate_ais", 1),
  ]),

  ("activate_deactivate_player_faction",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var3", ":var2"),
        (eq, ":var3", "fac_player_supporters_faction"),
        (assign, ":var1", 1),
      (try_end),
      (try_begin),
        (eq, ":var1", 1),
        (neg|faction_slot_eq, "fac_player_supporters_faction", 21, 0),
        (faction_set_slot, "fac_player_supporters_faction", 21, 0),
        (faction_set_slot, "fac_player_supporters_faction", 10, "trp_player"),
        (faction_set_slot, "fac_player_supporters_faction", 100, 1),
        (str_store_faction_name, s1, ":var0"),
        (faction_set_name, "fac_player_supporters_faction", "@{s1} Rebels"),
        (faction_set_color, "fac_player_supporters_faction", 11184810),
        (assign, "$players_kingdom", "fac_player_supporters_faction"),
        (assign, "$g_player_banner_granted", 1),
        (call_script, "script_store_average_center_value_per_faction"),
        (call_script, "script_update_all_notes"),
        (call_script, "script_add_notification_menu", "mnu_notification_player_faction_active", 0, 0),
      (else_try),
        (eq, ":var1", 0),
        (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
        (le, "$supported_pretender", 0),
        (faction_set_slot, "fac_player_supporters_faction", 21, 2),
        (faction_set_slot, "fac_player_supporters_faction", 10, "trp_player"),
        (assign, "$players_kingdom", 0),
        (assign, "$players_oath_renounced_against_kingdom", 0),
        (assign, "$players_oath_renounced_given_center", 0),
        (assign, "$players_oath_renounced_begin_time", 0),
        (call_script, "script_store_average_center_value_per_faction"),
        (call_script, "script_update_all_notes"),
        (call_script, "script_add_notification_menu", "mnu_notification_player_faction_deactive", 0, 0),
      (try_end),
    (try_end),
  ]),

  ("agent_reassign_team",
  [
    (store_script_param, ":var0", 1),
    (get_player_agent_no, ":var1"),
    (try_begin),
      (ge, ":var1", 0),
      (agent_is_human, ":var0"),
      (agent_is_ally, ":var0"),
      (agent_get_party_id, ":var2", ":var0"),
      (neq, ":var2", "p_main_party"),
      (assign, ":var3", 1),
      (store_faction_of_party, ":var4", ":var2"),
      (try_begin),
        (eq, ":var4", "$players_kingdom"),
        (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, "$players_kingdom", 7, "trp_player"),
        (assign, ":var3", 0),
      (else_try),
        (party_stack_get_troop_id, ":var5", ":var2", 0),
        (neg|is_between, ":var5", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (assign, ":var3", 0),
      (try_end),
      (eq, ":var3", 1),
      (agent_get_team, ":var6", ":var1"),
      (val_add, ":var6", 2),
      (agent_set_team, ":var0", ":var6"),
    (try_end),
  ]),

  ("start_quest",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (try_begin),
      (is_between, ":var1", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (str_store_troop_name_link, s62, ":var1"),
    (else_try),
      (str_store_troop_name, s62, ":var1"),
    (try_end),
    (str_store_string, s63, "@Given by: {s62}"),
    (store_current_hours, ":var2"),
    (str_store_date, s60, ":var2"),
    (str_store_string, s60, "@Given on: {s60}"),
    (add_quest_note_from_sreg, ":var0", 0, s60, 0),
    (add_quest_note_from_sreg, ":var0", 1, s63, 0),
    (add_quest_note_from_sreg, ":var0", 2, s2, 0),
    (try_begin),
      (quest_slot_ge, ":var0", 23, 1),
      (quest_get_slot, reg0, ":var0", 23),
      (add_quest_note_from_sreg, ":var0", 7, "@You have {reg0} days to finish this quest.", 0),
    (try_end),
    (try_begin),
      (quest_slot_ge, ":var0", 24, 1),
      (quest_get_slot, ":var3", ":var0", 24),
      (quest_set_slot, ":var0", 25, ":var3"),
    (try_end),
    (start_quest, ":var0", ":var1"),
    (display_message, "str_quest_log_updated"),
  ]),

  ("conclude_quest",
  [
    (store_script_param, ":var0", 1),
    (conclude_quest, ":var0"),
    (quest_get_slot, ":var1", ":var0", 6),
    (str_store_troop_name, s59, ":var1"),
    (add_quest_note_from_sreg, ":var0", 7, "@This quest has been concluded. Talk to {s59} to finish it.", 0),
  ]),

  ("succeed_quest",
  [
    (store_script_param, ":var0", 1),
    (succeed_quest, ":var0"),
    (quest_get_slot, ":var1", ":var0", 6),
    (str_store_troop_name, s59, ":var1"),
    (add_quest_note_from_sreg, ":var0", 7, "@This quest has been successfully completed. Talk to {s59} to claim your reward.", 0),
  ]),

  ("fail_quest",
  [
    (store_script_param, ":var0", 1),
    (fail_quest, ":var0"),
    (quest_get_slot, ":var1", ":var0", 6),
    (str_store_troop_name, s59, ":var1"),
    (add_quest_note_from_sreg, ":var0", 7, "@This quest has failed. Talk to {s59} to explain the situation.", 0),
  ]),

  ("report_quest_troop_positions",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (call_script, "script_get_information_about_troops_position", ":var1", 1),
    (str_store_string, s5, "@At the time quest was given:^{s1}"),
    (add_quest_note_from_sreg, ":var0", ":var2", s5, 1),
    (call_script, "script_update_troop_location_notes", ":var1", 1),
  ]),

  ("end_quest",
  [
    (store_script_param, ":var0", 1),
    (str_clear, s1),
    (add_quest_note_from_sreg, ":var0", 0, s1, 0),
    (add_quest_note_from_sreg, ":var0", 1, s1, 0),
    (add_quest_note_from_sreg, ":var0", 2, s1, 0),
    (add_quest_note_from_sreg, ":var0", 3, s1, 0),
    (add_quest_note_from_sreg, ":var0", 4, s1, 0),
    (add_quest_note_from_sreg, ":var0", 5, s1, 0),
    (add_quest_note_from_sreg, ":var0", 6, s1, 0),
    (add_quest_note_from_sreg, ":var0", 7, s1, 0),
    (try_begin),
      (neg|check_quest_failed, ":var0"),
      (val_add, "$g_total_quests_completed", 1),
    (try_end),
    (complete_quest, ":var0"),
    (try_begin),
      (is_between, ":var0", "qst_move_cattle_herd", "qst_deliver_grain"),
      (assign, "$merchant_quest_last_offerer", -1),
      (assign, "$merchant_offered_quest", -1),
    (try_end),
  ]),

  ("cancel_quest",
  [
    (store_script_param, ":var0", 1),
    (str_clear, s1),
    (add_quest_note_from_sreg, ":var0", 0, s1, 0),
    (add_quest_note_from_sreg, ":var0", 1, s1, 0),
    (add_quest_note_from_sreg, ":var0", 2, s1, 0),
    (add_quest_note_from_sreg, ":var0", 3, s1, 0),
    (add_quest_note_from_sreg, ":var0", 4, s1, 0),
    (add_quest_note_from_sreg, ":var0", 5, s1, 0),
    (add_quest_note_from_sreg, ":var0", 6, s1, 0),
    (add_quest_note_from_sreg, ":var0", 7, s1, 0),
    (cancel_quest, ":var0"),
    (try_begin),
      (is_between, ":var0", "qst_move_cattle_herd", "qst_deliver_grain"),
      (assign, "$merchant_quest_last_offerer", -1),
      (assign, "$merchant_offered_quest", -1),
    (try_end),
  ]),

  ("update_village_market_towns",
  [
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (store_faction_of_party, ":var1", ":var0"),
      (assign, ":var2", 999999),
      (assign, ":var3", -1),
      (try_for_range, ":var4", "p_town_1", "p_castle_1"),
        (store_faction_of_party, ":var5", ":var4"),
        (eq, ":var5", ":var1"),
        (store_distance_to_party_from_party, ":var6", ":var0", ":var4"),
        (lt, ":var6", ":var2"),
        (assign, ":var2", ":var6"),
        (assign, ":var3", ":var4"),
      (try_end),
      (gt, ":var3", -1),
      (party_set_slot, ":var0", 121, ":var3"),
    (try_end),
  ]),

  ("update_mercenary_units_of_towns",
  [
    (try_for_range, ":var0", "p_town_1", "p_castle_1"),
      (store_random_in_range, ":var1", "trp_osage_scout", "trp_town_walker_1"),
      (party_set_slot, ":var0", 90, ":var1"),
      (store_random_in_range, ":var2", 3, 8),
      (party_set_slot, ":var0", 91, ":var2"),
    (try_end),
  ]),

  ("update_volunteer_troops_in_village",
  [
    (store_script_param, ":var0", 1),
    (party_get_slot, ":var1", ":var0", 26),
    (party_get_slot, ":var2", ":var0", 19),
    (faction_get_slot, ":var3", ":var2", 41),
    (assign, ":var4", 7),
    (try_begin),
      (ge, ":var1", 5),
      (assign, ":var4", ":var1"),
      (val_div, ":var4", 2),
      (val_add, ":var4", 10),
    (else_try),
      (lt, ":var1", 0),
      (assign, ":var4", 0),
    (try_end),
    (val_mul, ":var4", 2),
    (store_random_in_range, ":var5", 0, ":var4"),
    (party_set_slot, ":var0", 222, ":var3"),
    (party_set_slot, ":var0", 223, ":var5"),
  ]),

  ("update_volunteer_troops_in_towns",
  [
    (store_script_param, ":var0", 1),
    (party_get_slot, ":var1", ":var0", 26),
    (party_get_slot, ":var2", ":var0", 19),
    (faction_get_slot, ":var3", ":var2", 41),
    (assign, ":var4", 1),
    (store_div, ":var5", ":var1", 10),
    (try_for_range, ":var6", 0, ":var5"),
      (store_random_in_range, ":var7", 0, 100),
      (lt, ":var7", 10),
      (store_random_in_range, ":var8", 0, 2),
      (troop_get_upgrade_troop, ":var9", ":var3", ":var8"),
      (try_begin),
        (le, ":var9", 0),
        (troop_get_upgrade_troop, ":var9", ":var3", 0),
      (try_end),
      (gt, ":var9", 0),
      (val_add, ":var4", 1),
      (assign, ":var3", ":var9"),
    (try_end),
    (assign, ":var10", 8),
    (try_begin),
      (ge, ":var1", 5),
      (val_add, ":var10", 18),
      (val_add, ":var10", ":var1"),
      (val_div, ":var10", 2),
    (else_try),
      (lt, ":var1", 0),
      (assign, ":var10", 0),
    (try_end),
    (val_mul, ":var10", 5),
    (store_add, ":var11", 2, ":var4"),
    (val_div, ":var10", ":var11"),
    (store_random_in_range, ":var12", 0, ":var10"),
    (party_set_slot, ":var0", 222, ":var3"),
    (party_set_slot, ":var0", 223, ":var12"),
  ]),

  ("update_volunteer_troops_in_castles",
  [
    (store_script_param, ":var0", 1),
    (store_faction_of_party, ":var1", "$current_town"),
    (store_relation, ":var2", ":var1", "$players_kingdom"),
    (party_get_slot, ":var3", ":var0", 19),
    (faction_get_slot, ":var4", ":var3", 42),
    (assign, ":var5", 1),
    (store_div, ":var6", ":var2", 10),
    (try_for_range, ":var7", 0, ":var6"),
      (store_random_in_range, ":var8", 0, 100),
      (le, ":var8", 15),
      (store_random_in_range, ":var8", 0, 2),
      (troop_get_upgrade_troop, ":var9", ":var4", ":var8"),
      (try_begin),
        (le, ":var9", 0),
        (troop_get_upgrade_troop, ":var9", ":var4", 0),
      (try_end),
      (gt, ":var9", 0),
      (val_add, ":var5", 1),
      (assign, ":var4", ":var9"),
    (try_end),
    (assign, ":var10", 6),
    (try_begin),
      (ge, ":var2", 20),
      (val_add, ":var10", ":var2"),
      (val_div, ":var10", 10),
    (else_try),
      (le, ":var2", 10),
      (assign, ":var10", 0),
    (try_end),
    (val_mul, ":var10", 3),
    (store_add, ":var11", 2, ":var5"),
    (val_div, ":var10", ":var11"),
    (store_random_in_range, ":var12", 0, ":var10"),
    (party_set_slot, ":var0", 222, ":var4"),
    (party_set_slot, ":var0", 223, ":var12"),
  ]),

  ("update_npc_volunteer_troops_in_village",
  [
    (store_script_param, ":var0", 1),
    (party_get_slot, ":var1", ":var0", 19),
    (faction_get_slot, ":var2", ":var1", 41),
    (assign, ":var3", 1),
    (try_for_range, ":var4", 0, 5),
      (store_random_in_range, ":var5", 0, 100),
      (lt, ":var5", 10),
      (store_random_in_range, ":var5", 0, 2),
      (troop_get_upgrade_troop, ":var6", ":var2", ":var5"),
      (try_begin),
        (le, ":var6", 0),
        (troop_get_upgrade_troop, ":var6", ":var2", 0),
      (try_end),
      (gt, ":var6", 0),
      (val_add, ":var3", 1),
      (assign, ":var2", ":var6"),
    (try_end),
    (assign, ":var7", 12),
    (store_add, ":var8", 2, ":var3"),
    (val_div, ":var7", ":var8"),
    (store_random_in_range, ":var9", 0, ":var7"),
    (party_set_slot, ":var0", 90, ":var2"),
    (party_set_slot, ":var0", 91, ":var9"),
  ]),

  ("update_companion_candidates_in_taverns",
  [
    (try_for_range, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
      (troop_set_slot, ":var0", 12, -1),
      (troop_slot_eq, ":var0", 2, 0),
      (store_random_in_range, ":var1", "p_town_1", "p_town_1b"),
      (try_begin),
        (neg|troop_slot_eq, ":var0", 60, ":var1"),
        (neg|troop_slot_eq, ":var0", 59, ":var1"),
        (troop_set_slot, ":var0", 12, ":var1"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_troop_name, s4, ":var0"),
          (str_store_party_name, s5, ":var1"),
          (display_message, "@{s4} is in {s5}"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("update_ransom_brokers",
  [
    (try_for_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 95, 0),
    (try_end),
    (try_for_range, ":var1", "trp_ransom_broker_1", "trp_tavern_traveler_1"),
      (store_random_in_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 95, ":var1"),
    (try_end),
  ]),

  ("update_tavern_travelers",
  [
    (try_for_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 96, 0),
    (try_end),
    (try_for_range, ":var1", "trp_tavern_traveler_1", "trp_tavern_bookseller_1"),
      (store_random_in_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 96, ":var1"),
      (assign, ":var2", 15),
      (try_for_range, ":var3", 0, ":var2"),
        (store_random_in_range, ":var4", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var4", 21, 0),
        (neq, ":var4", "$players_kingdom"),
        (neq, ":var4", "fac_player_supporters_faction"),
        (party_set_slot, ":var0", 97, ":var4"),
        (assign, ":var2", 0),
      (try_end),
    (try_end),
  ]),

  ("update_villages_infested_by_bandits",
  [
    (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
      (try_begin),
        (check_quest_active, "qst_eliminate_bandits_infesting_village"),
        (quest_slot_eq, "qst_eliminate_bandits_infesting_village", 1, ":var0"),
        (quest_get_slot, ":var1", "qst_eliminate_bandits_infesting_village", 11),
        (val_add, ":var1", 1),
        (try_begin),
          (lt, ":var1", 3),
          (quest_set_slot, "qst_eliminate_bandits_infesting_village", 11, ":var1"),
        (else_try),
          (party_set_slot, ":var0", 39, 0),
          (call_script, "script_abort_quest", "qst_eliminate_bandits_infesting_village", 2),
        (try_end),
      (else_try),
        (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
        (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", 1, ":var0"),
        (quest_get_slot, ":var1", "qst_deal_with_bandits_at_lords_village", 11),
        (val_add, ":var1", 1),
        (try_begin),
          (lt, ":var1", 3),
          (quest_set_slot, "qst_deal_with_bandits_at_lords_village", 11, ":var1"),
        (else_try),
          (party_set_slot, ":var0", 39, 0),
          (call_script, "script_abort_quest", "qst_deal_with_bandits_at_lords_village", 2),
        (try_end),
      (else_try),
        (party_set_slot, ":var0", 39, 0),
        (neg|troop_slot_eq, "trp_party_type_2", ":var0", 1),
        (store_random_in_range, ":var2", 0, 100),
        (lt, ":var2", 3),
        (store_random_in_range, ":var2", 0, 3),
        (try_begin),
          (eq, ":var2", 0),
          (assign, ":var3", "trp_guacho"),
        (else_try),
          (eq, ":var2", 1),
          (assign, ":var3", "trp_forest_bandit"),
        (else_try),
          (assign, ":var3", "trp_thief"),
        (try_end),
        (party_set_slot, ":var0", 39, ":var3"),
        (call_script, "script_change_center_prosperity", ":var0", -3),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_party_name_link, s1, ":var0"),
          (display_message, "@{s1} is infested by bandits."),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("update_animals_infested_by_bandits",
  [
    (try_for_parties, ":var0"),
      (try_begin),
        (party_set_slot, ":var0", 149, 0),
        (store_random_in_range, ":var1", 0, 100),
        (lt, ":var1", 3),
        (store_random_in_range, ":var1", 0, 3),
        (try_begin),
          (eq, ":var1", 0),
          (assign, ":var2", "trp_comanche_horse_archer"),
        (else_try),
          (eq, ":var1", 1),
          (assign, ":var2", "trp_forest_bandit"),
        (else_try),
          (assign, ":var2", "trp_mountain_bandit"),
        (try_end),
        (party_set_slot, ":var0", 149, ":var2"),
      (try_end),
    (try_end),
  ]),

  ("update_booksellers",
  [
    (try_for_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 98, 0),
    (try_end),
    (try_for_range, ":var1", "trp_tavern_bookseller_1", "trp_tavern_minstrel_1"),
      (store_random_in_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 98, ":var1"),
    (try_end),
  ]),

  ("update_tavern_minstels",
  [
    (try_for_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 99, 0),
    (try_end),
    (try_for_range, ":var1", "trp_tavern_minstrel_1", "trp_npc1"),
      (store_random_in_range, ":var0", "p_town_1", "p_castle_1"),
      (party_set_slot, ":var0", 99, ":var1"),
    (try_end),
  ]),

  ("update_faction_notes",
  [
    (store_script_param, ":var0", 1),
    (call_script, "script_store_faction_description_to_s3", ":var0"),
    (try_begin),
      (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (faction_get_slot, ":var1", ":var0", 10),
      (str_store_faction_name, s5, ":var0"),
      (str_store_troop_name_link, s6, ":var1"),
      (assign, ":var2", 0),
      (str_store_string, s8, "@nowhere"),
      (try_for_range_backwards, ":var3", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":var4", ":var3"),
        (eq, ":var4", ":var0"),
        (try_begin),
          (eq, ":var2", 0),
          (str_store_party_name_link, s8, ":var3"),
        (else_try),
          (eq, ":var2", 1),
          (str_store_party_name_link, s7, ":var3"),
          (str_store_string, s8, "@{s7} and {s8}"),
        (else_try),
          (str_store_party_name_link, s7, ":var3"),
          (str_store_string, s8, "@{s7}, {s8}"),
        (try_end),
        (val_add, ":var2", 1),
      (try_end),
      (assign, ":var5", 0),
      (str_store_string, s10, "@noone"),
      (try_for_range_backwards, ":var6", "trp_kingdom_heroes_including_player_begin", "trp_knight_1_1_wife"),
        (assign, ":var7", ":var6"),
        (try_begin),
          (eq, ":var6", "trp_kingdom_heroes_including_player_begin"),
          (assign, ":var7", "trp_player"),
          (assign, ":var8", "$players_kingdom"),
        (else_try),
          (store_troop_faction, ":var8", ":var7"),
        (try_end),
        (eq, ":var8", ":var0"),
        (neq, ":var7", ":var1"),
        (troop_slot_eq, ":var7", 2, 2),
        (try_begin),
          (eq, ":var5", 0),
          (str_store_troop_name_link, s10, ":var7"),
        (else_try),
          (eq, ":var5", 1),
          (str_store_troop_name_link, s9, ":var7"),
          (str_store_string, s10, "@{s9} and {s10}"),
        (else_try),
          (str_store_troop_name_link, s9, ":var7"),
          (str_store_string, s10, "@{s9}, {s10}"),
        (try_end),
        (val_add, ":var5", 1),
      (try_end),
      (str_store_string, s12, "@noone"),
      (assign, ":var9", 0),
      (try_for_range_backwards, ":var10", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var10", 21, 0),
        (store_relation, ":var11", ":var10", ":var0"),
        (lt, ":var11", 0),
        (try_begin),
          (eq, ":var9", 0),
          (str_store_faction_name_link, s12, ":var10"),
        (else_try),
          (eq, ":var9", 1),
          (str_store_faction_name_link, s11, ":var10"),
          (str_store_string, s12, "@{s11} and {s12}"),
        (else_try),
          (str_store_faction_name_link, s11, ":var10"),
          (str_store_string, s12, "@{s11}, {s12}"),
        (try_end),
        (val_add, ":var9", 1),
      (try_end),
      (str_store_string, s14, "@noone"),
      (assign, ":var12", 0),
      (try_for_range_backwards, ":var10", "fac_commoners", "fac_special_end"),
        (faction_slot_eq, ":var10", 21, 0),
        (store_relation, ":var11", ":var10", ":var0"),
        (lt, ":var11", 0),
        (try_begin),
          (eq, ":var12", 0),
          (str_store_faction_name_link, s14, ":var10"),
        (else_try),
          (eq, ":var12", 1),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13} and {s14}"),
        (else_try),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13}, {s14}"),
        (try_end),
        (val_add, ":var12", 1),
      (try_end),
      (try_for_range_backwards, ":var10", "fac_confederate_renegades", "fac_minor_end"),
        (faction_slot_eq, ":var10", 21, 0),
        (store_relation, ":var11", ":var10", ":var0"),
        (lt, ":var11", 0),
        (try_begin),
          (eq, ":var12", 0),
          (str_store_faction_name_link, s14, ":var10"),
        (else_try),
          (eq, ":var12", 1),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13} and {s14}"),
        (else_try),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13}, {s14}"),
        (try_end),
        (val_add, ":var12", 1),
      (try_end),
      (add_faction_note_from_sreg, ":var0", 0, "@{s3}^^{s5} is controlled by {s6}.^^It occupies {s8}.^^Its leading members are {s10}.^^{s5} is at war with {s12}.^^{s5} is permanently aligned against {s14}.", 0),
    (else_try),
      (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 1),
      (str_store_faction_name, s5, ":var0"),
      (add_faction_note_from_sreg, ":var0", 0, "@{s3}^^{s5} has been defeated!", 0),
      (str_clear, s1),
      (add_faction_note_from_sreg, ":var0", 1, s1, 0),
    (else_try),
      (this_or_next|is_between, ":var0", "fac_commoners", "fac_special_end"),
      (is_between, ":var0", "fac_confederate_renegades", "fac_minor_end"),
      (str_store_faction_name, s5, ":var0"),
      (assign, ":var13", 0),
      (try_for_range_backwards, ":var10", "fac_commoners", "fac_special_end"),
        (faction_slot_eq, ":var10", 21, 0),
        (store_relation, ":var11", ":var10", ":var0"),
        (lt, ":var11", 0),
        (try_begin),
          (eq, ":var13", 0),
          (str_store_faction_name_link, s14, ":var10"),
        (else_try),
          (eq, ":var13", 1),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13} and {s14}"),
        (else_try),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13}, {s14}"),
        (try_end),
        (val_add, ":var13", 1),
      (try_end),
      (try_for_range_backwards, ":var10", "fac_player_supporters_faction", "fac_minor_end"),
        (faction_slot_eq, ":var10", 21, 0),
        (store_relation, ":var11", ":var10", ":var0"),
        (lt, ":var11", 0),
        (try_begin),
          (eq, ":var13", 0),
          (str_store_faction_name_link, s14, ":var10"),
        (else_try),
          (eq, ":var13", 1),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13} and {s14}"),
        (else_try),
          (str_store_faction_name_link, s13, ":var10"),
          (str_store_string, s14, "@{s13}, {s14}"),
        (try_end),
        (val_add, ":var13", 1),
      (try_end),
      (add_faction_note_from_sreg, ":var0", 0, "@{s3}^^{s5} is permanently aligned against {s14}.", 0),
    (else_try),
      (str_clear, s1),
      (add_faction_note_from_sreg, ":var0", 0, s1, 0),
      (add_faction_note_from_sreg, ":var0", 1, s1, 0),
    (try_end),
    (try_begin),
      (is_between, ":var0", "fac_kingdom_1", "fac_kingdoms_end"),
      (add_faction_note_tableau_mesh, ":var0", "tableau_faction_note_mesh_banner"),
    (else_try),
      (add_faction_note_tableau_mesh, ":var0", "tableau_faction_note_mesh_banner"),
    (try_end),
  ]),

  ("update_faction_traveler_notes",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (try_for_parties, ":var2"),
      (store_faction_of_party, ":var3", ":var2"),
      (eq, ":var3", ":var0"),
      (party_get_num_companions, ":var4", ":var2"),
      (val_add, ":var1", ":var4"),
    (try_end),
    (str_store_faction_name, s5, ":var0"),
    (assign, reg1, ":var1"),
    (add_faction_note_from_sreg, ":var0", 1, "@{s5} has a strength of {reg1} men in total.", 1),
  ]),

  ("update_troop_notes",
  [
    (store_script_param, ":var0", 1),
    (str_store_troop_name, s54, ":var0"),
    (try_begin),
      (eq, ":var0", "trp_player"),
      (this_or_next|eq, "$player_has_homage", 1),
      (eq, "$players_kingdom", "fac_player_supporters_faction"),
      (assign, ":var1", "$players_kingdom"),
    (else_try),
      (store_troop_faction, ":var1", ":var0"),
    (try_end),
    (try_begin),
      (neq, ":var0", "trp_player"),
      (neg|is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (str_clear, s54),
      (add_troop_note_from_sreg, ":var0", 0, s54, 0),
      (add_troop_note_from_sreg, ":var0", 1, s54, 0),
      (add_troop_note_from_sreg, ":var0", 2, s54, 0),
    (else_try),
      (is_between, ":var0", "trp_knight_1_1_wife", "trp_heroes_end"),
      (str_clear, s54),
      (add_troop_note_from_sreg, ":var0", 0, s54, 0),
      (add_troop_note_from_sreg, ":var0", 1, s54, 0),
      (add_troop_note_from_sreg, ":var0", 2, s54, 0),
    (else_try),
      (is_between, ":var0", 0, 0),
      (neg|troop_slot_eq, ":var0", 2, 2),
      (neq, ":var0", "$supported_pretender"),
      (troop_get_slot, ":var2", ":var0", 14),
      (try_begin),
        (faction_slot_eq, ":var2", 21, 0),
        (faction_slot_eq, ":var2", 60, 1),
        (str_store_faction_name_link, s56, ":var2"),
        (add_troop_note_from_sreg, ":var0", 0, "@{s54} is a claimant to the throne of {s56}.", 0),
        (add_troop_note_tableau_mesh, ":var0", "tableau_troop_note_mesh"),
      (else_try),
        (str_clear, s54),
        (add_troop_note_from_sreg, ":var0", 0, s54, 0),
        (add_troop_note_from_sreg, ":var0", 1, s54, 0),
        (add_troop_note_from_sreg, ":var0", 2, s54, 0),
      (try_end),
    (else_try),
      (faction_get_slot, ":var3", ":var1", 10),
      (str_store_troop_name_link, s55, ":var3"),
      (str_store_faction_name_link, s56, ":var1"),
      (assign, reg4, 0),
      (assign, reg6, 0),
      (try_begin),
        (eq, ":var1", "fac_player_faction"),
        (assign, reg6, 1),
      (else_try),
        (eq, ":var3", ":var0"),
        (assign, reg4, 1),
      (try_end),
      (assign, ":var4", 0),
      (str_store_string, s58, "@nowhere"),
      (try_for_range_backwards, ":var5", "p_town_1", "p_salt_mine"),
        (party_slot_eq, ":var5", 7, ":var0"),
        (try_begin),
          (eq, ":var4", 0),
          (str_store_party_name_link, s58, ":var5"),
        (else_try),
          (eq, ":var4", 1),
          (str_store_party_name_link, s57, ":var5"),
          (str_store_string, s58, "@{s57} and {s58}"),
        (else_try),
          (str_store_party_name_link, s57, ":var5"),
          (str_store_string, s58, "@{s57}, {s58}"),
        (try_end),
        (val_add, ":var4", 1),
      (try_end),
      (troop_get_type, reg3, ":var0"),
      (call_script, "script_troop_get_gender_to_reg18", ":var0"),
      (troop_get_slot, reg5, ":var0", 7),
      (str_clear, s59),
      (try_begin),
        (call_script, "script_troop_get_player_relation", ":var0"),
        (assign, ":var6", reg0),
        (store_add, ":var7", ":var6", 100),
        (val_add, ":var7", 5),
        (store_div, ":var8", ":var7", 10),
        (val_clamp, ":var8", 0, 20),
        (store_add, ":var9", "str_relation_mnus_100_ns", ":var8"),
        (neq, ":var9", "str_relation_plus_0_ns"),
        (str_store_string, s60, "@{reg18?She:He}"),
        (str_store_string, s59, ":var9"),
        (str_store_string, s59, "@^{s59}"),
      (try_end),
      (assign, reg9, ":var4"),
      (add_troop_note_from_sreg, ":var0", 0, "@{reg6?:{reg4?{s54} is the ruler of {s56}.^:{s54} is a vassal of {s55} of {s56}.^}}Renown: {reg5}.^{reg9?{reg18?She:He} is the {reg18?lady:master} of {s58}.:{reg18?She:He} has no fiefs.}{s59}", 0),
      (add_troop_note_tableau_mesh, ":var0", "tableau_troop_note_mesh"),
    (try_end),
  ]),

  ("update_troop_location_notes",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (call_script, "script_get_information_about_troops_position", ":var0", 1),
    (try_begin),
      (neq, reg0, 0),
      (troop_get_type, reg1, ":var0"),
      (call_script, "script_troop_get_gender_to_reg18", ":var0"),
      (try_begin),
        (eq, ":var1", 0),
        (add_troop_note_from_sreg, ":var0", 2, "@The last time you saw {reg18?her:him}, {s1}", 1),
      (else_try),
        (add_troop_note_from_sreg, ":var0", 2, "@The last time you heard about {reg18?her:him}, {s1}", 1),
      (try_end),
    (try_end),
  ]),

  ("update_center_notes",
  [
    (store_script_param, ":var0", 1),
    (party_get_slot, ":var1", ":var0", 7),
    (try_begin),
      (ge, ":var1", 0),
      (store_troop_faction, ":var2", ":var1"),
      (str_store_troop_name_link, s1, ":var1"),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (gt, "$players_kingdom", 0),
        (str_store_faction_name_link, s2, "$players_kingdom"),
      (else_try),
        (str_store_faction_name_link, s2, ":var2"),
      (try_end),
      (str_store_party_name, s50, ":var0"),
      (try_begin),
        (party_slot_eq, ":var0", 0, 3),
        (str_store_string, s51, "@{s50}"),
      (else_try),
        (party_slot_eq, ":var0", 0, 4),
        (party_get_slot, ":var3", ":var0", 120),
        (str_store_party_name_link, s52, ":var3"),
        (str_store_string, s51, "@The village of {s50} near {s52}"),
      (else_try),
        (str_store_string, s51, "@{s50}"),
      (try_end),
      (str_store_string, s2, "@{s51} belongs to {s1} of {s2}.^"),
    (else_try),
      (str_clear, s2),
    (try_end),
    (try_begin),
      (is_between, ":var0", "p_village_1", "p_salt_mine"),
    (else_try),
      (assign, ":var4", 0),
      (try_for_range_backwards, ":var5", "p_village_1", "p_salt_mine"),
        (party_slot_eq, ":var5", 120, ":var0"),
        (try_begin),
          (eq, ":var4", 0),
          (str_store_party_name_link, s8, ":var5"),
        (else_try),
          (eq, ":var4", 1),
          (str_store_party_name_link, s7, ":var5"),
          (str_store_string, s8, "@{s7} and {s8}"),
        (else_try),
          (str_store_party_name_link, s7, ":var5"),
          (str_store_string, s8, "@{s7}, {s8}"),
        (try_end),
        (val_add, ":var4", 1),
      (try_end),
      (try_begin),
        (eq, ":var4", 0),
        (str_store_string, s2, "@{s2}It has no villages.^"),
      (else_try),
        (store_sub, reg0, ":var4", 1),
        (str_store_string, s2, "@{s2}{reg0?Its villages are:Its village is} {s8}.^"),
      (try_end),
    (try_end),
    (call_script, "script_get_prosperity_text_to_s50", ":var0"),
    (add_party_note_from_sreg, ":var0", 0, "@{s2}Its prosperity is: {s50}", 0),
    (add_party_note_tableau_mesh, ":var0", "tableau_center_note_mesh"),
  ]),

  ("update_center_recon_notes",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (this_or_next|is_between, ":var0", "p_town_1", "p_castle_1"),
      (is_between, ":var0", "p_castle_1", "p_village_1"),
      (party_get_slot, ":var1", ":var0", 53),
      (call_script, "script_center_get_food_consumption", ":var0"),
      (assign, ":var2", reg0),
      (store_div, reg6, ":var1", ":var2"),
      (party_collect_attachments_to_party, ":var0", "p_collective_ally"),
      (party_get_num_companions, reg5, "p_collective_ally"),
      (add_party_note_from_sreg, ":var0", 1, "@Current garrison consists of {reg5} men.^Has food stock for {reg6} days.", 1),
    (try_end),
  ]),

  ("update_all_notes",
  [
    (call_script, "script_update_troop_notes", "trp_player"),
    (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (call_script, "script_update_troop_notes", ":var0"),
    (try_end),
    (try_for_range, ":var1", "p_town_1", "p_salt_mine"),
      (call_script, "script_update_center_notes", ":var1"),
    (try_end),
    (try_for_range, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (call_script, "script_update_faction_notes", ":var2"),
    (try_end),
    (try_for_range, ":var2", "fac_commoners", "fac_special_end"),
      (call_script, "script_update_faction_notes", ":var2"),
    (try_end),
    (try_for_range, ":var2", "fac_confederate_renegades", "fac_minor_end"),
      (call_script, "script_update_faction_notes", ":var2"),
    (try_end),
  ]),

  ("shield_item_set_banner",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (assign, ":var3", -1),
    (assign, ":var4", "mesh_banners_default_b"),
    (try_begin),
      (lt, ":var1", 0),
      (try_begin),
        (ge, ":var2", 0),
        (this_or_next|troop_slot_ge, ":var2", 13, 1),
        (eq, ":var2", "trp_player"),
        (assign, ":var3", ":var2"),
      (else_try),
        (is_between, ":var2", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
        (assign, ":var3", "trp_player"),
      (else_try),
        (assign, ":var4", "mesh_banners_default_a"),
      (try_end),
    (else_try),
      (agent_get_troop_id, ":var5", ":var1"),
      (this_or_next|troop_slot_ge, ":var5", 13, 1),
      (eq, ":var2", "trp_player"),
      (assign, ":var3", ":var5"),
    (else_try),
      (agent_get_party_id, ":var6", ":var1"),
      (try_begin),
        (lt, ":var6", 0),
        (is_between, ":var5", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
        (main_party_has_troop, ":var5"),
        (assign, ":var6", "p_main_party"),
      (try_end),
      (ge, ":var6", 0),
      (party_get_template_id, ":var7", ":var6"),
      (try_begin),
        (eq, ":var7", "pt_deserters"),
        (assign, ":var4", "mesh_banners_default_c"),
      (else_try),
        (is_between, ":var6", "p_town_1", "p_salt_mine"),
        (party_get_slot, ":var8", "$g_encountered_party", 7),
        (ge, ":var8", 0),
        (assign, ":var3", ":var8"),
      (else_try),
        (this_or_next|party_slot_eq, ":var6", 0, 13),
        (eq, ":var6", "p_main_party"),
        (party_get_num_companion_stacks, ":var9", ":var6"),
        (gt, ":var9", 0),
        (party_stack_get_troop_id, ":var10", ":var6", 0),
        (this_or_next|troop_slot_ge, ":var10", 13, 1),
        (eq, ":var10", "trp_player"),
        (assign, ":var3", ":var10"),
      (try_end),
    (else_try),
      (eq, "$talk_context", 14),
      (neq, ":var2", "trp_player"),
      (assign, ":var4", "mesh_banners_default_d"),
    (else_try),
      (neq, ":var2", "trp_player"),
      (is_between, "$g_encountered_party", "p_town_1", "p_village_1"),
      (party_get_slot, ":var8", "$g_encountered_party", 7),
      (ge, ":var8", 0),
      (assign, ":var3", ":var8"),
    (try_end),
    (try_begin),
      (ge, ":var3", 0),
      (try_begin),
        (neg|troop_slot_ge, ":var3", 13, 1),
        (assign, ":var4", "mesh_banners_default_b"),
      (else_try),
        (troop_get_slot, ":var11", ":var3", 13),
        (store_add, ":var12", "spr_banner_f21", 1),
        (is_between, ":var11", "spr_banner_a", ":var12"),
        (val_sub, ":var11", "spr_banner_a"),
        (store_add, ":var4", ":var11", "mesh_arms_a01"),
      (try_end),
    (try_end),
    (cur_item_set_tableau_material, ":var0", ":var4"),
  ]),

  ("add_troop_to_cur_tableau",
  [
    (store_script_param, ":var0", 1),
    (set_fixed_point_multiplier, 100),
    (assign, ":var1", -1),
    (troop_get_slot, ":var2", ":var0", 13),
    (store_add, ":var3", "spr_banner_f21", 1),
    (try_begin),
      (is_between, ":var2", "spr_banner_a", ":var3"),
      (val_sub, ":var2", "spr_banner_a"),
      (store_add, ":var1", ":var2", "mesh_banner_a01"),
    (try_end),
    (cur_tableau_clear_override_items),
    (cur_tableau_set_override_flags, 31),
    (init_position, pos2),
    (cur_tableau_set_camera_parameters, 1, 6, 6, 10, 10000),
    (init_position, pos5),
    (assign, ":var4", 162),
    (store_mul, ":var5", ":var0", 87323),
    (assign, ":var5", 139),
    (store_mul, ":var6", ":var0", 124337),
    (val_mod, ":var6", 50),
    (val_add, ":var6", -25),
    (store_mul, ":var7", ":var0", 98123),
    (val_mod, ":var7", 20),
    (val_add, ":var7", -14),
    (assign, ":var8", 1),
    (position_set_z, pos5, ":var4"),
    (position_rotate_x, pos5, -90),
    (position_rotate_z, pos5, 180),
    (position_rotate_y, pos5, ":var6"),
    (position_rotate_x, pos5, ":var7"),
    (position_move_z, pos5, ":var5", 0),
    (position_move_x, pos5, 5, 0),
    (try_begin),
      (ge, ":var1", 0),
      (init_position, pos1),
      (position_set_z, pos1, -1500),
      (position_set_x, pos1, 265),
      (position_set_y, pos1, 400),
      (position_transform_position_to_parent, pos3, pos5, pos1),
      (cur_tableau_add_mesh, ":var1", pos3, 400, 0),
    (try_end),
    (cur_tableau_add_troop, ":var0", pos2, ":var8", 0),
    (cur_tableau_set_camera_position, pos5),
    (copy_position, pos8, pos5),
    (position_rotate_x, pos8, -90),
    (position_rotate_z, pos8, 30),
    (position_rotate_x, pos8, -60),
    (cur_tableau_add_sun_light, pos8, 175, 150, 125),
  ]),

  ("add_troop_to_cur_tableau_for_character",
  [
    (store_script_param, ":var0", 1),
    (set_fixed_point_multiplier, 100),
    (cur_tableau_clear_override_items),
    (cur_tableau_set_override_flags, 512),
    (init_position, pos2),
    (cur_tableau_set_camera_parameters, 1, 4, 8, 10, 10000),
    (init_position, pos5),
    (assign, ":var1", 150),
    (assign, ":var2", 360),
    (assign, ":var3", -15),
    (assign, ":var4", -18),
    (assign, ":var5", 1),
    (position_set_z, pos5, ":var1"),
    (position_rotate_x, pos5, -90),
    (position_rotate_z, pos5, 180),
    (position_rotate_y, pos5, ":var3"),
    (position_rotate_x, pos5, ":var4"),
    (position_move_z, pos5, ":var2", 0),
    (position_move_x, pos5, 5, 0),
    (try_begin),
      (troop_is_hero, ":var0"),
      (cur_tableau_add_troop, ":var0", pos2, ":var5", -1),
    (else_try),
      (store_mul, ":var6", ":var0", 126233),
      (val_mod, ":var6", 1000),
      (val_add, ":var6", 1),
      (cur_tableau_add_troop, ":var0", pos2, ":var5", ":var6"),
    (try_end),
    (cur_tableau_set_camera_position, pos5),
    (copy_position, pos8, pos5),
    (position_rotate_x, pos8, -90),
    (position_rotate_z, pos8, 30),
    (position_rotate_x, pos8, -60),
    (cur_tableau_add_sun_light, pos8, 175, 150, 125),
  ]),

  ("add_troop_to_cur_tableau_for_inventory",
  [
    (store_script_param, ":var0", 1),
    (store_mod, ":var1", ":var0", 4),
    (val_div, ":var0", 4),
    (val_mul, ":var1", 90),
    (set_fixed_point_multiplier, 100),
    (cur_tableau_clear_override_items),
    (init_position, pos2),
    (position_rotate_z, pos2, ":var1"),
    (cur_tableau_set_camera_parameters, 1, 4, 6, 10, 10000),
    (init_position, pos5),
    (assign, ":var2", 105),
    (assign, ":var3", 380),
    (assign, ":var4", -15),
    (assign, ":var5", -18),
    (assign, ":var6", 1),
    (position_set_z, pos5, ":var2"),
    (position_rotate_x, pos5, -90),
    (position_rotate_z, pos5, 180),
    (position_rotate_y, pos5, ":var4"),
    (position_rotate_x, pos5, ":var5"),
    (position_move_z, pos5, ":var3", 0),
    (position_move_x, pos5, 5, 0),
    (try_begin),
      (troop_is_hero, ":var0"),
      (cur_tableau_add_troop, ":var0", pos2, ":var6", -1),
    (else_try),
      (store_mul, ":var7", ":var0", 126233),
      (val_mod, ":var7", 1000),
      (val_add, ":var7", 1),
      (cur_tableau_add_troop, ":var0", pos2, ":var6", ":var7"),
    (try_end),
    (cur_tableau_set_camera_position, pos5),
    (copy_position, pos8, pos5),
    (position_rotate_x, pos8, -90),
    (position_rotate_z, pos8, 30),
    (position_rotate_x, pos8, -60),
    (cur_tableau_add_sun_light, pos8, 175, 150, 125),
  ]),

  ("add_troop_to_cur_tableau_for_party",
  [
    (store_script_param, ":var0", 1),
    (store_mod, ":var1", ":var0", 2),
    (val_div, ":var0", 2),
    (set_fixed_point_multiplier, 100),
    (cur_tableau_clear_override_items),
    (try_begin),
      (eq, ":var1", 1),
      (cur_tableau_set_override_flags, 543),
    (try_end),
    (init_position, pos2),
    (cur_tableau_set_camera_parameters, 1, 6, 6, 10, 10000),
    (init_position, pos5),
    (assign, ":var2", 105),
    (assign, ":var3", 450),
    (assign, ":var4", 15),
    (assign, ":var5", -18),
    (assign, ":var6", 1),
    (troop_get_inventory_slot, ":var7", ":var0", ek_horse),
    (try_begin),
      (gt, ":var7", 0),
      (eq, ":var1", 0),
      (cur_tableau_add_horse, ":var7", pos2, "anim_horse_stand", 0),
      (assign, ":var6", "anim_ride_0"),
      (assign, ":var4", 23),
      (assign, ":var2", 150),
      (assign, ":var3", 550),
    (try_end),
    (position_set_z, pos5, ":var2"),
    (position_rotate_x, pos5, -90),
    (position_rotate_z, pos5, 180),
    (position_rotate_y, pos5, ":var4"),
    (position_rotate_x, pos5, ":var5"),
    (position_move_z, pos5, ":var3", 0),
    (position_move_x, pos5, 5, 0),
    (try_begin),
      (troop_is_hero, ":var0"),
      (cur_tableau_add_troop, ":var0", pos2, ":var6", -1),
    (else_try),
      (store_mul, ":var8", ":var0", 126233),
      (val_mod, ":var8", 1000),
      (val_add, ":var8", 1),
      (cur_tableau_add_troop, ":var0", pos2, ":var6", ":var8"),
    (try_end),
    (cur_tableau_set_camera_position, pos5),
    (copy_position, pos8, pos5),
    (position_rotate_x, pos8, -90),
    (position_rotate_z, pos8, 30),
    (position_rotate_x, pos8, -60),
    (cur_tableau_add_sun_light, pos8, 175, 150, 125),
  ]),

  ("get_prosperity_text_to_s50",
  [
    (store_script_param, ":var0", 1),
    (party_get_slot, ":var1", ":var0", 50),
    (val_div, ":var1", 20),
    (try_begin),
      (eq, ":var1", 0),
      (str_store_string, s50, "@Dirt Poor"),
    (else_try),
      (eq, ":var1", 1),
      (str_store_string, s50, "@Poor"),
    (else_try),
      (eq, ":var1", 2),
      (str_store_string, s50, "@Average"),
    (else_try),
      (eq, ":var1", 3),
      (str_store_string, s50, "@Rich"),
    (else_try),
      (str_store_string, s50, "@Filthy Rich"),
    (try_end),
  ]),

  ("spawn_bandits",
  [
    (set_spawn_radius, 1),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_stagecoach"),
      (lt, ":var0", 14),
      (store_random_in_range, ":var1", "p_town_1", "p_town_7"),
      (spawn_around_party, ":var1", "pt_stagecoach"),
      (assign, ":var2", reg0),
      (party_set_ai_behavior, ":var2", ai_bhvr_travel_to_party),
      (party_set_ai_object, ":var2", ":var1"),
      (party_set_flags, ":var2", 65536, 0),
      (party_set_slot, ":var2", 4, 13),
      (party_set_slot, ":var2", 5, ":var1"),
      (party_set_bandit_attraction, ":var2", 100),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_manhunters"),
      (lt, ":var0", 18),
      (store_random_in_range, ":var1", "p_village_1", "p_salt_mine"),
      (spawn_around_party, ":var1", "pt_manhunters"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_forest_bandits"),
      (lt, ":var0", 4),
      (store_random_in_range, ":var1", "p_forest_bandit_spawn_point_1", "p_mountain_bandit_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_forest_bandits"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_mountain_bandits"),
      (lt, ":var0", 4),
      (store_random_in_range, ":var1", "p_mountain_bandit_spawn_point_1", "p_indian_raider_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_mountain_bandits"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_indian_raiders"),
      (lt, ":var0", 6),
      (store_random_in_range, ":var1", "p_indian_raider_spawn_point_1", "p_scalphunter_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_indian_raiders"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_scalphunters"),
      (lt, ":var0", 6),
      (store_random_in_range, ":var1", "p_scalphunter_spawn_point_1", "p_trapper_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_scalphunters"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_trappers"),
      (lt, ":var0", 8),
      (store_random_in_range, ":var1", "p_trapper_spawn_point_1", "p_miner_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_trappers"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_miners"),
      (lt, ":var0", 6),
      (store_random_in_range, ":var1", "p_miner_spawn_point_1", "p_homesteader_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_miners"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_homesteaders"),
      (lt, ":var0", 4),
      (store_random_in_range, ":var1", "p_homesteader_spawn_point_1", "p_imperialist_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_homesteaders"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_imperialists"),
      (lt, ":var0", 12),
      (store_random_in_range, ":var1", "p_imperialist_spawn_point_1", "p_confederate_renegade_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_imperialists"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_looters"),
      (lt, ":var0", 34),
      (store_random_in_range, ":var1", "p_village_1", "p_salt_mine"),
      (spawn_around_party, ":var1", "pt_looters"),
      (assign, ":var3", reg0),
      (try_begin),
        (check_quest_active, "qst_deal_with_looters"),
        (party_set_flags, ":var3", 262144, 1),
      (else_try),
        (party_set_flags, ":var3", 262144, 0),
      (try_end),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_outlaws_american"),
      (lt, ":var0", 7),
      (store_random_in_range, ":var1", "p_village_1", "p_salt_mine"),
      (spawn_around_party, ":var1", "pt_outlaws_american"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_outlaws_mexican"),
      (lt, ":var0", 7),
      (store_random_in_range, ":var1", "p_village_1", "p_salt_mine"),
      (spawn_around_party, ":var1", "pt_outlaws_mexican"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_confederate_renegades"),
      (lt, ":var0", 12),
      (store_random_in_range, ":var1", "p_confederate_renegade_spawn_point_1", "p_deer_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_confederate_renegades"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_american_chain_gang"),
      (lt, ":var0", 3),
      (store_random_in_range, ":var1", "p_town_1", "p_town_4"),
      (spawn_around_party, ":var1", "pt_american_chain_gang"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_mexican_chain_gang"),
      (lt, ":var0", 3),
      (store_random_in_range, ":var1", "p_town_4", "p_town_7"),
      (spawn_around_party, ":var1", "pt_mexican_chain_gang"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_deserters"),
      (lt, ":var0", 12),
      (set_spawn_radius, 4),
      (try_for_range, ":var4", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (store_random_in_range, ":var5", 0, 100),
        (lt, ":var5", 5),
        (troop_get_slot, ":var2", ":var4", 10),
        (store_troop_faction, ":var6", ":var4"),
        (neq, ":var6", "fac_player_supporters_faction"),
        (gt, ":var2", 0),
        (neg|party_is_in_any_town, ":var2"),
        (spawn_around_party, ":var2", "pt_deserters"),
        (assign, ":var7", reg0),
        (store_troop_faction, ":var8", ":var4"),
        (try_begin),
          (faction_slot_eq, ":var6", 9, "fac_culture_1"),
          (party_set_icon, ":var7", "icon_usa_soldier"),
        (else_try),
          (faction_slot_eq, ":var6", 9, "fac_culture_2"),
          (party_set_icon, ":var7", "icon_mexico_soldier"),
        (else_try),
          (faction_slot_eq, ":var6", 9, "fac_culture_3"),
          (party_set_icon, ":var7", "icon_apache_soldier"),
        (else_try),
          (faction_slot_eq, ":var6", 9, "fac_culture_4"),
          (party_set_icon, ":var7", "icon_comanche_soldier"),
        (else_try),
          (faction_slot_eq, ":var6", 9, "fac_culture_5"),
          (party_set_icon, ":var7", "icon_bandit_soldier"),
        (else_try),
          (faction_slot_eq, ":var6", 9, "fac_culture_6"),
          (party_set_icon, ":var7", "icon_lawman_soldier"),
        (else_try),
          (faction_slot_eq, ":var6", 9, "fac_culture_7"),
          (party_set_icon, ":var7", "icon_outlaw_soldier"),
        (try_end),
        (faction_get_slot, ":var9", ":var8", 77),
        (party_add_template, ":var7", ":var9"),
        (store_random_in_range, ":var5", 1, 4),
        (try_for_range, ":var10", 0, ":var5"),
          (neq, ":var7", 0),
          (party_upgrade_with_xp, ":var7", 10000, 0),
        (try_end),
      (try_end),
    (try_end),
    (set_spawn_radius, 1),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_deer_herd"),
      (lt, ":var0", 4),
      (store_random_in_range, ":var1", "p_deer_spawn_point_1", "p_buffalo_spawn_point_1"),
      (spawn_around_party, ":var1", "pt_deer_herd"),
      (assign, ":var3", reg0),
    (try_end),
    (try_begin),
      (store_num_parties_of_template, ":var0", "pt_buffalo_herd"),
      (lt, ":var0", 6),
      (store_random_in_range, ":var1", "p_buffalo_spawn_point_1", "p_spawn_points_end"),
      (spawn_around_party, ":var1", "pt_buffalo_herd"),
      (assign, ":var3", reg0),
    (try_end),
  ]),

  ("count_mission_casualties_from_agents",
  [
    (party_clear, "p_player_casualties"),
    (party_clear, "p_enemy_casualties"),
    (party_clear, "p_ally_casualties"),
    (assign, "$any_allies_at_the_last_battle", 0),
    (try_for_agents, ":var0"),
      (agent_is_human, ":var0"),
      (agent_get_party_id, ":var1", ":var0"),
      (try_begin),
        (neq, ":var1", "p_main_party"),
        (agent_is_ally, ":var0"),
        (assign, "$any_allies_at_the_last_battle", 1),
      (try_end),
      (neg|agent_is_alive, ":var0"),
      (agent_get_troop_id, ":var2", ":var0"),
      (try_begin),
        (eq, ":var1", "p_main_party"),
        (party_add_members, "p_player_casualties", ":var2", 1),
        (try_begin),
          (this_or_next|agent_slot_eq, ":var0", 5, 1),
          (agent_is_wounded, ":var0"),
          (party_wound_members, "p_player_casualties", ":var2", 1),
        (try_end),
      (else_try),
        (agent_is_ally, ":var0"),
        (party_add_members, "p_ally_casualties", ":var2", 1),
        (try_begin),
          (this_or_next|agent_slot_eq, ":var0", 5, 1),
          (agent_is_wounded, ":var0"),
          (party_wound_members, "p_ally_casualties", ":var2", 1),
        (try_end),
      (else_try),
        (party_add_members, "p_enemy_casualties", ":var2", 1),
        (try_begin),
          (this_or_next|agent_slot_eq, ":var0", 5, 1),
          (agent_is_wounded, ":var0"),
          (party_wound_members, "p_enemy_casualties", ":var2", 1),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("get_max_skill_of_player_party",
  [
    (store_script_param, ":var0", 1),
    (party_get_num_companion_stacks, ":var1", "p_main_party"),
    (store_skill_level, ":var2", ":var0", "trp_player"),
    (assign, ":var3", "trp_player"),
    (try_for_range, ":var4", 0, ":var1"),
      (party_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
      (troop_is_hero, ":var5"),
      (neg|troop_is_wounded, ":var5"),
      (store_skill_level, ":var6", ":var0", ":var5"),
      (gt, ":var6", ":var2"),
      (assign, ":var2", ":var6"),
      (assign, ":var3", ":var5"),
    (try_end),
    (assign, reg0, ":var2"),
    (assign, reg1, ":var3"),
  ]),

  ("upgrade_hero_party",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (party_upgrade_with_xp, ":var0", ":var1", 0),
  ]),

  ("get_improvement_details",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (eq, ":var0", 130),
      (str_store_string, s0, "@Manor"),
      (str_store_string, s1, "@A manor lets you rest at the village and pay your troops half wages while you rest."),
      (assign, reg0, 8000),
    (else_try),
      (eq, ":var0", 131),
      (str_store_string, s0, "@Hotel"),
      (str_store_string, s1, "@An oasis of comfort in a harsh wilderness.  Don't expect to get rich in a small town like this but it's a good beginning to your business empire."),
      (assign, reg0, 6000),
    (else_try),
      (eq, ":var0", 132),
      (str_store_string, s0, "@Livery Stable"),
      (str_store_string, s1, "@Tends to the needs of our four legged friends. Increases income."),
      (assign, reg0, 6000),
    (else_try),
      (eq, ":var0", 133),
      (str_store_string, s0, "@Way Station"),
      (str_store_string, s1, "@Contract with the local stage line to provide meals, lodgings and fresh horses.  Increases earnings for your hotel and stable."),
      (assign, reg0, 9000),
    (else_try),
      (eq, ":var0", 134),
      (str_store_string, s0, "@Saloon"),
      (str_store_string, s1, "@Nothing like a shot of good whiskey to wash down the trail dust."),
      (assign, reg0, 6000),
    (else_try),
      (eq, ":var0", 135),
      (str_store_string, s0, "@Gambling Tables"),
      (str_store_string, s1, "@You pride yourself on running honest games.  Sure you may run a loss from time to time but if it was a sure thing it wouldn't be gambling."),
      (assign, reg0, 6000),
    (else_try),
      (eq, ":var0", 136),
      (str_store_string, s0, "@Bordello"),
      (str_store_string, s1, "@Only the finest quality entertainment for the discerning gentlemen.  Besides your take of the ladies earnings their presence draws in more patrons for your other enterprises."),
      (assign, reg0, 9000),
    (else_try),
      (eq, ":var0", 137),
      (str_store_string, s0, "@Placer Mining"),
      (str_store_string, s1, "@Placer or 'tin pan' mining the most basic form of mining precious metals.  Increases town prosperity."),
      (assign, reg0, 4000),
    (else_try),
      (eq, ":var0", 138),
      (str_store_string, s0, "@Sluice Mining"),
      (str_store_string, s1, "@Replacing the tin pan with a sluice allows for greater productivity of the most promising claims. Further increases town prosperity."),
      (assign, reg0, 6000),
    (else_try),
      (eq, ":var0", 139),
      (str_store_string, s0, "@Industrial Mining"),
      (str_store_string, s1, "@Open pit or shaft mining in search of the mother lode. Increases village prosperity."),
      (assign, reg0, 9000),
    (else_try),
      (eq, ":var0", 140),
      (str_store_string, s0, "@Watch Tower"),
      (str_store_string, s1, "@A watch tower lets the villagers raise alarm earlier. The time it takes for enemies to loot the village increases by 25%."),
      (assign, reg0, 5000),
    (else_try),
      (eq, ":var0", 141),
      (str_store_string, s0, "@School"),
      (str_store_string, s1, "@A shool increases the loyality of the villagers to you by +1 every month."),
      (assign, reg0, 9000),
    (else_try),
      (eq, ":var0", 142),
      (str_store_string, s0, "@Messenger Post"),
      (str_store_string, s1, "@A messenger post lets the inhabitants send you a message whenever enemies are nearby, even if you are far away from here."),
      (assign, reg0, 4000),
    (else_try),
      (eq, ":var0", 143),
      (str_store_string, s0, "@Jailhouse"),
      (str_store_string, s1, "@A jailhouse reduces the chance of captives held here running away successfully."),
      (assign, reg0, 7000),
    (try_end),
  ]),

  ("cf_troop_agent_is_alive",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (try_for_agents, ":var2"),
      (agent_get_troop_id, ":var3", ":var2"),
      (eq, ":var0", ":var3"),
      (agent_is_alive, ":var2"),
      (val_add, ":var1", 1),
    (try_end),
    (gt, ":var1", 0),
  ]),

  ("cf_village_recruit_volunteers_cond",
  [
    (neg|party_slot_eq, "$current_town", 35, 2),
    (neg|party_slot_eq, "$current_town", 35, 1),
    (neg|party_slot_ge, "$current_town", 39, 1),
    (store_faction_of_party, ":var0", "$current_town"),
    (party_get_slot, ":var1", "$current_town", 26),
    (store_relation, ":var2", ":var0", "fac_player_faction"),
    (ge, ":var1", 0),
    (this_or_next|ge, ":var1", 5),
    (this_or_next|eq, ":var0", "$players_kingdom"),
    (this_or_next|ge, ":var2", 0),
    (this_or_next|eq, ":var0", "$supported_pretender_old_faction"),
    (eq, "$players_kingdom", 0),
    (party_slot_ge, "$current_town", 223, 0),
    (party_slot_ge, "$current_town", 222, 1),
    (party_get_free_companions_capacity, ":var3", "p_main_party"),
    (ge, ":var3", 1),
  ]),

  ("village_recruit_volunteers_recruit",
  [
    (party_get_slot, ":var0", "$current_town", 222),
    (party_get_slot, ":var1", "$current_town", 223),
    (party_get_free_companions_capacity, ":var2", "p_main_party"),
    (val_min, ":var1", ":var2"),
    (party_get_slot, ":var0", "$current_town", 222),
    (store_faction_of_party, ":var3", "$current_town"),
    (store_character_level, ":var4", ":var0"),
    (store_add, ":var5", ":var4", 90),
    (try_begin),
      (eq, ":var3", "$players_kingdom"),
      (val_mul, ":var5", 3),
      (val_div, ":var5", 4),
    (try_end),
    (store_troop_gold, ":var6", "trp_player"),
    (store_div, ":var7", ":var6", ":var5"),
    (val_min, ":var1", ":var7"),
    (party_add_members, "p_main_party", ":var0", ":var1"),
    (party_set_slot, "$current_town", 223, -1),
    (store_mul, ":var8", ":var1", ":var5"),
    (troop_remove_gold, "trp_player", ":var8"),
  ]),

  ("town_recruit_volunteers",
  [
    (party_get_slot, ":var0", "$current_town", 222),
    (party_get_slot, ":var1", "$current_town", 223),
    (party_get_free_companions_capacity, ":var2", "p_main_party"),
    (val_min, ":var1", ":var2"),
    (party_get_slot, ":var0", "$current_town", 222),
    (store_faction_of_party, ":var3", "$current_town"),
    (store_character_level, ":var4", ":var0"),
    (store_add, ":var5", ":var4", 90),
    (try_begin),
      (eq, ":var3", "$players_kingdom"),
      (val_mul, ":var5", 3),
      (val_div, ":var5", 4),
    (try_end),
    (store_troop_gold, ":var6", "trp_player"),
    (store_div, ":var7", ":var6", ":var5"),
    (val_min, ":var1", ":var7"),
    (party_add_members, "p_main_party", ":var0", ":var1"),
    (party_set_slot, "$current_town", 223, 0),
    (store_mul, ":var8", ":var1", ":var5"),
    (troop_remove_gold, "trp_player", ":var8"),
  ]),

  ("castle_recruit_volunteers",
  [
    (party_get_slot, ":var0", "$current_town", 222),
    (party_get_slot, ":var1", "$current_town", 223),
    (party_get_free_companions_capacity, ":var2", "p_main_party"),
    (val_min, ":var1", ":var2"),
    (party_get_slot, ":var0", "$current_town", 222),
    (store_faction_of_party, ":var3", "$current_town"),
    (store_character_level, ":var4", ":var0"),
    (store_add, ":var5", ":var4", 90),
    (try_begin),
      (eq, ":var3", "$players_kingdom"),
      (val_mul, ":var5", 3),
      (val_div, ":var5", 4),
    (try_end),
    (store_troop_gold, ":var6", "trp_player"),
    (store_div, ":var7", ":var6", ":var5"),
    (val_min, ":var1", ":var7"),
    (party_add_members, "p_main_party", ":var0", ":var1"),
    (party_set_slot, "$current_town", 223, 0),
    (store_mul, ":var8", ":var1", ":var5"),
    (troop_remove_gold, "trp_player", ":var8"),
  ]),

  ("get_troop_item_amount",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (troop_get_inventory_capacity, ":var2", ":var0"),
    (assign, ":var3", 0),
    (try_for_range, ":var4", 0, ":var2"),
      (troop_get_inventory_slot, ":var5", ":var0", ":var4"),
      (eq, ":var5", ":var1"),
      (val_add, ":var3", 1),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("get_name_from_dna_to_s50",
  [
    (store_script_param, ":var0", 1),
    (store_sub, ":var1", "str_nickname_1", "str_name_1"),
    (store_sub, ":var2", "str_surname_1", "str_nickname_1"),
    (store_sub, ":var3", "str_surnames_end", "str_surname_1"),
    (assign, ":var4", ":var0"),
    (val_mod, ":var4", ":var1"),
    (assign, ":var5", ":var0"),
    (val_mod, ":var5", ":var2"),
    (assign, ":var6", ":var0"),
    (val_mod, ":var6", ":var3"),
    (val_add, ":var4", "str_name_1"),
    (val_add, ":var5", "str_nickname_1"),
    (val_add, ":var6", "str_surname_1"),
    (str_store_string, s50, ":var4"),
    (assign, "$nickname_check", ":var0"),
    (val_mod, "$nickname_check", 2),
    (try_begin),
      (eq, "$nickname_check", 0),
      (str_store_string, s50, ":var5"),
    (try_end),
    (str_store_string, s50, ":var6"),
  ]),

  ("change_center_prosperity",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (party_get_slot, ":var2", ":var0", 50),
    (store_add, ":var3", ":var2", ":var1"),
    (val_clamp, ":var3", 0, 100),
    (store_div, ":var4", ":var2", 20),
    (store_div, ":var5", ":var3", 20),
    (try_begin),
      (neq, ":var4", ":var5"),
      (str_store_party_name_link, s2, ":var0"),
      (call_script, "script_get_prosperity_text_to_s50", ":var0"),
      (str_store_string, s3, s50),
      (party_set_slot, ":var0", 50, ":var3"),
      (call_script, "script_get_prosperity_text_to_s50", ":var0"),
      (str_store_string, s4, s50),
      (display_message, "@Prosperity of {s2} has changed from {s3} to {s4}."),
      (call_script, "script_update_center_notes", ":var0"),
    (else_try),
      (party_set_slot, ":var0", 50, ":var3"),
    (try_end),
  ]),

  ("get_center_ideal_prosperity",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 40),
    (try_begin),
      (is_between, ":var0", "p_village_1", "p_salt_mine"),
      (try_begin),
        (party_slot_eq, ":var0", 139, 1),
        (val_add, ":var1", 5),
      (try_end),
      (party_get_slot, ":var2", ":var0", 44),
      (val_mul, ":var2", 3),
      (val_add, ":var1", ":var2"),
      (party_get_slot, ":var3", ":var0", 45),
      (val_div, ":var3", 20),
      (val_add, ":var1", ":var3"),
    (else_try),
      (try_for_range, ":var4", "p_village_1", "p_salt_mine"),
        (party_slot_eq, ":var4", 120, ":var0"),
        (party_get_slot, ":var5", ":var4", 50),
        (val_div, ":var5", 20),
        (val_add, ":var1", ":var5"),
      (try_end),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("get_poorest_village_of_faction",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", -1),
    (assign, ":var2", 101),
    (try_for_range, ":var3", "p_village_1", "p_salt_mine"),
      (store_faction_of_party, ":var4", ":var3"),
      (eq, ":var4", ":var0"),
      (party_get_slot, ":var5", ":var3", 50),
      (lt, ":var5", ":var2"),
      (assign, ":var2", ":var5"),
      (assign, ":var1", ":var3"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("troop_add_gold",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (troop_add_gold, ":var0", ":var1"),
    (try_begin),
      (eq, ":var0", "trp_player"),
      (play_sound, "snd_money_received"),
    (try_end),
  ]),

  ("initialize_npcs",
  [
    (troop_set_slot, "trp_npc1", 60, "p_village_7"),
    (troop_set_slot, "trp_npc1", 132, 600),
    (troop_set_slot, "trp_npc2", 60, "p_town_1"),
    (troop_set_slot, "trp_npc2", 132, 200),
    (troop_set_slot, "trp_npc3", 60, "p_village_25"),
    (troop_set_slot, "trp_npc3", 132, 200),
    (troop_set_slot, "trp_npc4", 60, "p_town_3"),
    (troop_set_slot, "trp_npc4", 132, 600),
    (troop_set_slot, "trp_npc5", 60, "p_village_5"),
    (troop_set_slot, "trp_npc5", 132, 1000),
    (troop_set_slot, "trp_npc6", 60, "p_village_1"),
    (troop_set_slot, "trp_npc6", 132, 600),
    (troop_set_slot, "trp_npc7", 60, "p_village_23"),
    (troop_set_slot, "trp_npc7", 132, 600),
    (troop_set_slot, "trp_npc8", 60, "p_village_6"),
    (troop_set_slot, "trp_npc8", 132, 800),
    (troop_set_slot, "trp_npc9", 60, "p_village_13"),
    (troop_set_slot, "trp_npc9", 132, 400),
    (troop_set_slot, "trp_npc10", 60, "p_village_16"),
    (troop_set_slot, "trp_npc10", 132, 600),
    (troop_set_slot, "trp_npc11", 60, "p_village_8"),
    (troop_set_slot, "trp_npc11", 132, 400),
    (troop_set_slot, "trp_npc12", 60, "p_village_22"),
    (troop_set_slot, "trp_npc12", 132, 600),
    (troop_set_slot, "trp_npc13", 60, "p_village_12"),
    (troop_set_slot, "trp_npc13", 132, 600),
    (troop_set_slot, "trp_npc14", 60, "p_village_18"),
    (troop_set_slot, "trp_npc14", 132, 800),
    (troop_set_slot, "trp_npc15", 60, "p_village_15"),
    (troop_set_slot, "trp_npc15", 132, 400),
    (troop_set_slot, "trp_npc16", 60, "p_village_20"),
    (troop_set_slot, "trp_npc16", 132, 600),
    (troop_set_slot, "trp_npc17", 60, "p_town_2"),
    (troop_set_slot, "trp_npc17", 132, 800),
    (troop_set_slot, "trp_npc18", 60, "p_village_19"),
    (troop_set_slot, "trp_npc18", 132, 600),
    (store_sub, "$number_of_npc_slots", 131, 101),
    (try_for_range, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
      (try_for_range, ":var1", 0, "$number_of_npc_slots"),
        (store_add, ":var2", ":var1", 101),
        (store_mul, ":var3", ":var1", 18),
        (store_add, ":var4", "str_npc1_intro", ":var3"),
        (val_add, ":var4", ":var0"),
        (val_sub, ":var4", "trp_npc1"),
        (troop_set_slot, ":var0", ":var2", ":var4"),
      (try_end),
    (try_end),
    (try_for_range, ":var5", "trp_knight_1_1", "trp_heroes_end"),
      (store_random_in_range, ":var6", 0, 8),
      (try_begin),
        (eq, ":var6", 0),
        (assign, ":var6", 1),
      (try_end),
      (troop_set_slot, ":var5", 52, ":var6"),
    (try_end),
    (call_script, "script_add_log_entry", 31, "trp_player", -1, -1, -1),
  ]),

  ("objectionable_action",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", -2),
    (try_for_range, ":var3", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
      (main_party_has_troop, ":var3"),
      (try_begin),
        (troop_slot_eq, ":var3", 62, ":var0"),
        (troop_get_slot, ":var4", ":var3", 63),
        (try_begin),
          (troop_slot_eq, ":var3", 61, 1),
          (troop_get_slot, ":var5", ":var3", 69),
          (val_mul, ":var4", 2),
          (val_add, ":var5", ":var4"),
          (troop_set_slot, ":var3", 69, ":var5"),
        (else_try),
          (this_or_next|troop_slot_eq, ":var3", 61, 2),
          (eq, "$disable_npc_complaints", 1),
          (troop_get_slot, ":var5", ":var3", 69),
          (val_add, ":var5", ":var4"),
          (troop_set_slot, ":var3", 69, ":var5"),
        (else_try),
          (troop_slot_eq, ":var3", 61, 0),
          (gt, ":var4", ":var2"),
          (assign, "$npc_with_grievance", ":var3"),
          (assign, "$npc_grievance_string", ":var1"),
          (assign, "$npc_grievance_slot", 61),
          (assign, ":var2", ":var4"),
          (assign, "$npc_praise_not_complaint", 0),
          (try_begin),
            (lt, ":var4", 0),
            (assign, "$npc_praise_not_complaint", 1),
          (try_end),
        (try_end),
      (else_try),
        (troop_slot_eq, ":var3", 64, ":var0"),
        (troop_get_slot, ":var4", ":var3", 66),
        (try_begin),
          (troop_slot_eq, ":var3", 65, 1),
          (troop_get_slot, ":var5", ":var3", 69),
          (val_mul, ":var4", 2),
          (val_add, ":var5", ":var4"),
          (troop_set_slot, ":var3", 69, ":var5"),
        (else_try),
          (this_or_next|troop_slot_eq, ":var3", 65, 2),
          (eq, "$disable_npc_complaints", 1),
          (troop_get_slot, ":var5", ":var3", 69),
          (val_add, ":var5", ":var4"),
          (troop_set_slot, ":var3", 69, ":var5"),
        (else_try),
          (troop_slot_eq, ":var3", 65, 0),
          (gt, ":var4", ":var2"),
          (assign, "$npc_with_grievance", ":var3"),
          (assign, "$npc_grievance_string", ":var1"),
          (assign, "$npc_grievance_slot", 65),
          (assign, ":var2", ":var4"),
          (assign, "$npc_praise_not_complaint", 0),
          (try_begin),
            (lt, ":var4", 0),
            (assign, "$npc_praise_not_complaint", 1),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$npc_with_grievance", 0),
        (eq, "$npc_praise_not_complaint", 0),
        (str_store_troop_name, s4, "$npc_with_grievance"),
        (display_message, "@{s4} looks upset."),
      (try_end),
    (try_end),
  ]),

  ("post_battle_personality_clash_check",
  [
    (try_for_range, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
      (eq, "$disable_npc_complaints", 0),
      (main_party_has_troop, ":var0"),
      (neg|troop_is_wounded, ":var0"),
      (troop_get_slot, ":var1", ":var0", 73),
      (main_party_has_troop, ":var1"),
      (neg|troop_is_wounded, ":var1"),
      (try_begin),
        (troop_slot_eq, ":var0", 74, 0),
        (try_begin),
          (assign, "$npc_with_personality_clash_2", ":var0"),
        (try_end),
      (try_end),
    (try_end),
    (try_for_range, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
      (troop_slot_eq, ":var0", 76, 0),
      (eq, "$disable_npc_complaints", 0),
      (main_party_has_troop, ":var0"),
      (neg|troop_is_wounded, ":var0"),
      (troop_get_slot, ":var1", ":var0", 75),
      (main_party_has_troop, ":var1"),
      (neg|troop_is_wounded, ":var1"),
      (assign, "$npc_with_personality_match", ":var0"),
    (try_end),
    (try_begin),
      (gt, "$npc_with_personality_clash_2", 0),
      (assign, "$npc_map_talk_context", 74),
      (start_map_conversation, "$npc_with_personality_clash_2"),
    (else_try),
      (gt, "$npc_with_personality_match", 0),
      (assign, "$npc_map_talk_context", 76),
      (start_map_conversation, "$npc_with_personality_match"),
    (try_end),
  ]),

  ("event_player_defeated_enemy_party",
  [
    (try_begin),
      (check_quest_active, "qst_raid_caravan_to_start_war"),
      (neg|check_quest_concluded, "qst_raid_caravan_to_start_war"),
      (party_slot_eq, "$g_enemy_party", 0, 11),
      (store_faction_of_party, ":var0", "$g_enemy_party"),
      (quest_slot_eq, "qst_raid_caravan_to_start_war", 3, ":var0"),
      (quest_get_slot, ":var1", "qst_raid_caravan_to_start_war", 11),
      (quest_get_slot, ":var2", "qst_raid_caravan_to_start_war", 10),
      (val_add, ":var1", 1),
      (quest_set_slot, "qst_raid_caravan_to_start_war", 11, ":var1"),
      (try_begin),
        (ge, ":var1", ":var2"),
        (quest_get_slot, ":var3", "qst_raid_caravan_to_start_war", 3),
        (quest_get_slot, ":var4", "qst_raid_caravan_to_start_war", 6),
        (store_troop_faction, ":var5", ":var4"),
        (call_script, "script_diplomacy_start_war_between_kingdoms", ":var3", ":var5", 1),
        (call_script, "script_succeed_quest", "qst_raid_caravan_to_start_war"),
      (try_end),
    (try_end),
  ]),

  ("event_player_captured_as_prisoner",
  [
    (try_begin),
      (check_quest_active, "qst_raid_caravan_to_start_war"),
      (neg|check_quest_concluded, "qst_raid_caravan_to_start_war"),
      (quest_get_slot, ":var0", "qst_raid_caravan_to_start_war", 3),
      (store_faction_of_party, ":var1", "$capturer_party"),
      (eq, ":var0", ":var1"),
      (call_script, "script_fail_quest", "qst_raid_caravan_to_start_war"),
    (try_end),
    (try_for_range, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (troop_get_slot, ":var3", ":var2", 10),
      (gt, ":var3", 0),
      (party_slot_eq, ":var3", 30, "p_main_party"),
      (call_script, "script_party_set_ai_state", ":var3", -1, -1),
      (party_set_slot, ":var3", 30, -1),
      (assign, "$g_recalculate_ais", 1),
    (try_end),
  ]),

  ("npc_morale",
  [
    (store_script_param_1, ":var0"),
    (troop_get_slot, ":var1", ":var0", 69),
    (troop_get_slot, ":var2", ":var0", 77),
    (party_get_morale, ":var3", "p_main_party"),
    (store_sub, ":var4", ":var3", ":var1"),
    (val_sub, ":var4", ":var2"),
    (val_add, ":var4", 50),
    (assign, reg8, ":var4"),
    (val_mul, ":var4", 3),
    (val_div, ":var4", 4),
    (val_clamp, ":var4", 0, 100),
    (assign, reg5, ":var3"),
    (assign, reg6, ":var1"),
    (assign, reg7, ":var2"),
    (assign, reg9, ":var4"),
    (try_begin),
      (lt, ":var1", 3),
      (str_store_string, s7, "str_happy"),
    (else_try),
      (lt, ":var1", 15),
      (str_store_string, s7, "str_content"),
    (else_try),
      (lt, ":var1", 30),
      (str_store_string, s7, "str_concerned"),
    (else_try),
      (lt, ":var1", 45),
      (str_store_string, s7, "str_not_happy"),
    (else_try),
      (str_store_string, s7, "str_miserable"),
    (try_end),
    (try_begin),
      (lt, ":var2", 3),
      (str_store_string, s6, "str_happy"),
    (else_try),
      (lt, ":var2", 15),
      (str_store_string, s6, "str_content"),
    (else_try),
      (lt, ":var2", 30),
      (str_store_string, s6, "str_concerned"),
    (else_try),
      (lt, ":var2", 45),
      (str_store_string, s6, "str_not_happy"),
    (else_try),
      (str_store_string, s6, "str_miserable"),
    (try_end),
    (try_begin),
      (gt, ":var4", 80),
      (str_store_string, s8, "str_happy"),
      (str_store_string, s63, "str_bar_enthusiastic"),
    (else_try),
      (gt, ":var4", 60),
      (str_store_string, s8, "str_content"),
      (str_store_string, s63, "str_bar_content"),
    (else_try),
      (gt, ":var4", 40),
      (str_store_string, s8, "str_concerned"),
      (str_store_string, s63, "str_bar_weary"),
    (else_try),
      (gt, ":var4", 20),
      (str_store_string, s8, "str_not_happy"),
      (str_store_string, s63, "str_bar_disgruntled"),
    (else_try),
      (str_store_string, s8, "str_miserable"),
      (str_store_string, s63, "str_bar_miserable"),
    (try_end),
    (str_store_string, s21, "str_npc_morale_report"),
    (assign, reg0, ":var4"),
  ]),

  ("retire_companion",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (remove_member_from_party, ":var0", "p_main_party"),
    (troop_set_slot, ":var0", 77, 0),
    (troop_set_slot, ":var0", 69, 0),
    (troop_get_slot, ":var2", "trp_player", 7),
    (store_add, ":var3", ":var2", ":var1"),
    (troop_set_slot, ":var0", 2, 11),
    (troop_set_slot, ":var0", 84, ":var3"),
  ]),

  ("reduce_companion_morale_for_clash",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (troop_get_slot, ":var3", ":var0", ":var2"),
    (troop_get_slot, ":var4", ":var0", 77),
    (troop_get_slot, ":var5", ":var1", 77),
    (try_begin),
      (eq, ":var3", 1),
      (val_add, ":var4", 5),
    (else_try),
      (eq, ":var3", 2),
      (val_add, ":var5", 5),
    (else_try),
      (eq, ":var3", 3),
      (val_add, ":var4", 3),
      (val_add, ":var5", 3),
    (try_end),
    (troop_set_slot, ":var0", 77, ":var4"),
    (troop_set_slot, ":var1", 77, ":var5"),
  ]),

  ("calculate_ransom_amount_for_troop",
  [
    (store_script_param, ":var0", 1),
    (store_troop_faction, ":var1", ":var0"),
    (assign, ":var2", 400),
    (try_begin),
      (faction_slot_eq, ":var1", 10, ":var0"),
      (val_add, ":var2", 4000),
    (try_end),
    (assign, ":var3", 0),
    (try_for_range, ":var4", "p_town_1", "p_salt_mine"),
      (party_slot_eq, ":var4", 7, ":var0"),
      (try_begin),
        (party_slot_eq, ":var4", 0, 3),
        (val_add, ":var3", 4),
      (else_try),
        (party_slot_eq, ":var4", 0, 2),
        (val_add, ":var3", 2),
      (else_try),
        (val_add, ":var3", 1),
      (try_end),
    (try_end),
    (val_mul, ":var3", 500),
    (val_add, ":var2", ":var3"),
    (troop_get_slot, ":var5", ":var0", 7),
    (val_mul, ":var5", 2),
    (val_add, ":var2", ":var5"),
    (store_mul, ":var6", ":var2", 3),
    (val_div, ":var6", 2),
    (store_random_in_range, ":var7", ":var2", ":var6"),
    (val_div, ":var7", 100),
    (val_mul, ":var7", 100),
    (assign, reg0, ":var7"),
  ]),

  ("offer_ransom_amount_to_player_for_prisoners_in_party",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (party_get_num_prisoner_stacks, ":var2", ":var0"),
    (try_for_range, ":var3", 0, ":var2"),
      (eq, ":var1", 0),
      (party_prisoner_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (troop_is_hero, ":var4"),
      (troop_slot_eq, ":var4", 2, 2),
      (store_troop_faction, ":var5", ":var4"),
      (store_random_in_range, ":var6", 0, 100),
      (try_begin),
        (faction_slot_eq, ":var5", 21, 0),
        (le, ":var6", 5),
        (neq, "$g_ransom_offer_rejected", 1),
        (assign, ":var2", 0),
        (assign, ":var1", 1),
        (assign, "$g_ransom_offer_troop", ":var4"),
        (assign, "$g_ransom_offer_party", ":var0"),
        (jump_to_menu, "mnu_enemy_offer_ransom_for_prisoner"),
      (try_end),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("event_hero_taken_prisoner_by_player",
  [
    (store_script_param_1, ":var0"),
    (try_begin),
      (check_quest_active, "qst_persuade_lords_to_make_peace"),
      (try_begin),
        (quest_slot_eq, "qst_persuade_lords_to_make_peace", 2, ":var0"),
        (val_mul, ":var0", -1),
        (quest_set_slot, "qst_persuade_lords_to_make_peace", 2, ":var0"),
        (val_mul, ":var0", -1),
      (else_try),
        (quest_slot_eq, "qst_persuade_lords_to_make_peace", 4, ":var0"),
        (val_mul, ":var0", -1),
        (quest_set_slot, "qst_persuade_lords_to_make_peace", 4, ":var0"),
        (val_mul, ":var0", -1),
      (try_end),
      (neg|check_quest_concluded, "qst_persuade_lords_to_make_peace"),
      (neg|quest_slot_ge, "qst_persuade_lords_to_make_peace", 2, 0),
      (neg|quest_slot_ge, "qst_persuade_lords_to_make_peace", 4, 0),
      (call_script, "script_succeed_quest", "qst_persuade_lords_to_make_peace"),
    (try_end),
    (call_script, "script_update_troop_location_notes", ":var0", 0),
  ]),

  ("cf_check_hero_can_escape_from_player",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (try_begin),
      (check_quest_active, "qst_persuade_lords_to_make_peace"),
      (this_or_next|quest_slot_eq, "qst_persuade_lords_to_make_peace", 2, ":var0"),
      (quest_slot_eq, "qst_persuade_lords_to_make_peace", 4, ":var0"),
      (assign, ":var1", 1),
    (try_end),
    (eq, ":var1", 0),
    (store_random_in_range, ":var2", 0, 100),
    (lt, ":var2", 0),
  ]),

  ("cf_party_remove_random_regular_troop",
  [
    (store_script_param_1, ":var0"),
    (party_get_num_companion_stacks, ":var1", ":var0"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", 0, ":var1"),
      (party_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (neg|troop_is_hero, ":var4"),
      (party_stack_get_size, ":var5", ":var0", ":var3"),
      (val_add, ":var2", ":var5"),
    (try_end),
    (assign, reg0, -1),
    (gt, ":var2", 0),
    (store_random_in_range, ":var6", 0, ":var2"),
    (try_for_range, ":var3", 0, ":var1"),
      (party_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (neg|troop_is_hero, ":var4"),
      (party_stack_get_size, ":var5", ":var0", ":var3"),
      (val_sub, ":var6", ":var5"),
      (lt, ":var6", 0),
      (assign, ":var1", 0),
      (party_remove_members, ":var0", ":var4", 1),
      (assign, reg0, ":var4"),
    (try_end),
  ]),

  ("place_player_banner_near_inventory",
  [
    (troop_get_slot, ":var0", "trp_player", 13),
    (try_begin),
      (gt, ":var0", 0),
      (scene_prop_get_instance, ":var1", ":var0", 0),
      (try_begin),
        (ge, ":var1", 0),
        (get_player_agent_no, ":var2"),
        (agent_get_look_position, pos1, ":var2"),
        (position_move_y, pos1, -500),
        (position_rotate_z, pos1, 180),
        (position_set_z_to_ground_level, pos1),
        (position_move_z, pos1, 300),
        (prop_instance_set_position, ":var1", pos1),
      (try_end),
      (scene_prop_get_instance, ":var3", "spr_banner_pole", 0),
      (try_begin),
        (ge, ":var3", 0),
        (position_move_z, pos1, -320),
        (prop_instance_set_position, ":var3", pos1),
      (try_end),
    (else_try),
      (init_position, pos1),
      (position_move_z, pos1, -1000000),
      (scene_prop_get_instance, ":var1", "spr_banner_a", 0),
      (try_begin),
        (ge, ":var1", 0),
        (prop_instance_set_position, ":var1", pos1),
      (try_end),
      (scene_prop_get_instance, ":var3", "spr_banner_pole", 0),
      (try_begin),
        (ge, ":var3", 0),
        (prop_instance_set_position, ":var3", pos1),
      (try_end),
    (try_end),
  ]),

  ("place_player_banner_near_inventory_bms",
  [
    (troop_get_slot, ":var0", "trp_player", 13),
    (try_begin),
      (gt, ":var0", 0),
      (replace_scene_props, "spr_banner_a", ":var0"),
    (try_end),
  ]),

  ("stay_captive_for_hours",
  [
    (store_script_param, ":var0", 1),
    (store_current_hours, ":var1"),
    (val_add, ":var1", ":var0"),
    (val_max, "$g_check_autos_at_hour", ":var1"),
    (val_add, ":var0", 1),
    (rest_for_hours, ":var0", 0, 0),
  ]),

  ("set_parties_around_player_ignore_player",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (try_for_parties, ":var2"),
      (party_is_active, ":var2"),
      (store_distance_to_party_from_party, ":var3", "p_main_party", ":var2"),
      (lt, ":var3", ":var0"),
      (party_ignore_player, ":var2", ":var1"),
    (try_end),
  ]),

  ("randomly_make_prisoner_heroes_escape_from_party",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", -1),
    (assign, ":var3", -1),
    (try_begin),
      (check_quest_active, "qst_rescue_lord_by_replace"),
      (quest_get_slot, ":var2", "qst_rescue_lord_by_replace", 2),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_deliver_message_to_prisoner_lord"),
      (quest_get_slot, ":var3", "qst_deliver_message_to_prisoner_lord", 2),
    (try_end),
    (party_get_num_prisoner_stacks, ":var4", ":var0"),
    (try_for_range_backwards, ":var5", 0, ":var4"),
      (party_prisoner_stack_get_troop_id, ":var6", ":var0", ":var5"),
      (troop_is_hero, ":var6"),
      (neq, ":var6", ":var2"),
      (neq, ":var6", ":var3"),
      (troop_slot_eq, ":var6", 2, 2),
      (store_random_in_range, ":var7", 0, 1000),
      (lt, ":var7", ":var1"),
      (party_remove_prisoners, ":var0", ":var6", 1),
      (call_script, "script_remove_troop_from_prison", ":var6"),
      (str_store_troop_name_link, s1, ":var6"),
      (try_begin),
        (eq, ":var0", "p_main_party"),
        (str_store_string, s2, "@your party"),
      (else_try),
        (str_store_party_name, s2, ":var0"),
      (try_end),
      (assign, reg0, 0),
      (try_begin),
        (this_or_next|eq, ":var0", "p_main_party"),
        (party_slot_eq, ":var0", 7, "trp_player"),
        (assign, reg0, 1),
      (try_end),
      (store_troop_faction, ":var8", ":var6"),
      (str_store_faction_name_link, s3, ":var8"),
      (display_message, "@{reg0?One of your prisoners, :}{s1} of {s3} has escaped from captivity!", 0xFFFF2222),
    (try_end),
  ]),

  ("fill_tournament_participants_troop",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (try_begin),
      (eq, ":var1", 1),
      (party_get_num_companion_stacks, ":var3", "p_main_party"),
      (try_for_range, ":var4", 0, ":var3"),
        (party_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
        (troop_is_hero, ":var5"),
        (neq, ":var5", "trp_kidnapped_girl"),
        (troop_set_slot, "trp_tournament_participants", ":var2", ":var5"),
        (val_add, ":var2", 1),
      (try_end),
    (try_end),
    (party_collect_attachments_to_party, ":var0", "p_temp_party"),
    (party_get_num_companion_stacks, ":var3", "p_temp_party"),
    (try_for_range, ":var4", 0, ":var3"),
      (party_stack_get_troop_id, ":var5", "p_temp_party", ":var4"),
      (troop_is_hero, ":var5"),
      (troop_set_slot, "trp_tournament_participants", ":var2", ":var5"),
      (val_add, ":var2", 1),
    (try_end),
    (try_begin),
      (store_random_in_range, ":var6", 0, 100),
      (lt, ":var6", 50),
      (troop_set_slot, "trp_tournament_participants", ":var2", "trp_xerina"),
      (val_add, ":var2", 1),
    (try_end),
    (try_begin),
      (store_random_in_range, ":var6", 0, 100),
      (lt, ":var6", 50),
      (troop_set_slot, "trp_tournament_participants", ":var2", "trp_dranton"),
      (val_add, ":var2", 1),
    (try_end),
    (try_begin),
      (store_random_in_range, ":var6", 0, 100),
      (lt, ":var6", 50),
      (troop_set_slot, "trp_tournament_participants", ":var2", "trp_kradus"),
      (val_add, ":var2", 1),
    (try_end),
    (assign, ":var7", ":var2"),
    (try_for_range, ":var2", ":var7", 64),
      (store_random_in_range, ":var6", 0, 4),
      (try_begin),
        (eq, ":var6", 0),
        (troop_set_slot, "trp_tournament_participants", ":var2", "trp_regular_fighter"),
      (else_try),
        (eq, ":var6", 1),
        (troop_set_slot, "trp_tournament_participants", ":var2", "trp_veteran_fighter"),
      (else_try),
        (eq, ":var6", 2),
        (troop_set_slot, "trp_tournament_participants", ":var2", "trp_champion_fighter"),
      (try_end),
    (try_end),
  ]),

  ("get_num_tournament_participants",
  [
    (assign, ":var0", 0),
    (try_for_range, ":var1", 0, 64),
      (troop_slot_ge, "trp_tournament_participants", ":var1", 0),
      (val_add, ":var0", 1),
    (try_end),
    (assign, reg0, ":var0"),
  ]),

  ("get_random_tournament_participant",
  [
    (call_script, "script_get_num_tournament_participants"),
    (assign, ":var0", reg0),
    (store_random_in_range, ":var1", 0, ":var0"),
    (assign, ":var2", 1),
    (try_for_range, ":var3", 0, 64),
      (eq, ":var2", 1),
      (troop_slot_ge, "trp_tournament_participants", ":var3", 0),
      (val_sub, ":var1", 1),
      (lt, ":var1", 0),
      (assign, ":var2", 0),
      (troop_get_slot, ":var4", "trp_tournament_participants", ":var3"),
      (troop_set_slot, "trp_tournament_participants", ":var3", -1),
    (try_end),
    (assign, reg0, ":var4"),
  ]),

  ("add_tournament_participant",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 1),
    (try_for_range, ":var2", 0, 64),
      (eq, ":var1", 1),
      (troop_slot_eq, "trp_tournament_participants", ":var2", -1),
      (troop_set_slot, "trp_tournament_participants", ":var2", ":var0"),
      (assign, ":var1", 0),
    (try_end),
  ]),

  ("get_random_tournament_team_amount_and_size",
  [
    (call_script, "script_get_num_tournament_participants"),
    (assign, ":var0", reg0),
    (party_get_slot, ":var1", "$current_town", 151),
    (val_add, ":var1", 1),
    (party_get_slot, ":var2", "$current_town", 152),
    (val_add, ":var2", 1),
    (assign, ":var3", ":var0"),
    (val_min, ":var3", ":var1"),
    (assign, ":var4", ":var0"),
    (val_min, ":var4", ":var2"),
    (assign, ":var5", 1),
    (try_begin),
      (ge, ":var0", 32),
      (assign, ":var5", 2),
      (val_min, ":var5", ":var2"),
    (try_end),
    (assign, ":var6", 500),
    (try_for_range, ":var7", 0, ":var6"),
      (store_random_in_range, ":var8", 2, ":var3"),
      (store_random_in_range, ":var9", ":var5", ":var4"),
      (store_mul, ":var10", ":var8", ":var9"),
      (le, ":var10", ":var0"),
      (store_sub, ":var11", ":var0", ":var10"),
      (neq, ":var11", 1),
      (assign, ":var6", 0),
    (try_end),
    (try_begin),
      (gt, ":var6", 0),
      (assign, ":var8", 2),
      (assign, ":var9", 1),
    (try_end),
    (assign, reg0, ":var8"),
    (assign, reg1, ":var9"),
  ]),

  ("get_troop_priority_point_for_tournament",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (try_begin),
      (ge, ":var0", 0),
      (val_add, ":var1", 40000),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (val_add, ":var1", 80000),
      (try_end),
      (try_begin),
        (troop_is_hero, ":var0"),
        (val_add, ":var1", 20000),
      (try_end),
      (try_begin),
        (troop_slot_eq, ":var0", 2, 3),
        (val_add, ":var1", 10000),
      (else_try),
        (troop_slot_eq, ":var0", 2, 2),
        (troop_get_slot, ":var2", ":var0", 7),
        (val_add, ":var1", ":var2"),
        (val_add, ":var1", 1000),
      (else_try),
        (store_character_level, ":var3", ":var0"),
        (val_add, ":var1", ":var3"),
      (try_end),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("sort_tournament_participant_troops",
  [
    (try_for_range, ":var0", 0, 63),
      (store_add, ":var1", ":var0", 1),
      (try_for_range, ":var2", ":var1", 64),
        (troop_get_slot, ":var3", "trp_tournament_participants", ":var0"),
        (troop_get_slot, ":var4", "trp_tournament_participants", ":var2"),
        (call_script, "script_get_troop_priority_point_for_tournament", ":var3"),
        (assign, ":var5", reg0),
        (call_script, "script_get_troop_priority_point_for_tournament", ":var4"),
        (assign, ":var6", reg0),
        (gt, ":var6", ":var5"),
        (troop_set_slot, "trp_tournament_participants", ":var0", ":var4"),
        (troop_set_slot, "trp_tournament_participants", ":var2", ":var3"),
      (try_end),
    (try_end),
  ]),

  ("remove_tournament_participants_randomly",
  [
    (store_script_param, ":var0", 1),
    (try_for_range, ":var1", 0, ":var0"),
      (assign, ":var2", 0),
      (try_for_range, ":var3", 0, 64),
        (troop_get_slot, ":var4", "trp_tournament_participants", ":var3"),
        (ge, ":var4", 0),
        (store_character_level, ":var5", ":var4"),
        (val_min, ":var5", 38),
        (store_sub, ":var6", 40, ":var5"),
        (val_add, ":var2", ":var6"),
      (try_end),
      (store_random_in_range, ":var7", 0, ":var2"),
      (assign, ":var8", 1),
      (try_for_range, ":var3", 0, 64),
        (eq, ":var8", 1),
        (troop_get_slot, ":var4", "trp_tournament_participants", ":var3"),
        (ge, ":var4", 0),
        (store_character_level, ":var5", ":var4"),
        (val_min, ":var5", 38),
        (store_sub, ":var6", 40, ":var5"),
        (val_sub, ":var7", ":var6"),
        (lt, ":var7", 0),
        (troop_set_slot, "trp_tournament_participants", ":var3", -1),
        (assign, ":var8", 0),
      (try_end),
    (try_end),
  ]),

  ("end_tournament_fight",
  [
    (store_script_param, ":var0", 1),
    (call_script, "script_get_num_tournament_participants"),
    (assign, ":var1", reg0),
    (store_div, ":var2", ":var1", 2),
    (call_script, "script_remove_tournament_participants_randomly", ":var2"),
    (assign, ":var3", "$g_tournament_num_participants_for_fight"),
    (val_div, ":var3", 2),
    (get_player_agent_no, ":var4"),
    (agent_get_team, ":var5", ":var4"),
    (try_for_agents, ":var6"),
      (agent_is_human, ":var6"),
      (agent_get_troop_id, ":var7", ":var6"),
      (neg|is_between, ":var7", "trp_town_1_arena_master", "trp_town_1_armorer"),
      (agent_get_team, ":var8", ":var6"),
      (assign, ":var9", 0),
      (try_begin),
        (eq, ":var0", 1),
        (eq, ":var8", ":var5"),
        (val_add, ":var9", 5000000),
      (try_end),
      (agent_get_kill_count, ":var10", ":var6", 1),
      (store_mul, ":var11", ":var10", 160000),
      (val_add, ":var9", ":var11"),
      (call_script, "script_get_troop_priority_point_for_tournament", ":var7"),
      (val_add, ":var9", reg0),
      (try_begin),
        (eq, ":var6", ":var4"),
        (eq, ":var0", 0),
        (assign, ":var12", 1),
        (try_begin),
          (ge, ":var10", 2),
          (assign, ":var12", 0),
        (else_try),
          (eq, ":var10", 1),
          (le, "$g_tournament_cur_tier", 1),
          (assign, ":var12", 0),
        (try_end),
        (eq, ":var12", 1),
        (assign, ":var9", 0),
      (try_end),
      (agent_set_slot, ":var6", 6, ":var9"),
    (try_end),
    (try_for_range, ":var13", 0, ":var3"),
      (assign, ":var14", 0),
      (assign, ":var15", -1),
      (try_for_agents, ":var6"),
        (agent_is_human, ":var6"),
        (agent_get_slot, ":var16", ":var6", 6),
        (gt, ":var16", ":var14"),
        (assign, ":var15", ":var6"),
        (assign, ":var14", ":var16"),
      (try_end),
      (agent_set_slot, ":var15", 6, 0),
      (agent_get_troop_id, ":var7", ":var15"),
      (call_script, "script_add_tournament_participant", ":var7"),
    (try_end),
    (assign, "$g_tournament_player_team_won", ":var0"),
    (jump_to_menu, "mnu_town_tournament"),
  ]),

  ("get_win_amount_for_tournament_bet",
  [
    (party_get_slot, ":var0", "$current_town", 51),
    (try_begin),
      (eq, "$g_tournament_cur_tier", 0),
      (assign, ":var1", 120),
    (else_try),
      (eq, "$g_tournament_cur_tier", 1),
      (assign, ":var1", 90),
    (else_try),
      (eq, "$g_tournament_cur_tier", 2),
      (assign, ":var1", 60),
    (else_try),
      (eq, "$g_tournament_cur_tier", 3),
      (assign, ":var1", 40),
    (else_try),
      (eq, "$g_tournament_cur_tier", 4),
      (assign, ":var1", 20),
    (else_try),
      (assign, ":var1", 8),
    (try_end),
    (val_mul, ":var1", ":var0"),
    (val_div, ":var1", 100),
    (val_add, ":var1", 100),
    (assign, reg0, ":var1"),
  ]),

  ("tournament_place_bet",
  [
    (store_script_param, ":var0", 1),
    (call_script, "script_get_win_amount_for_tournament_bet"),
    (assign, ":var1", reg0),
    (val_mul, ":var1", ":var0"),
    (val_div, ":var1", 100),
    (val_sub, ":var1", ":var0"),
    (val_add, "$g_tournament_bet_placed", ":var0"),
    (val_add, "$g_tournament_bet_win_amount", ":var1"),
    (troop_remove_gold, "trp_player", ":var0"),
    (assign, "$g_tournament_last_bet_tier", "$g_tournament_cur_tier"),
  ]),

  ("calculate_amount_of_cattle_can_be_stolen",
  [
    (store_script_param, ":var0", 1),
    (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
    (assign, ":var1", reg0),
    (store_mul, ":var2", ":var1", 2),
    (call_script, "script_party_count_fit_for_battle", "p_main_party"),
    (store_add, ":var3", reg0, 10),
    (val_div, ":var3", 10),
    (val_add, ":var2", ":var3"),
    (party_get_slot, ":var4", ":var0", 45),
    (val_min, ":var2", ":var4"),
    (assign, reg0, ":var2"),
  ]),

  ("draw_banner_to_region",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_script_param, ":var3", 4),
    (store_script_param, ":var4", 5),
    (store_script_param, ":var5", 6),
    (store_script_param, ":var6", 7),
    (store_script_param, ":var7", 8),
    (store_script_param, ":var8", 9),
    (store_script_param, ":var9", 10),
    (troop_get_slot, ":var10", ":var0", 91),
    (val_add, ":var10", "mesh_custom_banner_bg"),
    (troop_get_slot, ":var11", ":var0", 85),
    (troop_get_slot, ":var12", ":var0", 86),
    (troop_get_slot, ":var13", ":var0", 97),
    (troop_get_slot, ":var14", ":var0", 98),
    (call_script, "script_get_troop_custom_banner_num_positionings", ":var0"),
    (assign, ":var15", reg0),
    (val_mod, ":var14", ":var15"),
    (init_position, pos2),
    (position_set_x, pos2, ":var3"),
    (position_set_y, pos2, ":var4"),
    (assign, ":var16", 1),
    (convert_to_fixed_point, ":var16"),
    (position_set_z, pos2, ":var16"),
    (init_position, pos1),
    (position_set_x, pos1, ":var1"),
    (position_set_y, pos1, ":var2"),
    (position_move_z, pos1, -20),
    (init_position, pos3),
    (position_set_x, pos3, ":var7"),
    (position_set_y, pos3, ":var7"),
    (position_set_z, pos3, ":var16"),
    (try_begin),
      (this_or_next|eq, ":var10", "mesh_custom_banner_bg"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg01"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg02"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg03"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg08"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg09"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg10"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg11"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg12"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg13"),
      (this_or_next|eq, ":var10", "mesh_custom_banner_fg16"),
      (eq, ":var10", "mesh_custom_banner_fg17"),
      (cur_tableau_add_mesh_with_scale_and_vertex_color, ":var10", pos1, pos2, 0, ":var11"),
    (else_try),
      (cur_tableau_add_mesh_with_scale_and_vertex_color, ":var10", pos1, pos3, 0, ":var11"),
    (try_end),
    (position_move_z, pos1, -20),
    (position_move_x, pos2, ":var3"),
    (position_move_y, pos2, ":var4"),
    (cur_tableau_add_mesh_with_scale_and_vertex_color, "mesh_custom_banner_bg", pos1, pos2, 0, ":var12"),
    (assign, ":var17", ":var5"),
    (val_min, ":var17", ":var6"),
    (val_min, ":var17", ":var8"),
    (call_script, "script_get_custom_banner_charge_type_position_scale_color", "trp_player", ":var14"),
    (try_begin),
      (this_or_next|eq, ":var9", 2),
      (eq, ":var9", 3),
      (assign, ":var18", 0),
      (try_begin),
        (eq, ":var13", 1),
        (assign, ":var18", 1),
      (else_try),
        (eq, ":var13", 2),
        (eq, ":var14", 1),
        (assign, ":var18", 1),
      (else_try),
        (eq, ":var13", 3),
        (eq, ":var14", 1),
        (assign, ":var18", 1),
      (try_end),
      (try_begin),
        (eq, ":var18", 1),
        (val_add, ":var2", 30),
      (try_end),
    (try_end),
    (try_begin),
      (ge, ":var13", 1),
      (val_mul, reg1, ":var17"),
      (val_div, reg1, 10000),
      (position_get_x, ":var19", pos0),
      (position_get_y, ":var20", pos0),
      (val_mul, ":var19", ":var5"),
      (val_mul, ":var20", ":var6"),
      (val_div, ":var19", 10000),
      (val_div, ":var20", 10000),
      (val_add, ":var19", ":var1"),
      (val_add, ":var20", ":var2"),
      (position_set_x, pos0, ":var19"),
      (position_set_y, pos0, ":var20"),
      (assign, ":var21", reg1),
      (convert_to_fixed_point, ":var21"),
      (store_mul, ":var22", ":var21", -1),
      (init_position, pos4),
      (position_set_x, pos4, ":var21"),
      (position_set_y, pos4, ":var21"),
      (position_set_z, pos4, ":var21"),
      (store_div, ":var23", reg0, 256),
      (try_begin),
        (this_or_next|eq, ":var23", 1),
        (eq, ":var23", 3),
        (position_set_x, pos4, ":var22"),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var23", 2),
        (eq, ":var23", 3),
        (position_set_y, pos4, ":var22"),
      (try_end),
      (val_mod, reg0, 256),
      (cur_tableau_add_mesh_with_scale_and_vertex_color, reg0, pos0, pos4, 0, reg2),
    (try_end),
    (try_begin),
      (ge, ":var13", 2),
      (val_mul, reg4, ":var17"),
      (val_div, reg4, 10000),
      (position_get_x, ":var19", pos1),
      (position_get_y, ":var20", pos1),
      (val_mul, ":var19", ":var5"),
      (val_mul, ":var20", ":var6"),
      (val_div, ":var19", 10000),
      (val_div, ":var20", 10000),
      (val_add, ":var19", ":var1"),
      (val_add, ":var20", ":var2"),
      (position_set_x, pos1, ":var19"),
      (position_set_y, pos1, ":var20"),
      (assign, ":var21", reg4),
      (convert_to_fixed_point, ":var21"),
      (store_mul, ":var22", ":var21", -1),
      (init_position, pos4),
      (position_set_x, pos4, ":var21"),
      (position_set_y, pos4, ":var21"),
      (position_set_z, pos4, ":var21"),
      (store_div, ":var23", reg3, 256),
      (try_begin),
        (this_or_next|eq, ":var23", 1),
        (eq, ":var23", 3),
        (position_set_x, pos4, ":var22"),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var23", 2),
        (eq, ":var23", 3),
        (position_set_y, pos4, ":var22"),
      (try_end),
      (val_mod, reg3, 256),
      (cur_tableau_add_mesh_with_scale_and_vertex_color, reg3, pos1, pos4, 0, reg5),
    (try_end),
    (try_begin),
      (ge, ":var13", 3),
      (val_mul, reg7, ":var17"),
      (val_div, reg7, 10000),
      (position_get_x, ":var19", pos2),
      (position_get_y, ":var20", pos2),
      (val_mul, ":var19", ":var5"),
      (val_mul, ":var20", ":var6"),
      (val_div, ":var19", 10000),
      (val_div, ":var20", 10000),
      (val_add, ":var19", ":var1"),
      (val_add, ":var20", ":var2"),
      (position_set_x, pos2, ":var19"),
      (position_set_y, pos2, ":var20"),
      (assign, ":var21", reg7),
      (convert_to_fixed_point, ":var21"),
      (store_mul, ":var22", ":var21", -1),
      (init_position, pos4),
      (position_set_x, pos4, ":var21"),
      (position_set_y, pos4, ":var21"),
      (position_set_z, pos4, ":var21"),
      (store_div, ":var23", reg6, 256),
      (try_begin),
        (this_or_next|eq, ":var23", 1),
        (eq, ":var23", 3),
        (position_set_x, pos4, ":var22"),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var23", 2),
        (eq, ":var23", 3),
        (position_set_y, pos4, ":var22"),
      (try_end),
      (val_mod, reg6, 256),
      (cur_tableau_add_mesh_with_scale_and_vertex_color, reg6, pos2, pos4, 0, reg8),
    (try_end),
    (try_begin),
      (ge, ":var13", 4),
      (val_mul, reg10, ":var17"),
      (val_div, reg10, 10000),
      (position_get_x, ":var19", pos3),
      (position_get_y, ":var20", pos3),
      (val_mul, ":var19", ":var5"),
      (val_mul, ":var20", ":var6"),
      (val_div, ":var19", 10000),
      (val_div, ":var20", 10000),
      (val_add, ":var19", ":var1"),
      (val_add, ":var20", ":var2"),
      (position_set_x, pos3, ":var19"),
      (position_set_y, pos3, ":var20"),
      (assign, ":var21", reg10),
      (convert_to_fixed_point, ":var21"),
      (store_mul, ":var22", ":var21", -1),
      (init_position, pos4),
      (position_set_x, pos4, ":var21"),
      (position_set_y, pos4, ":var21"),
      (position_set_z, pos4, ":var21"),
      (store_div, ":var23", reg9, 256),
      (try_begin),
        (this_or_next|eq, ":var23", 1),
        (eq, ":var23", 3),
        (position_set_x, pos4, ":var22"),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var23", 2),
        (eq, ":var23", 3),
        (position_set_y, pos4, ":var22"),
      (try_end),
      (val_mod, reg9, 256),
      (cur_tableau_add_mesh_with_scale_and_vertex_color, reg9, pos3, pos4, 0, reg11),
    (try_end),
  ]),

  ("get_troop_custom_banner_num_positionings",
  [
    (store_script_param, ":var0", 1),
    (troop_get_slot, ":var1", ":var0", 97),
    (try_begin),
      (eq, ":var1", 1),
      (assign, ":var2", 2),
    (else_try),
      (eq, ":var1", 2),
      (assign, ":var2", 4),
    (else_try),
      (eq, ":var1", 3),
      (assign, ":var2", 6),
    (else_try),
      (assign, ":var2", 2),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("get_custom_banner_charge_type_position_scale_color",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (troop_get_slot, ":var2", ":var0", 97),
    (init_position, pos0),
    (init_position, pos1),
    (init_position, pos2),
    (init_position, pos3),
    (troop_get_slot, reg0, ":var0", 92),
    (val_add, reg0, "mesh_custom_banner_charge_01"),
    (troop_get_slot, reg2, ":var0", 87),
    (troop_get_slot, reg3, ":var0", 93),
    (val_add, reg3, "mesh_custom_banner_charge_01"),
    (troop_get_slot, reg5, ":var0", 88),
    (troop_get_slot, reg6, ":var0", 94),
    (val_add, reg6, "mesh_custom_banner_charge_01"),
    (troop_get_slot, reg8, ":var0", 89),
    (troop_get_slot, reg9, ":var0", 95),
    (val_add, reg9, "mesh_custom_banner_charge_01"),
    (troop_get_slot, reg11, ":var0", 90),
    (try_begin),
      (eq, ":var2", 1),
      (try_begin),
        (eq, ":var1", 0),
        (assign, reg1, 100),
      (else_try),
        (assign, reg1, 50),
      (try_end),
    (else_try),
      (eq, ":var2", 2),
      (try_begin),
        (eq, ":var1", 0),
        (position_set_y, pos0, 25),
        (position_set_y, pos1, -25),
        (assign, reg1, 40),
        (assign, reg4, 40),
      (else_try),
        (eq, ":var1", 1),
        (position_set_x, pos0, -25),
        (position_set_x, pos1, 25),
        (assign, reg1, 40),
        (assign, reg4, 40),
      (else_try),
        (eq, ":var1", 2),
        (position_set_x, pos0, -25),
        (position_set_y, pos0, 25),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, -25),
        (assign, reg1, 50),
        (assign, reg4, 50),
      (else_try),
        (position_set_x, pos0, -25),
        (position_set_y, pos0, -25),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, 25),
        (assign, reg1, 50),
        (assign, reg4, 50),
      (try_end),
    (else_try),
      (eq, ":var2", 3),
      (try_begin),
        (eq, ":var1", 0),
        (position_set_y, pos0, 33),
        (position_set_y, pos2, -33),
        (assign, reg1, 30),
        (assign, reg4, 30),
        (assign, reg7, 30),
      (else_try),
        (eq, ":var1", 1),
        (position_set_x, pos0, -33),
        (position_set_x, pos2, 33),
        (assign, reg1, 30),
        (assign, reg4, 30),
        (assign, reg7, 30),
      (else_try),
        (eq, ":var1", 2),
        (position_set_x, pos0, -30),
        (position_set_y, pos0, 30),
        (position_set_x, pos2, 30),
        (position_set_y, pos2, -30),
        (assign, reg1, 35),
        (assign, reg4, 35),
        (assign, reg7, 35),
      (else_try),
        (eq, ":var1", 3),
        (position_set_x, pos0, -30),
        (position_set_y, pos0, -30),
        (position_set_x, pos2, 30),
        (position_set_y, pos2, 30),
        (assign, reg1, 35),
        (assign, reg4, 35),
        (assign, reg7, 35),
      (else_try),
        (eq, ":var1", 4),
        (position_set_x, pos0, -25),
        (position_set_y, pos0, -25),
        (position_set_y, pos1, 25),
        (position_set_x, pos2, 25),
        (position_set_y, pos2, -25),
        (assign, reg1, 50),
        (assign, reg4, 50),
        (assign, reg7, 50),
      (else_try),
        (position_set_x, pos0, -25),
        (position_set_y, pos0, 25),
        (position_set_y, pos1, -25),
        (position_set_x, pos2, 25),
        (position_set_y, pos2, 25),
        (assign, reg1, 50),
        (assign, reg4, 50),
        (assign, reg7, 50),
      (try_end),
    (else_try),
      (try_begin),
        (eq, ":var1", 0),
        (position_set_x, pos0, -25),
        (position_set_y, pos0, 25),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, 25),
        (position_set_x, pos2, -25),
        (position_set_y, pos2, -25),
        (position_set_x, pos3, 25),
        (position_set_y, pos3, -25),
        (assign, reg1, 50),
        (assign, reg4, 50),
        (assign, reg7, 50),
        (assign, reg10, 50),
      (else_try),
        (position_set_y, pos0, 30),
        (position_set_x, pos1, -30),
        (position_set_x, pos2, 30),
        (position_set_y, pos3, -30),
        (assign, reg1, 35),
        (assign, reg4, 35),
        (assign, reg7, 35),
        (assign, reg10, 35),
      (try_end),
    (try_end),
  ]),

  ("get_random_custom_banner",
  [
    (store_script_param, ":var0", 1),
    (store_random_in_range, ":var1", 1, 5),
    (troop_set_slot, ":var0", 97, ":var1"),
    (store_random_in_range, ":var2", 0, 42),
    (call_script, "script_get_custom_banner_color_from_index", ":var2"),
    (assign, ":var3", reg0),
    (troop_set_slot, ":var0", 85, ":var3"),
    (assign, ":var4", 1),
    (try_for_range, ":var5", 0, ":var4"),
      (store_random_in_range, ":var2", 0, 42),
      (call_script, "script_get_custom_banner_color_from_index", ":var2"),
      (assign, ":var6", reg0),
      (try_begin),
        (call_script, "script_cf_check_color_visibility", ":var3", ":var6"),
        (troop_set_slot, ":var0", 86, ":var6"),
      (else_try),
        (val_add, ":var4", 1),
      (try_end),
    (try_end),
    (assign, ":var4", 4),
    (assign, ":var7", 0),
    (try_for_range, ":var5", 0, ":var4"),
      (store_random_in_range, ":var2", 0, 42),
      (call_script, "script_get_custom_banner_color_from_index", ":var2"),
      (assign, ":var8", reg0),
      (try_begin),
        (call_script, "script_cf_check_color_visibility", ":var8", ":var3"),
        (call_script, "script_cf_check_color_visibility", ":var8", ":var6"),
        (store_add, ":var9", ":var7", 87),
        (troop_set_slot, ":var0", ":var9", ":var8"),
        (store_random_in_range, ":var10", "mesh_custom_banner_charge_01", "mesh_tableau_mesh_custom_banner"),
        (val_sub, ":var10", "mesh_custom_banner_charge_01"),
        (store_add, ":var9", ":var7", 92),
        (troop_set_slot, ":var0", ":var9", ":var10"),
        (val_add, ":var7", 1),
      (else_try),
        (val_add, ":var4", 1),
      (try_end),
    (try_end),
    (store_random_in_range, ":var11", "mesh_custom_banner_bg", "mesh_custom_banner_charge_01"),
    (val_sub, ":var11", "mesh_custom_banner_bg"),
    (troop_set_slot, ":var0", 91, ":var11"),
    (store_random_in_range, ":var12", "mesh_custom_banner_01", "mesh_custom_banner_bg"),
    (val_sub, ":var12", "mesh_custom_banner_01"),
    (troop_set_slot, ":var0", 96, ":var12"),
    (store_random_in_range, ":var13", 0, 4),
    (troop_set_slot, ":var0", 98, ":var13"),
  ]),

  ("get_custom_banner_color_from_index",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 4278190080),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 0),
    (store_mod, ":var5", ":var0", 7),
    (try_begin),
      (eq, ":var5", 0),
      (assign, ":var4", 255),
    (else_try),
      (eq, ":var5", 1),
      (assign, ":var2", 238),
    (else_try),
      (eq, ":var5", 2),
      (assign, ":var2", 251),
      (assign, ":var3", 172),
    (else_try),
      (eq, ":var5", 3),
      (assign, ":var2", 95),
      (assign, ":var4", 255),
    (else_try),
      (eq, ":var5", 4),
      (assign, ":var2", 5),
      (assign, ":var3", 68),
    (else_try),
      (eq, ":var5", 5),
      (assign, ":var2", 238),
      (assign, ":var3", 238),
      (assign, ":var4", 238),
    (else_try),
      (assign, ":var2", 34),
      (assign, ":var3", 34),
      (assign, ":var4", 34),
    (try_end),
    (store_div, ":var6", ":var0", 7),
    (store_sub, ":var6", 8, ":var6"),
    (val_mul, ":var2", ":var6"),
    (val_div, ":var2", 8),
    (val_mul, ":var3", ":var6"),
    (val_div, ":var3", 8),
    (val_mul, ":var4", ":var6"),
    (val_div, ":var4", 8),
    (val_mul, ":var3", 256),
    (val_mul, ":var2", 65536),
    (val_add, ":var1", ":var4"),
    (val_add, ":var1", ":var3"),
    (val_add, ":var1", ":var2"),
    (assign, reg0, ":var1"),
  ]),

  ("cf_check_color_visibility",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_mod, ":var2", ":var0", 256),
    (store_div, ":var3", ":var0", 256),
    (val_mod, ":var3", 256),
    (store_div, ":var4", ":var0", 65536),
    (val_mod, ":var4", 256),
    (store_mod, ":var5", ":var1", 256),
    (store_div, ":var6", ":var1", 256),
    (val_mod, ":var6", 256),
    (store_div, ":var7", ":var1", 65536),
    (val_mod, ":var7", 256),
    (store_sub, ":var8", ":var4", ":var7"),
    (val_abs, ":var8"),
    (store_sub, ":var9", ":var3", ":var6"),
    (val_abs, ":var9"),
    (store_sub, ":var10", ":var2", ":var5"),
    (val_abs, ":var10"),
    (assign, ":var11", 0),
    (val_max, ":var11", ":var8"),
    (val_max, ":var11", ":var9"),
    (val_max, ":var11", ":var10"),
    (ge, ":var11", 64),
  ]),

  ("get_next_active_kingdom",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", "fac_kingdoms_end"),
    (try_for_range, ":var2", "fac_player_supporters_faction", ":var1"),
      (val_add, ":var0", 1),
      (try_begin),
        (ge, ":var0", "fac_kingdoms_end"),
        (assign, ":var0", "fac_player_supporters_faction"),
      (try_end),
      (faction_slot_eq, ":var0", 21, 0),
      (neq, ":var0", "fac_player_supporters_faction"),
      (assign, ":var1", 0),
    (try_end),
    (assign, reg0, ":var0"),
  ]),

  ("store_average_center_value_per_faction",
  [
    (store_sub, ":var0", "p_castle_1", "p_town_1"),
    (store_sub, ":var1", "p_village_1", "p_castle_1"),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var3", 21, 0),
      (val_add, ":var2", 1),
    (try_end),
    (val_max, ":var2", 1),
    (store_mul, "$g_average_center_value_per_faction", ":var0", 2),
    (val_add, "$g_average_center_value_per_faction", ":var1"),
    (val_mul, "$g_average_center_value_per_faction", 10),
    (val_div, "$g_average_center_value_per_faction", ":var2"),
  ]),

  ("remove_cattles_if_herd_is_close_to_party",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", ":var1"),
    (try_for_parties, ":var3"),
      (gt, ":var2", 0),
      (party_slot_eq, ":var3", 0, 17),
      (store_distance_to_party_from_party, ":var4", ":var3", ":var0"),
      (lt, ":var4", 3),
      (assign, ":var5", 1),
      (try_begin),
        (check_quest_active, "qst_move_cattle_herd"),
        (quest_slot_eq, "qst_move_cattle_herd", 8, ":var3"),
        (assign, ":var5", 0),
      (try_end),
      (eq, ":var5", 1),
      (party_count_companions_of_type, ":var6", ":var3", "trp_cattle"),
      (try_begin),
        (le, ":var6", ":var2"),
        (assign, ":var7", ":var6"),
        (remove_party, ":var3"),
      (else_try),
        (assign, ":var7", ":var2"),
        (party_remove_members, ":var3", "trp_cattle", ":var2"),
      (try_end),
      (val_sub, ":var2", ":var7"),
      (try_begin),
        (party_slot_eq, ":var0", 0, 4),
        (party_get_slot, ":var8", ":var0", 45),
        (val_add, ":var8", ":var7"),
        (party_set_slot, ":var0", 45, ":var8"),
      (try_end),
      (assign, reg3, ":var7"),
      (str_store_party_name_link, s1, ":var0"),
      (display_message, "@You brought {reg3} heads of cattle herd to {s1}."),
    (try_end),
    (store_sub, reg0, ":var1", ":var2"),
  ]),

  ("get_rumor_to_s61",
  [
    (store_script_param, ":var0", 1),
    (store_current_hours, ":var1"),
    (store_div, ":var2", ":var1", 24),
    (assign, ":var3", 0),
    (assign, ":var4", 3),
    (try_for_range, ":var5", 0, ":var4"),
      (store_mul, ":var6", ":var5", 6781),
      (val_add, ":var6", ":var0"),
      (store_mod, ":var7", ":var6", 7),
      (val_add, ":var6", ":var1"),
      (try_begin),
        (eq, ":var7", 0),
        (str_store_string, s61, "@I heard that cholera is on the rise 'round these parts. Be careful where you water your horses."),
        (assign, ":var3", 1),
      (else_try),
        (eq, ":var7", 1),
        (try_begin),
          (store_sub, ":var8", "trp_knight_1_1_wife", "trp_kingdom_1_lord"),
          (store_mod, ":var9", ":var6", ":var8"),
          (val_add, ":var9", "trp_kingdom_1_lord"),
          (troop_get_slot, ":var10", ":var9", 52),
          (gt, ":var10", 0),
          (store_add, ":var11", ":var10", "str_gossip_about_character_default"),
          (str_store_troop_name, s6, ":var9"),
          (str_store_string, s61, ":var11"),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, ":var7", 2),
        (try_begin),
          (store_sub, ":var8", "itm_gold_bar", "itm_smoked_fish"),
          (store_add, ":var12", ":var6", ":var2"),
          (store_mod, ":var12", ":var12", ":var8"),
          (store_add, ":var13", ":var12", 234),
          (val_add, ":var12", "itm_smoked_fish"),
          (store_mul, ":var14", 1000, 3),
          (val_div, ":var14", 4),
          (assign, ":var15", -1),
          (try_for_range, ":var16", 0, 10),
            (store_sub, ":var8", "p_castle_1", "p_town_1"),
            (store_add, ":var17", ":var6", ":var16"),
            (store_mod, ":var18", ":var17", ":var8"),
            (val_add, ":var18", "p_town_1"),
            (neq, ":var18", "$g_encountered_party"),
            (party_get_slot, ":var19", ":var18", ":var13"),
            (lt, ":var19", ":var14"),
            (assign, ":var14", ":var19"),
            (assign, ":var15", ":var18"),
          (try_end),
          (ge, ":var15", 0),
          (str_store_item_name, s62, ":var12"),
          (str_store_party_name, s63, ":var15"),
          (str_store_string, s61, "@I heard that one can buy {s62} very cheap at {s63}."),
          (assign, ":var3", 1),
        (try_end),
      (else_try),
        (eq, ":var7", 3),
        (try_begin),
          (store_sub, ":var8", "itm_gold_bar", "itm_smoked_fish"),
          (store_add, ":var12", ":var6", ":var2"),
          (store_mod, ":var12", ":var12", ":var8"),
          (store_add, ":var13", ":var12", 234),
          (val_add, ":var12", "itm_smoked_fish"),
          (store_mul, ":var20", 1000, 5),
          (val_div, ":var20", 4),
          (assign, ":var21", -1),
          (try_for_range, ":var16", 0, 10),
            (store_sub, ":var8", "p_castle_1", "p_town_1"),
            (store_add, ":var17", ":var6", ":var16"),
            (store_mod, ":var18", ":var17", ":var8"),
            (val_add, ":var18", "p_town_1"),
            (neq, ":var18", "$g_encountered_party"),
            (party_get_slot, ":var19", ":var18", ":var13"),
            (gt, ":var19", ":var20"),
            (assign, ":var20", ":var19"),
            (assign, ":var21", ":var18"),
          (try_end),
          (ge, ":var21", 0),
          (str_store_item_name, s62, ":var12"),
          (str_store_party_name, s63, ":var21"),
          (str_store_string, s61, "@I heard that they pay a very high price for {s62} at {s63}."),
          (assign, ":var3", 1),
        (try_end),
      (try_end),
      (try_begin),
        (gt, ":var3", 0),
        (assign, ":var4", 0),
      (try_end),
    (try_end),
    (assign, reg0, ":var3"),
  ]),

  ("lord_comment_to_s43",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (troop_get_slot, ":var2", ":var0", 52),
    (val_add, ":var2", ":var1"),
    (str_store_string, s43, ":var2"),
  ]),

  ("add_log_entry",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_script_param, ":var3", 4),
    (store_script_param, ":var4", 5),
    (assign, ":var5", -1),
    (assign, ":var6", -1),
    (assign, ":var7", -1),
    (try_begin),
      (gt, ":var2", 0),
      (party_get_slot, ":var5", ":var2", 7),
      (store_faction_of_party, ":var6", ":var2"),
    (try_end),
    (try_begin),
      (ge, ":var3", 0),
      (store_troop_faction, ":var7", ":var3"),
    (try_end),
    (val_add, "$num_log_entries", 1),
    (store_current_hours, ":var8"),
    (troop_set_slot, "trp_log_array_entry_type", "$num_log_entries", ":var0"),
    (troop_set_slot, "trp_log_array_entry_time", "$num_log_entries", ":var8"),
    (troop_set_slot, "trp_log_array_actor", "$num_log_entries", ":var1"),
    (troop_set_slot, "trp_log_array_center_object", "$num_log_entries", ":var2"),
    (troop_set_slot, "trp_log_array_center_object_lord", "$num_log_entries", ":var5"),
    (troop_set_slot, "trp_log_array_center_object_faction", "$num_log_entries", ":var6"),
    (troop_set_slot, "trp_log_array_troop_object", "$num_log_entries", ":var3"),
    (troop_set_slot, "trp_log_array_troop_object_faction", "$num_log_entries", ":var7"),
    (troop_set_slot, "trp_log_array_faction_object", "$num_log_entries", ":var4"),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (assign, reg3, "$num_log_entries"),
      (assign, reg4, ":var0"),
      (display_message, "@Log entry {reg3}: type {reg4}"),
      (try_begin),
        (gt, ":var2", 0),
        (str_store_party_name, s4, ":var2"),
        (display_message, "@Center: {s4}"),
      (try_end),
      (try_begin),
        (gt, ":var3", 0),
        (str_store_troop_name, s4, ":var3"),
        (display_message, "@Troop: {s4}"),
      (try_end),
      (try_begin),
        (gt, ":var5", 0),
        (str_store_troop_name, s4, ":var5"),
        (display_message, "@Lord: {s4}"),
      (try_end),
    (try_end),
    (try_begin),
      (this_or_next|gt, "$g_ally_party", 0),
      (eq, ":var0", 18),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (display_message, "@Ally party is present"),
      (try_end),
      (try_for_range, ":var9", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (party_count_companions_of_type, ":var10", "p_collective_friends", ":var9"),
        (gt, ":var10", 0),
        (troop_set_slot, ":var9", 19, "$num_log_entries"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (str_store_troop_name, s4, ":var9"),
          (display_message, "@{s4} is present at event"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("get_relevant_comment_for_log_entry",
  [
    (store_script_param, ":var0", 1),
    (troop_get_slot, ":var1", "trp_log_array_entry_type", ":var0"),
    (troop_get_slot, ":var2", "trp_log_array_entry_time", ":var0"),
    (troop_get_slot, ":var3", "trp_log_array_actor", ":var0"),
    (troop_get_slot, ":var4", "trp_log_array_center_object_lord", ":var0"),
    (troop_get_slot, ":var5", "trp_log_array_center_object_faction", ":var0"),
    (troop_get_slot, ":var6", "trp_log_array_troop_object", ":var0"),
    (troop_get_slot, ":var7", "trp_log_array_troop_object_faction", ":var0"),
    (troop_get_slot, ":var8", "trp_log_array_faction_object", ":var0"),
    (assign, ":var9", 0),
    (assign, ":var10", -1),
    (assign, ":var11", 0),
    (troop_get_slot, ":var12", "$g_talk_troop", 52),
    (store_current_hours, ":var13"),
    (store_sub, ":var14", ":var13", ":var2"),
    (assign, ":var15", 0),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (try_begin),
        (assign, reg5, ":var0"),
        (assign, reg6, ":var1"),
        (assign, reg8, ":var2"),
        (gt, "$players_kingdom", 0),
        (try_begin),
          (gt, ":var7", 0),
          (store_relation, ":var15", "$players_kingdom", ":var7"),
          (assign, reg7, ":var15"),
          (display_message, "@Event #{reg5}, type {reg6}, time {reg8}: player's kingdom relation to troop object = {reg7}"),
        (else_try),
          (gt, ":var5", 0),
          (store_relation, ":var15", "$players_kingdom", ":var5"),
          (assign, reg7, ":var15"),
          (display_message, "@Event #{reg5}, type {reg6}, time {reg8}: player's kingdom relation to center object faction = {reg7}"),
        (else_try),
          (gt, ":var8", 0),
          (store_relation, ":var15", "$players_kingdom", ":var8"),
          (assign, reg7, ":var15"),
          (display_message, "@Event #{reg5}, type {reg6}, time {reg8}: player's kingdom relation to faction object = {reg7}"),
        (else_try),
          (display_message, "@Event #{reg5}, type {reg6}, time {reg8}. No relevant kingdom relation"),
        (try_end),
      (else_try),
        (display_message, "@Event #{reg5}, type {reg6}, time {reg8}. Player unaffiliated"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var1", 31),
      (eq, "$g_talk_troop_met", 0),
      (is_between, "$g_talk_troop_faction_relation", -5, 5),
      (is_between, "$g_talk_troop_relation", -5, 5),
      (assign, ":var9", 25),
      (troop_get_slot, ":var16", "trp_player", 7),
      (troop_get_slot, ":var17", "trp_player", 13),
      (store_random_in_range, ":var18", 100, 200),
      (try_begin),
        (eq, ":var12", 0),
        (gt, "$players_kingdom", 0),
        (assign, ":var10", "str_comment_intro_liege_affiliated"),
      (else_try),
        (gt, ":var16", ":var18"),
        (assign, ":var10", "str_comment_intro_famous_liege"),
        (val_add, ":var10", ":var12"),
      (else_try),
        (gt, ":var17", 0),
        (assign, ":var10", "str_comment_intro_noble_liege"),
        (val_add, ":var10", ":var12"),
      (else_try),
        (assign, ":var10", "str_comment_intro_common_liege"),
        (val_add, ":var10", ":var12"),
      (try_end),
    (else_try),
      (eq, ":var1", 1),
      (eq, ":var3", "trp_player"),
      (try_begin),
        (eq, ":var4", "$g_talk_troop"),
        (assign, ":var9", 200),
        (assign, ":var11", -1),
        (assign, ":var10", "str_comment_you_raided_my_village_default"),
        (try_begin),
          (lt, "$g_talk_troop_faction_relation", -5),
          (this_or_next|eq, ":var12", 6),
          (eq, ":var12", 7),
          (assign, ":var10", "str_comment_you_raided_my_village_enemy_benevolent"),
        (else_try),
          (lt, "$g_talk_troop_faction_relation", -5),
          (this_or_next|eq, ":var12", 4),
          (eq, ":var12", 3),
          (assign, ":var10", "str_comment_you_raided_my_village_enemy_coldblooded"),
        (else_try),
          (lt, "$g_talk_troop_faction_relation", -5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_you_raided_my_village_enemy_spiteful"),
        (else_try),
          (lt, "$g_talk_troop_faction_relation", -5),
          (assign, ":var10", "str_comment_you_raided_my_village_enemy"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_you_raided_my_village_unfriendly_spiteful"),
        (else_try),
          (gt, "$g_talk_troop_relation", 5),
          (assign, ":var10", "str_comment_you_raided_my_village_friendly"),
        (try_end),
      (try_end),
    (else_try),
      (eq, ":var1", 2),
      (eq, ":var3", "trp_player"),
      (try_begin),
        (eq, ":var4", "$g_talk_troop"),
        (assign, ":var9", 30),
        (assign, ":var11", -1),
        (assign, ":var10", "str_comment_you_robbed_my_village_default"),
        (try_begin),
          (lt, "$g_talk_troop_faction_relation", -5),
          (this_or_next|eq, ":var12", 4),
          (eq, ":var12", 3),
          (assign, ":var10", "str_comment_you_robbed_my_village_enemy_coldblooded"),
        (else_try),
          (lt, "$g_talk_troop_faction_relation", -5),
          (assign, ":var10", "str_comment_you_robbed_my_village_enemy"),
        (else_try),
          (gt, "$g_talk_troop_relation", 5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_you_robbed_my_village_friendly_spiteful"),
        (else_try),
          (gt, "$g_talk_troop_relation", 5),
          (assign, ":var10", "str_comment_you_robbed_my_village_friendly"),
        (try_end),
      (try_end),
    (else_try),
      (eq, ":var1", 3),
      (eq, ":var3", "trp_player"),
      (eq, ":var8", "$g_talk_troop_faction"),
      (faction_slot_eq, "$g_talk_troop_faction", 10, "$g_talk_troop"),
      (assign, ":var9", 30),
      (assign, ":var11", -1),
      (assign, ":var10", "str_comment_you_accosted_my_caravan_default"),
      (try_begin),
        (lt, "$g_talk_troop_faction_relation", -5),
        (assign, ":var10", "str_comment_you_accosted_my_caravan_enemy"),
      (try_end),
    (else_try),
      (eq, ":var1", 4),
      (eq, ":var3", "trp_player"),
      (try_begin),
        (eq, ":var4", "$g_talk_troop"),
        (assign, ":var9", 40),
        (assign, ":var11", 0),
        (try_begin),
          (this_or_next|eq, ":var12", 6),
          (eq, ":var12", 7),
          (assign, ":var10", "str_comment_you_helped_villagers_benevolent"),
          (assign, ":var11", 1),
        (else_try),
          (gt, "$g_talk_troop_relation", 5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_you_helped_villagers_friendly_cruel"),
          (assign, ":var11", -1),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_you_helped_villagers_unfriendly_spiteful"),
          (assign, ":var11", -1),
        (else_try),
          (gt, "$g_talk_troop_relation", 5),
          (assign, ":var10", "str_comment_you_helped_villagers_friendly"),
        (else_try),
          (this_or_next|eq, ":var12", 3),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_you_helped_villagers_cruel"),
          (assign, ":var11", -1),
        (else_try),
          (assign, ":var10", "str_comment_you_helped_villagers_default"),
        (try_end),
      (try_end),
    (else_try),
      (eq, ":var1", 10),
      (try_begin),
        (eq, ":var4", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_captured_my_castle_enemy_spiteful"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var4", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 6),
        (assign, ":var10", "str_comment_you_captured_my_castle_enemy_chivalrous"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var4", "$g_talk_troop"),
        (assign, ":var10", "str_comment_you_captured_my_castle_enemy"),
        (assign, ":var9", 200),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_captured_a_castle_allied_spiteful"),
        (assign, ":var9", 75),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (gt, "$g_talk_troop_relation", 5),
        (assign, ":var10", "str_comment_you_captured_a_castle_allied_friendly"),
        (assign, ":var9", 75),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_captured_a_castle_allied_unfriendly_spiteful"),
        (assign, ":var9", 75),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (lt, "$g_talk_troop_relation", -5),
        (assign, ":var10", "str_comment_you_captured_a_castle_allied_unfriendly"),
        (assign, ":var9", 75),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (assign, ":var10", "str_comment_you_captured_a_castle_allied"),
        (assign, ":var9", 75),
      (try_end),
    (else_try),
      (this_or_next|eq, ":var1", 11),
      (eq, ":var1", 17),
      (troop_slot_eq, "$g_talk_troop", 19, ":var0"),
      (try_begin),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_defeated_a_lord_unfriendly_spiteful"),
        (assign, ":var9", 150),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (assign, ":var10", "str_comment_we_defeated_a_lord_unfriendly"),
        (assign, ":var9", 150),
      (else_try),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_defeated_a_lord_cruel"),
        (assign, ":var9", 150),
      (else_try),
        (eq, ":var12", 2),
        (assign, ":var10", "str_comment_we_defeated_a_lord_cruel"),
        (assign, ":var9", 150),
      (else_try),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_we_defeated_a_lord_upstanding"),
        (assign, ":var9", 150),
      (else_try),
        (assign, ":var10", "str_comment_we_defeated_a_lord_default"),
        (assign, ":var9", 150),
      (try_end),
    (else_try),
      (this_or_next|eq, ":var1", 10),
      (eq, ":var1", 18),
      (troop_slot_eq, "$g_talk_troop", 19, ":var0"),
      (try_begin),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_fought_in_siege_unfriendly_spiteful"),
        (assign, ":var9", 150),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (assign, ":var10", "str_comment_we_fought_in_siege_unfriendly"),
        (assign, ":var9", 150),
      (else_try),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_fought_in_siege_cruel"),
        (assign, ":var9", 150),
      (else_try),
        (eq, ":var12", 2),
        (assign, ":var10", "str_comment_we_fought_in_siege_quarrelsome"),
        (assign, ":var9", 150),
      (else_try),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_we_fought_in_siege_upstanding"),
        (assign, ":var9", 150),
      (else_try),
        (assign, ":var10", "str_comment_we_fought_in_siege_default"),
        (assign, ":var9", 150),
      (try_end),
    (else_try),
      (eq, ":var1", 19),
      (troop_slot_eq, "$g_talk_troop", 19, ":var0"),
      (try_begin),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_fought_in_major_battle_unfriendly_spiteful"),
        (assign, ":var9", 150),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (assign, ":var10", "str_comment_we_fought_in_major_battle_unfriendly"),
        (assign, ":var9", 150),
      (else_try),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_fought_in_major_battle_cruel"),
        (assign, ":var9", 150),
      (else_try),
        (eq, ":var12", 2),
        (assign, ":var10", "str_comment_we_fought_in_major_battle_cruel"),
        (assign, ":var9", 150),
      (else_try),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_we_fought_in_major_battle_upstanding"),
        (assign, ":var9", 150),
      (else_try),
        (assign, ":var10", "str_comment_we_fought_in_major_battle_default"),
        (assign, ":var9", 150),
      (try_end),
    (else_try),
      (eq, ":var1", 11),
      (try_begin),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 6),
        (assign, ":var10", "str_comment_you_defeated_me_enemy_chivalrous"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 5),
        (eq, ":var12", 2),
        (assign, ":var10", "str_comment_you_defeated_me_enemy_spiteful"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (assign, ":var10", "str_comment_you_defeated_me_enemy"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 7),
        (eq, ":var12", 4),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy_pragmatic"),
        (assign, ":var9", 85),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 6),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy_chivalrous"),
        (assign, ":var9", 85),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy_spiteful"),
        (assign, ":var9", 85),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy"),
        (assign, ":var9", 85),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (faction_slot_eq, "$players_kingdom", 10, "$g_talk_troop"),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_liege"),
        (assign, ":var9", 70),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_unfriendly_spiteful"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_spiteful"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 7),
        (eq, ":var12", 1),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_unfriendly_chivalrous"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied"),
        (assign, ":var9", 65),
      (try_end),
    (else_try),
      (eq, ":var1", 11),
      (try_begin),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 6),
        (assign, ":var10", "str_comment_you_defeated_me_enemy_chivalrous"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 5),
        (eq, ":var12", 2),
        (assign, ":var10", "str_comment_you_defeated_me_enemy_spiteful"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (assign, ":var10", "str_comment_you_defeated_me_enemy"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 7),
        (eq, ":var12", 4),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy_pragmatic"),
        (assign, ":var9", 85),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 6),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy_chivalrous"),
        (assign, ":var9", 85),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy_spiteful"),
        (assign, ":var9", 85),
      (else_try),
        (eq, ":var7", "$g_talk_troop_faction"),
        (assign, ":var10", "str_comment_you_defeated_my_friend_enemy"),
        (assign, ":var9", 85),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (faction_slot_eq, "$players_kingdom", 10, "$g_talk_troop"),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_liege"),
        (assign, ":var9", 70),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_unfriendly_spiteful"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_spiteful"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 7),
        (eq, ":var12", 1),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied_unfriendly_chivalrous"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (assign, ":var10", "str_comment_you_defeated_a_lord_allied"),
        (assign, ":var9", 65),
      (try_end),
    (else_try),
      (eq, ":var1", 17),
      (neq, ":var6", "$g_talk_troop"),
      (eq, ":var7", "$g_talk_troop_faction"),
      (try_begin),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 7),
        (eq, ":var12", 1),
        (assign, ":var10", "str_comment_you_helped_my_ally_unfriendly_chivalrous"),
        (assign, ":var9", 65),
        (assign, ":var11", 2),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (assign, ":var10", "str_comment_you_helped_my_ally_unfriendly"),
        (assign, ":var9", 0),
      (else_try),
        (eq, ":var12", 0),
        (assign, ":var10", "str_comment_you_helped_my_ally_liege"),
        (assign, ":var9", 65),
        (assign, ":var11", 3),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_helped_my_ally_unfriendly_spiteful"),
        (assign, ":var9", 65),
      (else_try),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_helped_my_ally_spiteful"),
        (assign, ":var9", 65),
      (else_try),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_you_helped_my_ally_chivalrous"),
        (assign, ":var9", 65),
        (assign, ":var11", 2),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (assign, ":var10", "str_comment_you_helped_my_ally_default"),
      (try_end),
    (else_try),
      (eq, ":var1", 14),
      (troop_slot_eq, "$g_talk_troop", 19, ":var0"),
      (try_begin),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_were_defeated_unfriendly_spiteful"),
        (assign, ":var9", 150),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (assign, ":var10", "str_comment_we_were_defeated_unfriendly"),
        (assign, ":var9", 150),
      (else_try),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_we_were_defeated_cruel"),
        (assign, ":var9", 150),
      (else_try),
        (assign, ":var10", "str_comment_we_were_defeated_default"),
        (assign, ":var9", 150),
      (try_end),
    (else_try),
      (eq, ":var1", 14),
      (try_begin),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_i_defeated_you_enemy_spiteful"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (eq, ":var12", 1),
        (assign, ":var10", "str_comment_i_defeated_you_enemy_chivalrous"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 6),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_i_defeated_you_enemy_benevolent"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 4),
        (assign, ":var10", "str_comment_i_defeated_you_enemy_coldblooded"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (assign, ":var10", "str_comment_i_defeated_you_enemy"),
        (assign, ":var9", 200),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (assign, ":var10", "str_comment_i_defeated_you_enemy"),
        (assign, ":var9", 200),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (gt, "$g_talk_troop_relation", 5),
        (assign, ":var10", "str_comment_you_were_defeated_allied_friendly_spiteful"),
        (assign, ":var9", 80),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 5),
        (lt, "$g_talk_troop_relation", -5),
        (assign, ":var10", "str_comment_you_were_defeated_allied_unfriendly_cruel"),
        (assign, ":var9", 80),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (le, "$g_talk_troop_relation", 5),
        (assign, ":var10", "str_comment_you_were_defeated_allied_spiteful"),
        (assign, ":var9", 80),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (eq, ":var12", 3),
        (assign, ":var10", "str_comment_you_were_defeated_allied_pitiless"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (eq, ":var12", 7),
        (lt, "$g_talk_troop_relation", -15),
        (assign, ":var10", "str_comment_you_were_defeated_allied_unfriendly_upstanding"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, "$g_talk_troop_relation", -10),
        (assign, ":var10", "str_comment_you_were_defeated_allied_unfriendly"),
        (assign, ":var9", 65),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (assign, ":var10", "str_comment_you_were_defeated_allied"),
        (assign, ":var9", 65),
      (try_end),
    (else_try),
      (eq, ":var1", 15),
      (troop_slot_eq, "$g_talk_troop", 19, ":var0"),
      (try_begin),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_abandoned_us_unfriendly_spiteful"),
        (assign, ":var9", 150),
        (assign, ":var11", -5),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (eq, ":var12", 3),
        (assign, ":var10", "str_comment_you_abandoned_us_unfriendly_pitiless"),
        (assign, ":var9", 150),
        (assign, ":var11", -5),
      (else_try),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_abandoned_us_spiteful"),
        (assign, ":var11", -5),
      (else_try),
        (eq, ":var12", 1),
        (assign, ":var10", "str_comment_you_abandoned_us_chivalrous"),
        (assign, ":var9", 150),
        (assign, ":var11", -2),
      (else_try),
        (this_or_next|eq, ":var12", 7),
        (eq, ":var12", 6),
        (assign, ":var10", "str_comment_you_abandoned_us_benefitofdoubt"),
        (assign, ":var9", 150),
        (assign, ":var11", -1),
      (else_try),
        (assign, ":var10", "str_comment_you_abandoned_us_default"),
        (assign, ":var9", 150),
        (assign, ":var11", -2),
      (try_end),
    (else_try),
      (this_or_next|eq, ":var1", 15),
      (eq, ":var1", 16),
      (eq, ":var6", "$g_talk_troop"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (assign, reg7, ":var14"),
        (display_message, "@Elapsed hours: {reg7}"),
      (try_end),
      (gt, ":var14", 2),
      (try_begin),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_ran_from_me_enemy_spiteful"),
        (assign, ":var9", 25),
      (else_try),
        (eq, ":var12", 1),
        (assign, ":var10", "str_comment_you_ran_from_me_enemy_chivalrous"),
        (assign, ":var9", 25),
      (else_try),
        (this_or_next|eq, ":var12", 6),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_you_ran_from_me_enemy_benevolent"),
        (assign, ":var9", 25),
      (else_try),
        (eq, ":var12", 4),
        (assign, ":var10", "str_comment_you_ran_from_me_enemy_coldblooded"),
        (assign, ":var9", 25),
      (else_try),
        (assign, ":var10", "str_comment_you_ran_from_me_enemy"),
        (assign, ":var9", 25),
      (try_end),
    (else_try),
      (eq, ":var1", 16),
      (try_begin),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (neq, ":var6", "$g_talk_troop"),
        (lt, "$g_talk_troop_relation", 5),
        (eq, ":var12", 1),
        (assign, ":var10", "str_comment_you_ran_from_foe_allied_chivalrous"),
        (assign, ":var9", 80),
        (assign, ":var11", -3),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (neq, ":var6", "$g_talk_troop"),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_you_ran_from_foe_allied_upstanding"),
        (assign, ":var9", 80),
        (assign, ":var11", -1),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (neq, ":var6", "$g_talk_troop"),
        (lt, "$g_talk_troop_relation", 5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_ran_from_foe_allied_spiteful"),
        (assign, ":var9", 80),
      (try_end),
    (else_try),
      (eq, ":var1", 13),
      (try_begin),
        (eq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_let_me_go_spiteful"),
        (assign, ":var9", 300),
        (assign, ":var11", -15),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (ge, "$g_talk_troop_faction_relation", 0),
        (assign, ":var10", "str_comment_you_let_me_go_default"),
        (assign, ":var9", 300),
        (assign, ":var11", 2),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (lt, "$g_talk_troop_faction_relation", 0),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 7),
        (assign, ":var11", 5),
        (assign, ":var9", 300),
        (assign, ":var10", "str_comment_you_let_me_go_enemy_chivalrous"),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (lt, "$g_talk_troop_faction_relation", 0),
        (this_or_next|eq, ":var12", 3),
        (eq, ":var12", 4),
        (assign, ":var9", 300),
        (assign, ":var10", "str_comment_you_let_me_go_enemy_coldblooded"),
      (else_try),
        (eq, ":var6", "$g_talk_troop"),
        (lt, "$g_talk_troop_faction_relation", 0),
        (assign, ":var9", 300),
        (assign, ":var10", "str_comment_you_let_me_go_enemy"),
        (assign, ":var11", 1),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (neq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 1),
        (eq, ":var12", 6),
        (assign, ":var10", "str_comment_you_let_go_a_lord_allied_chivalrous"),
        (assign, ":var9", 80),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (neq, ":var6", "$g_talk_troop"),
        (eq, ":var12", 7),
        (assign, ":var10", "str_comment_you_let_go_a_lord_allied_upstanding"),
        (assign, ":var9", 80),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (neq, ":var6", "$g_talk_troop"),
        (this_or_next|eq, ":var12", 4),
        (eq, ":var12", 3),
        (assign, ":var10", "str_comment_you_let_go_a_lord_allied_coldblooded"),
        (assign, ":var9", 80),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (neq, ":var6", "$g_talk_troop"),
        (lt, "$g_talk_troop_relation", -5),
        (this_or_next|eq, ":var12", 2),
        (eq, ":var12", 5),
        (assign, ":var10", "str_comment_you_let_go_a_lord_allied_unfriendly_spiteful"),
        (assign, ":var9", 80),
      (else_try),
        (eq, "$players_kingdom", "$g_talk_troop_faction"),
        (lt, ":var15", 0),
        (neq, ":var6", "$g_talk_troop"),
        (assign, ":var10", "str_comment_you_let_go_a_lord_allied"),
        (assign, ":var9", 80),
      (try_end),
    (else_try),
      (eq, ":var1", 21),
      (eq, ":var3", "trp_player"),
      (try_begin),
        (eq, ":var8", "$g_talk_troop_faction"),
        (neq, ":var6", "$g_talk_troop"),
        (assign, ":var9", 200),
        (try_begin),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 1),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_martial_unfriendly"),
        (else_try),
          (eq, ":var12", 1),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_martial"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 2),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_quarrelsome_unfriendly"),
        (else_try),
          (eq, ":var12", 2),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_quarrelsome"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 3),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_selfrighteous_unfriendly"),
        (else_try),
          (eq, ":var12", 3),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_selfrighteous"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 4),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_cunning_unfriendly"),
        (else_try),
          (eq, ":var12", 4),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_cunning"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_debauched_unfriendly"),
        (else_try),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_debauched"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 6),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_goodnatured_unfriendly"),
        (else_try),
          (eq, ":var12", 6),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_goodnatured"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 7),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_upstanding_unfriendly"),
        (else_try),
          (eq, ":var12", 7),
          (assign, ":var10", "str_comment_pledged_allegiance_allied_upstanding"),
        (try_end),
      (try_end),
    (else_try),
      (eq, ":var1", 22),
      (eq, ":var3", "trp_player"),
      (try_begin),
        (eq, ":var8", "$g_talk_troop_faction"),
        (neq, ":var6", "$g_talk_troop"),
        (eq, ":var8", "$players_kingdom"),
        (assign, ":var9", 110),
        (try_begin),
          (gt, "$g_talk_troop_relation", 5),
          (this_or_next|eq, ":var12", 3),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_our_king_granted_you_a_fief_allied_friendly_cruel"),
        (else_try),
          (gt, "$g_talk_troop_relation", 5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 4),
          (assign, ":var10", "str_comment_our_king_granted_you_a_fief_allied_friendly_cynical"),
        (else_try),
          (gt, "$g_talk_troop_relation", 5),
          (assign, ":var10", "str_comment_our_king_granted_you_a_fief_allied_friendly"),
        (else_try),
          (is_between, "$g_talk_troop_relation", -5, 5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_our_king_granted_you_a_fief_allied_spiteful"),
          (assign, ":var11", -2),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (eq, ":var12", 7),
          (assign, ":var10", "str_comment_our_king_granted_you_a_fief_allied_unfriendly_upstanding"),
        (else_try),
          (lt, "$g_talk_troop_relation", -5),
          (this_or_next|eq, ":var12", 2),
          (eq, ":var12", 5),
          (assign, ":var10", "str_comment_our_king_granted_you_a_fief_allied_unfriendly_spiteful"),
        (else_try),
          (assign, ":var10", "str_comment_our_king_granted_you_a_fief_allied"),
        (try_end),
      (try_end),
    (else_try),
      (eq, ":var1", 23),
      (eq, ":var3", "trp_player"),
      (try_begin),
        (eq, ":var8", "$g_talk_troop_faction"),
        (neq, ":var6", "$g_talk_troop"),
        (try_begin),
          (ge, "$g_talk_troop_faction_relation", 0),
          (neq, "$g_talk_troop_faction", "$players_kingdom"),
          (assign, ":var9", 180),
          (try_begin),
            (gt, "$g_talk_troop_relation", 5),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_friendly"),
          (else_try),
            (ge, "$g_talk_troop_relation", 0),
            (eq, ":var12", 6),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_friendly"),
          (try_end),
        (else_try),
          (lt, "$g_talk_troop_faction_relation", 0),
          (assign, ":var9", 300),
          (try_begin),
            (ge, "$g_talk_troop_relation", 0),
            (this_or_next|eq, ":var12", 3),
            (eq, ":var12", 5),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_unfriendly_moralizing"),
          (else_try),
            (gt, "$g_talk_troop_relation", 5),
            (this_or_next|eq, ":var12", 6),
            (eq, ":var12", 7),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_enemy_friendly"),
          (else_try),
            (gt, "$g_talk_troop_relation", 5),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_enemy"),
          (else_try),
            (is_between, "$g_talk_troop_relation", -5, 5),
            (this_or_next|eq, ":var12", 2),
            (eq, ":var12", 5),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_unfriendly_spiteful"),
            (assign, ":var11", -2),
          (else_try),
            (lt, "$g_talk_troop_relation", -5),
            (this_or_next|eq, ":var12", 2),
            (this_or_next|eq, ":var12", 3),
            (eq, ":var12", 5),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_unfriendly_spiteful"),
          (else_try),
            (assign, ":var10", "str_comment_you_renounced_your_alliegance_default"),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (assign, reg0, ":var10"),
    (assign, reg1, ":var9"),
    (assign, reg2, ":var11"),
  ]),

  ("get_relevant_comment_to_s42",
  [
    (troop_get_slot, ":var0", "$g_talk_troop", 52),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (store_add, ":var1", ":var0", "str_personality_archetypes"),
      (str_store_string, s15, ":var1"),
      (display_message, "@Reputation type: {s15}"),
    (try_end),
    (assign, ":var2", 50),
    (assign, ":var3", -1),
    (assign, ":var4", 0),
    (assign, ":var5", -1),
    (assign, ":var6", 0),
    (store_current_hours, ":var7"),
    (troop_get_slot, ":var8", "$g_talk_troop", 29),
    (troop_set_slot, "$g_talk_troop", 29, "$num_log_entries"),
    (store_add, ":var9", "$num_log_entries", 1),
    (try_for_range, ":var10", 1, ":var9"),
      (troop_get_slot, ":var11", "trp_log_array_entry_time", ":var10"),
      (store_sub, ":var12", ":var7", ":var11"),
      (try_begin),
        (le, ":var10", ":var8"),
        (try_begin),
          (eq, ":var10", ":var8"),
          (eq, "$cheat_mode", 1),
          (assign, reg5, ":var10"),
          (display_message, "@Entries up to #{reg5} skipped"),
        (try_end),
      (else_try),
        (call_script, "script_get_relevant_comment_for_log_entry", ":var10"),
        (gt, reg1, 10),
        (assign, ":var13", reg1),
        (assign, ":var14", reg0),
        (store_random_in_range, ":var15", 70, 140),
        (val_mul, ":var13", ":var15"),
        (store_add, ":var16", ":var12", 500),
        (val_mul, ":var13", 1000),
        (val_div, ":var13", ":var16"),
        (try_begin),
          (gt, ":var13", ":var2"),
          (assign, ":var2", ":var13"),
          (assign, ":var3", ":var14"),
          (assign, ":var5", ":var10"),
          (assign, ":var6", reg2),
        (try_end),
      (try_end),
    (try_end),
    (try_begin),
      (gt, ":var3", 0),
      (assign, ":var4", 1),
      (troop_get_slot, ":var17", "trp_log_array_actor", ":var5"),
      (troop_get_slot, ":var18", "trp_log_array_center_object", ":var5"),
      (troop_get_slot, ":var19", "trp_log_array_center_object_lord", ":var5"),
      (troop_get_slot, ":var20", "trp_log_array_center_object_faction", ":var5"),
      (troop_get_slot, ":var21", "trp_log_array_troop_object", ":var5"),
      (troop_get_slot, ":var22", "trp_log_array_troop_object_faction", ":var5"),
      (troop_get_slot, ":var23", "trp_log_array_faction_object", ":var5"),
      (try_begin),
        (ge, ":var17", 0),
        (str_store_troop_name, s50, ":var17"),
      (try_end),
      (try_begin),
        (ge, ":var18", 0),
        (str_store_party_name, s51, ":var18"),
      (try_end),
      (try_begin),
        (ge, ":var19", 0),
        (str_store_troop_name, s52, ":var19"),
      (try_end),
      (try_begin),
        (ge, ":var20", 0),
        (str_store_faction_name, s53, ":var20"),
      (try_end),
      (try_begin),
        (ge, ":var21", 0),
        (str_store_troop_name, s54, ":var21"),
      (try_end),
      (try_begin),
        (ge, ":var22", 0),
        (str_store_faction_name, s55, ":var22"),
      (try_end),
      (try_begin),
        (ge, ":var23", 0),
        (str_store_faction_name, s56, ":var23"),
      (try_end),
      (str_store_string, s42, ":var3"),
    (try_end),
    (assign, reg0, ":var4"),
    (assign, "$log_comment_relation_change", ":var6"),
  ]),

  ("find_rival_from_faction",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (troop_get_slot, ":var3", ":var0", 52),
    (try_for_range, ":var4", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
      (store_troop_faction, ":var5", ":var4"),
      (eq, ":var5", ":var1"),
      (troop_get_slot, ":var6", ":var4", 52),
      (try_begin),
        (eq, ":var3", 1),
        (eq, ":var6", 1),
        (assign, ":var2", ":var4"),
      (else_try),
        (eq, ":var3", 5),
        (eq, ":var6", 7),
        (assign, ":var2", ":var4"),
      (else_try),
        (eq, ":var3", 3),
        (eq, ":var6", 6),
        (assign, ":var2", ":var4"),
      (else_try),
        (eq, ":var3", 4),
        (eq, ":var6", 2),
        (assign, ":var2", ":var4"),
      (else_try),
        (eq, ":var3", 2),
        (eq, ":var6", 4),
        (assign, ":var2", ":var4"),
      (else_try),
        (eq, ":var3", 6),
        (eq, ":var6", 3),
        (assign, ":var2", ":var4"),
      (else_try),
        (eq, ":var3", 7),
        (eq, ":var6", 5),
        (assign, ":var2", ":var4"),
      (try_end),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("rebellion_arguments",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (troop_get_slot, ":var3", ":var0", 52),
    (try_begin),
      (eq, ":var3", 1),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", 30),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", 10),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", -20),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", -30),
      (try_end),
    (else_try),
      (eq, ":var3", 2),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", -20),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", -30),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", 30),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", 10),
      (try_end),
    (else_try),
      (eq, ":var3", 3),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", -20),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", -30),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", 20),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", 20),
      (try_end),
    (else_try),
      (eq, ":var3", 4),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", -30),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", 20),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", -20),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", 20),
      (try_end),
    (else_try),
      (eq, ":var3", 5),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", -20),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", -20),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", 20),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", 10),
      (try_end),
    (else_try),
      (eq, ":var3", 6),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", 10),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", 20),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", -15),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", -25),
      (try_end),
    (else_try),
      (eq, ":var3", 7),
      (try_begin),
        (eq, ":var1", 1),
        (assign, ":var2", 10),
      (else_try),
        (eq, ":var1", 2),
        (assign, ":var2", 0),
      (else_try),
        (eq, ":var1", 3),
        (assign, ":var2", -40),
      (else_try),
        (eq, ":var1", 4),
        (assign, ":var2", 10),
      (try_end),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("get_culture_with_party_faction_for_music",
  [
    (store_script_param, ":var0", 1),
    (store_faction_of_party, ":var1", ":var0"),
    (try_begin),
      (this_or_next|eq, ":var1", "fac_player_faction"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (assign, ":var1", "$players_kingdom"),
    (try_end),
    (try_begin),
      (is_between, ":var0", "p_town_1", "p_salt_mine"),
      (this_or_next|eq, ":var1", "fac_player_supporters_faction"),
      (neg|is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (party_get_slot, ":var1", ":var0", 61),
    (try_end),
    (try_begin),
      (eq, ":var1", "fac_kingdom_1"),
      (assign, ":var2", 1),
    (else_try),
      (eq, ":var1", "fac_kingdom_2"),
      (assign, ":var2", 2),
    (else_try),
      (eq, ":var1", "fac_kingdom_3"),
      (assign, ":var2", 4),
    (else_try),
      (eq, ":var1", "fac_kingdom_4"),
      (assign, ":var2", 8),
    (else_try),
      (assign, ":var2", 0),
    (try_end),
    (assign, reg0, ":var2"),
  ]),

  ("music_set_situation_with_culture",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 0),
    (try_begin),
      (this_or_next|eq, ":var0", 8192),
      (this_or_next|eq, ":var0", 1048576),
      (this_or_next|eq, ":var0", 524288),
      (this_or_next|eq, ":var0", 16384),
      (eq, ":var0", 2097152),
      (call_script, "script_get_culture_with_party_faction_for_music", "$g_encountered_party"),
      (val_or, ":var1", reg0),
    (else_try),
      (this_or_next|eq, ":var0", 4096),
      (eq, ":var0", 1024),
      (call_script, "script_get_culture_with_party_faction_for_music", "$g_encountered_party"),
      (val_or, ":var1", reg0),
      (call_script, "script_get_culture_with_party_faction_for_music", "p_main_party"),
      (val_or, ":var1", reg0),
      (call_script, "script_get_closest_center", "p_main_party"),
      (call_script, "script_get_culture_with_party_faction_for_music", reg0),
      (val_or, ":var1", reg0),
    (else_try),
      (eq, ":var0", 65536),
      (call_script, "script_get_culture_with_party_faction_for_music", "p_main_party"),
      (val_or, ":var1", reg0),
      (call_script, "script_get_closest_center", "p_main_party"),
      (call_script, "script_get_culture_with_party_faction_for_music", reg0),
      (val_or, ":var1", reg0),
    (else_try),
      (eq, ":var0", 8388608),
      (call_script, "script_get_culture_with_party_faction_for_music", "p_main_party"),
      (val_or, ":var1", reg0),
    (else_try),
      (eq, ":var0", 32768),
      (call_script, "script_get_culture_with_party_faction_for_music", "$g_encountered_party"),
      (val_or, ":var1", reg0),
    (try_end),
    (try_begin),
      (this_or_next|eq, ":var0", 8192),
      (eq, ":var0", 1048576),
      (try_begin),
        (is_currently_night),
        (assign, ":var0", 524288),
      (try_end),
    (try_end),
    (music_set_situation, ":var0"),
    (music_set_culture, ":var1"),
  ]),

  ("combat_music_set_situation_with_culture",
  [
    (assign, ":var0", 1024),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (try_for_agents, ":var3"),
      (agent_is_alive, ":var3"),
      (agent_is_human, ":var3"),
      (agent_get_troop_id, ":var4", ":var3"),
      (store_character_level, ":var5", ":var4"),
      (val_add, ":var5", 10),
      (val_mul, ":var5", ":var5"),
      (try_begin),
        (agent_is_ally, ":var3"),
        (val_add, ":var1", ":var5"),
      (else_try),
        (val_add, ":var2", ":var5"),
      (try_end),
    (try_end),
    (val_mul, ":var1", 4),
    (val_div, ":var1", 3),
    (try_begin),
      (lt, ":var1", ":var2"),
      (assign, ":var0", 4096),
    (try_end),
    (call_script, "script_music_set_situation_with_culture", ":var0"),
  ]),

  ("play_victorious_sound",
  [
    (call_script, "script_music_set_situation_with_culture", 8388608),
  ]),

  ("set_items_for_tournament",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_script_param, ":var3", 4),
    (store_script_param, ":var4", 5),
    (store_script_param, ":var5", 6),
    (store_script_param, ":var6", 7),
    (store_script_param, ":var7", 8),
    (store_script_param, ":var8", 9),
    (store_script_param, ":var9", 10),
    (store_add, ":var10", ":var2", ":var3"),
    (val_add, ":var10", ":var7"),
    (try_for_range, ":var11", 0, 32),
      (mission_tpl_entry_clear_override_items, "mt_arena_melee_fight", ":var11"),
      (assign, ":var12", 0),
      (store_div, ":var13", ":var11", 8),
      (try_begin),
        (store_random_in_range, ":var14", 0, 100),
        (lt, ":var14", ":var0"),
        (assign, ":var12", 1),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_horse"),
      (try_end),
      (try_begin),
        (eq, ":var12", 1),
        (store_add, ":var15", ":var10", ":var1"),
        (val_add, ":var15", ":var5"),
        (val_add, ":var15", ":var6"),
      (else_try),
        (store_add, ":var15", ":var10", ":var4"),
      (try_end),
      (store_random_in_range, ":var14", 0, ":var15"),
      (store_add, ":var16", "itm_arena_shield_red", ":var13"),
      (try_begin),
        (val_sub, ":var14", ":var2"),
        (lt, ":var14", 0),
        (try_begin),
          (store_random_in_range, ":var17", 0, 100),
          (lt, ":var17", 50),
          (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_sword"),
          (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", ":var16"),
        (else_try),
          (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_heavy_practice_sword"),
        (try_end),
      (else_try),
        (val_sub, ":var14", ":var3"),
        (lt, ":var14", 0),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_axe"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", ":var16"),
      (else_try),
        (val_sub, ":var14", ":var7"),
        (lt, ":var14", 0),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_sword"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_crossbow"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_bolts"),
      (else_try),
        (eq, ":var12", 0),
        (val_sub, ":var14", ":var4"),
        (lt, ":var14", 0),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_bow"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_arrows"),
      (else_try),
        (eq, ":var12", 1),
        (val_sub, ":var14", ":var1"),
        (lt, ":var14", 0),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_lance"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", ":var16"),
      (else_try),
        (eq, ":var12", 1),
        (val_sub, ":var14", ":var5"),
        (lt, ":var14", 0),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_javelin"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", ":var16"),
      (else_try),
        (eq, ":var12", 1),
        (val_sub, ":var14", ":var6"),
        (lt, ":var14", 0),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_bow"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", "itm_practice_arrows"),
      (try_end),
      (try_begin),
        (ge, ":var8", 0),
        (store_add, ":var18", ":var8", ":var13"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", ":var18"),
      (try_end),
      (try_begin),
        (ge, ":var9", 0),
        (store_add, ":var19", ":var9", ":var13"),
        (mission_tpl_entry_add_override_item, "mt_arena_melee_fight", ":var11", ":var19"),
      (try_end),
    (try_end),
  ]),

  ("custom_battle_end",
  [
    (assign, "$g_custom_battle_team1_death_count", 0),
    (assign, "$g_custom_battle_team2_death_count", 0),
    (try_for_agents, ":var0"),
      (agent_is_human, ":var0"),
      (neg|agent_is_alive, ":var0"),
      (agent_get_team, ":var1", ":var0"),
      (try_begin),
        (eq, ":var1", 0),
        (val_add, "$g_custom_battle_team1_death_count", 1),
      (else_try),
        (val_add, "$g_custom_battle_team2_death_count", 1),
      (try_end),
    (try_end),
  ]),

  ("remove_troop_from_prison",
  [
    (store_script_param, ":var0", 1),
    (troop_set_slot, ":var0", 8, -1),
    (try_begin),
      (check_quest_active, "qst_rescue_lord_by_replace"),
      (quest_slot_eq, "qst_rescue_lord_by_replace", 2, ":var0"),
      (call_script, "script_cancel_quest", "qst_rescue_lord_by_replace"),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_deliver_message_to_prisoner_lord"),
      (quest_slot_eq, "qst_deliver_message_to_prisoner_lord", 2, ":var0"),
      (call_script, "script_cancel_quest", "qst_deliver_message_to_prisoner_lord"),
    (try_end),
  ]),

  ("shift_pos1_along_y_axis_to_ground",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, reg0, 1),
    (assign, ":var2", 0),
    (call_script, "script_shift_pos1_along_y_axis_to_ground_aux", ":var0", ":var1", ":var2"),
  ]),

  ("shift_pos1_along_y_axis_to_ground_aux",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (get_scene_boundaries, pos10, pos11),
    (position_get_x, ":var3", pos10),
    (position_get_y, ":var4", pos10),
    (position_get_x, ":var5", pos11),
    (position_get_y, ":var6", pos11),
    (copy_position, pos2, pos1),
    (position_set_z_to_ground_level, pos2),
    (position_get_x, ":var7", pos1),
    (position_get_y, ":var8", pos1),
    (position_get_z, ":var9", pos1),
    (position_get_z, ":var10", pos2),
    (try_begin),
      (this_or_next|ge, ":var2", ":var1"),
      (this_or_next|le, ":var7", ":var3"),
      (this_or_next|le, ":var8", ":var4"),
      (this_or_next|ge, ":var7", ":var5"),
      (ge, ":var8", ":var6"),
      (assign, reg0, -1),
    (else_try),
      (gt, ":var0", 0),
      (le, ":var10", ":var9"),
      (position_move_y, pos1, ":var0"),
      (val_add, ":var2", ":var0"),
      (call_script, "script_shift_pos1_along_y_axis_to_ground_aux", ":var0", ":var1", ":var2"),
    (else_try),
      (lt, ":var0", 0),
      (ge, ":var10", ":var9"),
      (position_move_y, pos1, ":var0"),
      (val_sub, ":var2", ":var0"),
      (call_script, "script_shift_pos1_along_y_axis_to_ground_aux", ":var0", ":var1", ":var2"),
    (else_try),
      (position_set_z_to_ground_level, pos1),
    (try_end),
  ]),

  ("init_saloon_walker_agents",
  [
    (try_for_agents, ":var0"),
      (agent_get_entry_no, ":var1", ":var0"),
      (is_between, ":var1", 51, 65),
      (agent_get_troop_id, ":var2", ":var0"),
      (agent_get_position, pos1, ":var0"),
      (assign, ":var3", 9999999),
      (try_for_range, ":var4", 50, 65),
        (entry_point_get_position, pos2, ":var4"),
        (get_distance_between_positions, ":var5", pos1, pos2),
        (lt, ":var5", 200),
        (lt, ":var5", ":var3"),
        (assign, ":var3", ":var5"),
        (agent_set_slot, ":var0", 0, ":var4"),
      (try_end),
      (store_random_in_range, ":var6", 0, 100),
      (try_begin),
        (lt, ":var6", 10),
        (is_between, ":var2", "trp_saloon_walker_1", "trp_tournament_master"),
        (call_script, "script_set_saloon_walker_destination", ":var0"),
        (agent_set_stand_animation, ":var0", "anim_stand_man"),
      (else_try),
        (agent_get_position, pos2, ":var0"),
        (scene_prop_get_num_instances, ":var7", "spr_barstool_no_col"),
        (assign, ":var8", 0),
        (try_for_range, ":var9", 0, ":var7"),
          (eq, ":var8", 0),
          (scene_prop_get_instance, ":var10", "spr_barstool_no_col", ":var9"),
          (prop_instance_get_position, pos3, ":var10"),
          (get_distance_between_positions, ":var5", pos3, pos2),
          (lt, ":var5", 100),
          (assign, ":var8", 1),
        (try_end),
        (try_for_agents, ":var11"),
          (neq, ":var11", ":var0"),
          (agent_get_position, pos4, ":var11"),
          (get_distance_between_positions, ":var5", pos3, pos4),
          (lt, ":var5", 100),
          (assign, ":var8", 0),
        (try_end),
        (eq, ":var8", 1),
        (agent_set_position, ":var0", pos3),
        (try_begin),
          (eq, ":var2", "trp_saloon_walker_2"),
          (agent_set_stand_animation, ":var0", "anim_sit_drunkard"),
        (else_try),
          (agent_set_stand_animation, ":var0", "anim_sit"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("tick_saloon_walkers",
  [
    (try_for_agents, ":var0"),
      (neg|agent_slot_eq, ":var0", 22, 1),
      (agent_get_troop_id, ":var1", ":var0"),
      (agent_get_entry_no, ":var2", ":var0"),
      (agent_get_slot, ":var3", ":var0", 0),
      (is_between, ":var2", 51, 65),
      (store_random_in_range, ":var4", 0, 100),
      (try_begin),
        (lt, ":var4", 10),
        (is_between, ":var1", "trp_saloon_walker_1", "trp_tournament_master"),
        (call_script, "script_set_saloon_walker_destination", ":var0"),
        (agent_set_stand_animation, ":var0", "anim_stand_man"),
      (else_try),
        (agent_get_position, pos2, ":var0"),
        (entry_point_get_position, pos4, ":var3"),
        (gt, ":var3", 0),
        (agent_set_scripted_destination, ":var0", pos4, 0),
        (scene_prop_get_num_instances, ":var5", "spr_barstool_no_col"),
        (assign, ":var6", 999999),
        (try_for_range, ":var7", 0, ":var5"),
          (scene_prop_get_instance, ":var8", "spr_barstool_no_col", ":var7"),
          (prop_instance_get_position, pos3, ":var8"),
          (get_distance_between_positions, ":var9", pos3, pos2),
          (get_distance_between_positions, ":var10", pos4, pos2),
          (lt, ":var9", 200),
          (lt, ":var10", 200),
          (lt, ":var9", ":var6"),
          (assign, ":var6", ":var9"),
          (prop_instance_get_position, pos5, ":var8"),
        (try_end),
        (try_for_agents, ":var11"),
          (neq, ":var11", ":var0"),
          (agent_get_position, pos6, ":var11"),
          (get_distance_between_positions, ":var9", pos5, pos6),
          (lt, ":var9", 100),
          (assign, ":var6", 999999),
        (try_end),
        (try_begin),
          (neq, ":var6", 999999),
          (agent_set_position, ":var0", pos5),
          (try_begin),
            (eq, ":var1", "trp_saloon_walker_2"),
            (agent_set_stand_animation, ":var0", "anim_sit_drunkard"),
          (else_try),
            (agent_set_stand_animation, ":var0", "anim_sit"),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
  ]),

  ("set_saloon_walker_destination",
  [
    (store_script_param_1, ":var0"),
    (assign, reg0, 51),
    (assign, reg1, 52),
    (assign, reg2, 53),
    (assign, reg3, 54),
    (assign, reg4, 55),
    (assign, reg5, 56),
    (assign, reg6, 57),
    (assign, reg7, 58),
    (assign, reg8, 59),
    (assign, reg9, 60),
    (assign, reg10, 61),
    (assign, reg11, 62),
    (assign, reg12, 63),
    (assign, reg13, 64),
    (get_player_agent_no, ":var1"),
    (try_for_agents, ":var2"),
      (neq, ":var1", ":var2"),
      (agent_get_slot, ":var3", ":var2", 0),
      (try_begin),
        (eq, ":var3", 51),
        (assign, reg0, 0),
      (else_try),
        (eq, ":var3", 52),
        (assign, reg1, 0),
      (else_try),
        (eq, ":var3", 53),
        (assign, reg2, 0),
      (else_try),
        (eq, ":var3", 54),
        (assign, reg3, 0),
      (else_try),
        (eq, ":var3", 55),
        (assign, reg4, 0),
      (else_try),
        (eq, ":var3", 56),
        (assign, reg5, 0),
      (else_try),
        (eq, ":var3", 57),
        (assign, reg6, 0),
      (else_try),
        (eq, ":var3", 58),
        (assign, reg7, 0),
      (else_try),
        (eq, ":var3", 59),
        (assign, reg8, 0),
      (else_try),
        (eq, ":var3", 60),
        (assign, reg9, 0),
      (else_try),
        (eq, ":var3", 61),
        (assign, reg10, 0),
      (else_try),
        (eq, ":var3", 62),
        (assign, reg11, 0),
      (else_try),
        (eq, ":var3", 63),
        (assign, reg12, 0),
      (else_try),
        (eq, ":var3", 64),
        (assign, reg13, 0),
      (try_end),
    (try_end),
    (assign, ":var4", 100),
    (assign, ":var3", 0),
    (try_for_range, ":var5", 0, ":var4"),
      (shuffle_range, 0, 14),
      (gt, reg0, 0),
      (assign, ":var3", reg0),
      (assign, ":var4", 0),
    (try_end),
    (try_begin),
      (gt, ":var3", 0),
      (agent_set_slot, ":var0", 0, ":var3"),
      (entry_point_get_position, pos1, ":var3"),
      (agent_clear_scripted_mode, ":var0"),
      (agent_set_scripted_destination, ":var0", pos1, 0),
      (agent_set_speed_limit, ":var0", 5),
    (try_end),
  ]),

  ("emit_bullet",
  [
    (set_fixed_point_multiplier, 100),
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (call_script, "script_get_agent_closest_to_position", ":var0"),
    (assign, ":var2", reg0),
    (try_for_range_backwards, ":var3", 1, 256),
      (troop_slot_eq, "trp_bullet_active", ":var3", 0),
      (assign, ":var4", ":var3"),
    (try_end),
    (troop_set_slot, "trp_bullet_active", ":var4", 1),
    (troop_set_slot, "trp_bullet_source_agent", ":var4", ":var2"),
    (store_add, ":var5", ":var0", 1),
    (agent_get_look_position, ":var5", ":var2"),
    (position_copy_rotation, ":var0", ":var5"),
    (troop_set_slot, "trp_bullet_emit_time", ":var4", "$bullet_timer"),
    (position_get_x, ":var6", ":var0"),
    (position_get_y, ":var7", ":var0"),
    (position_get_z, ":var8", ":var0"),
    (troop_set_slot, "trp_bullet_x", ":var4", ":var6"),
    (troop_set_slot, "trp_bullet_y", ":var4", ":var7"),
    (troop_set_slot, "trp_bullet_z", ":var4", ":var8"),
    (troop_set_slot, "trp_bullet_last_x", ":var4", ":var6"),
    (troop_set_slot, "trp_bullet_last_y", ":var4", ":var6"),
    (troop_set_slot, "trp_bullet_last_z", ":var4", ":var6"),
    (position_get_rotation_around_z, ":var9", ":var0"),
    (troop_set_slot, "trp_bullet_z_rot", ":var4", ":var9"),
    (position_move_y, ":var0", ":var1"),
    (position_get_x, ":var10", ":var0"),
    (position_get_y, ":var11", ":var0"),
    (position_get_z, ":var12", ":var0"),
    (val_sub, ":var10", ":var6"),
    (val_sub, ":var11", ":var7"),
    (val_sub, ":var12", ":var8"),
    (troop_set_slot, "trp_bullet_x_velocity", ":var4", ":var10"),
    (troop_set_slot, "trp_bullet_y_velocity", ":var4", ":var11"),
    (troop_set_slot, "trp_bullet_z_velocity", ":var4", ":var12"),
    (call_script, "script_trace_bullet_to_ground", ":var4", 0, 1000),
  ]),

  ("trace_bullet_to_ground",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (set_fixed_point_multiplier, 100),
    (troop_get_slot, ":var3", "trp_bullet_x", ":var0"),
    (troop_get_slot, ":var4", "trp_bullet_y", ":var0"),
    (troop_get_slot, ":var5", "trp_bullet_z", ":var0"),
    (troop_get_slot, ":var6", "trp_bullet_last_x", ":var0"),
    (troop_get_slot, ":var7", "trp_bullet_last_y", ":var0"),
    (troop_get_slot, ":var8", "trp_bullet_last_z", ":var0"),
    (troop_get_slot, ":var9", "trp_bullet_z_rot", ":var0"),
    (troop_get_slot, ":var10", "trp_bullet_x_velocity", ":var0"),
    (troop_get_slot, ":var11", "trp_bullet_y_velocity", ":var0"),
    (troop_get_slot, ":var12", "trp_bullet_z_velocity", ":var0"),
    (init_position, pos1),
    (position_set_x, pos1, ":var6"),
    (position_set_y, pos1, ":var7"),
    (position_set_z, pos1, ":var8"),
    (position_rotate_z, pos1, ":var9"),
    (val_add, ":var1", "$bullet_timer_speed"),
    (val_mul, ":var10", ":var1"),
    (val_mul, ":var11", ":var1"),
    (val_mul, ":var12", ":var1"),
    (assign, ":var13", 981),
    (val_mul, ":var13", ":var1"),
    (val_mul, ":var13", ":var1"),
    (val_div, ":var13", 20000),
    (store_add, ":var14", ":var3", ":var10"),
    (store_add, ":var15", ":var4", ":var11"),
    (val_sub, ":var12", ":var13"),
    (store_add, ":var16", ":var5", ":var12"),
    (init_position, pos2),
    (position_set_x, pos2, ":var14"),
    (position_set_y, pos2, ":var15"),
    (position_set_z, pos2, ":var16"),
    (troop_set_slot, "trp_bullet_last_x", ":var0", ":var14"),
    (troop_set_slot, "trp_bullet_last_y", ":var0", ":var15"),
    (troop_set_slot, "trp_bullet_last_z", ":var0", ":var16"),
    (store_mul, ":var17", ":var10", ":var10"),
    (store_mul, ":var18", ":var11", ":var11"),
    (val_add, ":var17", ":var18"),
    (store_mul, ":var18", ":var12", ":var12"),
    (val_add, ":var17", ":var18"),
    (store_sqrt, ":var19", ":var17"),
    (try_begin),
      (assign, ":var20", 0),
      (try_for_agents, ":var21"),
        (agent_is_alive, ":var21"),
        (agent_get_position, pos3, ":var21"),
        (position_move_z, pos3, 100),
        (position_transform_position_to_local, pos4, pos1, pos3),
        (position_get_y, ":var22", pos4),
        (is_between, ":var22", 0, ":var19"),
        (position_get_x, ":var23", pos4),
        (is_between, ":var23", -40, 40),
        (position_get_z, ":var24", pos4),
        (is_between, ":var24", -100, 110),
        (troop_set_slot, "trp_bullet_active", ":var0", 0),
        (assign, ":var20", 1),
      (try_end),
      (eq, ":var20", 1),
    (else_try),
      (position_get_z, ":var24", pos2),
      (copy_position, pos3, pos2),
      (position_set_z_to_ground_level, pos3),
      (position_get_z, ":var25", pos3),
      (val_sub, ":var24", ":var25"),
      (lt, ":var24", 0),
      (troop_set_slot, "trp_bullet_active", ":var0", 0),
      (particle_system_burst, "psys_bullet_kick_dust", pos1, 3),
      (particle_system_burst, "psys_bullet_kick_dirt", pos1, 5),
    (else_try),
      (lt, ":var1", ":var2"),
      (call_script, "script_trace_bullet_to_ground", ":var0", ":var1", ":var2"),
    (try_end),
  ]),

  ("emit_projectile",
  [
    (set_fixed_point_multiplier, 100),
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_script_param, ":var3", 4),
    (store_script_param, ":var4", 5),
    (store_script_param, ":var5", 6),
    (store_script_param, ":var6", 7),
    (store_script_param, ":var7", 8),
    (store_script_param, ":var8", 9),
    (store_script_param, ":var9", 10),
    (store_script_param, ":var10", 11),
    (store_script_param, ":var11", 12),
    (store_script_param, ":var12", 13),
    (assign, ":var13", 99999999),
    (try_for_agents, ":var14"),
      (agent_is_alive, ":var14"),
      (agent_is_human, ":var14"),
      (agent_get_position, pos0, ":var14"),
      (get_distance_between_positions, ":var15", pos0, ":var0"),
      (lt, ":var15", ":var13"),
      (assign, ":var13", ":var15"),
      (assign, ":var16", ":var14"),
    (try_end),
    (try_for_range_backwards, reg0, 1, 256),
      (troop_slot_eq, "trp_pjct_active", reg0, 0),
      (assign, ":var17", reg0),
    (try_end),
    (troop_set_slot, "trp_pjct_active", ":var17", 1),
    (troop_set_slot, "trp_pjct_source_agent", ":var17", ":var16"),
    (troop_set_slot, "trp_pjct_damage", ":var17", ":var2"),
    (troop_set_slot, "trp_pjct_bounce_effect", ":var17", ":var3"),
    (troop_set_slot, "trp_pjct_explosive", ":var17", ":var4"),
    (troop_set_slot, "trp_pjct_explosion_area", ":var17", ":var6"),
    (troop_set_slot, "trp_pjct_explosion_damage", ":var17", ":var7"),
    (troop_set_slot, "trp_pjct_particle_system", ":var17", ":var8"),
    (troop_set_slot, "trp_pjct_explode_on_ground_hit", ":var17", ":var10"),
    (troop_set_slot, "trp_pjct_particle_system_magnitude", ":var17", ":var9"),
    (troop_set_slot, "trp_pjct_check_collision", ":var17", ":var11"),
    (troop_set_slot, "trp_pjct_hit_ground", ":var17", 0),
    (store_add, ":var18", ":var0", 1),
    (agent_get_look_position, ":var18", ":var16"),
    (position_copy_rotation, ":var0", ":var18"),
    (troop_set_slot, "trp_pjct_emit_time", ":var17", "$timer"),
    (store_add, ":var19", "$timer", ":var5"),
    (troop_set_slot, "trp_pjct_explosion_countdown", ":var17", ":var19"),
    (position_get_x, ":var20", ":var0"),
    (position_get_y, ":var21", ":var0"),
    (position_get_z, ":var22", ":var0"),
    (troop_set_slot, "trp_pjct_x", ":var17", ":var20"),
    (troop_set_slot, "trp_pjct_y", ":var17", ":var21"),
    (troop_set_slot, "trp_pjct_z", ":var17", ":var22"),
    (troop_set_slot, "trp_pjct_last_x", ":var17", ":var20"),
    (troop_set_slot, "trp_pjct_last_y", ":var17", ":var21"),
    (troop_set_slot, "trp_pjct_last_z", ":var17", ":var22"),
    (position_move_y, ":var0", ":var1"),
    (position_get_x, ":var23", ":var0"),
    (position_get_y, ":var24", ":var0"),
    (position_get_z, ":var25", ":var0"),
    (val_sub, ":var23", ":var20"),
    (val_sub, ":var24", ":var21"),
    (val_sub, ":var25", ":var22"),
    (troop_set_slot, "trp_pjct_x_velocity", ":var17", ":var23"),
    (troop_set_slot, "trp_pjct_y_velocity", ":var17", ":var24"),
    (troop_set_slot, "trp_pjct_z_velocity", ":var17", ":var25"),
    (troop_set_slot, "trp_pjct_attach_scene_prop", ":var17", -1),
    (try_begin),
      (ge, ":var12", 0),
      (scene_prop_get_num_instances, ":var26", ":var12"),
      (assign, ":var27", -1),
      (try_for_range, ":var28", 0, ":var26"),
        (scene_prop_get_instance, ":var29", ":var12", ":var28"),
        (troop_slot_eq, "trp_instance_attached_to", ":var29", 0),
        (assign, ":var27", ":var29"),
      (try_end),
      (troop_set_slot, "trp_instance_attached_to", ":var27", ":var17"),
      (troop_set_slot, "trp_pjct_attach_scene_prop", ":var17", ":var27"),
      (prop_instance_animate_to_position, ":var27", ":var0", 1),
    (try_end),
  ]),

  ("get_agent_closest_to_position",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 99999999),
    (try_for_agents, ":var2"),
      (agent_is_alive, ":var2"),
      (agent_is_human, ":var2"),
      (agent_get_position, pos0, ":var2"),
      (get_distance_between_positions, ":var3", pos0, ":var0"),
      (lt, ":var3", ":var1"),
      (assign, ":var1", ":var3"),
      (assign, reg0, ":var2"),
    (try_end),
  ]),

  ("position_face_position",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 9999999),
    (assign, ":var3", 0),
    (try_for_range, ":var4", 1, 361),
      (position_rotate_x, ":var0", 1),
      (copy_position, pos0, ":var0"),
      (position_move_y, pos0, 1000),
      (get_distance_between_positions, ":var5", pos0, ":var1"),
      (lt, ":var5", ":var2"),
      (assign, ":var2", ":var5"),
      (assign, ":var3", ":var4"),
    (try_end),
    (position_rotate_x, ":var0", ":var3"),
    (assign, ":var2", 9999999),
    (assign, ":var6", 0),
    (try_for_range, ":var4", 1, 361),
      (position_rotate_z, ":var0", 1),
      (copy_position, pos0, ":var0"),
      (position_move_y, pos0, 1000),
      (get_distance_between_positions, ":var5", pos0, ":var1"),
      (lt, ":var5", ":var2"),
      (assign, ":var2", ":var5"),
      (assign, ":var6", ":var4"),
    (try_end),
    (position_rotate_z, ":var0", ":var6"),
  ]),

  ("agent_deliver_damage_to_agent",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (get_player_agent_no, ":var3"),
    (store_agent_hit_points, ":var4", ":var1", 1),
    (try_begin),
      (ge, ":var2", 1),
      (assign, reg1, ":var2"),
      (try_begin),
        (eq, ":var3", ":var0"),
        (display_message, "@Delivered {reg1} damage."),
      (try_end),
      (try_begin),
        (eq, ":var3", ":var1"),
        (display_message, "@Received {reg1} damage."),
      (try_end),
      (val_sub, ":var4", ":var2"),
      (val_max, ":var4", 0),
      (agent_set_hit_points, ":var1", ":var4", 1),
      (eq, ":var4", 0),
      (set_show_messages, 0),
      (agent_deliver_damage_to_agent, ":var0", ":var1"),
      (set_show_messages, 1),
    (try_end),
    (assign, reg0, ":var4"),
  ]),

  ("position_get_rotation_around",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (copy_position, pos62, ":var0"),
    (try_begin),
      (eq, ":var1", 0),
      (init_position, pos0),
      (position_copy_origin, pos0, pos62),
      (position_get_rotation_around_z, reg0, pos62),
      (val_mul, reg0, -1),
      (position_rotate_z, pos62, reg0),
      (position_rotate_y, pos62, 90),
      (position_transform_position_to_local, pos63, pos62, pos0),
      (position_get_rotation_around_z, reg0, pos63),
    (else_try),
      (eq, ":var1", 1),
      (init_position, pos0),
      (position_copy_origin, pos0, pos62),
      (position_get_rotation_around_z, reg0, pos62),
      (val_mul, reg0, -1),
      (position_rotate_z, pos62, reg0),
      (position_rotate_x, pos62, 90),
      (position_transform_position_to_local, pos63, pos62, pos0),
      (position_get_rotation_around_z, reg0, pos63),
    (else_try),
      (position_get_rotation_around_z, reg0, pos62),
    (try_end),
  ]),

  ("cf_create_gang",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_sub, ":var2", ":var0", "fac_culture_1"),
    (val_sub, ":var2", 4),
    (val_mul, ":var2", 7),
    (val_add, ":var2", "fac_unused_1"),
    (store_add, ":var3", ":var2", 7),
    (assign, ":var4", -1),
    (try_for_range, ":var5", ":var2", ":var3"),
      (faction_slot_eq, ":var5", 21, 2),
      (assign, ":var4", ":var5"),
    (try_end),
    (ge, ":var4", 0),
    (assign, ":var6", 0),
    (try_for_range, ":var7", 0, 20),
      (eq, ":var6", 0),
      (troop_get_slot, ":var8", "trp_gang_colors_used_by", ":var7"),
      (this_or_next|eq, ":var8", 0),
      (neg|faction_slot_eq, ":var8", 21, 0),
      (troop_get_slot, ":var9", "trp_gang_colors", ":var7"),
      (faction_set_color, ":var4", ":var9"),
      (troop_set_slot, "trp_gang_colors_used_by", ":var7", ":var4"),
      (assign, ":var6", 1),
    (try_end),
    (faction_set_slot, ":var4", 21, 0),
    (faction_set_slot, ":var4", 100, 1),
    (faction_set_slot, ":var4", 101, 0),
    (faction_set_slot, ":var4", 102, 1),
    (faction_set_slot, ":var4", 103, 0),
    (faction_set_slot, ":var4", 104, 0),
    (faction_set_slot, ":var4", 105, 1),
    (faction_set_slot, ":var4", 106, 0),
    (faction_set_slot, ":var4", 9, ":var0"),
    (faction_set_slot, ":var4", 10, ":var1"),
    (faction_set_slot, ":var4", 7, -1),
    (faction_get_slot, ":var10", ":var0", 41),
    (faction_set_slot, ":var4", 41, ":var10"),
    (faction_get_slot, ":var10", ":var0", 42),
    (faction_set_slot, ":var4", 42, ":var10"),
    (faction_get_slot, ":var10", ":var0", 43),
    (faction_set_slot, ":var4", 43, ":var10"),
    (faction_get_slot, ":var10", ":var0", 44),
    (faction_set_slot, ":var4", 44, ":var10"),
    (faction_get_slot, ":var10", ":var0", 45),
    (faction_set_slot, ":var4", 45, ":var10"),
    (try_begin),
      (faction_slot_eq, ":var4", 9, "fac_culture_1"),
      (faction_set_slot, ":var4", 48, 0),
      (faction_set_slot, ":var4", 49, "trp_volunteer"),
      (faction_set_slot, ":var4", 50, "trp_volunteer"),
      (faction_set_slot, ":var4", 51, "trp_volunteer"),
      (faction_set_slot, ":var4", 52, "trp_volunteer"),
      (faction_set_slot, ":var4", 77, "pt_kingdom_1_reinforcements_a"),
      (faction_set_slot, ":var4", 78, "pt_kingdom_1_reinforcements_b"),
      (faction_set_slot, ":var4", 79, "pt_kingdom_1_reinforcements_c"),
      (faction_set_slot, ":var4", 76, "pt_kingdom_1_reinforcements_d"),
    (else_try),
      (faction_slot_eq, ":var4", 9, "fac_culture_2"),
      (faction_set_slot, ":var4", 48, 0),
      (faction_set_slot, ":var4", 49, "trp_husar"),
      (faction_set_slot, ":var4", 50, "trp_husar"),
      (faction_set_slot, ":var4", 51, "trp_husar"),
      (faction_set_slot, ":var4", 52, "trp_husar"),
      (faction_set_slot, ":var4", 77, "pt_kingdom_2_reinforcements_a"),
      (faction_set_slot, ":var4", 78, "pt_kingdom_2_reinforcements_b"),
      (faction_set_slot, ":var4", 79, "pt_kingdom_2_reinforcements_c"),
      (faction_set_slot, ":var4", 76, "pt_kingdom_2_reinforcements_d"),
    (else_try),
      (faction_slot_eq, ":var4", 9, "fac_culture_4"),
      (faction_set_slot, ":var4", 48, 0),
      (faction_set_slot, ":var4", 49, "trp_comanche_shaman"),
      (faction_set_slot, ":var4", 50, "trp_comanche_shaman"),
      (faction_set_slot, ":var4", 51, "trp_comanche_shaman"),
      (faction_set_slot, ":var4", 52, "trp_comanche_shaman"),
      (faction_set_slot, ":var4", 77, "pt_kingdom_3_reinforcements_a"),
      (faction_set_slot, ":var4", 78, "pt_kingdom_3_reinforcements_b"),
      (faction_set_slot, ":var4", 79, "pt_kingdom_3_reinforcements_c"),
      (faction_set_slot, ":var4", 76, "pt_kingdom_3_reinforcements_d"),
    (else_try),
      (faction_slot_eq, ":var4", 9, "fac_culture_3"),
      (faction_set_slot, ":var4", 48, 0),
      (faction_set_slot, ":var4", 49, "trp_apache_thunder_brave"),
      (faction_set_slot, ":var4", 50, "trp_apache_thunder_brave"),
      (faction_set_slot, ":var4", 51, "trp_apache_thunder_brave"),
      (faction_set_slot, ":var4", 52, "trp_apache_thunder_brave"),
      (faction_set_slot, ":var4", 77, "pt_kingdom_4_reinforcements_a"),
      (faction_set_slot, ":var4", 78, "pt_kingdom_4_reinforcements_b"),
      (faction_set_slot, ":var4", 79, "pt_kingdom_4_reinforcements_c"),
      (faction_set_slot, ":var4", 76, "pt_kingdom_4_reinforcements_d"),
    (else_try),
      (faction_slot_eq, ":var4", 9, "fac_culture_5"),
      (faction_set_slot, ":var4", 48, 0),
      (faction_set_slot, ":var4", 49, "trp_guacho"),
      (faction_set_slot, ":var4", 50, "trp_guacho"),
      (faction_set_slot, ":var4", 51, "trp_guacho"),
      (faction_set_slot, ":var4", 52, "trp_guacho"),
      (faction_set_slot, ":var4", 77, "pt_kingdom_5_reinforcements_a"),
      (faction_set_slot, ":var4", 78, "pt_kingdom_5_reinforcements_b"),
      (faction_set_slot, ":var4", 79, "pt_kingdom_5_reinforcements_c"),
      (faction_set_slot, ":var4", 76, "pt_kingdom_5_reinforcements_d"),
      (str_store_troop_name, s1, ":var1"),
      (faction_set_name, ":var4", "@The {s1} Banda"),
      (set_relation, ":var4", "fac_commoners", -50),
      (set_relation, ":var4", "fac_outlaws", 50),
      (set_relation, ":var4", "fac_deserters", 0),
      (set_relation, ":var4", "fac_scalphunters", 0),
      (set_relation, ":var4", "fac_indian_raiders", -50),
      (set_relation, ":var4", "fac_imperialists", 0),
      (set_relation, ":var4", "fac_confederate_renegades", 0),
      (faction_set_slot, ":var4", 90, -1),
    (else_try),
      (faction_slot_eq, ":var4", 9, "fac_culture_6"),
      (faction_set_slot, ":var4", 48, 0),
      (faction_set_slot, ":var4", 49, "trp_ranger"),
      (faction_set_slot, ":var4", 50, "trp_ranger"),
      (faction_set_slot, ":var4", 51, "trp_ranger"),
      (faction_set_slot, ":var4", 52, "trp_ranger"),
      (faction_set_slot, ":var4", 77, "pt_kingdom_6_reinforcements_a"),
      (faction_set_slot, ":var4", 78, "pt_kingdom_6_reinforcements_b"),
      (faction_set_slot, ":var4", 79, "pt_kingdom_6_reinforcements_c"),
      (faction_set_slot, ":var4", 76, "pt_kingdom_6_reinforcements_d"),
      (str_store_troop_name, s1, ":var1"),
      (faction_set_name, ":var4", "@The {s1} Lawmen"),
      (set_relation, ":var4", "fac_commoners", 50),
      (set_relation, ":var4", "fac_outlaws", -50),
      (set_relation, ":var4", "fac_deserters", 0),
      (set_relation, ":var4", "fac_scalphunters", -50),
      (set_relation, ":var4", "fac_indian_raiders", -50),
      (set_relation, ":var4", "fac_imperialists", 0),
      (set_relation, ":var4", "fac_confederate_renegades", 0),
      (faction_set_slot, ":var4", 90, 0),
    (else_try),
      (faction_slot_eq, ":var4", 9, "fac_culture_7"),
      (faction_set_slot, ":var4", 48, 0),
      (faction_set_slot, ":var4", 49, "trp_thug"),
      (faction_set_slot, ":var4", 50, "trp_thug"),
      (faction_set_slot, ":var4", 51, "trp_thug"),
      (faction_set_slot, ":var4", 52, "trp_thug"),
      (faction_set_slot, ":var4", 77, "pt_kingdom_7_reinforcements_a"),
      (faction_set_slot, ":var4", 78, "pt_kingdom_7_reinforcements_b"),
      (faction_set_slot, ":var4", 79, "pt_kingdom_7_reinforcements_c"),
      (faction_set_slot, ":var4", 76, "pt_kingdom_7_reinforcements_d"),
      (str_store_troop_name, s1, ":var1"),
      (faction_set_name, ":var4", "@The {s1} Gang"),
      (set_relation, ":var4", "fac_commoners", -50),
      (set_relation, ":var4", "fac_outlaws", 50),
      (set_relation, ":var4", "fac_deserters", 0),
      (set_relation, ":var4", "fac_scalphunters", -50),
      (set_relation, ":var4", "fac_indian_raiders", -50),
      (set_relation, ":var4", "fac_imperialists", 0),
      (set_relation, ":var4", "fac_confederate_renegades", 0),
      (faction_set_slot, ":var4", 90, -1),
    (try_end),
    (assign, reg0, ":var4"),
  ]),

  ("add_troop_to_cur_tableau_wanted",
  [
    (store_script_param, ":var0", 1),
    (set_fixed_point_multiplier, 100),
    (cur_tableau_clear_override_items),
    (cur_tableau_set_override_flags, 15),
    (init_position, pos2),
    (cur_tableau_set_camera_parameters, 1, 6, 6, 10, 10000),
    (init_position, pos5),
    (assign, ":var1", 162),
    (assign, ":var2", 100),
    (store_mul, ":var3", ":var0", 124337),
    (val_mod, ":var3", 50),
    (val_add, ":var3", -25),
    (store_mul, ":var4", ":var0", 98123),
    (val_mod, ":var4", 20),
    (val_add, ":var4", -14),
    (assign, ":var5", 1),
    (position_set_z, pos5, ":var1"),
    (position_rotate_x, pos5, -90),
    (position_rotate_z, pos5, 180),
    (position_rotate_y, pos5, ":var3"),
    (position_rotate_x, pos5, ":var4"),
    (position_move_z, pos5, ":var2", 0),
    (position_move_x, pos5, 5, 0),
    (cur_tableau_add_troop, ":var0", pos2, ":var5", 0),
    (cur_tableau_set_camera_position, pos5),
    (copy_position, pos8, pos5),
    (position_rotate_x, pos8, -90),
    (position_rotate_z, pos8, 30),
    (position_rotate_x, pos8, -60),
    (cur_tableau_add_sun_light, pos8, 1750, 1500, 1250),
  ]),

  ("add_troop_to_cur_tableau_for_character_b",
  [
    (store_script_param, ":var0", 1),
    (store_mod, ":var1", ":var0", 4),
    (val_div, ":var0", 4),
    (val_mul, ":var1", 90),
    (set_fixed_point_multiplier, 100),
    (cur_tableau_clear_override_items),
    (cur_tableau_set_override_flags, 511),
    (cur_tableau_add_override_item, "itm_native_body_warpaint"),
    (init_position, pos2),
    (position_rotate_z, pos2, ":var1"),
    (cur_tableau_set_camera_parameters, 1, 4, 8, 10, 10000),
    (init_position, pos5),
    (assign, ":var2", 150),
    (assign, ":var3", 180),
    (assign, ":var4", -15),
    (assign, ":var5", -18),
    (assign, ":var6", 1),
    (position_set_z, pos5, ":var2"),
    (position_rotate_x, pos5, -90),
    (position_rotate_z, pos5, 180),
    (position_rotate_y, pos5, ":var4"),
    (position_rotate_x, pos5, ":var5"),
    (position_move_z, pos5, ":var3", 0),
    (position_move_x, pos5, 5, 0),
    (try_begin),
      (troop_is_hero, ":var0"),
      (cur_tableau_add_troop, ":var0", pos2, ":var6", -1),
    (else_try),
      (store_mul, ":var7", ":var0", 126233),
      (val_mod, ":var7", 1000),
      (val_add, ":var7", 1),
      (cur_tableau_add_troop, ":var0", pos2, ":var6", ":var7"),
    (try_end),
    (cur_tableau_set_camera_position, pos5),
    (copy_position, pos8, pos5),
    (position_rotate_x, pos8, -90),
    (position_rotate_z, pos8, 30),
    (position_rotate_x, pos8, -60),
    (cur_tableau_add_sun_light, pos8, 175, 150, 125),
  ]),

  ("update_fugitive_quest",
  [
    (assign, ":var0", -1),
    (assign, ":var1", -1),
    (assign, ":var2", -1),
    (assign, ":var3", -1),
    (assign, ":var4", -1),
    (assign, ":var5", -1),
    (assign, ":var6", -1),
    (assign, ":var7", -1),
    (assign, ":var8", -1),
    (assign, ":var9", -1),
    (assign, ":var10", -1),
    (assign, ":var11", 1),
    (assign, ":var12", 0),
    (assign, ":var13", 0),
    (assign, ":var14", 0),
    (assign, ":var15", 0),
    (assign, ":var16", 0),
    (assign, ":var17", -1),
    (assign, ":var18", -1),
    (party_get_slot, ":var17", "$current_town", 25),
    (assign, ":var18", "$current_town"),
    (store_random_in_range, ":var1", "p_village_1", "p_bank_1"),
    (store_random_in_range, ":var9", 0, 126233),
    (val_mod, ":var9", 1000),
    (val_add, ":var9", 1),
    (assign, ":var19", "qst_hunt_down_fugitive"),
    (assign, ":var15", 30),
    (try_begin),
      (ge, ":var1", 0),
      (store_faction_of_party, ":var2", ":var1"),
    (try_end),
    (quest_set_slot, ":var19", 2, ":var0"),
    (quest_set_slot, ":var19", 1, ":var1"),
    (quest_set_slot, ":var19", 4, ":var4"),
    (quest_set_slot, ":var19", 3, ":var2"),
    (quest_set_slot, ":var19", 15, ":var3"),
    (quest_set_slot, ":var19", 7, ":var5"),
    (quest_set_slot, ":var19", 8, ":var6"),
    (quest_set_slot, ":var19", 9, ":var7"),
    (quest_set_slot, ":var19", 10, ":var8"),
    (quest_set_slot, ":var19", 20, ":var11"),
    (quest_set_slot, ":var19", 21, ":var12"),
    (quest_set_slot, ":var19", 22, ":var13"),
    (quest_set_slot, ":var19", 19, ":var14"),
    (quest_set_slot, ":var19", 23, ":var15"),
    (quest_set_slot, ":var19", 24, ":var16"),
    (quest_set_slot, ":var19", 11, 0),
    (quest_set_slot, ":var19", 6, ":var17"),
    (quest_set_slot, ":var19", 12, ":var18"),
    (quest_set_slot, ":var19", 13, ":var9"),
    (quest_set_slot, ":var19", 14, ":var10"),
  ]),

  ("setup_wanted_fugitive_quest",
  [
    (assign, ":var0", -1),
    (assign, ":var1", -1),
    (assign, ":var2", -1),
    (assign, ":var3", -1),
    (assign, ":var4", -1),
    (assign, ":var5", -1),
    (assign, ":var6", -1),
    (assign, ":var7", -1),
    (assign, ":var8", -1),
    (assign, ":var9", -1),
    (assign, ":var10", -1),
    (assign, ":var11", 1),
    (assign, ":var12", 0),
    (assign, ":var13", 0),
    (assign, ":var14", 0),
    (assign, ":var15", 0),
    (assign, ":var16", 0),
    (assign, ":var17", -1),
    (assign, ":var18", -1),
    (assign, ":var17", "$g_talk_troop"),
    (assign, ":var18", "$current_town"),
    (store_random_in_range, ":var1", "p_village_1", "p_bank_1"),
    (store_random_in_range, ":var9", 0, 126233),
    (val_mod, ":var9", 1000),
    (val_add, ":var9", 1),
    (store_random_in_range, ":var19", "str_crime_1", "str_crimes_end"),
    (try_begin),
      (is_between, ":var19", "str_crime_1", "str_crime_10"),
      (assign, ":var20", 1),
    (else_try),
      (is_between, ":var19", "str_crime_10", "str_crime_20"),
      (assign, ":var20", 2),
    (else_try),
      (is_between, ":var19", "str_crime_20", "str_crimes_end"),
      (assign, ":var20", 3),
    (try_end),
    (store_mul, ":var13", ":var20", 500),
    (store_mul, ":var12", ":var20", 150),
    (assign, ":var15", 30),
    (try_begin),
      (ge, ":var1", 0),
      (store_faction_of_party, ":var2", ":var1"),
    (try_end),
    (assign, ":var21", "qst_wanted_fugitive"),
    (quest_set_slot, ":var21", 2, ":var0"),
    (quest_set_slot, ":var21", 1, ":var1"),
    (quest_set_slot, ":var21", 4, ":var4"),
    (quest_set_slot, ":var21", 3, ":var2"),
    (quest_set_slot, ":var21", 15, ":var3"),
    (quest_set_slot, ":var21", 7, ":var5"),
    (quest_set_slot, ":var21", 8, ":var6"),
    (quest_set_slot, ":var21", 9, ":var7"),
    (quest_set_slot, ":var21", 10, ":var8"),
    (quest_set_slot, ":var21", 20, ":var11"),
    (quest_set_slot, ":var21", 19, ":var14"),
    (quest_set_slot, ":var21", 23, ":var15"),
    (quest_set_slot, ":var21", 24, ":var16"),
    (quest_set_slot, ":var21", 11, 0),
    (quest_set_slot, ":var21", 6, ":var17"),
    (quest_set_slot, ":var21", 12, ":var18"),
    (quest_set_slot, ":var21", 13, ":var9"),
    (quest_set_slot, ":var21", 16, ":var19"),
    (quest_set_slot, ":var21", 14, ":var10"),
    (quest_set_slot, ":var21", 21, ":var12"),
    (quest_set_slot, ":var21", 22, ":var13"),
  ]),

  ("get_correct_fugitive_troop_to_reg0",
  [
    (quest_get_slot, ":var0", "qst_wanted_fugitive", 22),
    (try_begin),
      (eq, ":var0", 0),
      (assign, ":var1", "trp_fugitive_original"),
    (else_try),
      (le, ":var0", 500),
      (assign, ":var1", "trp_fugitive_wanted_1"),
    (else_try),
      (le, ":var0", 1000),
      (assign, ":var1", "trp_fugitive_wanted_2"),
    (else_try),
      (assign, ":var1", "trp_fugitive_wanted_3"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("agents_fly_around_position_1",
  [
    (store_script_param, ":var0", 1),
    (store_div, ":var1", ":var0", 2),
    (try_for_agents, ":var2"),
      (agent_get_position, pos2, ":var2"),
      (get_distance_between_positions, ":var3", pos1, pos2),
      (try_begin),
        (lt, ":var3", ":var1"),
        (agent_set_animation, ":var2", "anim_unused_human_anim_6"),
      (else_try),
        (lt, ":var3", ":var0"),
        (agent_set_animation, ":var2", "anim_unused_human_anim_7"),
      (try_end),
    (try_end),
  ]),

  ("explosion_at_pos1",
  [
    (set_fixed_point_multiplier, 100),
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_mul, ":var3", ":var0", 3),
    (call_script, "script_agents_fly_around_position_1", ":var3"),
    (particle_system_burst, "psys_explosion_fire", pos1, 10),
    (particle_system_burst, "psys_explosion_smoke", pos1, 60),
    (particle_system_burst, "psys_explosion_debris", pos1, 50),
    (particle_system_burst, "psys_explosion_dirt", pos1, 30),
    (store_random_in_range, reg1, 0, 4),
    (val_add, reg1, "snd_cannon_shot1"),
    (try_for_agents, ":var4"),
      (agent_is_alive, ":var4"),
      (agent_is_human, ":var4"),
      (assign, ":var5", ":var0"),
      (assign, ":var6", ":var1"),
      (agent_get_position, pos2, ":var4"),
      (position_move_z, pos2, 100),
      (get_distance_between_positions, ":var7", pos1, pos2),
      (gt, ":var5", ":var7"),
      (store_sub, ":var8", ":var5", ":var7"),
      (val_mul, ":var6", ":var8"),
      (val_div, ":var6", ":var5"),
      (ge, ":var6", 1),
      (try_begin),
        (ge, ":var2", 0),
        (call_script, "script_agent_deliver_damage_to_agent", ":var2", ":var4", ":var6"),
      (else_try),
        (call_script, "script_agent_deliver_damage_to_agent", ":var4", ":var4", ":var6"),
      (try_end),
    (try_end),
    (try_for_agents, ":var4"),
      (store_mul, ":var6", ":var1", 2),
      (store_mul, ":var5", ":var0", 2),
      (agent_is_alive, ":var4"),
      (neg|agent_is_human, ":var4"),
      (agent_get_position, pos2, ":var4"),
      (position_move_z, pos2, 100),
      (get_distance_between_positions, ":var7", pos1, pos2),
      (gt, ":var5", ":var7"),
      (store_sub, ":var8", ":var5", ":var7"),
      (val_mul, ":var6", ":var8"),
      (val_div, ":var6", ":var5"),
      (ge, ":var6", 1),
      (try_begin),
        (ge, ":var2", 0),
        (call_script, "script_agent_deliver_damage_to_agent", ":var2", ":var4", ":var6"),
      (else_try),
        (call_script, "script_agent_deliver_damage_to_agent", ":var4", ":var4", ":var6"),
      (try_end),
    (try_end),
  ]),

  ("cannon_effects_grapeshot",
  [
    (store_script_param, ":var0", 1),
    (particle_system_burst, "psys_cannon_alt_smoke", ":var0", 10),
    (particle_system_burst, "psys_cannon_alt_smoke_near", ":var0", 10),
    (particle_system_burst, "psys_cannon_flash", ":var0", 20),
    (position_move_y, ":var0", -250),
    (particle_system_burst, "psys_cannon_ignite_smoke", ":var0", 10),
    (particle_system_burst, "psys_cannon_ignite_flash", ":var0", 10),
  ]),

  ("cannon_effects_roundshot",
  [
    (store_script_param, ":var0", 1),
    (particle_system_burst, "psys_cannon_alt_smoke", ":var0", 10),
    (particle_system_burst, "psys_cannon_alt_smoke_near", ":var0", 10),
    (particle_system_burst, "psys_cannon_flash", ":var0", 20),
    (position_move_y, ":var0", -250),
    (particle_system_burst, "psys_cannon_ignite_smoke", ":var0", 10),
    (particle_system_burst, "psys_cannon_ignite_flash", ":var0", 10),
  ]),

  ("cf_team_charge_if_ammo_le_percent",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (try_for_agents, ":var4"),
      (agent_get_team, ":var5", ":var4"),
      (eq, ":var5", ":var0"),
      (val_add, ":var3", 1),
      (agent_get_ammo, ":var6", ":var4"),
      (le, ":var6", 3),
      (val_add, ":var2", 1),
    (try_end),
    (val_mul, ":var2", 100),
    (store_div, ":var7", ":var2", ":var3"),
    (ge, ":var7", ":var1"),
    (team_give_order, ":var0", 10, 2),
  ]),

  ("enter_town",
  [
    (store_script_param, ":var0", 1),
    (assign, "$talk_context", 0),
    (try_begin),
      (call_script, "script_cf_enter_center_location_bandit_check"),
    (else_try),
      (party_get_slot, ":var1", "$current_town", 10),
      (modify_visitors_at_site, ":var1"),
      (reset_visitors),
      (try_begin),
        (gt, ":var0", -1),
        (set_jump_entry, ":var0"),
      (else_try),
        (eq, "$town_entered", 0),
        (eq, "$town_nighttime", 0),
        (set_jump_entry, 1),
      (else_try),
        (set_jump_entry, 0),
      (try_end),
      (party_get_num_companion_stacks, ":var2", "p_main_party"),
      (assign, ":var3", -1),
      (try_for_range, ":var4", 0, ":var2"),
        (party_stack_get_troop_id, ":var5", "p_main_party", ":var4"),
        (troop_is_hero, ":var5"),
        (gt, ":var5", 0),
        (store_troop_health, ":var6", ":var5", 1),
        (gt, ":var6", 7),
        (assign, ":var3", ":var5"),
      (try_end),
      (try_begin),
        (gt, ":var3", 0),
        (try_begin),
          (gt, ":var0", -1),
          (set_visitor, 62, ":var3"),
        (else_try),
          (eq, "$town_entered", 0),
          (eq, "$town_nighttime", 0),
          (set_visitor, 61, ":var3"),
        (else_try),
          (set_visitor, 60, ":var3"),
        (try_end),
      (else_try),
        (party_stack_get_troop_id, ":var5", "p_main_party", 0),
        (gt, ":var5", 0),
        (try_begin),
          (gt, ":var0", -1),
          (set_visitor, 62, ":var5"),
        (else_try),
          (eq, "$town_entered", 0),
          (eq, "$town_nighttime", 0),
          (set_visitor, 61, ":var5"),
        (else_try),
          (set_visitor, 60, ":var5"),
        (try_end),
      (try_end),
      (assign, "$town_entered", 1),
      (assign, "$g_mt_mode", 0),
      (store_faction_of_party, ":var7", "$current_town"),
      (party_get_slot, ":var8", "$current_town", 20),
      (set_visitor, 51, ":var8"),
      (assign, ":var9", 54),
      (try_begin),
        (neg|check_quest_active, "qst_eliminate_bandits_infesting_village"),
        (neg|check_quest_active, "qst_deal_with_bandits_at_lords_village"),
        (assign, ":var10", "p_salt_mine"),
        (try_for_range, ":var11", "p_village_1", ":var10"),
          (party_slot_eq, ":var11", 120, "$current_town"),
          (party_get_slot, ":var12", ":var11", 25),
          (party_slot_ge, ":var11", 39, 1),
          (neg|party_slot_eq, ":var11", 7, "trp_player"),
          (set_visitor, ":var9", ":var12"),
          (val_add, ":var9", 1),
          (assign, ":var10", 0),
        (try_end),
      (try_end),
      (store_random_in_range, ":var13", "trp_tavern_visitor_1", "trp_local_merchant"),
      (set_visitor, ":var9", ":var13"),
      (val_add, ":var9", 1),
      (try_for_range, ":var0", ":var9", 60),
        (store_random_in_range, ":var13", "trp_saloon_walker_1", "trp_tournament_master"),
        (set_visitor, ":var0", ":var13"),
      (try_end),
      (try_begin),
        (neq, ":var7", "fac_player_supporters_faction"),
        (faction_get_slot, ":var14", "$g_encountered_party_faction", 51),
        (faction_get_slot, ":var15", "$g_encountered_party_faction", 52),
        (set_visitor, 23, ":var15"),
        (set_visitor, 24, ":var14"),
      (try_end),
      (party_get_slot, ":var16", "$current_town", 22),
      (set_visitor, 9, ":var16"),
      (party_get_slot, ":var16", "$current_town", 21),
      (set_visitor, 10, ":var16"),
      (party_get_slot, ":var16", "$current_town", 25),
      (set_visitor, 11, ":var16"),
      (party_get_slot, ":var16", "$current_town", 24),
      (set_visitor, 12, ":var16"),
      (party_get_slot, ":var16", "$current_town", 23),
      (set_visitor, 5, ":var16"),
      (party_get_slot, ":var17", "$current_town", 90),
      (party_get_slot, ":var18", "$current_town", 91),
      (try_begin),
        (gt, ":var18", 0),
        (set_visitor, 52, ":var17"),
      (try_end),
      (try_for_range, ":var19", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
        (troop_slot_eq, ":var19", 2, 0),
        (troop_slot_eq, ":var19", 12, "$current_town"),
        (set_visitor, 53, ":var19"),
      (try_end),
      (call_script, "script_init_town_walkers"),
      (set_jump_mission, "mt_town_center"),
      (try_for_range, ":var13", 0, "trp_end"),
        (troop_slot_eq, ":var13", 142, ":var1"),
        (troop_get_slot, ":var0", ":var13", 143),
        (set_visitor, ":var0", ":var13"),
      (try_end),
      (jump_to_scene, ":var1"),
      (change_screen_mission),
    (try_end),
  ]),

  ("copy_inventory",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (troop_clear_inventory, ":var0"),
    (troop_get_inventory_capacity, ":var2", ":var1"),
    (try_for_range, ":var3", 10, ":var2"),
      (troop_get_inventory_slot, ":var4", ":var1", ":var3"),
      (troop_get_inventory_slot_modifier, ":var5", ":var1", ":var3"),
      (troop_add_item, ":var0", ":var4", ":var5"),
    (try_end),
  ]),

  ("change_random_party_color",
  [
    (try_for_range, ":var0", "fac_confederate_renegades", "fac_minor_end"),
      (store_relation, ":var1", ":var0", "fac_player_faction"),
      (try_begin),
        (lt, ":var1", 0),
        (faction_set_color, ":var0", 9124410),
      (else_try),
        (faction_set_color, ":var0", 9152624),
      (try_end),
    (try_end),
    (try_for_range, ":var0", "fac_commoners", "fac_special_end"),
      (store_relation, ":var1", ":var0", "fac_player_faction"),
      (try_begin),
        (lt, ":var1", 0),
        (faction_set_color, ":var0", 9124410),
      (else_try),
        (faction_set_color, ":var0", 9152624),
      (try_end),
    (try_end),
  ]),

  ("dmod_kill_agent",
  [
    (store_script_param, ":var0", 1),
    (agent_get_horse, ":var1", ":var0"),
    (try_begin),
      (ge, ":var1", 0),
      (agent_set_hit_points, ":var1", -1, 1),
      (agent_deliver_damage_to_agent, ":var0", ":var1"),
      (agent_set_animation_progress, ":var1", 100),
    (try_end),
    (agent_set_slot, ":var0", 5, 1),
    (agent_set_hit_points, ":var0", -1, 1),
    (agent_deliver_damage_to_agent, ":var0", ":var0"),
    (agent_set_animation, ":var0", "anim_dance"),
    (agent_set_animation_progress, ":var0", 99),
  ]),

  ("shotgun_fire",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (set_fixed_point_multiplier, 100),
    (assign, ":var3", 99999),
    (try_for_agents, reg1),
      (agent_is_human, reg1),
      (agent_get_position, pos4, reg1),
      (position_move_z, pos4, 120),
      (get_distance_between_positions, reg2, pos1, pos4),
      (lt, reg2, ":var3"),
      (assign, ":var3", reg2),
      (assign, ":var4", reg1),
    (try_end),
    (agent_get_team, ":var5", ":var4"),
    (get_player_agent_no, ":var6"),
    (try_for_agents, reg1),
      (agent_is_alive, reg1),
      (neq, reg1, ":var4"),
      (agent_get_team, ":var7", reg1),
      (this_or_next|eq, ":var4", ":var6"),
      (teams_are_enemies, ":var7", ":var5"),
      (agent_get_troop_id, ":var8", reg1),
      (this_or_next|neq, ":var8", "trp_deer"),
      (this_or_next|neq, ":var8", "trp_buffalo"),
      (neg|agent_is_human, reg1),
      (agent_get_position, pos2, reg1),
      (position_transform_position_to_local, pos3, pos1, pos2),
      (position_get_x, ":var9", pos3),
      (val_mul, ":var9", -1),
      (position_get_y, ":var10", pos3),
      (position_get_z, ":var11", pos3),
      (is_between, ":var10", 0, ":var1"),
      (store_mul, reg10, ":var0", ":var10"),
      (val_div, reg10, 100),
      (store_mul, ":var12", -1, reg10),
      (assign, ":var13", reg10),
      (try_begin),
        (agent_is_human, reg1),
        (store_add, ":var14", ":var12", -30),
        (store_add, ":var15", ":var13", 30),
      (else_try),
        (store_add, ":var14", ":var12", -100),
        (store_add, ":var15", ":var13", 100),
      (try_end),
      (is_between, ":var11", ":var14", ":var15"),
      (agent_get_horse, ":var16", reg1),
      (try_begin),
        (agent_is_human, reg1),
        (le, ":var16", -1),
        (store_add, ":var17", ":var12", -180),
        (store_add, ":var18", ":var13", 0),
      (else_try),
        (agent_is_human, reg1),
        (store_add, ":var17", ":var12", -220),
        (store_add, ":var18", ":var13", -40),
      (else_try),
        (neg|agent_is_human, reg1),
        (store_add, ":var17", ":var12", -140),
        (store_add, ":var18", ":var13", 0),
      (try_end),
      (is_between, ":var9", ":var17", ":var18"),
      (get_distance_between_positions, reg24, pos1, pos2),
      (store_sub, reg21, ":var1", reg24),
      (val_mul, reg21, ":var2"),
      (val_div, reg21, ":var1"),
      (val_mul, reg21, 2),
      (try_begin),
        (lt, ":var11", 0),
        (val_mul, ":var11", -1),
      (else_try),
        (eq, ":var11", 0),
        (assign, ":var11", 1),
      (try_end),
      (val_div, ":var11", 3),
      (val_sub, reg21, ":var11"),
      (val_add, ":var9", 120),
      (try_begin),
        (lt, ":var9", 0),
        (val_mul, ":var9", -1),
      (else_try),
        (eq, ":var9", 0),
        (assign, ":var9", 1),
      (try_end),
      (val_div, ":var9", 3),
      (val_sub, reg21, ":var9"),
      (gt, reg21, 0),
      (store_agent_hit_points, reg20, reg1, 1),
      #(val_sub, reg20, reg21),
      #(agent_set_hit_points, reg1, reg20, 1),
      (set_show_messages, 1),
      (agent_deliver_damage_to_agent_advanced, ":returned", ":var4", reg1, reg21),
      #(set_show_messages, 1),
      (agent_get_troop_id, reg23, reg1),
      (agent_get_troop_id, reg22, ":var4"),
      (try_begin),
        (position_move_y, pos3, -50),
        (position_transform_position_to_parent, pos4, pos1, pos3),
        (store_random_in_range, ":var19", 100, 170),
        (position_move_z, pos4, ":var19", 1),
        (particle_system_burst, "psys_game_blood", pos4, reg21),
        (particle_system_burst, "psys_game_blood_2", pos4, reg21),
        (try_begin),
          (gt, reg21, 10),
          (agent_is_human, reg1),
          (gt, reg20, 0),
          (gt, reg21, 20),
          (le, ":var16", -1),
          (agent_set_animation, reg1, "anim_unused_human_anim_6"),
          (agent_play_sound, reg1, "snd_man_die"),
        (else_try),
          (le, ":var16", -1),
          (agent_is_human, reg1),
          (agent_set_animation, reg1, "anim_unused_human_anim_7"),
          (agent_play_sound, reg1, "snd_man_hit"),
        (try_end),
      (try_end),
      #(try_begin),
      #  (eq, reg22, "trp_player"),
      #  (try_begin),
      #    (agent_is_human, reg1),
      #    (display_message, "@Delivered {reg21} damage."),
      #  (else_try),
      #    (display_message, "@Delivered {reg21} damage to horse."),
      #  (try_end),
      #(else_try),
      #  (eq, reg23, "trp_player"),
      #  (try_begin),
      #    (agent_is_human, reg1),
      #    (display_message, "@Received {reg21} damage."),
      #  (else_try),
      #    (display_message, "@Horse received {reg21} damage."),
      #  (try_end),
      #(try_end),
      #(try_begin),
      #  (le, reg20, 0),
      #  (str_store_troop_name, s10, reg22),
      #  (str_store_troop_name, s11, reg23),
      #  (try_begin),
      #    (agent_is_human, reg1),
      #    (agent_is_ally, reg1),
      #    (display_message, "@{s11} killed by {s10}.", 0xFF0000),
      #  (else_try),
      #    (agent_is_human, reg1),
      #    (display_message, "@{s11} killed by {s10}.", 0x59914B),
      #  (try_end),
      #(try_end),
    (try_end),
  ]),

  ("faction_cooldown",
  [
    (store_script_param, ":var0", 1),
    (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
    (try_begin),
      (ge, "$player_honor", 100),
      (assign, ":var2", 0),
      (assign, ":var3", 200),
    (else_try),
      (ge, "$player_honor", 75),
      (assign, ":var2", 25),
      (assign, ":var3", 175),
    (else_try),
      (ge, "$player_honor", 50),
      (assign, ":var2", 50),
      (assign, ":var3", 150),
    (else_try),
      (ge, "$player_honor", 25),
      (assign, ":var2", 75),
      (assign, ":var3", 125),
    (else_try),
      (le, "$player_honor", -100),
      (assign, ":var2", 200),
      (assign, ":var3", 0),
    (else_try),
      (le, "$player_honor", -75),
      (assign, ":var2", 175),
      (assign, ":var3", 25),
    (else_try),
      (le, "$player_honor", -50),
      (assign, ":var2", 150),
      (assign, ":var3", 50),
    (else_try),
      (le, "$player_honor", -25),
      (assign, ":var2", 125),
      (assign, ":var3", 75),
    (else_try),
      (assign, ":var2", 100),
      (assign, ":var3", 100),
    (try_end),
    (faction_get_slot, ":var4", ":var0", 90),
    (try_begin),
      (eq, ":var4", 1),
      (gt, ":var1", 0),
      (assign, ":var5", ":var2"),
    (else_try),
      (eq, ":var4", 1),
      (lt, ":var1", 0),
      (assign, ":var5", ":var3"),
    (else_try),
      (eq, ":var4", -1),
      (gt, ":var1", 0),
      (assign, ":var5", ":var3"),
    (else_try),
      (eq, ":var4", -1),
      (lt, ":var1", 0),
      (assign, ":var5", ":var2"),
    (else_try),
      (assign, ":var5", 100),
    (try_end),
    (assign, ":var6", 100),
    (try_begin),
      (ge, ":var1", 75),
      (assign, reg3, -4),
    (else_try),
      (ge, ":var1", 50),
      (assign, reg3, -3),
    (else_try),
      (ge, ":var1", 25),
      (assign, reg3, -2),
    (else_try),
      (ge, ":var1", 2),
      (assign, reg3, -1),
    (else_try),
      (ge, ":var1", -1),
      (assign, reg3, 0),
    (else_try),
      (ge, ":var1", -25),
      (assign, reg3, 1),
    (else_try),
      (ge, ":var1", -50),
      (assign, reg3, 2),
    (else_try),
      (ge, ":var1", -75),
      (assign, reg3, 3),
    (else_try),
      (assign, reg3, 4),
    (try_end),
    (try_begin),
      (neq, reg3, 0),
      (assign, ":var7", reg3),
      (val_mul, reg3, ":var5"),
      (val_div, reg3, ":var6"),
      (assign, ":var8", reg3),
      (call_script, "script_change_player_relation_with_faction", ":var0", reg3),
      (assign, reg3, ":var7"),
      (try_begin),
        (neq, ":var8", ":var7"),
        (try_begin),
          (gt, reg3, 0),
          (str_store_string, s3, "@(+{reg3}"),
        (else_try),
          (str_store_string, s3, "@({reg3}"),
        (try_end),
        (assign, reg3, ":var8"),
        (str_store_string, s3, "@{s3} * honor = "),
      (else_try),
        (str_clear, s4),
        (str_store_string, s3, "@({s4}"),
      (try_end),
      (try_begin),
        (eq, reg3, 0),
        (str_store_string, s3, "@{s3}no change)"),
      (else_try),
        (gt, reg3, 0),
        (str_store_string, s3, "@{s3}+{reg3})"),
      (else_try),
        (str_store_string, s3, "@{s3}{reg3})"),
      (try_end),
      (assign, reg3, 1),
    (else_try),
      (str_store_string, s3, "@ "),
      (assign, reg3, 0),
    (try_end),
  ]),

  ("faction_cooldown_will_occur_yn",
  [
    (store_script_param, ":var0", 1),
    (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
    (try_begin),
      (gt, ":var1", 1),
      (assign, reg1, 1),
    (else_try),
      (lt, ":var1", -1),
      (assign, reg1, 1),
    (else_try),
      (assign, reg1, 0),
    (try_end),
  ]),

  ("override_unuseable_items",
  [
    (call_script, "script_override_unuseable_items_sub", "trp_player"),
    (try_for_range, ":var0", "trp_town_1_weaponsmith", "trp_town_1_tavernkeeper"),
      (call_script, "script_override_unuseable_items_sub", ":var0"),
    (try_end),
  ]),

  ("override_unuseable_items_sub",
  [
    (set_show_messages, 0),
    (store_script_param, ":var0", 1),
    (try_for_range, ":var1", 0, 100),
      (troop_get_inventory_slot, ":var2", ":var0", ":var1"),
      (troop_get_inventory_slot_modifier, ":var3", ":var0", ":var1"),
      (try_begin),
        (is_between, ":var2", "itm_cartridges_bolts_0", "itm_cartridges_end"),
        (try_begin),
          (try_begin),
            (is_between, ":var2", "itm_cartridges_bolts_0", "itm_cartridges_0"),
            (store_sub, reg1, ":var2", "itm_cartridges_bolts_0"),
          (else_try),
            (is_between, ":var2", "itm_cartridges_0", "itm_cartridges_end"),
            (store_sub, reg1, ":var2", "itm_cartridges_0"),
          (try_end),
          (store_skill_level, ":var4", "skl_reserved_13", trp_player),
          (lt, ":var4", reg1),
          (troop_set_inventory_slot, ":var0", ":var1", "itm_no_item"),
          (troop_remove_item, ":var0", "itm_no_item"),
          (store_add, ":var5", ":var2", 23),
          (troop_add_item, ":var0", ":var5", ":var3"),
        (try_end),
      (else_try),
        (is_between, ":var2", "itm_un_cartridges_bolts_0", "itm_un_cartridges_end"),
        (try_begin),
          (try_begin),
            (is_between, ":var2", "itm_un_cartridges_bolts_0", "itm_un_cartridges_0"),
            (store_sub, reg1, ":var2", "itm_un_cartridges_bolts_0"),
          (else_try),
            (is_between, ":var2", "itm_un_cartridges_0", "itm_un_cartridges_end"),
            (store_sub, reg1, ":var2", "itm_un_cartridges_0"),
          (try_end),
          (store_skill_level, ":var4", "skl_reserved_13", trp_player),
          (ge, ":var4", reg1),
          (troop_set_inventory_slot, ":var0", ":var1", "itm_no_item"),
          (troop_remove_item, ":var0", "itm_no_item"),
          (store_sub, ":var5", ":var2", 23),
          (troop_add_item, ":var0", ":var5", ":var3"),
        (try_end),
      (else_try),
        (eq, ":var2", "itm_shotgun8"),
        (store_attribute_level, ":var6", "trp_player", ca_strength),
        (lt, ":var6", 10),
        (troop_set_inventory_slot, ":var0", ":var1", "itm_no_item"),
        (troop_remove_item, ":var0", "itm_no_item"),
        (troop_add_item, ":var0", "itm_un_shotgun8", ":var3"),
      (else_try),
        (eq, ":var2", "itm_un_shotgun8"),
        (store_attribute_level, ":var6", "trp_player", ca_strength),
        (ge, ":var6", 10),
        (troop_set_inventory_slot, ":var0", ":var1", "itm_no_item"),
        (troop_remove_item, ":var0", "itm_no_item"),
        (troop_add_item, ":var0", "itm_shotgun8", ":var3"),
      (try_end),
    (try_end),
    (set_show_messages, 1),
  ]),

  ("replace_standard_ammo",
  [
    (store_script_param, ":var0", 1),
    (try_for_range, ":var1", 0, 100),
      (troop_get_inventory_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (eq, ":var2", "itm_cartridges"),
        (store_random_in_range, ":var3", "itm_cartridges_0", "itm_cartridges_end"),
        (troop_set_inventory_slot, ":var0", ":var1", ":var3"),
      (else_try),
        (eq, ":var2", "itm_cartridges_bolts"),
        (store_random_in_range, ":var3", "itm_cartridges_bolts_0", "itm_cartridges_0"),
        (troop_set_inventory_slot, ":var0", ":var1", ":var3"),
      (try_end),
    (try_end),
  ]),

  ("equip_random_zombie_gear",
  [
    (store_script_param, ":var0", 1),
    (troop_clear_inventory, ":var0"),
    (store_random_in_range, ":var1", 0, 100),
    (try_begin),
      (is_between, ":var1", 0, 100),
      (store_random_in_range, ":var2", 0, 100),
      (try_begin),
        (is_between, ":var2", 0, 30),
        (troop_add_item, ":var0", "itm_feather_c"),
      (try_end),
      (store_random_in_range, ":var2", 0, 100),
      (try_begin),
        (is_between, ":var2", 0, 30),
        (troop_add_item, ":var0", "itm_apache_vest_a"),
      (else_try),
        (is_between, ":var2", 30, 60),
        (troop_add_item, ":var0", "itm_apache_vest_b"),
      (try_end),
      (store_random_in_range, ":var2", 0, 100),
      (try_begin),
        (is_between, ":var2", 0, 30),
        (troop_add_item, ":var0", "itm_2by4nails"),
      (else_try),
        (is_between, ":var2", 30, 50),
        (troop_add_item, ":var0", "itm_machete"),
      (else_try),
        (is_between, ":var2", 50, 70),
        (troop_add_item, ":var0", "itm_machete_b"),
      (else_try),
        (is_between, ":var2", 70, 90),
        (troop_add_item, ":var0", "itm_machete3"),
      (try_end),
    (try_end),
    (troop_equip_items, ":var0"),
  ]),

  ("cf_move_scene_props_underground",
  [
    (store_script_param, ":var0", 1),
    (scene_prop_get_num_instances, ":var1", ":var0"),
    (ge, ":var1", 0),
    (init_position, pos1),
    (position_set_z, pos1, -100000),
    (try_for_range, ":var2", 0, ":var1"),
      (scene_prop_get_instance, ":var3", ":var0", ":var2"),
      (prop_instance_animate_to_position, ":var3", pos1, 1),
    (try_end),
  ]),

  ("get_distance_between_agents",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (set_fixed_point_multiplier, 100),
    (agent_get_position, pos1, ":var0"),
    (agent_get_position, pos2, ":var1"),
    (get_distance_between_positions, reg0, pos1, pos2),
  ]),

  ("move_agent_away_from_agent",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (agent_get_position, pos1, ":var0"),
    (agent_get_position, pos2, ":var1"),
    (position_copy_rotation, pos2, pos1),
    (position_move_y, pos2, ":var2"),
    (agent_set_scripted_destination, ":var1", pos2),
  ]),

  ("agent_modify_slot",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (agent_get_slot, ":var3", ":var0", ":var1"),
    (val_add, ":var3", ":var2"),
    (agent_set_slot, ":var0", ":var1", ":var3"),
  ]),

  ("troop_modify_slot",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (troop_get_slot, ":var3", ":var0", ":var1"),
    (val_add, ":var3", ":var2"),
    (troop_set_slot, ":var0", ":var1", ":var3"),
  ]),

  ("cf_agent_run_to_closest_hiding_spot",
  [
    (store_script_param, ":var0", 1),
    (set_fixed_point_multiplier, 100),
    (get_player_agent_no, ":var1"),
    (agent_get_position, pos1, ":var0"),
    (agent_get_position, pos2, ":var1"),
    (get_distance_between_positions, ":var2", pos1, pos2),
    (agent_get_slot, ":var3", ":var0", 28),
    (agent_get_slot, ":var4", ":var0", 29),
    (neg|this_or_next|agent_slot_eq, ":var0", 24, 2),
    (this_or_next|lt, ":var2", 700),
    (eq, ":var3", ":var4"),
    (init_position, pos0),
    (assign, ":var5", 999999),
    (assign, ":var6", -1),
    (scene_prop_get_num_instances, ":var7", "spr_hiding_spot"),
    (try_for_range, ":var8", 0, ":var7"),
      (scene_prop_get_instance, ":var9", "spr_hiding_spot", ":var8"),
      (prop_instance_get_position, pos3, ":var9"),
      (troop_get_slot, ":var10", "trp_hiding_spots", ":var8"),
      (assign, ":var11", 0),
      (try_begin),
        (lt, ":var10", 4),
        (get_distance_between_positions, ":var2", pos2, pos3),
        (gt, ":var2", 700),
        (neq, ":var8", ":var4"),
        (assign, ":var11", 1),
      (else_try),
        (store_add, ":var12", ":var8", 1),
        (eq, ":var7", ":var12"),
        (eq, ":var6", -1),
        (assign, ":var11", 1),
      (try_end),
      (eq, ":var11", 1),
      (get_distance_between_positions, ":var13", pos1, pos3),
      (lt, ":var13", ":var5"),
      (assign, ":var5", ":var13"),
      (assign, ":var6", ":var8"),
      (copy_position, pos0, pos3),
    (try_end),
    (try_begin),
      (call_script, "script_troop_modify_slot", "trp_hiding_spots", ":var6", 1),
      (agent_set_slot, ":var0", 28, ":var6"),
      (agent_clear_scripted_mode, ":var0"),
      (agent_set_scripted_destination, ":var0", pos0),
      (neq, ":var3", -1),
      (call_script, "script_troop_modify_slot", "trp_hiding_spots", ":var3", -1),
    (try_end),
  ]),

  ("cancel_town_panic",
  [
    (store_script_param, ":var0", 1),
    (assign, "$g_mt_mode", 0),
    (try_for_agents, ":var1"),
      (agent_clear_scripted_mode, ":var1"),
      (call_script, "script_cf_shootout_init_town_agent", ":var1", ":var0"),
      (call_script, "script_agent_return_to_entry", ":var1"),
    (try_end),
    (try_for_range, ":var2", 0, 256),
      (troop_set_slot, "trp_hiding_spots", ":var2", 0),
    (try_end),
    (call_script, "script_init_town_walker_agents"),
  ]),

  ("agent_return_to_entry",
  [
    (store_script_param, ":var0", 1),
    (agent_get_entry_no, ":var1", ":var0"),
    (entry_point_get_position, pos1, ":var1"),
    (agent_clear_scripted_mode, ":var0"),
    (agent_set_speed_limit, ":var0", 5),
    (agent_set_scripted_destination, ":var0", pos1),
  ]),

  ("transport_player",
  [
    (try_begin),
      (party_get_position, pos1, "$g_destination"),
      (map_get_land_position_around_position, pos2, pos1, 1),
      (party_set_position, "p_main_party", pos2),
    (try_end),
  ]),

  ("cannon_fire_sound",
  [
    (store_script_param, ":var0", 1),
    (set_fixed_point_multiplier, 100),
    (store_add, ":var1", ":var0", 1),
    (get_player_agent_no, ":var2"),
    (agent_get_position, ":var1", ":var2"),
    (get_distance_between_positions, ":var3", ":var1", ":var0"),
    (assign, ":var4", -1),
    (try_begin),
      (lt, ":var3", 5000),
      (assign, ":var4", "snd_cannon_shot1_loud"),
    (else_try),
      (lt, ":var3", 10000),
      (assign, ":var4", "snd_cannon_shot1_mid"),
    (else_try),
      (lt, ":var3", 15000),
      (assign, ":var4", "snd_cannon_shot1_quiet"),
    (else_try),
      (assign, ":var4", "snd_cannon_shot1_distant"),
    (try_end),
    (store_random_in_range, ":var5", 0, 4),
    (val_add, ":var4", ":var5"),
    (play_sound, ":var4"),
  ]),

  ("clear_inventory",
  [
    (store_script_param, ":var0", 1),
    (troop_clear_inventory, ":var0"),
    (try_for_range, ":var1", 0, 10),
      (troop_set_inventory_slot, ":var0", ":var1", -1),
    (try_end),
  ]),

  ("persuasion_attempt",
  [
    (store_script_param_1, ":var0"),
    (assign, ":var1", 0),
    (assign, ":var2", 0),
    (try_for_range, ":var3", 0, ":var0"),
      (store_random_in_range, ":var4", 0, 100),
      (ge, ":var4", 50),
      (store_add, ":var1", ":var1", 1),
    (try_end),
    (try_for_range, ":var3", 0, ":var1"),
      (store_random_in_range, ":var4", 40, 140),
      (store_add, ":var2", ":var2", ":var4"),
    (try_end),
    (try_begin),
      (ge, ":var2", 100),
      (assign, reg0, 1),
      (display_message, "@Persuasion Attempt Successful."),
    (else_try),
      (assign, reg0, 0),
      (display_message, "@Persuasion Attempt Failed."),
    (try_end),
  ]),

  ("disguise_attempt",
  [
    (store_script_param_1, ":var0"),
    (troop_get_type, ":var1", "trp_player"),
    (try_begin),
      (eq, ":var0", "pt_imperialists"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_mexican_imperial_hat"),
      (this_or_next|eq, ":var1", 2),
      (eq, ":var1", 5),
      (assign, reg0, 1),
    (else_try),
      (eq, ":var0", "pt_confederate_renegades"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_a"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_b"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_c"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_d"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_e"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_f"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_g"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_h"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_uniform_i"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_csa_coat"),
      (troop_has_item_equipped, "trp_player", "itm_leather_jerkin_cs"),
      (assign, reg0, 1),
    (else_try),
      (eq, ":var0", "pt_indian_raiders"),
      (this_or_next|troop_has_item_equipped, "trp_player", "itm_native_body_warpaint"),
      (this_or_next|eq, ":var1", 3),
      (eq, ":var1", 6),
      (assign, reg0, 1),
    (else_try),
      (eq, ":var0", "pt_scalphunters"),
      (troop_has_item_equipped, "trp_player", "itm_scalpingknife"),
      (assign, reg0, 1),
    (else_try),
      (assign, reg0, 0),
    (try_end),
  ]),

  ("check_if_agent_has_ranged",
  [
    (store_script_param, ":var0", 1),
    (assign, reg0, -1),
    (assign, ":var1", "itm_torch"),
    (try_for_range, ":var2", "itm_javelin", ":var1"),
      (agent_has_item_equipped, ":var0", ":var2"),
      (assign, reg0, 1),
      (assign, ":var1", -1),
    (try_end),
  ]),

  ("cf_skill_check",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_script_param, ":var3", 4),
    (store_skill_level, ":var4", ":var1", ":var0"),
    (store_mul, ":var5", ":var4", ":var3"),
    (store_add, ":var6", ":var2", ":var5"),
    (assign, reg0, ":var6"),
    (store_random_in_range, ":var7", 1, 101),
    (val_max, ":var7", 1),
    (le, ":var7", ":var6"),
  ]),

  ("cf_town_walker_persuasion_check",
  [
    (store_script_param, ":var0", 1),
    (assign, ":var1", 1),
    (try_begin),
      (eq, ":var0", "trp_town_walker_4"),
      (call_script, "script_cf_skill_check", "trp_player", "skl_persuasion", 50, 5),
    (else_try),
      (this_or_next|eq, ":var0", "trp_saloon_walker_1"),
      (this_or_next|eq, ":var0", "trp_saloon_walker_2"),
      (eq, ":var0", "trp_town_walker_1"),
      (call_script, "script_cf_skill_check", "trp_player", "skl_persuasion", 40, 5),
    (else_try),
      (eq, ":var0", "trp_town_walker_6"),
      (call_script, "script_cf_skill_check", "trp_player", "skl_persuasion", 30, 5),
    (else_try),
      (this_or_next|eq, ":var0", "trp_saloon_walker_3"),
      (eq, ":var0", "trp_town_walker_5"),
      (call_script, "script_cf_skill_check", "trp_player", "skl_persuasion", 20, 5),
    (else_try),
      (eq, ":var0", "trp_town_walker_2"),
      (call_script, "script_cf_skill_check", "trp_player", "skl_persuasion", 10, 5),
    (else_try),
      (eq, ":var0", "trp_town_walker_3"),
      (call_script, "script_cf_skill_check", "trp_player", "skl_persuasion", 0, 5),
    (else_try),
      (assign, ":var1", 0),
    (try_end),
    (eq, ":var1", 1),
  ]),

  ("rob_agent",
  [
    (store_script_param, ":var0", 1),
    (agent_get_slot, ":var1", ":var0", 30),
    (agent_set_slot, ":var0", 30, 0),
    (troop_add_gold, "trp_player", ":var1"),
  ]),

  ("store_random_string_to_s0",
  [
    (store_script_param, ":var0", 1),
    (val_add, ":var0", 1),
    (store_random_in_range, ":var1", 1, ":var0"),
    (str_store_string_reg, s0, ":var1"),
  ]),

  ("cf_set_town_agent_behavior",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (is_between, ":var1", 0, 5),
    (get_player_agent_no, ":var2"),
    (agent_get_troop_id, ":var3", ":var0"),
    (try_begin),
      (agent_slot_eq, ":var0", 24, -1),
      (agent_set_animation_progress, ":var0", 99),
      (agent_set_stand_animation, ":var0", anim_stand_man),
      (agent_set_speed_limit, ":var0", 999),
    (try_end),
    (try_begin),
      (eq, ":var1", 0),
      (agent_set_team, ":var0", 1),
      (try_begin),
        (call_script, "script_get_distance_between_agents", ":var2", ":var0"),
        (agent_set_scripted_destination, ":var0", pos1),
        (lt, reg0, 1000),
        (assign, "$warn_player", 1),
        (start_mission_conversation, ":var3"),
      (try_end),
    (else_try),
      (eq, ":var1", 1),
      (agent_set_team, ":var0", 2),
      (agent_get_position, pos1, ":var2"),
      (agent_set_scripted_destination, ":var0", pos1),
    (else_try),
      (eq, ":var1", 2),
      (try_begin),
        (call_script, "script_cf_agent_run_to_closest_hiding_spot", ":var0"),
      (try_end),
    (else_try),
      (eq, ":var1", 3),
      (agent_clear_scripted_mode, ":var0"),
      (agent_set_team, ":var0", 1),
      (agent_set_animation, ":var0", "anim_stick_em_up"),
    (else_try),
      (eq, ":var1", 4),
      (agent_clear_scripted_mode, ":var0"),
      (agent_set_team, ":var0", 1),
      (try_begin),
        (agent_slot_eq, ":var0", 24, 3),
        (agent_set_animation_progress, ":var0", 99),
      (try_end),
      (store_add, ":var4", 200, 200),
      (call_script, "script_move_agent_away_from_agent", ":var2", ":var0", ":var4"),
    (try_end),
    (agent_set_slot, ":var0", 24, ":var1"),
  ]),

  ("cf_agent_is_in_front_of_agent",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (agent_get_position, pos1, ":var0"),
    (agent_get_position, pos2, ":var1"),
    (neg|position_is_behind_position, pos1, pos2),
  ]),

  ("cf_agent_is_behind_agent",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (agent_get_position, pos1, ":var0"),
    (agent_get_position, pos2, ":var1"),
    (position_is_behind_position, pos1, pos2),
  ]),

  ("nearby_agents_scatter",
  [
    (store_script_param, ":var0", 1),
    (try_for_agents, ":var1"),
      (agent_is_alive, ":var1"),
      (agent_is_human, ":var1"),
      (call_script, "script_get_distance_between_agents", ":var0", ":var1"),
      (le, reg0, 700),
      (agent_get_slot, ":var2", ":var1", 28),
      (agent_set_slot, ":var1", 29, ":var2"),
    (try_end),
  ]),

  ("cap_faction_relations",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_relation, ":var3", ":var0", ":var1"),
    (val_min, ":var3", ":var2"),
    (set_relation, ":var0", ":var1", ":var3"),
  ]),

  ("crime_committed",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_faction_of_party, ":var3", ":var1"),
    (agent_get_slot, ":var4", ":var0", 25),
    (agent_get_slot, ":var5", ":var0", 23),
    (assign, ":var6", 0),
    (assign, ":var7", 0),
    (try_begin),
      (eq, ":var2", 1),
      (try_begin),
        (eq, ":var4", 1),
        (val_add, "$assaults_guard", 1),
      (else_try),
        (val_add, "$assaults", 1),
      (try_end),
      (assign, ":var6", -3),
      (assign, ":var7", 0),
    (else_try),
      (eq, ":var2", 2),
      (assign, ":var6", -10),
      (assign, ":var7", -1),
      (try_begin),
        (eq, ":var4", 1),
        (val_sub, "$g_spawned_guards", 1),
        (val_add, "$murders_guard", 1),
        (this_or_next|eq, ":var5", 0),
        (val_sub, "$assaults_guard", 1),
      (else_try),
        (val_add, "$murders", 1),
        (this_or_next|eq, ":var5", 0),
        (val_sub, "$assaults", 1),
      (try_end),
      (try_begin),
        (eq, ":var5", 1),
        (store_sub, ":var6", -10, -3),
        (store_sub, ":var7", -1, 0),
      (try_end),
    (else_try),
      (eq, ":var2", 3),
      (val_add, "$robberies", 1),
      (assign, ":var6", -2),
      (assign, ":var7", 0),
    (else_try),
      (eq, ":var2", 4),
      (val_add, "$attempted_robberies", 1),
      (assign, ":var6", -1),
      (assign, ":var7", 0),
    (try_end),
    (call_script, "script_cap_faction_relations", "fac_player_faction", ":var3", -1),
    (try_begin),
      (eq, ":var4", 1),
      (assign, ":var8", 2),
    (else_try),
      (assign, ":var8", 1),
    (try_end),
    (val_mul, ":var6", ":var8"),
    (val_mul, ":var7", ":var8"),
    (call_script, "script_change_player_relation_with_faction", ":var3", ":var7"),
    (call_script, "script_change_player_relation_with_center", ":var1", ":var6"),
    (assign, "$g_mt_mode", 2),
  ]),

  ("cf_shootout_init_town_agent",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (agent_is_human, ":var0"),
    (agent_get_troop_id, ":var2", ":var0"),
    (try_begin),
      (eq, ":var2", "trp_player"),
      (agent_set_team, ":var0", 3),
    (else_try),
      (is_between, ":var2", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
      (party_count_companions_of_type, ":var3", "p_main_party", ":var2"),
      (ge, ":var3", 1),
      (agent_set_team, ":var0", 3),
    (else_try),
      (eq, ":var2", "trp_wanted_sign"),
      (agent_set_team, ":var0", 0),
    (else_try),
      (agent_set_team, ":var0", 1),
    (try_end),
    (store_agent_hit_points, ":var4", ":var0", 1),
    (agent_set_slot, ":var0", 14, 0),
    (agent_set_slot, ":var0", 15, 0),
    (agent_set_slot, ":var0", 16, 1),
    (agent_set_slot, ":var0", 17, 100),
    (agent_set_slot, ":var0", 18, 200),
    (agent_set_slot, ":var0", 19, 125),
    (agent_set_slot, ":var0", 21, ":var4"),
    (agent_set_slot, ":var0", 20, 90),
    (agent_set_slot, ":var0", 22, 0),
    (agent_set_slot, ":var0", 23, 0),
    (agent_set_slot, ":var0", 24, -1),
    (agent_set_slot, ":var0", 28, -1),
    (agent_set_slot, ":var0", 29, -1),
    (agent_set_slot, ":var0", 25, 0),
    (agent_set_slot, ":var0", 27, 1400),
    (try_begin),
      (call_script, "script_cf_agent_is_town_guard", ":var0", ":var1"),
      (agent_set_slot, ":var0", 14, 5),
      (agent_set_slot, ":var0", 16, 50),
      (agent_set_slot, ":var0", 17, 70),
      (agent_set_slot, ":var0", 18, 40),
      (agent_set_slot, ":var0", 19, 40),
      (agent_set_slot, ":var0", 20, 0),
      (agent_set_slot, ":var0", 25, 1),
      (agent_set_slot, ":var0", 27, 2100),
    (else_try),
      (troop_is_guarantee_ranged, ":var2"),
      (store_random_in_range, ":var5", 1, 4),
      (agent_set_slot, ":var0", 14, ":var5"),
    (else_try),
      (call_script, "script_check_if_agent_has_ranged", ":var0"),
      (eq, reg0, 1),
      (agent_set_slot, ":var0", 14, 1),
    (try_end),
    (try_begin),
      (eq, ":var2", "trp_town_walker_4"),
      (store_random_in_range, ":var6", 1, 100),
      (agent_set_slot, ":var0", 30, ":var6"),
    (else_try),
      (this_or_next|eq, ":var2", "trp_saloon_walker_1"),
      (this_or_next|eq, ":var2", "trp_saloon_walker_2"),
      (eq, ":var2", "trp_town_walker_1"),
      (store_random_in_range, ":var6", 100, 200),
      (agent_set_slot, ":var0", 30, ":var6"),
    (else_try),
      (eq, ":var2", "trp_town_walker_6"),
      (store_random_in_range, ":var6", 300, 400),
      (agent_set_slot, ":var0", 30, ":var6"),
    (else_try),
      (this_or_next|eq, ":var2", "trp_saloon_walker_3"),
      (eq, ":var2", "trp_town_walker_5"),
      (store_random_in_range, ":var6", 400, 500),
      (agent_set_slot, ":var0", 30, ":var6"),
    (else_try),
      (eq, ":var2", "trp_town_walker_2"),
      (store_random_in_range, ":var6", 500, 600),
      (agent_set_slot, ":var0", 30, ":var6"),
    (else_try),
      (eq, ":var2", "trp_town_walker_3"),
      (store_random_in_range, ":var6", 600, 700),
      (agent_set_slot, ":var0", 30, ":var6"),
    (else_try),
      (store_random_in_range, ":var6", 1, 100),
      (agent_set_slot, ":var0", 30, ":var6"),
    (try_end),
  ]),

  ("cf_agent_is_town_guard",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (agent_get_troop_id, ":var2", ":var0"),
    (store_faction_of_party, ":var3", ":var1"),
    (faction_get_slot, ":var4", ":var3", 49),
    (faction_get_slot, ":var5", ":var3", 51),
    (faction_get_slot, ":var6", ":var3", 52),
    (this_or_next|eq, ":var2", ":var4"),
    (this_or_next|eq, ":var2", ":var5"),
    (eq, ":var2", ":var6"),
  ]),

  ("store_faction_relation_description_to_s3",
  [
    (store_script_param, ":var0", 1),
    (try_begin),
      (ge, ":var0", 90),
      (str_store_string, s3, "@Loyal"),
    (else_try),
      (ge, ":var0", 80),
      (str_store_string, s3, "@Devoted"),
    (else_try),
      (ge, ":var0", 70),
      (str_store_string, s3, "@Fond"),
    (else_try),
      (ge, ":var0", 60),
      (str_store_string, s3, "@Gracious"),
    (else_try),
      (ge, ":var0", 50),
      (str_store_string, s3, "@Friendly"),
    (else_try),
      (ge, ":var0", 40),
      (str_store_string, s3, "@Supportive"),
    (else_try),
      (ge, ":var0", 30),
      (str_store_string, s3, "@Favorable"),
    (else_try),
      (ge, ":var0", 20),
      (str_store_string, s3, "@Cooperative"),
    (else_try),
      (ge, ":var0", 10),
      (str_store_string, s3, "@Accepting"),
    (else_try),
      (ge, ":var0", 0),
      (str_store_string, s3, "@Indifferent"),
    (else_try),
      (ge, ":var0", -10),
      (str_store_string, s3, "@Suspicious"),
    (else_try),
      (ge, ":var0", -20),
      (str_store_string, s3, "@Grumbling"),
    (else_try),
      (ge, ":var0", -30),
      (str_store_string, s3, "@Hostile"),
    (else_try),
      (ge, ":var0", -40),
      (str_store_string, s3, "@Resentful"),
    (else_try),
      (ge, ":var0", -50),
      (str_store_string, s3, "@Angry"),
    (else_try),
      (ge, ":var0", -60),
      (str_store_string, s3, "@Hateful"),
    (else_try),
      (ge, ":var0", -70),
      (str_store_string, s3, "@Revengeful"),
    (else_try),
      (str_store_string, s3, "@Vengeful"),
    (try_end),
  ]),

  ("store_faction_description_to_s3",
  [
    (str_clear, s3),
    (store_script_param, ":var0", 1),
    (str_store_faction_name, s2, ":var0"),
    (try_begin),
      (eq, ":var0", "fac_commoners"),
      (str_store_string, s3, "@{s2} are the unorganized, collective regular people of the west. They value justice, honesty, and hard work. They seek their fortunes within the limits of the law."),
    (else_try),
      (eq, ":var0", "fac_outlaws"),
      (str_store_string, s3, "@{s2} are the unorganized, collective scum of the west. Outlawed in civilized places, they steal and kill to survive."),
    (else_try),
      (eq, ":var0", "fac_deserters"),
      (str_store_string, s3, "@{s2} are unorganized, lost soldiers who have left their military posts and cannot return home. They now do what they must to survive."),
    (else_try),
      (eq, ":var0", "fac_kingdom_1"),
      (str_store_string, s3, "@{s2} are an industrious nation looking to expand westward after emerging victorious from a bloody civil war. The nation now turns it's military attention westward to problems on the frontier."),
    (else_try),
      (eq, ":var0", "fac_kingdom_2"),
      (str_store_string, s3, "@{s2} are the republican resistance of a nation stuggling to remain independent. While fighting the war against the tyrant Emperor Maxillian I in the south, they also fight to maintain their borders here in the north."),
    (else_try),
      (eq, ":var0", "fac_kingdom_3"),
      (str_store_string, s3, "@{s2} are a proud, rugged people with a rich heritage of strength and honor. They are prepared to fight all intruders to preserve their land and way of life."),
    (else_try),
      (eq, ":var0", "fac_kingdom_4"),
      (str_store_string, s3, "@{s2} are a plains people whose way of life revolves around the horse. They fight to maintain their hunting lands and protect their culture."),
    (else_try),
      (eq, ":var0", "fac_confederate_renegades"),
      (str_store_string, s3, "@{s2} are the remnants of the defeated Confederate army who refuse to give up the fight against the United States."),
    (else_try),
      (eq, ":var0", "fac_imperialists"),
      (str_store_string, s3, "@{s2} are the scattered forces of the Mexican Imperial army that has detached from the main force in the south. They aim to harass the Mexican Republicans and seize targets of opportunity."),
    (else_try),
      (eq, ":var0", "fac_scalphunters"),
      (str_store_string, s3, "@{s2} are savage Mexicans who murder unsuspecting bypassers near border towns. From the dead, they take the scalps and sell them for a handsome profit to groups looking for revenge."),
    (else_try),
      (eq, ":var0", "fac_indian_raiders"),
      (str_store_string, s3, "@{s2} are nomadic warriors from a gathering of tribes who fight to stop the settlement of the frontier. These warriors have earned a reputation for their ferocity and rarely show mercy."),
    (else_try),
      (is_between, ":var0", "fac_unused_1", "fac_kingdoms_end"),
      (faction_get_slot, ":var1", ":var0", 9),
      (try_begin),
        (eq, ":var1", "fac_culture_5"),
        (str_store_string, s3, "@{s2} are an organized gang of Mexican criminals whose goal is to capture villages and take up permanent residence. The more villages they hold, the more booze, bullets, and senioritas they can take."),
      (else_try),
        (eq, ":var1", "fac_culture_6"),
        (str_store_string, s3, "@{s2} are an organized gang of corrupt lawmen whose goal is to uproot the criminal element in villages and replace their corruption with their own. They may have badges, but these men care not for justice."),
      (else_try),
        (eq, ":var1", "fac_culture_7"),
        (str_store_string, s3, "@{s2} are an organized gang of American criminals whose goal is to control entire villages and terrify the populace. In taking more settlements, they hope to satisfy their lust for power, sex, and gold."),
      (try_end),
    (try_end),
  ]),

  ("party_store_robbery_amount_to_reg5",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (assign, ":var3", 100),
    (assign, ":var4", 2000),
    (assign, ":var5", 200),
    (assign, ":var6", 1000),
    (assign, ":var7", 300),
    (assign, ":var8", ":var0"),
    (val_abs, ":var8"),
    (val_mul, ":var8", ":var4"),
    (val_div, ":var8", ":var3"),
    (assign, reg5, ":var8"),
    (call_script, "script_party_calculate_strength", ":var1", 0),
    (assign, ":var9", reg0),
    (call_script, "script_party_calculate_strength", ":var2", 0),
    (assign, ":var10", reg0),
    (try_begin),
      (ge, ":var9", ":var10"),
      (assign, ":var11", 0),
    (else_try),
      (store_sub, ":var11", ":var10", ":var9"),
      (try_begin),
        (gt, ":var11", ":var5"),
        (assign, ":var11", ":var5"),
      (try_end),
      (val_mul, ":var11", ":var6"),
      (val_div, ":var11", ":var5"),
    (try_end),
    (store_add, ":var12", ":var8", ":var11"),
    (try_begin),
      (lt, ":var12", ":var7"),
      (assign, ":var12", ":var7"),
    (try_end),
    (assign, reg5, ":var12"),
  ]),

  ("get_player_troop_recruitment_allowed_to_reg0",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 30),
    (assign, ":var3", 40),
    (store_character_level, ":var4", ":var1"),
    (val_mul, ":var4", ":var3"),
    (val_div, ":var4", ":var2"),
    (try_begin),
      (ge, ":var0", ":var4"),
      (assign, reg0, 1),
    (else_try),
      (assign, reg0, 0),
    (try_end),
  ]),

  ("get_player_troop_recruitment_cost_to_reg0",
  [
    (store_script_param_1, ":var0"),
    (store_script_param_2, ":var1"),
    (assign, ":var2", 30),
    (assign, ":var3", 2000),
    (assign, ":var4", 100),
    (assign, ":var5", 50),
    (store_character_level, ":var6", ":var1"),
    (val_mul, ":var6", ":var3"),
    (val_div, ":var6", ":var2"),
    (try_begin),
      (gt, ":var0", 0),
      (assign, ":var7", ":var0"),
      (val_mul, ":var7", ":var5"),
      (val_div, ":var7", ":var4"),
      (store_sub, ":var7", 100, ":var7"),
      (val_mul, ":var6", ":var7"),
      (val_div, ":var6", 100),
    (try_end),
    (assign, reg0, ":var6"),
  ]),

  ("party_recruitment_breakdown",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (assign, ":var2", 0),
    (assign, ":var3", 0),
    (assign, ":var4", 0),
    (assign, reg10, 0),
    (assign, reg11, 0),
    (assign, reg12, 0),
    (assign, reg13, 0),
    (assign, reg14, 0),
    (assign, reg15, 0),
    (assign, reg16, 0),
    (assign, reg17, 0),
    (assign, reg18, 0),
    (assign, reg19, 0),
    (assign, reg20, 0),
    (assign, reg21, 0),
    (assign, reg22, 0),
    (assign, reg23, 0),
    (assign, reg24, 0),
    (assign, reg25, 0),
    (assign, reg26, 0),
    (assign, reg27, 0),
    (assign, reg28, 0),
    (assign, reg29, 0),
    (assign, reg30, 0),
    (assign, reg31, 0),
    (assign, reg32, 0),
    (assign, reg33, 0),
    (assign, reg34, 0),
    (assign, reg35, 0),
    (assign, reg36, 0),
    (assign, reg37, 0),
    (assign, reg38, 0),
    (assign, reg39, 0),
    (str_store_string, s4, "@We like you enough to make these troops available for recruitment:^^"),
    (party_get_num_companion_stacks, ":var5", ":var1"),
    (try_for_range, ":var6", ":var2", ":var5"),
      (assign, ":var7", 0),
      (assign, ":var8", 0),
      (assign, ":var9", 0),
      (le, ":var3", 10),
      (party_stack_get_troop_id, ":var7", ":var1", ":var6"),
      (call_script, "script_get_player_troop_recruitment_allowed_to_reg0", ":var0", ":var7"),
      (assign, ":var10", reg0),
      (call_script, "script_get_player_troop_recruitment_cost_to_reg0", ":var0", ":var7"),
      (assign, ":var8", reg0),
      (try_begin),
        (neg|troop_is_hero, ":var7"),
        (party_stack_get_size, ":var9", ":var1", ":var6"),
      (else_try),
        (troop_is_wounded, ":var7"),
        (assign, ":var9", 0),
      (try_end),
      (try_begin),
        (gt, ":var9", 0),
        (eq, ":var10", 1),
        (assign, ":var4", 1),
        (val_add, ":var3", 1),
        (try_begin),
          (eq, ":var3", 1),
          (assign, reg10, ":var7"),
          (assign, reg20, ":var8"),
          (assign, reg30, ":var9"),
        (else_try),
          (eq, ":var3", 2),
          (assign, reg11, ":var7"),
          (assign, reg21, ":var8"),
          (assign, reg31, ":var9"),
        (else_try),
          (eq, ":var3", 3),
          (assign, reg12, ":var7"),
          (assign, reg22, ":var8"),
          (assign, reg32, ":var9"),
        (else_try),
          (eq, ":var3", 4),
          (assign, reg13, ":var7"),
          (assign, reg23, ":var8"),
          (assign, reg33, ":var9"),
        (else_try),
          (eq, ":var3", 5),
          (assign, reg14, ":var7"),
          (assign, reg24, ":var8"),
          (assign, reg34, ":var9"),
        (else_try),
          (eq, ":var3", 6),
          (assign, reg15, ":var7"),
          (assign, reg25, ":var8"),
          (assign, reg35, ":var9"),
        (else_try),
          (eq, ":var3", 7),
          (assign, reg16, ":var7"),
          (assign, reg26, ":var8"),
          (assign, reg36, ":var9"),
        (else_try),
          (eq, ":var3", 8),
          (assign, reg17, ":var7"),
          (assign, reg27, ":var8"),
          (assign, reg37, ":var9"),
        (else_try),
          (eq, ":var3", 9),
          (assign, reg18, ":var7"),
          (assign, reg28, ":var8"),
          (assign, reg38, ":var9"),
        (else_try),
          (eq, ":var3", 10),
          (assign, reg19, ":var7"),
          (assign, reg29, ":var8"),
          (assign, reg39, ":var9"),
        (try_end),
        (str_store_troop_name, s5, ":var7"),
        (str_store_string, s4, "@{s4} {s5}: "),
        (assign, reg0, ":var9"),
        (str_store_string, s4, "@{s4} ({reg0} at"),
        (assign, reg0, ":var8"),
        (call_script, "script_game_get_money_text_alt", reg0),
        (str_store_string, s4, "@{s4} {s1} each)^"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var4", 0),
      (str_store_string, s4, "@Actually, I don't have any troops that I trust you with at the moment. Help us out more, and maybe we'll let you use them."),
    (else_try),
      (str_store_string, s4, "@{s4}^Interested?"),
    (try_end),
  ]),

  ("destroy_distant_parties_of_template",
  [
    (store_script_param, ":var0", 1),
    (store_num_parties_of_template, ":var1", ":var0"),
    (try_for_range, reg2, 0, ":var1"),
      (store_random_party_of_template, reg1, ":var0"),
      (store_distance_to_party_from_party, ":var2", "p_main_party", reg1),
      (ge, ":var2", 10),
      (remove_party, reg1),
      (display_message, "@DEBUG: Removed old party: {reg1}."),
    (try_end),
  ]),

  ("spawn_ambush_party_template",
  [
    (store_script_param, ":var0", 1),
    (set_spawn_radius, 0),
    (spawn_around_party, "p_main_party", ":var0"),
    (assign, ":var1", reg0),
    (party_set_slot, ":var1", 0, 21),
    (party_set_slot, ":var1", 4, 17),
    (party_set_ai_behavior, ":var1", ai_bhvr_attack_party),
    (party_set_ai_object, ":var1", "p_main_party"),
    (assign, reg1, "$player_honor"),
    (val_abs, reg1),
    (val_div, reg1, 25),
    (try_begin),
      (gt, reg1, 4),
      (assign, reg1, 4),
    (try_end),
    (assign, ":var2", reg1),
    (try_begin),
      (eq, ":var0", "pt_bounty_hunters_dishonorable"),
      (try_for_range, reg2, 0, ":var2"),
        (party_add_members, ":var1", "trp_bounty_hunter", 1),
        (store_random_in_range, ":var3", 1, 3),
        (party_add_members, ":var1", "trp_thief", ":var3"),
        (store_random_in_range, ":var3", 1, 3),
        (party_add_members, ":var1", "trp_marauder", ":var3"),
        (store_random_in_range, ":var3", 1, 3),
        (party_add_members, ":var1", "trp_looter_2", ":var3"),
      (try_end),
    (else_try),
      (eq, ":var0", "pt_bounty_hunters_honorable"),
      (try_for_range, reg2, 0, ":var2"),
        (party_add_members, ":var1", "trp_bounty_hunter", 1),
        (store_random_in_range, ":var3", 1, 3),
        (party_add_members, ":var1", "trp_manhunter", ":var3"),
        (store_random_in_range, ":var3", 1, 3),
        (party_add_members, ":var1", "trp_trapper_2", ":var3"),
        (store_random_in_range, ":var3", 1, 3),
        (party_add_members, ":var1", "trp_miner_2", ":var3"),
      (try_end),
    (else_try),
      (display_message, "@DEBUG: Populate Ambush Party Template: PARTY TEMPLATE NOT FOUND."),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("separate_regulars_from_party",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (party_clear, ":var1"),
    (party_get_num_companion_stacks, ":var2", ":var0"),
    (try_for_range_backwards, ":var3", 0, ":var2"),
      (party_stack_get_troop_id, ":var4", ":var0", ":var3"),
      (neg|troop_is_hero, ":var4"),
      (party_stack_get_size, ":var5", ":var0", ":var3"),
      (party_remove_members, ":var0", ":var4", ":var5"),
      (party_add_members, ":var1", ":var4", ":var5"),
    (try_end),
  ]),

  ("cf_fail_duel_if_rules_infringed",
  [
    (store_script_param, ":var0", 1),
    (get_player_agent_no, ":var1"),
    (call_script, "script_get_correct_fugitive_troop_to_reg0"),
    (assign, ":var2", reg0),
    (assign, ":var3", -1),
    (try_for_agents, ":var4"),
      (agent_get_troop_id, ":var5", ":var4"),
      (eq, ":var5", ":var2"),
      (assign, ":var3", ":var4"),
    (try_end),
    (agent_get_wielded_item, ":var6", ":var3", 0),
    (lt, ":var6", 0),
    (agent_get_wielded_item, ":var6", ":var1", 0),
    (gt, ":var6", -1),
    (display_message, "@You infringed the duel rules!"),
    (agent_set_team, ":var3", 1),
    (call_script, "script_change_player_honor", -1),
    (set_party_battle_mode),
    (quest_set_slot, ":var0", 11, 1),
  ]),

  ("spawn_alerted_agents_from_faction_slot",
  [
    (store_script_param, ":var0", 1),
    (store_script_param, ":var1", 2),
    (store_script_param, ":var2", 3),
    (store_faction_of_party, ":var3", "$current_town"),
    (faction_get_slot, ":var4", ":var3", ":var0"),
    (set_spawn_position, ":var1"),
    (try_for_range, ":var5", 0, ":var2"),
      (lt, "$g_spawned_guards", 10),
      (spawn_agent, ":var4"),
      (agent_set_slot, reg0, 22, 1),
      (val_add, "$g_spawned_guards", 1),
    (try_end),
    (display_message, "@End spawn alerted agents from faction slot"),
  ]),

  ("get_random_prop_instance",
  [
    (store_script_param, ":var0", 1),
    (scene_prop_get_num_instances, ":var1", ":var0"),
    (store_random_in_range, ":var2", 0, ":var1"),
    (scene_prop_get_instance, ":var3", ":var0", ":var2"),
    (prop_instance_get_position, pos0, ":var3"),
    (display_message, "@end get random prop instance"),
  ]),

  ("troop_get_gender_to_reg18",
  [
    (store_script_param, ":var0", 1),
    (troop_get_type, ":var1", ":var0"),
    (try_begin),
      (this_or_next|eq, ":var1", 0),
      (this_or_next|eq, ":var1", 1),
      (this_or_next|eq, ":var1", 2),
      (eq, ":var1", 3),
      (assign, reg18, 0),
    (else_try),
      (this_or_next|eq, ":var1", 4),
      (this_or_next|eq, ":var1", 5),
      (eq, ":var1", 6),
      (assign, reg18, 1),
    (else_try),
      (display_message, "@Error: Unknown race encountered."),
      (assign, reg18, 1),
    (try_end),
  ]),

  ("faction_update_culture_of_owned_centers",
  [
    (store_script_param, ":var0", 1),
    (faction_get_slot, ":var1", ":var0", 9),
    (try_for_range, ":var2", "p_town_1", "p_salt_mine"),
      (store_faction_of_party, ":var3", ":var2"),
      (eq, ":var0", ":var3"),
      (party_set_slot, ":var2", 19, ":var1"),
    (try_end),
  ]),

  ("check_remaining_troop_conditions",
  [
    (assign, ":var0", 0),
    (assign, ":var1", 0),
    (get_player_agent_no, ":var2"),
    (agent_get_team, ":var3", ":var2"),
    (try_for_agents, ":var4"),
      (agent_is_human, ":var4"),
      (agent_is_alive, ":var4"),
      (agent_get_team, ":var5", ":var4"),
      (try_begin),
        (eq, ":var5", ":var3"),
        (val_add, ":var0", 1),
      (else_try),
        (teams_are_enemies, ":var5", ":var3"),
        (val_add, ":var1", 1),
      (else_try),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var0", 0),
      (assign, reg0, 1),
    (else_try),
      (eq, ":var1", 0),
      (assign, reg0, 2),
    (else_try),
      (assign, reg0, 0),
    (try_end),
  ]),

  ("setup_generic_battle_scene",
  [
    (party_get_current_terrain, ":var0", "p_main_party"),
    (assign, reg0, ":var0"),
    (str_store_string, s0, "@default"),
    (try_begin),
      (try_begin),
        (eq, ":var0", 3),
        (store_random_in_range, ":var1", "scn_generic_battle_plain_01", "scn_generic_battle_plain_forest_01"),
        (str_store_string, s0, "@plain"),
      (else_try),
        (eq, ":var0", 11),
        (store_random_in_range, ":var1", "scn_generic_battle_plain_forest_01", "scn_generic_battle_steppe_01"),
        (str_store_string, s0, "@plain forest (forest)"),
      (else_try),
        (eq, ":var0", 2),
        (store_random_in_range, ":var1", "scn_generic_battle_steppe_01", "scn_generic_battle_steppe_forest_01"),
        (str_store_string, s0, "@steppe"),
      (else_try),
        (this_or_next|eq, ":var0", 10),
        (eq, ":var0", 12),
        (store_random_in_range, ":var1", "scn_generic_battle_steppe_forest_01", "scn_generic_battle_desert_01"),
        (str_store_string, s0, "@steppe forest"),
      (else_try),
        (this_or_next|eq, ":var0", 4),
        (eq, ":var0", 5),
        (store_random_in_range, ":var1", "scn_generic_battle_desert_01", "scn_training_ground_horse_track_1"),
        (str_store_string, s0, "@desert"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (display_message, "@DEBUG: Generic Battle - Terrain Type: {reg0} - {s0}"),
    (try_end),
    (assign, reg0, ":var1"),
  ]),

  ("hunting_count_living_animals",
  [
    (assign, ":var0", 0),
    (try_for_agents, ":var1"),
      (agent_is_alive, ":var1"),
      (agent_get_item_id, ":var2", ":var1"),
      (this_or_next|eq, ":var2", "itm_buffalo"),
      (eq, ":var2", "itm_deer"),
      (val_add, ":var0", 1),
    (try_end),
    (assign, reg0, ":var0"),
  ]),

  # copied from native
    #script_troop_agent_set_banner
  # INPUT: agent_no
  # OUTPUT: none
  ("troop_agent_set_banner",
    [
       (store_script_param, ":tableau_no",1),
       (store_script_param, ":agent_no", 2),
       (store_script_param, ":troop_no", 3),
       (call_script, "script_agent_troop_get_banner_mesh", ":agent_no", ":troop_no"),
       (cur_agent_set_banner_tableau_material, ":tableau_no", reg0),
     ]),

  #script_agent_troop_get_banner_mesh
  # INPUT: agent_no, troop_no
  # OUTPUT: banner_mesh
  ("agent_troop_get_banner_mesh",
    [
       (store_script_param, ":agent_no", 1),
       (store_script_param, ":troop_no", 2),
       (assign, ":banner_troop", -1),
       (assign, ":banner_mesh", "mesh_banners_default_b"),
       (try_begin),
         (lt, ":agent_no", 0),
         (try_begin),
           (ge, ":troop_no", 0),
           (this_or_next|troop_slot_ge, ":troop_no", slot_troop_banner_scene_prop, 1),
           (eq, ":troop_no", "trp_player"),
           (assign, ":banner_troop", ":troop_no"),
         (else_try),
           (is_between, ":troop_no", companions_begin, companions_end),
           (assign, ":banner_troop", "trp_player"),
         (else_try),
           (assign, ":banner_mesh", "mesh_banners_default_a"),
         (try_end),
       (else_try),
         (eq, "$g_is_quick_battle", 1),
         (agent_get_team, ":agent_team", ":agent_no"),
         (try_begin),
           (eq, ":agent_team", 0),
           (assign, ":banner_mesh", "$g_quick_battle_team_0_banner"),
         (else_try),
           (assign, ":banner_mesh", "$g_quick_battle_team_1_banner"),
         (try_end),
       (else_try),
         (game_in_multiplayer_mode),
         (agent_get_group, ":agent_group", ":agent_no"),
         (try_begin),
           (neg|player_is_active, ":agent_group"),
           (agent_get_player_id, ":agent_group", ":agent_no"),
         (try_end),
         (try_begin),
           #if player banners are not allowed, use the default banner mesh
           (eq, "$g_multiplayer_allow_player_banners", 1),
           (player_is_active, ":agent_group"),
           (player_get_banner_id, ":player_banner", ":agent_group"),
           (ge, ":player_banner", 0),
           (store_add, ":banner_mesh", ":player_banner", arms_meshes_begin),
           (assign, ":already_used", 0),
           (try_for_range, ":cur_faction", npc_kingdoms_begin, npc_kingdoms_end), #wrong client data check
             (faction_slot_eq, ":cur_faction", slot_faction_banner, ":banner_mesh"),
             (assign, ":already_used", 1),
           (try_end),
           (try_begin),
             (neg|is_between, ":banner_mesh", arms_meshes_begin, arms_meshes_end_minus_one),
             (assign, ":already_used", 1),
           (try_end),
           (eq, ":already_used", 0), #otherwise use the default banner mesh
         (else_try),
        # #INVASION MODE START
        # (assign, ":personal_banners", 0),
        # (try_begin),
        #   (ge, ":agent_no", 0),
        #   (eq, "$g_multiplayer_game_type", multiplayer_game_type_captain_coop),
        #   (agent_get_team, ":agent_team", ":agent_no"),
        #   (team_get_faction, ":team_faction_no", ":agent_team"),
        #   (this_or_next|eq, ":team_faction_no", "fac_outlaws"),
        #   (eq, ":team_faction_no", "fac_ccoop_all_stars"),
        #   (assign, ":personal_banners", 1),
        # (try_end),
        # (this_or_next|eq, ":personal_banners", 1),
        # #INVASION MODE END
           (agent_get_team, ":agent_team", ":agent_no"),
           (team_get_faction, ":team_faction_no", ":agent_team"),

           (try_begin),
             (agent_is_human, ":agent_no"),
             (try_begin),
               (this_or_next|eq, ":team_faction_no", "fac_outlaws"),
               (eq, ":team_faction_no", "fac_ccoop_all_stars"),
               (agent_get_troop_id, ":troop_no", ":agent_no"),
               (store_troop_faction, ":team_faction_no", ":troop_no"),
             (try_end),
             (faction_get_slot, ":banner_mesh", ":team_faction_no", slot_faction_banner),
           (else_try),
             (agent_get_rider, ":rider_agent_no", ":agent_no"),
             #(agent_get_position, pos1, ":agent_no"),
             #(position_get_x, ":pos_x", pos1),
             #(position_get_y, ":pos_y", pos1),
             #(assign, reg0, ":pos_x"),
             #(assign, reg1, ":pos_y"),
             #(assign, reg2, ":agent_no"),
             #(display_message, "@{!}agent_no:{reg2}, pos_x:{reg0} , posy:{reg1}"),
             (try_begin),
               (ge, ":rider_agent_no", 0),
               (agent_is_active, ":rider_agent_no"),
               (agent_get_team, ":rider_agent_team", ":rider_agent_no"),
               (team_get_faction, ":rider_team_faction_no", ":rider_agent_team"),
               (faction_get_slot, ":banner_mesh", ":rider_team_faction_no", slot_faction_banner),
             (else_try),
               (assign, ":banner_mesh", "mesh_banners_default_c"),
             (try_end),                   
           (try_end),             
         (try_end),
       (else_try),
         (agent_get_troop_id, ":troop_id", ":agent_no"),
         (this_or_next|troop_slot_ge,  ":troop_id", slot_troop_banner_scene_prop, 1),
         (eq, ":troop_no", "trp_player"),
         (assign, ":banner_troop", ":troop_id"),
       (else_try),
         (agent_get_party_id, ":agent_party", ":agent_no"),
         (try_begin),
           (lt, ":agent_party", 0),
           (is_between, ":troop_id", companions_begin, companions_end),
           (main_party_has_troop, ":troop_id"),
           (assign, ":agent_party", "p_main_party"),
         (try_end),
         (ge, ":agent_party", 0),
         (party_get_template_id, ":party_template", ":agent_party"),
         (try_begin),
           (eq, ":party_template", "pt_deserters"),
           (assign, ":banner_mesh", "mesh_banners_default_c"),
         (else_try),
           (is_between, ":agent_party", centers_begin, centers_end),
           (is_between, ":troop_id", companions_begin, companions_end),
           (neq, "$talk_context", tc_tavern_talk),
           #this should be a captured companion in prison
           (assign, ":banner_troop", "trp_player"),
         (else_try),
           (is_between, ":agent_party", centers_begin, centers_end),
           (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
           (ge, ":town_lord", 0),
           (assign, ":banner_troop", ":town_lord"),
         (else_try),
           (this_or_next|party_slot_eq, ":agent_party", slot_party_type, spt_kingdom_hero_party),
           (eq, ":agent_party", "p_main_party"),
           (party_get_num_companion_stacks, ":num_stacks", ":agent_party"),
           (gt, ":num_stacks", 0),
           (party_stack_get_troop_id, ":leader_troop_id", ":agent_party", 0),
           (this_or_next|troop_slot_ge,  ":leader_troop_id", slot_troop_banner_scene_prop, 1),
           (eq, ":leader_troop_id", "trp_player"),
           (assign, ":banner_troop", ":leader_troop_id"),
         (try_end),
       (else_try), #Check if we are in a tavern
         (eq, "$talk_context", tc_tavern_talk),
         (neq, ":troop_no", "trp_player"),
         (assign, ":banner_mesh", "mesh_banners_default_d"),
       (else_try), #can't find party, this can be a town guard
         (neq, ":troop_no", "trp_player"),
         (is_between, "$g_encountered_party", walled_centers_begin, walled_centers_end),
         (party_get_slot, ":town_lord", "$g_encountered_party", slot_town_lord),
         (ge, ":town_lord", 0),
         (assign, ":banner_troop", ":town_lord"),
       (try_end),
       (try_begin),
         (ge, ":banner_troop", 0),
         (try_begin),
           (neg|troop_slot_ge, ":banner_troop", slot_troop_banner_scene_prop, 1),
           (assign, ":banner_mesh", "mesh_banners_default_b"),
         (else_try), 
           (troop_get_slot, ":banner_spr", ":banner_troop", slot_troop_banner_scene_prop),
           (store_add, ":banner_scene_props_end", banner_scene_props_end_minus_one, 1),
           (is_between, ":banner_spr", banner_scene_props_begin, ":banner_scene_props_end"),
           (val_sub, ":banner_spr", banner_scene_props_begin),
           (store_add, ":banner_mesh", ":banner_spr", arms_meshes_begin),
         (try_end),
       (try_end),
       (assign, reg0, ":banner_mesh"),
     ]),

]