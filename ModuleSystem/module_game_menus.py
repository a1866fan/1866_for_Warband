# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_game_menus import *
from header_parties import *
from header_items import *
from header_mission_templates import *
from header_music import *
from header_terrain_types import *

from module_constants import *

####################################################################################################################
#  (menu-id, menu-flags, menu_text, mesh-name, [<operations>], [<options>]),
#
#   Each game menu is a tuple that contains the following fields:
#  
#  1) Game-menu id (string): used for referencing game-menus in other files.
#     The prefix menu_ is automatically added before each game-menu-id
#
#  2) Game-menu flags (int). See header_game_menus.py for a list of available flags.
#     You can also specify menu text color here, with the menu_text_color macro
#  3) Game-menu text (string).
#  4) mesh-name (string). Not currently used. Must be the string "none"
#  5) Operations block (list). A list of operations. See header_operations.py for reference.
#     The operations block is executed when the game menu is activated.
#  6) List of Menu options (List).
#     Each menu-option record is a tuple containing the following fields:
#   6.1) Menu-option-id (string) used for referencing game-menus in other files.
#        The prefix mno_ is automatically added before each menu-option.
#   6.2) Conditions block (list). This must be a valid operation block. See header_operations.py for reference. 
#        The conditions are executed for each menu option to decide whether the option will be shown to the player or not.
#   6.3) Menu-option text (string).
#   6.4) Consequences block (list). This must be a valid operation block. See header_operations.py for reference. 
#        The consequences are executed for the menu option that has been selected by the player.
#
#
# Note: The first Menu is the initial character creation menu.
####################################################################################################################

game_menus = [
  ("start_game_1", menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "Welcome to 1866, pardner. Before you can start playing the game you must create a character.^^Please select your character's gender.",
    "none",
    [],
    [
      ("start_male",
      [],
      "Male",
      [
        (assign, "$g_character_sex", 0),
        (jump_to_menu, "mnu_start_character_0"),
      ]
      ),

      ("start_female",
      [],
      "Female",
      [
        (assign, "$g_character_sex", 1),
        (jump_to_menu, "mnu_start_character_0"),
      ]
      ),

      ("go_back",
      [],
      "Go_back",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("start_phase_2", mnf_disable_all_keys,
    "You arrive in the Wild West in 1866, a land torn between US and Mexican troops, with Indians and bandits battling each other for supremacy. It's a haven for gunslingers and mercenaries, cutthroats and adventurers, all willing to risk their lives in pursuit of fortune, power, or glory... In this land which holds great dangers and even greater opportunities, you will leave your past behind and start a new life. Now, on a rise above a distant training field, you feel that you hold the key of your destiny in your hands, free to choose as you will, and that whatever course you take, great adventures await you.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_get_player_party_morale_values"),
        (party_set_morale, "p_main_party", reg0),
        (change_screen_return),
      ]
      ),

      ("tutorial_cheat",
      [
        (eq, 0, 1),
      ],
      "CHEAT!",
      [
        (change_screen_return),
        (assign, "$cheat_mode", 1),
        (set_show_messages, 0),
        (add_xp_to_troop, 15000, "trp_player"),
        (troop_add_gold, "trp_player", 10000),
        (troop_raise_skill, "trp_player", skl_leadership, 7),
        (troop_raise_skill, "trp_player", skl_prisoner_management, 5),
        (troop_add_item, "trp_player", "itm_arena_armor_white", imod_plain),
        (troop_add_item, "trp_player", "itm_rollingblock", imod_plain),
        (troop_add_item, "trp_player", "itm_fr_pinfire", imod_plain),
        (troop_add_item, "trp_player", "itm_lemat", imod_plain),
        (troop_add_item, "trp_player", "itm_cartridges_100", imod_plain),
        (troop_add_item, "trp_player", "itm_banjo_rifle", imod_plain),
        (troop_add_item, "trp_player", "itm_umbrella_rifle", imod_plain),
        (troop_add_item, "trp_player", "itm_sheriff_jacket_a", imod_plain),
        (troop_add_item, "trp_player", "itm_hat_winter", imod_plain),
        (troop_add_item, "trp_player", "itm_steel_toed_boots", imod_plain),
        (troop_add_item, "trp_player", "itm_artillery_sword", imod_plain),
        (troop_add_item, "trp_player", "itm_cavalry_sabre_b", imod_plain),
        (troop_add_item, "trp_player", "itm_winchester_shorty", imod_plain),
        (troop_add_item, "trp_player", "itm_spencer_a", imod_plain),
        (troop_add_item, "trp_player", "itm_doublebarrelshotgun", imod_plain),
        (troop_add_item, "trp_player", "itm_sharps_scoped", imod_plain),
        (troop_add_item, "trp_player", "itm_henry_a", imod_plain),
        (troop_add_item, "trp_player", "itm_dynamite_big", imod_plain),
        (troop_add_item, "trp_player", "itm_springfield_61_bayonet", imod_plain),
        (troop_add_item, "trp_player", "itm_cartridges_bolts_100", imod_plain),
        (set_show_messages, 1),
        (try_for_range, ":var0", "scn_town_1_center", "scn_castle_1_exterior"),
          (scene_set_slot, ":var0", 0, 1),
        (try_end),
        (call_script, "script_get_player_party_morale_values"),
        (party_set_morale, "p_main_party", reg0),
      ]
      ),
    ],
  ),

  ("start_game_3", mnf_disable_all_keys,
    "Choose your scenario:",
    "none",
    [
      (troop_set_slot, "trp_banner_background_color_array", 126, 4280361505),
      (troop_set_slot, "trp_banner_background_color_array", 127, 4280361505),
      (troop_set_slot, "trp_banner_background_color_array", 128, 4281219856),
      (troop_set_slot, "trp_banner_background_color_array", 129, 4282539387),
      (troop_set_slot, "trp_banner_background_color_array", 130, 4281943560),
    ],
    [
      ("custom_battle",
      [],
      "Build_Your_Own_Battle",
      [
        (jump_to_menu, "mnu_custom_battle_custom"),
      ]
      ),

      ("custom_battle_scenario_1",
      [],
      "Stopping_the_Stagecoach_Robbery",
      [
        (assign, "$g_custom_battle_scenario", 0),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_3",
      [],
      "Robbing_the_Gold_Train",
      [
        (assign, "$g_custom_battle_scenario", 1),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_4",
      [],
      "Circle_the_Wagons_(Defense)",
      [
        (assign, "$g_custom_battle_scenario", 2),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_5",
      [],
      "Circle_the_Wagons_(Assault)",
      [
        (assign, "$g_custom_battle_scenario", 4),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_6",
      [],
      "The_Man_with_No_Name",
      [
        (assign, "$g_custom_battle_scenario", 3),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_7",
      [],
      "Remember_The_Alamo",
      [
        (assign, "$g_custom_battle_scenario", 5),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_8",
      [],
      "Gettysburg",
      [
        (jump_to_menu, "mnu_custom_battle_gettysburg"),
      ]
      ),

      ("custom_battle_scenario_9",
      [],
      "Homestead_Defense",
      [
        (assign, "$g_custom_battle_scenario", 6),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_10",
      [],
      "Zombie_Fun",
      [
        (assign, "$g_custom_battle_scenario", 7),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_11",
      [
        (eq, 0, 1),
      ],
      "The_Great_Escape",
      [
        (assign, "$g_custom_battle_scenario", 8),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("custom_battle_scenario_13",
      [
        (eq, 0, 1),
      ],
      "Chain_Gang_Escape",
      [
        (assign, "$g_custom_battle_scenario", 9),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("choose_scene",
      [],
      "Scene_Chooser",
      [
        (jump_to_menu, "mnu_choose_scenes_0"),
      ]
      ),

      ("go_back",
      [],
      "Go_back",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("tutorial", mnf_disable_all_keys,
    "You approach a field where the locals are training with weapons. You can practice here to improve your combat skills.",
    "none",
    [
      (set_passage_menu, "mnu_tutorial"),
      (try_begin),
        (eq, "$tutorial_1_finished", 1),
        (str_store_string, s1, "str_finished"),
      (else_try),
        (str_store_string, s1, "str_empty_string"),
      (try_end),
      (try_begin),
        (eq, "$tutorial_2_finished", 1),
        (str_store_string, s2, "str_finished"),
      (else_try),
        (str_store_string, s2, "str_empty_string"),
      (try_end),
      (try_begin),
        (eq, "$tutorial_3_finished", 1),
        (str_store_string, s3, "str_finished"),
      (else_try),
        (str_store_string, s3, "str_empty_string"),
      (try_end),
      (try_begin),
        (eq, "$tutorial_4_finished", 1),
        (str_store_string, s4, "str_finished"),
      (else_try),
        (str_store_string, s4, "str_empty_string"),
      (try_end),
      (try_begin),
        (eq, "$tutorial_5_finished", 1),
        (str_store_string, s5, "str_finished"),
      (else_try),
        (str_store_string, s5, "str_empty_string"),
      (try_end),
    ],
    [
      ("tutorial_1",
      [],
      "Tutorial_#1:_Basic_movement_and_weapon_selection._{s1}",
      [
        (modify_visitors_at_site, "scn_tutorial_1"),
        (reset_visitors, 0),
        (set_jump_mission, "mt_tutorial_1"),
        (jump_to_scene, "scn_tutorial_1"),
        (change_screen_mission),
      ]
      ),

      ("tutorial_2",
      [],
      "Tutorial_#2:_Fighting_with_a_shield._{s2}",
      [
        (modify_visitors_at_site, "scn_tutorial_2"),
        (reset_visitors, 0),
        (set_visitor, 1, "trp_tutorial_maceman"),
        (set_visitor, 2, "trp_tutorial_archer"),
        (set_jump_mission, "mt_tutorial_2"),
        (jump_to_scene, "scn_tutorial_2"),
        (change_screen_mission),
      ]
      ),

      ("tutorial_3",
      [],
      "Tutorial_#3:_Fighting_without_a_shield._{s3}",
      [
        (modify_visitors_at_site, "scn_tutorial_3"),
        (reset_visitors, 0),
        (set_visitor, 1, "trp_tutorial_maceman"),
        (set_visitor, 2, "trp_tutorial_swordsman"),
        (set_jump_mission, "mt_tutorial_3"),
        (jump_to_scene, "scn_tutorial_3"),
        (change_screen_mission),
      ]
      ),

      ("tutorial_3b",
      [
        (eq, 0, 1),
      ],
      "Tutorial_3_b",
      [
        (try_begin),
          (ge, "$tutorial_3_state", 12),
          (modify_visitors_at_site, "scn_tutorial_3"),
          (reset_visitors, 0),
          (set_visitor, 1, "trp_tutorial_maceman"),
          (set_visitor, 2, "trp_tutorial_swordsman"),
          (set_jump_mission, "mt_tutorial_3_2"),
          (jump_to_scene, "scn_tutorial_3"),
          (change_screen_mission),
        (else_try),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (try_end),
      ]
,
      "next_level"
      ),

      ("tutorial_4",
      [],
      "Tutorial_#4:_Riding_a_horse._{s4}",
      [
        (modify_visitors_at_site, "scn_tutorial_4"),
        (reset_visitors, 0),
        (set_jump_mission, "mt_tutorial_4"),
        (jump_to_scene, "scn_tutorial_4"),
        (change_screen_mission),
      ]
      ),

      ("tutorial_5",
      [
        (eq, 1, 0),
      ],
      "Tutorial_#5:_Commanding_a_band_of_soldiers._{s5}",
      [
        (modify_visitors_at_site, "scn_tutorial_5"),
        (reset_visitors, 0),
        (set_visitor, 0, "trp_player"),
        (set_jump_mission, "mt_tutorial_5"),
        (jump_to_scene, "scn_tutorial_5"),
        (change_screen_mission),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("reports", 0,
    "Character Renown: {reg5}^Honor Rating: {reg6}^Party Morale: {reg8}^Party Size Limit: {reg7}^",
    "none",
    [
      (call_script, "script_game_get_party_companion_limit"),
      (assign, ":var0", reg0),
      (troop_get_slot, ":var1", "trp_player", 7),
      (assign, reg5, ":var1"),
      (assign, reg6, "$player_honor"),
      (assign, reg7, ":var0"),
      (party_get_morale, reg8, "p_main_party"),
    ],
    [
      ("cheat_faction_orders",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat:_Faction_orders.",
      [
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("view_character_report",
      [],
      "View_character_report.",
      [
        (jump_to_menu, "mnu_character_report"),
      ]
      ),

      ("view_party_size_report",
      [],
      "View_party_size_report.",
      [
        (jump_to_menu, "mnu_party_size_report"),
      ]
      ),

      ("view_morale_report",
      [],
      "View_party_morale_report.",
      [
        (jump_to_menu, "mnu_morale_report"),
      ]
      ),

      ("view_character_report_2",
      [
        (eq, "$cheat_mode", 1),
      ],
      "NPC_status_check.",
      [
        (try_for_range, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
          (main_party_has_troop, ":var0"),
          (str_store_troop_name, s4, ":var0"),
          (troop_get_slot, reg3, ":var0", 61),
          (troop_get_slot, reg4, ":var0", 65),
          (troop_get_slot, reg5, ":var0", 72),
          (troop_get_slot, reg6, ":var0", 74),
          (troop_get_slot, reg7, ":var0", 76),
          (display_message, "@{s4}: M{reg3}, 2M{reg4}, PC{reg5}, 2PC{reg6}, PM{reg7}"),
        (try_end),
      ]
      ),

      ("view_faction_relations_report",
      [],
      "View_faction_relations_report.",
      [
        (jump_to_menu, "mnu_faction_relations_report"),
      ]
      ),

      ("view_besiged_report",
      [
        (gt, "$players_kingdom", 0),
      ],
      "View_besieged_centers_report.",
      [
        (jump_to_menu, "mnu_besieged_report"),
      ]
      ),

      ("view_wages_report",
      [],
      "View_wages_report.",
      [
        (jump_to_menu, "mnu_wages_report"),
      ]
      ),

      ("resume_travelling",
      [],
      "Resume_travelling.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("custom_battle_2", mnf_disable_all_keys,
    "{s16}",
    "none",
    [
      (assign, "$g_battle_result", 0),
      (set_show_messages, 0),
      (reset_visitors),
      (try_begin),
        (eq, "$g_custom_battle_scenario", 0),
        (assign, "$g_player_troop", "trp_deputy_sheriff"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_1"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_local_militia", 5),
        (set_visitors, 2, "trp_pinkerton_agent", 4),
        (set_visitors, 3, "trp_ranger", 2),
        (set_visitors, 4, "trp_posseman", 4),
        (set_visitors, 5, "trp_county_militia", 2),
        (set_visitors, 6, "trp_county_militia", 4),
        (set_visitors, 16, "trp_stagecoach_robber", 6),
        (set_visitors, 17, "trp_thug", 10),
        (set_visitors, 18, "trp_gunslinger", 6),
        (set_visitors, 19, "trp_gambler", 3),
        (set_visitors, 20, "trp_bank_robber", 2),
        (str_store_string, s16, "str_custom_battle_1"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 1),
        (assign, "$g_player_troop", "trp_qb_hero_robert"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_3"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_stagecoach_robber", 4),
        (set_visitors, 2, "trp_thug", 3),
        (set_visitors, 3, "trp_thug", 2),
        (set_visitors, 4, "trp_gunslinger", 3),
        (set_visitors, 5, "trp_gunslinger", 2),
        (set_visitors, 6, "trp_bank_robber", 4),
        (set_visitors, 16, "trp_soldado", 4),
        (set_visitors, 17, "trp_sargento", 3),
        (set_visitors, 17, "trp_supremos_poderes_riflelero", 2),
        (set_visitors, 18, "trp_sargento", 3),
        (set_visitors, 19, "trp_supremos_poderes_riflelero", 3),
        (set_visitors, 20, "trp_sargento", 3),
        (set_visitors, 21, "trp_husar", 7),
        (set_visitors, 24, "trp_sargento", 1),
        (str_store_string, s16, "str_custom_battle_2"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 2),
        (assign, "$g_player_troop", "trp_qb_hero_barrett"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_4"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, 1, "trp_comanche_horse_archer", 5),
        (set_visitors, 2, "trp_comanche_horse_gunner", 4),
        (set_visitors, 3, "trp_comanche_warrior_legend", 2),
        (set_visitors, 4, "trp_comanche_raider", 5),
        (set_visitors, 5, "trp_comanche_wind_rider", 3),
        (set_visitors, 6, "trp_comanche_raider", 5),
        (set_visitors, 7, "trp_comanche_fire_rider", 2),
        (set_visitors, 8, "trp_comanche_horse_archer", 3),
        (set_visitor, 16, "$g_player_troop"),
        (set_visitors, 17, "trp_regular", 4),
        (set_visitors, 18, "trp_pinkerton_agent", 1),
        (set_visitors, 19, "trp_state_militia", 3),
        (set_visitors, 20, "trp_local_militia", 4),
        (str_store_string, s16, "str_custom_battle_3"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 3),
        (assign, "$g_player_troop", "trp_qb_hero_no_name"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_5"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 16, "trp_thief", 3),
        (set_visitors, 17, "trp_burglar", 2),
        (set_visitors, 18, "trp_thug", 3),
        (set_visitors, 19, "trp_gunslinger", 2),
        (set_visitors, 20, "trp_dynamite_thrower", 2),
        (set_visitors, 21, "trp_county_militia", 2),
        (set_visitors, 22, "trp_state_militia", 3),
        (set_visitors, 23, "trp_pinkerton_agent", 2),
        (set_visitors, 24, "trp_marauder", 3),
        (set_visitors, 25, "trp_cut_throat", 2),
        (set_visitors, 26, "trp_pistolero", 2),
        (set_visitors, 27, "trp_assassin", 3),
        (set_visitors, 28, "trp_desperado", 2),
        (set_visitors, 29, "trp_ranger", 1),
        (set_visitors, 30, "trp_thug", 2),
        (set_visitors, 31, "trp_gunslinger", 2),
        (str_store_string, s16, "str_custom_battle_4"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 4),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_7"),
        (assign, "$g_player_troop", "trp_qb_hero_buffalo_hump"),
        (set_player_troop, "$g_player_troop"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_comanche_raider", 5),
        (set_visitors, 2, "trp_comanche_horse_gunner", 4),
        (set_visitors, 3, "trp_comanche_war_chief", 2),
        (set_visitors, 4, "trp_comanche_raider", 4),
        (set_visitors, 5, "trp_comanche_warrior_legend", 2),
        (set_visitors, 6, "trp_comanche_horse_archer", 4),
        (set_visitors, 16, "trp_local_militia", 6),
        (set_visitors, 17, "trp_regular", 10),
        (set_visitors, 18, "trp_pinkerton_agent", 6),
        (set_visitors, 19, "trp_ranger", 3),
        (set_visitors, 20, "trp_local_militia", 2),
        (str_store_string, s16, "str_custom_battle_5"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 5),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_alamo"),
        (assign, "$g_player_troop", "trp_qb_hero_william_travis"),
        (set_player_troop, "$g_player_troop"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_alamo_us_militia", 10),
        (set_visitors, 2, "trp_alamo_us_militia", 0),
        (set_visitors, 3, "trp_alamo_us_militia", 20),
        (set_visitors, 4, "trp_alamo_us_infantryman", 5),
        (set_visitors, 5, "trp_alamo_us_infantryman", 10),
        (set_visitors, 6, "trp_alamo_us_infantryman", 10),
        (set_visitors, 16, "trp_alamo_cazadore", 20),
        (set_visitors, 17, "trp_alamo_cazadore", 20),
        (set_visitors, 18, "trp_alamo_sargento", 10),
        (set_visitors, 19, "trp_alamo_soldado_presidial", 10),
        (set_visitors, 20, "trp_alamo_dragon", 10),
        (str_store_string, s16, "str_custom_battle_7"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 10),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_gettysburg_1"),
        (assign, "$g_player_troop", "trp_qb_hero_luke_tanglewood"),
        (set_player_troop, "$g_player_troop"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_veteran_volunteer", 4),
        (set_visitors, 2, "trp_volunteer", 4),
        (set_visitors, 3, "trp_veteran_regular", 3),
        (set_visitors, 4, "trp_regular", 3),
        (set_visitors, 5, "trp_infantry_sergeant", 2),
        (set_visitors, 6, "trp_volunteer", 4),
        (set_visitors, 16, "trp_qb_csa_volunteer", 12),
        (set_visitors, 17, "trp_qb_csa_sergeant", 6),
        (set_visitors, 18, "trp_qb_csa_regular", 6),
        (set_visitors, 19, "trp_qb_csa_veteran_volunteer", 6),
        (set_visitors, 20, "trp_qb_csa_volunteer", 12),
        (set_visitors, 21, "trp_qb_csa_scout", 5),
        (set_visitors, 22, "trp_qb_csa_volunteer", 10),
        (str_store_string, s16, "str_custom_battle_6"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 6),
        (assign, "$g_player_troop", "trp_qb_hero_farmer"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_8"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_qb_hero_farmer_wife", 1),
        (set_visitors, 16, "trp_stagecoach_robber", 4),
        (set_visitors, 17, "trp_thug", 3),
        (set_visitors, 18, "trp_gambler", 1),
        (set_visitors, 19, "trp_gunslinger", 2),
        (set_visitors, 20, "trp_bank_robber", 2),
        (str_store_string, s16, "str_custom_battle_8"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 7),
        (assign, "$g_player_troop", "trp_qb_hero_hobo"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_9"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_qbz_regular", 4),
        (set_visitors, 22, "trp_qb_zombie", 10),
        (str_store_string, s16, "str_custom_battle_9"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 8),
        (assign, "$g_player_troop", "trp_qb_hero_prisoner"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_quick_battle_10"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_visitors, 1, "trp_qbz_regular", 4),
        (set_visitors, 22, "trp_qb_zombie", 10),
        (str_store_string, s16, "str_custom_battle_9"),
      (else_try),
        (eq, "$g_custom_battle_scenario", 9),
        (assign, "$g_player_troop", "trp_qb_hero_prisoner"),
        (set_player_troop, "$g_player_troop"),
        (assign, "$g_custom_battle_scene", "scn_chain_gang_escape"),
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (str_store_string, s16, "str_custom_battle_11"),
      (try_end),
      (set_show_messages, 1),
    ],
    [
      ("custom_battle_go",
      [],
      "Start.",
      [
        (try_begin),
          (eq, "$g_custom_battle_scenario", 7),
          (set_jump_mission, "mt_zombie_custom_battle"),
        (else_try),
          (set_jump_mission, "mt_custom_battle"),
        (try_end),
        (jump_to_menu, "mnu_custom_battle_end"),
        (jump_to_scene, "$g_custom_battle_scene"),
        (assign, "$spawn_bottle_troops", 1),
        (change_screen_mission),
      ]
      ),

      ("leave_custom_battle_2",
      [],
      "Cancel.",
      [
        (jump_to_menu, "mnu_start_game_3"),
      ]
      ),
    ],
  ),

  ("custom_battle_end", mnf_disable_all_keys,
    "The battle is over. {s1} Your side killed {reg5} enemies and lost {reg6} men over the battle. You personally killed {reg7} men in the fighting.",
    "none",
    [
      (music_set_situation, 0),
      (assign, reg5, "$g_custom_battle_team2_death_count"),
      (assign, reg6, "$g_custom_battle_team1_death_count"),
      (get_player_agent_kill_count, ":var0"),
      (get_player_agent_kill_count, ":var1", 1),
      (store_add, reg7, ":var0", ":var1"),
      (try_begin),
        (eq, "$g_battle_result", 1),
        (str_store_string, s1, "str_battle_won"),
      (else_try),
        (str_store_string, s1, "str_battle_lost"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue.",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("start_character_0", menu_text_color(0xFF000000)|mnf_disable_all_keys,
    "{s1}^^Please select your character's nationality.",
    "none",
    [
      (try_begin),
        (eq, "$g_character_sex", 0),
        (str_store_string, s1, "@The west had a terrible power over most men, turning honest fortune seekers into desperate outlaws, and regular folks into larger than life heroes."),
      (else_try),
        (eq, "$g_character_sex", 1),
        (str_store_string, s1, "@The west was too wild for most women, but the ones who lived there were stubborn as a mule and tough as nails."),
      (try_end),
    ],
    [
      ("start_american",
      [],
      "American",
      [
        (try_begin),
          (eq, "$g_character_sex", 0),
          (troop_set_type, "trp_player", 0),
          (assign, "$character_race_gender", 0),
        (else_try),
          (eq, "$g_character_sex", 1),
          (troop_set_type, "trp_player", 4),
          (assign, "$character_race_gender", 4),
        (try_end),
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),

      ("start_mexican",
      [],
      "Mexican",
      [
        (try_begin),
          (eq, "$g_character_sex", 0),
          (troop_set_type, "trp_player", 2),
          (assign, "$character_race_gender", 2),
        (else_try),
          (eq, "$g_character_sex", 1),
          (troop_set_type, "trp_player", 5),
          (assign, "$character_race_gender", 5),
        (try_end),
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),

      ("start_indian",
      [],
      "Indian",
      [
        (try_begin),
          (eq, "$g_character_sex", 0),
          (troop_set_type, "trp_player", 3),
          (assign, "$character_race_gender", 3),
        (else_try),
          (eq, "$g_character_sex", 1),
          (troop_set_type, "trp_player", 6),
          (assign, "$character_race_gender", 6),
        (try_end),
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),

      ("go_back",
      [],
      "Go_back",
      [
        (jump_to_menu, "mnu_start_game_1"),
      ]
      ),
    ],
  ),

  ("start_character_1", mnf_disable_all_keys,
    "{s1}",
    "none",
    [
      (try_begin),
        (this_or_next|eq, "$character_race_gender", 0),
        (eq, "$character_race_gender", 4),
        (str_store_string, s1, "@Years before you were born, your family moved west seeking fortune. Their journey westward in one of a thousand wagon trains was long and strenuous.^^Your father was..."),
      (else_try),
        (this_or_next|eq, "$character_race_gender", 2),
        (eq, "$character_race_gender", 5),
        (str_store_string, s1, "@Years before you were born, your Spanish ancestors moved to Mexico seeking fortune. Their journey to the new world was difficult, crowded into ships with thousands of other immigrants.^^Your father was..."),
      (else_try),
        (this_or_next|eq, "$character_race_gender", 3),
        (eq, "$character_race_gender", 6),
        (str_store_string, s1, "@Years before you were born, the first settlers moved west seeking fortune. Some tribes started trading with them while others fought them.^^At that time your father was..."),
      (try_end),
      (str_clear, s10),
      (str_clear, s11),
      (str_clear, s12),
      (str_clear, s13),
      (str_clear, s14),
      (str_clear, s15),
    ],
    [
      ("start_noble",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (eq, "$character_race_gender", 4),
      ],
      "An_army_colonel.",
      [
        (assign, "$background_type", 1),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_guard_1",
      [
        (this_or_next|eq, "$character_race_gender", 2),
        (eq, "$character_race_gender", 5),
      ],
      "A_Mexican_soldier.",
      [
        (assign, "$background_type", 2),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_forester",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (eq, "$character_race_gender", 4),
      ],
      "A_famous_lawman.",
      [
        (assign, "$background_type", 4),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_merchant",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (this_or_next|eq, "$character_race_gender", 4),
        (this_or_next|eq, "$character_race_gender", 2),
        (eq, "$character_race_gender", 5),
      ],
      "An_honest_farmer.",
      [
        (assign, "$background_type", 3),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_nomad_1",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (this_or_next|eq, "$character_race_gender", 4),
        (this_or_next|eq, "$character_race_gender", 2),
        (eq, "$character_race_gender", 5),
      ],
      "A_mountain_man.",
      [
        (assign, "$background_type", 10),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_nomad_2",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (this_or_next|eq, "$character_race_gender", 4),
        (this_or_next|eq, "$character_race_gender", 2),
        (eq, "$character_race_gender", 5),
      ],
      "A_notorious_bandit.",
      [
        (assign, "$background_type", 6),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_gambler",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (eq, "$character_race_gender", 4),
      ],
      "A_crafty_gambler.",
      [
        (assign, "$background_type", 5),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_noble_2",
      [
        (this_or_next|eq, "$character_race_gender", 3),
        (eq, "$character_race_gender", 6),
      ],
      "A_cunning_chieftain.",
      [
        (assign, "$background_type", 7),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_guard_2",
      [
        (this_or_next|eq, "$character_race_gender", 3),
        (eq, "$character_race_gender", 6),
      ],
      "A_brave_warrior.",
      [
        (assign, "$background_type", 8),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("start_guard_3",
      [
        (this_or_next|eq, "$character_race_gender", 3),
        (eq, "$character_race_gender", 6),
      ],
      "A_shrewd_merchant.",
      [
        (assign, "$background_type", 9),
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),

      ("go_back",
      [],
      "Go_back",
      [
        (jump_to_menu, "mnu_start_character_0"),
      ]
      ),
    ],
  ),

  ("start_character_2", 0,
    "You began a special relationship with the west at an early age. Your imagination danced with tales of daring exploits in a wild land.^^You spent your early life...",
    "none",
    [],
    [
      ("page",
      [],
      "In_a_gold_rush_boomtown.",
      [
        (assign, "$background_answer_2", 1),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("apprentice",
      [],
      "In_a_rural_farming_village.",
      [
        (assign, "$background_answer_2", 2),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("stockboy",
      [],
      "Wandering_from_place_to_place.",
      [
        (assign, "$background_answer_2", 3),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("urchin",
      [],
      "Far_from_civilization.",
      [
        (assign, "$background_answer_2", 4),
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),

      ("go_back",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_1"),
      ]
      ),
    ],
  ),

  ("start_character_3", mnf_disable_all_keys,
    "Back in the East, deeply rooted differences divided the United States and made brother strike against brother.  The sound of cannons firing at Fort Sumter reached as far as the Frontier, and the American Civil War between North and South became a harsh reality.^^  With the United States distracted, France saw an opportunity to reclaim debts owed to her by Mexico.  The French invaded and placed a puppet emperor on the Mexican Throne.  Mexican Republicans resisted the occupation, and the Franco-Mexican war reached a fever pitch.  It wasn't long before everyone you knew took up arms for what they believed in.^^  Your life was about to change. You decided to...",
    "none",
    [
      (assign, reg3, "$character_race_gender"),
    ],
    [
      ("squire_1",
      [
        (eq, "$character_race_gender", 0),
      ],
      "Join_the_American_Civil_War_as_a_Union_soldier.",
      [
        (assign, "$background_answer_3", 3),
        (str_store_string, s12, "@You were always a patriot, and you decided you would rather die than see your country torn apart by Southern rebels.  You offered your services to the Union in the American Civil War, and after only a few battles you made a name for yourself as a soldier whose opinion was valued by many commanders.  As you watched the supply lines move and the army engineers and surgeons do their part, you realized that winning a war takes more than courageous fighting."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("squire_2",
      [
        (eq, "$character_race_gender", 3),
      ],
      "Join_the_American_Civil_War_as_a_Union_soldier_in_an_Indian_regiment.",
      [
        (assign, "$background_answer_3", 6),
        (str_store_string, s12, "@The way of life of your ancestors was changing forever, and you saw opportunity balancing on the edge of a bayonette.  For steady rations and a musket of your own, you offered your skills and knowledge of the land to the Union forces in the American Civil War.  Despite your repeated display of exceptional bravery, you were never promoted within the army.  As the war came to an end, you were discharged, and opportunity had somehow slipped through your fingers."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("squire_3",
      [
        (eq, "$character_race_gender", 0),
      ],
      "Join_the_American_Civil_War_as_a_Confederate_soldier.",
      [
        (assign, "$background_answer_3", 4),
        (str_store_string, s12, "@You never trusted the Federal government, and you welcomed the opportunity to fight for liberty just as your forefathers had done.  You joined the Confederate forces in the American Civil War, and soon became known for your bravery, your keen eye, and the unforgiving swing of your sabre.  Like the famous minutemen of the revolution, you learned that deception and stealth were powerful weapons, and that hit-and-run guerrilla tactics were often the best way to fight an enemy."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("squire_4",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (eq, "$character_race_gender", 2),
      ],
      "Join_the_Franco-Mexican_War_as_a_mercenary_for_France.",
      [
        (assign, "$background_answer_3", 8),
        (str_store_string, s12, "@You knew you had found a winning horse in France when they placed Maximillian I on the the Mexican throne.  Lured in by a generous wage and the possibility for spoils of war, you enlisted as a mercenary with the French and the puppet Mexican Empire.  You witnessed first hand that while the Napoleanic tactics employed by the French still had their place, they were being rendered obsolete by advances in repeating arms.  Unfortunately, when Napoleon III announced the withdrawal of all French forces, you knew you had picked the wrong horse.  You gathered up what you could of your wages and fled north under the cover of night."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("squire_5",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (eq, "$character_race_gender", 2),
      ],
      "Join_the_Franco-Mexican_War_as_a_soldier_for_Mexico.",
      [
        (assign, "$background_answer_3", 9),
        (str_store_string, s12, "@You never had the desire to throw your life away in a war, but when you heard how the French took Mexico City and placed the crown on the head of a Frenchman, you were furious.  You joined the Republican forces of Mexico immediately, and soon became known as a skilled pistolier and furious lancer.  The tide of the war began to shift as Republican forces gained victory after vicory.  When Napoleon III announced the withdrawl of all French forces, you knew that the war against the Mexican puppet empire was all but won.  You knew your part in this war had come to an end, and rather than see the liberation of the capital, you decided to return north."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("squire_6",
      [
        (eq, "$character_race_gender", 3),
      ],
      "Join_the_Apache_on_the_warpath.",
      [
        (assign, "$background_answer_3", 10),
        (str_store_string, s12, "@As the fighting drew many soldiers out of the region, Apache and Navaho leaders saw a golden opportunity and went on the warpath.  Unchecked, The tribes wreaked havoc accross the plains. Eventually, a group of volunteers led by Kit Carson managed to defeat the Navaho and force a surrender.  The Apache tribes, however, retreated into the mountains and continued to make raids.  You became a warrior in battle, and returned to your people as an honored champion."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("squire_7",
      [
        (eq, "$character_race_gender", 3),
      ],
      "Join_the_Comanche_on_the_warpath.",
      [
        (assign, "$background_answer_3", 11),
        (str_store_string, s12, "@As the fighting drew many soldiers out of the region, Comanche and Kiowa leaders intensified their raids against the whites.  Fewer American soldiers meant more horses and fewer casualties.  Your most glorious fighting took place at the Battle of Adobe Walls, where you forced Kit Carson and his volunteers to retreat from an attack on your village.  Throughout the years of your raiding, you became a hardened warrior, and a hero amongst your people."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("squire_8",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (this_or_next|eq, "$character_race_gender", 4),
        (this_or_next|eq, "$character_race_gender", 2),
        (eq, "$character_race_gender", 5),
      ],
      "Profit_from_the_conflict.",
      [
        (assign, "$background_answer_3", 7),
        (str_store_string, s12, "@You never liked the idea of dying for a cause, and you knew that war did present many opportunities to the aspiring entrepenuer.  You supplied the highest bidder with smuggled weapons and supplies, dealt in the black market, and even found time to raid the occasional undefended homesteads now and again.  You learned to play on people's fears, and found that your raids increased business dramitically.  You only had to leave an inconspicuous feather or a tomahawk at the scene, and within hours frightened homesteaders would be lining up to buy the very weapons you had just stolen.  But when the wars wound down, your revenue stream dried up."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("student",
      [
        (this_or_next|eq, "$character_race_gender", 0),
        (this_or_next|eq, "$character_race_gender", 4),
        (this_or_next|eq, "$character_race_gender", 2),
        (eq, "$character_race_gender", 5),
      ],
      "Join_the_local_militia.",
      [
        (assign, "$background_answer_3", 5),
        (str_store_string, s12, "@You viewed the war as a terrible waste of life.  Your responsibilites were still with the ones you loved, so you joined the local militia to prevent atrocities at home rather than afar.  With all able bodied men fighting the war, any semblance of law had gone with them. The filth of society raised to the surface, and eventually, those you had stayed to protect had either died or left.  You remained stalwart in your cause, hopeful for the return of your loved ones upon the end of the war.  When that fateful day came, the shuffling masses that were shadows of the people you once knew returned home, and you realized that despite your best efforts, you had failed to protect anyone at all."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("student_indian",
      [
        (this_or_next|eq, "$character_race_gender", 3),
        (eq, "$character_race_gender", 6),
      ],
      "Watch_over_your_people.",
      [
        (assign, "$background_answer_3", 5),
        (str_store_string, s12, "@In a time of so much war and so many enemies, you chose to spend your days looking over your people.  With all able bodied warriors fighting in the raids, the duties of defending and providing for the tribe fell to the most dependable in the tribe.  Under your careful watch, you managed to keep your people safe in trying times."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("teacher",
      [
        (this_or_next|eq, "$character_race_gender", 4),
        (eq, "$character_race_gender", 5),
      ],
      "Work_as_a_school_teacher.",
      [
        (assign, "$background_answer_3", 13),
        (str_store_string, s12, "@When the war came, it didn't just take away men; it took away fathers and brothers.  You began working as a grade school teacher.  You soon developed your own personal method of teaching, and became quite effective in helping even the most troubled children.  Eventually, attendance diminished as more children were needed on the family farms, and your services were no longer required."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("nurse",
      [
        (this_or_next|eq, "$character_race_gender", 4),
        (eq, "$character_race_gender", 5),
      ],
      "Volunteer_as_a_nurse.",
      [
        (assign, "$background_answer_3", 12),
        (str_store_string, s12, "@You were unable to fight in the war, but you still wanted to do something to help.  You joined a medical unit of volunteer nurses to help treat the wounded.  At times, the primitive tools and medicines available seemed to make fighting seem in the war almost preferable, but you soon learned how to cope.  Eventually the day came when you decided that you had seen enough gangrenous limbs and amputations, and you decided to move on."),
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),

      ("go_back",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_2"),
      ]
      ),
    ],
  ),

  ("start_character_4", mnf_disable_all_keys,
    "{s12} ^^ With the war at an end, you decided to pursue a new life for yourself in the west. However, you have just...",
    "none",
    [],
    [
      ("struck_it_rich",
      [],
      "Made_a_small_fortune_at_the_poker_table._(Very_Easy)",
      [
        (assign, "$background_answer_4", 1),
        (str_store_string, s13, "@You just happened to be on a hot streak at the poker table when the dumbest, richest, and drunkest men in town wandered into the saloon.  A few hours later, you had everything they were carrying short of the clothes they were wearing.  When you started to hear accusations of cheating, you checked out of the saloon, liquidated their assets at the local trader, and made off for the next town with a small fortune."),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("supply_wagon",
      [],
      "Discovered_a_raided_stagecoach._(Easy)",
      [
        (assign, "$background_answer_4", 2),
        (str_store_string, s13, "@In your day to day travels, you came across a stagecoach that had recently been attacked.  You knew it wasn't indians; too many goods had been left behind. This was definitely bandits, and it was clear that they were only after money.  Fortunately, they left behind many other valuables, and like any good opportunist, you decided to help yourself."),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("no_incident",
      [],
      "Completed_your_journey_without_incident._(Medium)",
      [
        (assign, "$background_answer_4", 3),
        (str_store_string, s13, "@You were very surprised that nothing out of the ordinary has happened so far in your recent travels. Normally, your life is just full of exciting events. Maybe things are actually starting to settle down for you. On the other hand, maybe this is just the calm before the storm..."),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("robbed",
      [],
      "Been_robbed_by_bandits._(Hard)",
      [
        (assign, "$background_answer_4", 4),
        (str_store_string, s13, "@While traveling alone, you were ambushed by bandits. You were knocked unconscious in the resulting fight. When you awoke, you discovered that everything you were carrying had been stolen!"),
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),

      ("go_back",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_3"),
      ]
      ),
    ],
  ),

  ("choose_skill", mnf_disable_all_keys,
    "{s13}",
    "none",
    [
      (assign, "$current_string_reg", 10),
    ],
    [
      ("begin_adventuring",
      [],
      "Become_an_adventurer_and_ride_into_the_West.",
      [
        (set_show_messages, 0),
        (try_begin),
          (this_or_next|eq, "$character_race_gender", 0),
          (eq, "$character_race_gender", 1),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_agility, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, 1),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
        (else_try),
          (eq, "$character_race_gender", 4),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, 3),
          (troop_raise_skill, "trp_player", "skl_athletics", 1),
        (else_try),
          (eq, "$character_race_gender", 2),
          (troop_raise_attribute, "trp_player", ca_strength, 2),
          (troop_raise_attribute, "trp_player", ca_agility, 1),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
        (else_try),
          (eq, "$character_race_gender", 5),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_skill, "trp_player", "skl_athletics", 1),
        (else_try),
          (eq, "$character_race_gender", 3),
          (troop_raise_attribute, "trp_player", ca_strength, 2),
          (troop_raise_attribute, "trp_player", ca_agility, 3),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, -2),
        (else_try),
          (eq, "$character_race_gender", 6),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_attribute, "trp_player", ca_agility, 1),
          (troop_raise_skill, "trp_player", "skl_athletics", 1),
        (try_end),
        (troop_raise_skill, "trp_player", "skl_athletics", 1),
        (troop_raise_skill, "trp_player", "skl_riding", 1),
        (troop_raise_skill, "trp_player", "skl_weapon_master", 3),
        (troop_raise_proficiency, "trp_player", wpt_firearm, 45),
        (troop_raise_proficiency, "trp_player", wpt_crossbow, 100),
        (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 20),
        (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 20),
        (troop_raise_proficiency, "trp_player", wpt_throwing, 20),
        (troop_raise_proficiency, "trp_player", wpt_polearm, 15),
        (troop_raise_proficiency, "trp_player", wpt_archery, 15),
        (try_begin),
          (eq, "$background_type", 1),
          (troop_set_slot, "trp_player", 7, 100),
          (call_script, "script_change_player_honor", 3),
          (troop_raise_attribute, "trp_player", ca_charisma, 3),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 30),
          (troop_raise_proficiency, "trp_player", wpt_firearm, 40),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 40),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 1),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (troop_raise_skill, "trp_player", skl_tactics, 1),
          (troop_raise_skill, "trp_player", skl_leadership, 1),
          (troop_raise_skill, "trp_player", skl_horse_archery, 1),
        (else_try),
          (eq, "$background_type", 2),
          (troop_set_slot, "trp_player", 7, 50),
          (call_script, "script_change_player_honor", 1),
          (troop_raise_attribute, "trp_player", ca_strength, 2),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 35),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 30),
          (troop_raise_proficiency, "trp_player", wpt_firearm, 20),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 25),
          (troop_raise_skill, "trp_player", "skl_ironflesh", 1),
          (troop_raise_skill, "trp_player", "skl_power_strike", 2),
          (troop_raise_skill, "trp_player", "skl_weapon_master", 1),
          (troop_raise_skill, "trp_player", "skl_leadership", 1),
          (troop_raise_skill, "trp_player", "skl_trainer", 1),
        (else_try),
          (eq, "$background_type", 3),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 10),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 10),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 20),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 20),
          (troop_raise_proficiency, "trp_player", wpt_firearm, 10),
          (troop_raise_skill, "trp_player", "skl_ironflesh", 3),
          (troop_raise_skill, "trp_player", "skl_athletics", 1),
          (troop_raise_skill, "trp_player", "skl_inventory_management", 2),
          (troop_raise_skill, "trp_player", "skl_trade", 2),
        (else_try),
          (eq, "$background_type", 4),
          (troop_set_slot, "trp_player", 7, 25),
          (call_script, "script_change_player_honor", 1),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_agility, 3),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 10),
          (troop_raise_proficiency, "trp_player", wpt_two_handed_weapon, 10),
          (troop_raise_proficiency, "trp_player", wpt_firearm, 70),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 20),
          (troop_raise_skill, "trp_player", "skl_riding", 1),
          (troop_raise_skill, "trp_player", "skl_prisoner_management", 3),
          (troop_raise_skill, "trp_player", "skl_leadership", 1),
        (else_try),
          (eq, "$background_type", 10),
          (troop_set_slot, "trp_player", 7, 5),
          (troop_raise_attribute, "trp_player", ca_strength, 3),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, -1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 20),
          (troop_raise_proficiency, "trp_player", wpt_archery, 10),
          (troop_raise_proficiency, "trp_player", wpt_firearm, 10),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 30),
          (troop_raise_skill, "trp_player", "skl_ironflesh", 1),
          (troop_raise_skill, "trp_player", "skl_tracking", 3),
          (troop_raise_skill, "trp_player", "skl_pathfinding", 2),
          (troop_raise_skill, "trp_player", "skl_spotting", 2),
        (else_try),
          (eq, "$background_type", 6),
          (troop_set_slot, "trp_player", 7, 5),
          (call_script, "script_change_player_honor", -2),
          (troop_raise_attribute, "trp_player", ca_strength, 1),
          (troop_raise_attribute, "trp_player", ca_agility, 2),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, -1),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 5),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 5),
          (troop_raise_proficiency, "trp_player", wpt_firearm, 30),
          (troop_raise_skill, "trp_player", "skl_athletics", 1),
          (troop_raise_skill, "trp_player", "skl_looting", 3),
          (troop_raise_skill, "trp_player", "skl_pathfinding", 1),
          (troop_raise_skill, "trp_player", "skl_riding", 2),
          (troop_raise_skill, "trp_player", "skl_persuasion", 1),
        (else_try),
          (eq, "$background_type", 5),
          (troop_raise_attribute, "trp_player", ca_strength, -1),
          (troop_raise_attribute, "trp_player", ca_agility, 0),
          (troop_raise_attribute, "trp_player", ca_intelligence, 4),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 5),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, -45),
          (troop_raise_proficiency, "trp_player", wpt_firearm, 5),
          (troop_raise_skill, "trp_player", "skl_athletics", 1),
          (troop_raise_skill, "trp_player", "skl_riding", 1),
          (troop_raise_skill, "trp_player", "skl_trade", 2),
          (troop_raise_skill, "trp_player", "skl_looting", 1),
          (troop_raise_skill, "trp_player", "skl_inventory_management", 2),
          (troop_raise_skill, "trp_player", "skl_persuasion", 3),
        (else_try),
          (eq, "$background_type", 7),
          (troop_set_slot, "trp_player", 7, 100),
          (call_script, "script_change_player_honor", 3),
          (troop_raise_attribute, "trp_player", ca_intelligence, 2),
          (troop_raise_attribute, "trp_player", ca_charisma, 2),
          (troop_raise_proficiency, "trp_player", wpt_one_handed_weapon, 30),
          (troop_raise_proficiency, "trp_player", wpt_archery, 40),
          (troop_raise_proficiency, "trp_player", wpt_throwing, 25),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 15),
          (troop_raise_skill, "trp_player", skl_weapon_master, 1),
          (troop_raise_skill, "trp_player", skl_power_strike, 1),
          (troop_raise_skill, "trp_player", skl_riding, 1),
          (troop_raise_skill, "trp_player", skl_horse_archery, 1),
          (troop_raise_skill, "trp_player", skl_leadership, 1),
          (troop_raise_skill, "trp_player", skl_athletics, 1),
        (else_try),
          (eq, "$background_type", 8),
          (troop_set_slot, "trp_player", 7, 20),
          (troop_raise_attribute, "trp_player", ca_strength, 4),
          (troop_raise_proficiency, "trp_player", wpt_archery, 40),
          (troop_raise_proficiency, "trp_player", wpt_throwing, 30),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 30),
          (troop_raise_proficiency, "trp_player", wpt_crossbow, 10),
          (troop_raise_skill, "trp_player", "skl_power_draw", 2),
          (troop_raise_skill, "trp_player", "skl_riding", 1),
          (troop_raise_skill, "trp_player", "skl_horse_archery", 2),
          (troop_raise_skill, "trp_player", "skl_athletics", 1),
        (else_try),
          (eq, "$background_type", 9),
          (troop_raise_attribute, "trp_player", ca_charisma, 4),
          (troop_raise_proficiency, "trp_player", wpt_polearm, 30),
          (troop_raise_proficiency, "trp_player", wpt_archery, 10),
          (troop_raise_skill, "trp_player", "skl_trade", 3),
          (troop_raise_skill, "trp_player", "skl_persuasion", 1),
          (troop_raise_skill, "trp_player", "skl_power_draw", 1),
          (troop_raise_skill, "trp_player", "skl_inventory_management", 3),
        (try_end),
        (try_begin),
          (eq, "$background_answer_2", 1),
          (troop_raise_skill, "trp_player", "skl_trade", 1),
          (troop_raise_skill, "trp_player", "skl_persuasion", 1),
        (else_try),
          (eq, "$background_answer_2", 2),
          (troop_raise_skill, "trp_player", "skl_engineer", 1),
          (troop_raise_skill, "trp_player", "skl_power_strike", 1),
        (else_try),
          (eq, "$background_answer_2", 3),
          (troop_raise_skill, "trp_player", "skl_spotting", 1),
          (troop_raise_skill, "trp_player", "skl_pathfinding", 1),
        (else_try),
          (eq, "$background_answer_2", 4),
          (call_script, "script_change_troop_renown", "trp_player", 5),
          (troop_raise_skill, "trp_player", "skl_power_throw", 1),
          (troop_raise_skill, "trp_player", "skl_power_draw", 1),
        (try_end),
        (try_begin),
          (eq, "$background_answer_3", 3),
          (troop_raise_skill, "trp_player", "skl_reserved_13", 2),
          (troop_raise_skill, "trp_player", "skl_looting", 2),
          (troop_raise_skill, "trp_player", "skl_leadership", 2),
          (troop_add_item, "trp_player", "itm_leather_gloves", imod_plain),
          (troop_add_item, "trp_player", "itm_cavalry_uniform_a", imod_ragged),
          (troop_add_item, "trp_player", "itm_steel_toed_boots", imod_ragged),
          (troop_add_item, "trp_player", "itm_springfield_42"),
          (troop_add_item, "trp_player", "itm_bowie", imod_chipped),
          (troop_add_item, "trp_player", "itm_cartridges_bolts_0"),
          (troop_add_item, "trp_player", "itm_cattle_meat", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 6),
          (troop_raise_skill, "trp_player", "skl_ironflesh", 2),
          (troop_raise_skill, "trp_player", "skl_athletics", 2),
          (troop_raise_skill, "trp_player", "skl_weapon_master", 1),
          (troop_raise_skill, "trp_player", "skl_looting", 1),
          (troop_add_item, "trp_player", "itm_cavalry_hat_a_apache", imod_plain),
          (troop_add_item, "trp_player", "itm_cavalry_uniform_a", imod_ragged),
          (troop_add_item, "trp_player", "itm_springfield_07"),
          (troop_add_item, "trp_player", "itm_cartridges_bolts_0"),
          (troop_add_item, "trp_player", "itm_steel_toed_boots", imod_ragged),
          (troop_add_item, "trp_player", "itm_knife", imod_chipped),
          (troop_add_item, "trp_player", "itm_cabbages", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 8),
          (troop_raise_skill, "trp_player", "skl_power_strike", 1),
          (troop_raise_skill, "trp_player", "skl_weapon_master", 2),
          (troop_raise_skill, "trp_player", "skl_engineer", 1),
          (troop_raise_skill, "trp_player", "skl_leadership", 1),
          (troop_raise_skill, "trp_player", "skl_trade", 1),
          (troop_add_item, "trp_player", "itm_sombrero_a_1_3", imod_ragged),
          (troop_add_item, "trp_player", "itm_mexican_jacket", imod_ragged),
          (troop_add_item, "trp_player", "itm_fr_pinfire", imod_plain),
          (troop_add_item, "trp_player", "itm_machete", imod_chipped),
          (troop_add_item, "trp_player", "itm_cartridges_0", imod_plain),
          (troop_add_item, "trp_player", "itm_pork", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 9),
          (troop_raise_skill, "trp_player", "skl_ironflesh", 1),
          (troop_raise_skill, "trp_player", "skl_reserved_13", 2),
          (troop_raise_skill, "trp_player", "skl_tactics", 2),
          (troop_raise_skill, "trp_player", "skl_persuasion", 1),
          (troop_raise_skill, "trp_player", "skl_prisoner_management", 1),
          (troop_add_item, "trp_player", "itm_mexican_uniform_a", imod_ragged),
          (troop_add_item, "trp_player", "itm_wrapping_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_mexican_soldier_hat", imod_ragged),
          (troop_add_item, "trp_player", "itm_machete_b", imod_chipped),
          (troop_add_item, "trp_player", "itm_springfield_42carbine"),
          (troop_add_item, "trp_player", "itm_cartridges_bolts_0", imod_plain),
          (troop_add_item, "trp_player", "itm_sausages", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 4),
          (troop_raise_skill, "trp_player", "skl_looting", 1),
          (troop_raise_skill, "trp_player", "skl_tactics", 2),
          (troop_raise_skill, "trp_player", "skl_inventory_management", 2),
          (troop_raise_skill, "trp_player", "skl_leadership", 1),
          (troop_add_item, "trp_player", "itm_cartridges_bolts_0", imod_plain),
          (troop_add_item, "trp_player", "itm_springfield_shotgun"),
          (troop_add_item, "trp_player", "itm_toothpick", imod_rusty),
          (troop_add_item, "trp_player", "itm_steel_toed_boots", imod_ragged),
          (troop_add_item, "trp_player", "itm_csa_uniform_a", imod_ragged),
          (troop_add_item, "trp_player", "itm_chicken", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 10),
          (troop_raise_skill, "trp_player", "skl_power_strike", 1),
          (troop_raise_skill, "trp_player", "skl_power_throw", 1),
          (troop_raise_skill, "trp_player", "skl_tracking", 2),
          (troop_raise_skill, "trp_player", "skl_pathfinding", 1),
          (troop_raise_skill, "trp_player", "skl_spotting", 1),
          (troop_add_item, "trp_player", "itm_native_body_warpaint"),
          (troop_add_item, "trp_player", "itm_enfield_trade_gun_c"),
          (troop_add_item, "trp_player", "itm_cartridges_bolts_0", imod_plain),
          (troop_add_item, "trp_player", "itm_scalpingknife"),
          (troop_add_item, "trp_player", "itm_hide_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_feather_c"),
          (troop_add_item, "trp_player", "itm_dried_meat", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 11),
          (troop_raise_skill, "trp_player", "skl_power_draw", 1),
          (troop_raise_skill, "trp_player", "skl_riding", 1),
          (troop_raise_skill, "trp_player", "skl_horse_archery", 1),
          (troop_raise_skill, "trp_player", "skl_tracking", 1),
          (troop_raise_skill, "trp_player", "skl_pathfinding", 1),
          (troop_raise_skill, "trp_player", "skl_spotting", 1),
          (troop_add_item, "trp_player", "itm_native_body_warpaint"),
          (troop_add_item, "trp_player", "itm_gunclub"),
          (troop_add_item, "trp_player", "itm_short_bow"),
          (troop_add_item, "trp_player", "itm_arrows"),
          (troop_add_item, "trp_player", "itm_hide_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_feather_a"),
          (troop_add_item, "trp_player", "itm_dried_meat", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 5),
          (troop_raise_skill, "trp_player", "skl_power_strike", 1),
          (troop_raise_skill, "trp_player", "skl_riding", 1),
          (troop_raise_skill, "trp_player", "skl_trainer", 1),
          (troop_raise_skill, "trp_player", "skl_engineer", 1),
          (troop_raise_skill, "trp_player", "skl_prisoner_management", 2),
          (troop_add_item, "trp_player", "itm_overcoat_b", imod_ragged),
          (troop_add_item, "trp_player", "itm_knife", imod_rusty),
          (troop_add_item, "trp_player", "itm_coltpolice", imod_plain),
          (troop_add_item, "trp_player", "itm_cartridges_0"),
          (troop_add_item, "trp_player", "itm_leather_boots", imod_ragged),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 13),
          (troop_raise_skill, "trp_player", "skl_trainer", 3),
          (troop_raise_skill, "trp_player", "skl_persuasion", 2),
          (troop_raise_skill, "trp_player", "skl_trade", 1),
          (troop_add_item, "trp_player", "itm_woolen_dress", imod_ragged),
          (troop_add_item, "trp_player", "itm_knife", imod_chipped),
          (troop_add_item, "trp_player", "itm_deringer"),
          (troop_add_item, "trp_player", "itm_cartridges_0"),
          (troop_add_item, "trp_player", "itm_woolen_hose", imod_plain),
          (troop_add_item, "trp_player", "itm_butter", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 12),
          (troop_raise_skill, "trp_player", "skl_wound_treatment", 2),
          (troop_raise_skill, "trp_player", "skl_surgery", 2),
          (troop_raise_skill, "trp_player", "skl_first_aid", 2),
          (troop_add_item, "trp_player", "itm_blue_dress", imod_ragged),
          (troop_add_item, "trp_player", "itm_butchering_knife", imod_chipped),
          (troop_add_item, "trp_player", "itm_deringer"),
          (troop_add_item, "trp_player", "itm_cartridges_0"),
          (troop_add_item, "trp_player", "itm_blue_hose", imod_plain),
          (troop_add_item, "trp_player", "itm_cheese", imod_plain),
        (else_try),
          (eq, "$background_answer_3", 7),
          (troop_raise_skill, "trp_player", "skl_looting", 2),
          (troop_raise_skill, "trp_player", "skl_inventory_management", 2),
          (troop_raise_skill, "trp_player", "skl_trade", 2),
          (troop_add_item, "trp_player", "itm_overcoat_b", imod_ragged),
          (troop_add_item, "trp_player", "itm_toothpick", imod_rusty),
          (troop_add_item, "trp_player", "itm_sharps_pepperbox_rusty"),
          (troop_add_item, "trp_player", "itm_cartridges_0"),
          (troop_add_item, "trp_player", "itm_leather_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_donkey_a", imod_plain),
          (troop_add_gold, "trp_player", 300),
          (troop_add_item, "trp_player", "itm_smoked_fish", imod_plain),
        (try_end),
        (try_begin),
          (eq, "$background_answer_4", 1),
          (troop_add_gold, "trp_player", 10000),
        (else_try),
          (eq, "$background_answer_4", 2),
          (troop_add_item, "trp_player", "itm_wine", imod_plain),
          (troop_add_item, "trp_player", "itm_ale", imod_plain),
          (troop_add_item, "trp_player", "itm_iron", imod_plain),
          (troop_add_item, "trp_player", "itm_linen", imod_plain),
          (troop_add_item, "trp_player", "itm_furs", imod_plain),
          (troop_add_item, "trp_player", "itm_tools", imod_plain),
          (troop_add_item, "trp_player", "itm_cabbages", imod_plain),
          (troop_add_item, "trp_player", "itm_apples", imod_plain),
          (troop_add_item, "trp_player", "itm_bread", imod_plain),
          (troop_add_item, "trp_player", "itm_hide_boots", imod_plain),
          (troop_add_item, "trp_player", "itm_leather_apron", imod_plain),
          (troop_add_item, "trp_player", "itm_nomad_vest", imod_plain),
          (troop_add_item, "trp_player", "itm_sombrero_a_2_4", imod_plain),
          (troop_add_item, "trp_player", "itm_hat_a", imod_plain),
          (troop_add_item, "trp_player", "itm_leadpipe", imod_plain),
          (troop_add_item, "trp_player", "itm_spear_c", imod_plain),
        (else_try),
          (eq, "$background_answer_4", 3),
        (else_try),
          (eq, "$background_answer_4", 4),
          (troop_clear_inventory, "trp_player"),
          (troop_add_item, "trp_player", "itm_union_suit", imod_plain),
        (try_end),
        (assign, "$g_player_voice", 0),
        (try_begin),
          (eq, "$g_character_sex", 0),
          (try_begin),
            (eq, "$character_race_gender", 0),
            (eq, "$background_type", 1),
            (assign, "$g_player_voice", 1),
          (else_try),
            (eq, "$character_race_gender", 0),
            (assign, "$g_player_voice", 2),
          (else_try),
            (eq, "$character_race_gender", 2),
            (assign, "$g_player_voice", 3),
          (else_try),
            (eq, "$character_race_gender", 3),
            (eq, "$background_answer_3", 11),
            (assign, "$g_player_voice", 5),
          (else_try),
            (eq, "$character_race_gender", 3),
            (assign, "$g_player_voice", 4),
          (try_end),
        (try_end),
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_1"),
        (try_begin),
          (this_or_next|eq, "$character_race_gender", 0),
          (this_or_next|eq, "$character_race_gender", 4),
          (this_or_next|eq, "$character_race_gender", 2),
          (eq, "$character_race_gender", 5),
          (eq, "$background_type", 4),
          (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_6"),
        (else_try),
          (this_or_next|eq, "$character_race_gender", 2),
          (eq, "$character_race_gender", 5),
          (eq, "$background_type", 6),
          (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_5"),
        (else_try),
          (this_or_next|eq, "$character_race_gender", 0),
          (eq, "$character_race_gender", 4),
          (eq, "$background_type", 6),
          (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_7"),
        (else_try),
          (this_or_next|eq, "$character_race_gender", 2),
          (eq, "$character_race_gender", 5),
          (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_2"),
        (else_try),
          (this_or_next|eq, "$character_race_gender", 3),
          (eq, "$character_race_gender", 6),
          (eq, "$background_answer_3", 11),
          (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_4"),
        (else_try),
          (this_or_next|eq, "$character_race_gender", 3),
          (eq, "$character_race_gender", 6),
          (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_3"),
        (try_end),
        (try_begin),
          (eq, "$background_type", 1),
          (jump_to_menu, "mnu_auto_return"),
          (start_presentation, "prsnt_banner_selection"),
        (else_try),
          (change_screen_return, 0),
        (try_end),
        (set_show_messages, 1),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_start_character_4"),
      ]
      ),
    ],
  ),

  ("past_life_explanation", mnf_disable_all_keys,
    "{s3}",
    "none",
    [
      (try_begin),
        (gt, "$current_string_reg", 14),
        (assign, "$current_string_reg", 10),
      (try_end),
      (str_store_string_reg, s3, "$current_string_reg"),
      (try_begin),
        (ge, "$current_string_reg", 14),
        (str_store_string, s5, "@Back to the beginning..."),
      (else_try),
        (str_store_string, s5, "@View next segment..."),
      (try_end),
    ],
    [
      ("view_next",
      [],
      "{s5}",
      [
        (val_add, "$current_string_reg", 1),
        (jump_to_menu, "mnu_past_life_explanation"),
      ]
      ),

      ("continue",
      [],
      "Continue...",
      []
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_choose_skill"),
      ]
      ),
    ],
  ),

  ("auto_return", 0,
    "This menu automatically returns to caller.",
    "none",
    [
      (change_screen_return, 0),
    ],
    [
    ],
    [],
  ),

  ("morale_report", 0,
    "{s1}",
    "none",
    [
      (call_script, "script_get_player_party_morale_values"),
      (assign, ":var0", reg0),
      (assign, reg1, "$g_player_party_morale_modifier_party_size"),
      (try_begin),
        (gt, reg1, 0),
        (str_store_string, s2, "@ -"),
      (else_try),
        (str_store_string, s2, "@ "),
      (try_end),
      (assign, reg2, "$g_player_party_morale_modifier_leadership"),
      (try_begin),
        (gt, reg2, 0),
        (str_store_string, s3, "@ +"),
      (else_try),
        (str_store_string, s3, "@ "),
      (try_end),
      (try_begin),
        (gt, "$g_player_party_morale_modifier_no_food", 0),
        (assign, reg7, "$g_player_party_morale_modifier_no_food"),
        (str_store_string, s5, "@^No food:  -{reg7}"),
      (else_try),
        (str_store_string, s5, "@ "),
      (try_end),
      (assign, reg3, "$g_player_party_morale_modifier_food"),
      (try_begin),
        (gt, reg3, 0),
        (str_store_string, s4, "@ +"),
      (else_try),
        (str_store_string, s4, "@ "),
      (try_end),
      (try_begin),
        (gt, "$g_player_party_morale_modifier_debt", 0),
        (assign, reg6, "$g_player_party_morale_modifier_debt"),
        (str_store_string, s6, "@^Wage debt:  -{reg6}"),
      (else_try),
        (str_store_string, s6, "@ "),
      (try_end),
      (party_get_morale, reg5, "p_main_party"),
      (store_sub, reg4, reg5, ":var0"),
      (try_begin),
        (gt, reg4, 0),
        (str_store_string, s7, "@ +"),
      (else_try),
        (str_store_string, s7, "@ "),
      (try_end),
      (str_store_string, s1, "@Current party morale is {reg5}.^Current party morale modifiers are:^^Base morale:  +50^Party size: {s2}{reg1}^Leadership: {s3}{reg2}^Food variety: {s4}{reg3}{s5}{s6}^Recent events: {s7}{reg4}^TOTAL:  {reg5}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("faction_orders", 0,
    "{s9}",
    "none",
    [
      (str_clear, s9),
      (store_current_hours, ":var0"),
      (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var1", 21, 0),
        (neq, ":var1", "fac_player_supporters_faction"),
        (faction_get_slot, ":var2", ":var1", 4),
        (faction_get_slot, ":var3", ":var1", 5),
        (faction_get_slot, ":var4", ":var1", 7),
        (faction_get_slot, ":var5", ":var1", 6),
        (faction_get_slot, ":var6", ":var1", 8),
        (str_store_faction_name, s10, ":var1"),
        (store_sub, reg1, ":var0", ":var5"),
        (assign, reg2, ":var6"),
        (try_begin),
          (eq, ":var2", 0),
          (str_store_string, s11, "@Defending"),
        (else_try),
          (eq, ":var2", 1),
          (str_store_string, s11, "@Gathering army"),
        (else_try),
          (eq, ":var2", 2),
          (str_store_party_name, s11, ":var3"),
          (str_store_string, s11, "@Besieging {s11}"),
        (else_try),
          (eq, ":var2", 3),
          (str_store_party_name, s11, ":var3"),
          (str_store_string, s11, "@Raiding {s11}"),
        (else_try),
          (eq, ":var2", 4),
          (str_store_party_name, s11, ":var3"),
          (str_store_string, s11, "@Attacking enemies around {s11}"),
        (try_end),
        (str_store_faction_name, s10, ":var1"),
        (try_begin),
          (lt, ":var4", 0),
          (str_store_string, s12, "@No one"),
        (else_try),
          (str_store_troop_name, s12, ":var4"),
        (try_end),
        (str_store_string, s9, "@{s9}{s10}^Current state: {s11}^Marshall: {s12}^Since the last offensive: {reg1} hours^Offensive maximum followers: {reg2}^^"),
      (try_end),
      (try_begin),
        (neg|is_between, "$g_cheat_selected_faction", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (call_script, "script_get_next_active_kingdom", "fac_kingdoms_end"),
        (assign, "$g_cheat_selected_faction", reg0),
      (try_end),
      (str_store_faction_name, s10, "$g_cheat_selected_faction"),
      (str_store_string, s9, "@Selected faction is: {s10}^^{s9}"),
    ],
    [
      ("faction_orders_next_faction",
      [],
      "Select_next_faction.",
      [
        (call_script, "script_get_next_active_kingdom", "$g_cheat_selected_faction"),
        (assign, "$g_cheat_selected_faction", reg0),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_defend",
      [],
      "Force_defend.",
      [
        (faction_set_slot, "$g_cheat_selected_faction", 4, 0),
        (faction_set_slot, "$g_cheat_selected_faction", 5, -1),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_gather",
      [],
      "Force_gather_army.",
      [
        (store_current_hours, ":var0"),
        (faction_set_slot, "$g_cheat_selected_faction", 4, 1),
        (faction_set_slot, "$g_cheat_selected_faction", 6, ":var0"),
        (faction_set_slot, "$g_cheat_selected_faction", 8, 1),
        (faction_set_slot, "$g_cheat_selected_faction", 5, -1),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_increase_time",
      [],
      "Increase_last_offensive_time_by_24_hours.",
      [
        (faction_get_slot, ":var0", "$g_cheat_selected_faction", 6),
        (val_sub, ":var0", 24),
        (faction_set_slot, "$g_cheat_selected_faction", 6, ":var0"),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_rethink",
      [],
      "Force_rethink.",
      [
        (call_script, "script_init_ai_calculation"),
        (call_script, "script_decide_faction_ai", "$g_cheat_selected_faction"),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("faction_orders_rethink_all",
      [],
      "Force_rethink_for_all_factions.",
      [
        (call_script, "script_recalculate_ais"),
        (jump_to_menu, "mnu_faction_orders"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("character_report", 0,
    "{s9}",
    "none",
    [
      (try_begin),
        (gt, "$g_player_reading_book", 0),
        (player_has_item, "$g_player_reading_book"),
        (str_store_item_name, s8, "$g_player_reading_book"),
        (str_store_string, s9, "@You are currently reading {s8}."),
      (else_try),
        (assign, "$g_player_reading_book", 0),
        (str_store_string, s9, "@You are not reading any books."),
      (try_end),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (str_store_string, s6, "@none"),
      (str_store_string, s8, "@none"),
      (try_for_range, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (call_script, "script_troop_get_player_relation", ":var2"),
        (assign, ":var3", reg0),
        (try_begin),
          (gt, ":var3", 20),
          (try_begin),
            (eq, ":var0", 0),
            (str_store_troop_name, s8, ":var2"),
          (else_try),
            (eq, ":var0", 1),
            (str_store_troop_name, s7, ":var2"),
            (str_store_string, s8, "@{s7} and {s8}"),
          (else_try),
            (str_store_troop_name, s7, ":var2"),
            (str_store_string, s8, "@{s7}, {s8}"),
          (try_end),
          (val_add, ":var0", 1),
        (else_try),
          (lt, ":var3", -20),
          (try_begin),
            (eq, ":var1", 0),
            (str_store_troop_name, s6, ":var2"),
          (else_try),
            (eq, ":var1", 1),
            (str_store_troop_name, s5, ":var2"),
            (str_store_string, s6, "@{s5} and {s6}"),
          (else_try),
            (str_store_troop_name, s5, ":var2"),
            (str_store_string, s6, "@{s5}, {s6}"),
          (try_end),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (assign, reg3, "$player_honor"),
      (troop_get_slot, reg2, "trp_player", 7),
      (str_store_string, s9, "@Renown: {reg2}.^Honour rating: {reg3}.^Friends: {s8}.^Enemies: {s6}.^{s9}"),
      (call_script, "script_get_number_of_hero_centers", "trp_player"),
      (assign, ":var4", reg0),
      (try_begin),
        (gt, ":var4", 0),
        (try_for_range, ":var5", 0, ":var4"),
          (call_script, "script_troop_get_leaded_center_with_index", "trp_player", ":var5"),
          (assign, ":var6", reg0),
          (try_begin),
            (eq, ":var5", 0),
            (str_store_party_name, s8, ":var6"),
          (else_try),
            (eq, ":var5", 1),
            (str_store_party_name, s7, ":var6"),
            (str_store_string, s8, "@{s7} and {s8}"),
          (else_try),
            (str_store_party_name, s7, ":var6"),
            (str_store_string, s8, "@{s7}, {s8}"),
          (try_end),
        (try_end),
        (str_store_string, s9, "@Your estates are: {s8}.^{s9}"),
      (try_end),
      (try_begin),
        (gt, "$players_kingdom", 0),
        (str_store_faction_name, s8, "$players_kingdom"),
        (str_store_string, s9, "@You are a protector of {s8}.^{s9}"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("party_size_report", 0,
    "{s1}",
    "none",
    [
      (call_script, "script_game_get_party_companion_limit"),
      (assign, ":var0", reg0),
      (store_skill_level, ":var1", "skl_leadership", "trp_player"),
      (val_mul, ":var1", 5),
      (store_attribute_level, ":var2", "trp_player", ca_charisma),
      (troop_get_slot, ":var3", "trp_player", 7),
      (val_div, ":var3", 25),
      (try_begin),
        (gt, ":var1", 0),
        (str_store_string, s2, "@ +"),
      (else_try),
        (str_store_string, s2, "@ "),
      (try_end),
      (try_begin),
        (gt, ":var2", 0),
        (str_store_string, s3, "@ +"),
      (else_try),
        (str_store_string, s3, "@ "),
      (try_end),
      (try_begin),
        (gt, ":var3", 0),
        (str_store_string, s4, "@ +"),
      (else_try),
        (str_store_string, s4, "@ "),
      (try_end),
      (assign, reg5, ":var0"),
      (assign, reg1, ":var1"),
      (assign, reg2, ":var2"),
      (assign, reg3, ":var3"),
      (str_store_string, s1, "@Current party size limit is {reg5}.^Current party size modifiers are:^^Base size:  +10^Leadership: {s2}{reg1}^Charisma: {s3}{reg2}^Renown: {s4}{reg3}^TOTAL:  {reg5}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("besieged_report", 0,
    "{s1}",
    "none",
    [
      (str_clear, s3),
      (str_store_faction_name, s0, "$players_kingdom"),
      (assign, reg0, 0),
      (try_for_range, ":var0", "p_town_1", "p_village_1"),
        (party_get_slot, ":var1", ":var0", 54),
        (store_faction_of_party, ":var2", ":var0"),
        (ge, ":var1", 0),
        (eq, ":var2", "$players_kingdom"),
        (val_add, reg0, 1),
        (str_store_party_name_link, s2, ":var0"),
        (str_store_string, s3, "@{s3}^{s2} has been besieged."),
      (try_end),
      (str_store_string, s1, "@{s0} has {reg0} center(s) under sieged.^{s3}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("wages_report", 0,
    "{s1}",
    "none",
    [
      (assign, reg0, 0),
      (call_script, "script_calculate_player_faction_wage"),
      (store_troop_gold, reg1, "trp_player"),
      (str_store_string, s1, "@Total weekly wages: {reg0}^Total current cash: {reg1}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("faction_relations_report", 0,
    "{s1}",
    "none",
    [
      (str_store_string, s1, "@Your relations with the factions are:^^Major Factions:"),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var0", 21, 0),
        (neq, ":var0", "fac_player_supporters_faction"),
        (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
        (call_script, "script_store_faction_relation_description_to_s3", ":var1"),
        (str_store_faction_name, s4, ":var0"),
        (assign, reg1, ":var1"),
        (str_store_string, s1, "@{s1}^{s4}: {reg1} ({s3})"),
        (try_begin),
          (eq, ":var0", "fac_kingdom_4"),
          (str_store_string, s1, "@{s1}^^Gang Factions:"),
        (try_end),
      (try_end),
      (str_store_string, s1, "@{s1}^^Minor Factions:"),
      (try_for_range, ":var2", 41, 45),
        (store_relation, ":var1", "fac_player_supporters_faction", ":var2"),
        (call_script, "script_store_faction_relation_description_to_s3", ":var1"),
        (str_store_faction_name, s4, ":var2"),
        (assign, reg1, ":var1"),
        (str_store_string, s1, "@{s1}^{s4}: {reg1} ({s3})"),
      (try_end),
      (str_store_string, s1, "@{s1}^^Special Factions:"),
      (try_for_range, ":var2", "fac_commoners", 4),
        (store_relation, ":var1", "fac_player_supporters_faction", ":var2"),
        (call_script, "script_store_faction_relation_description_to_s3", ":var1"),
        (str_store_faction_name, s4, ":var2"),
        (assign, reg1, ":var1"),
        (str_store_string, s1, "@{s1}^{s4}: {reg1} ({s3})"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_reports"),
      ]
      ),
    ],
  ),

  ("camp", mnf_scale_picture,
    "You set up camp. What do you want to do?",
    "none",
    [
      (assign, "$g_player_icon_state", 0),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_camp_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_camp"),
      (try_end),
    ],
    [
      ("camp_action_1",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat:_Walk_around.",
      [
        (set_jump_mission, "mt_ai_training"),
        (call_script, "script_setup_random_scene"),
        (change_screen_mission),
      ]
      ),

      ("camp_action",
      [],
      "Take_an_action.",
      [
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("camp_wait_here",
      [],
      "Wait_here_for_some_time.",
      [
        (assign, "$g_camp_mode", 1),
        (assign, "$g_player_icon_state", 1),
        (rest_for_hours_interactive, 168, 5, 1),
        (change_screen_return),
      ]
      ),

      ("camp_cheat",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT_MENU!",
      [
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("resume_travelling",
      [],
      "Resume_travelling.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("camp_cheat", 0,
    "Select a cheat:",
    "none",
    [],
    [
      ("camp_cheat_1",
      [],
      "Increase_player_renown.",
      [
        (str_store_string, s1, "@Player renown is increased by 100. "),
        (call_script, "script_change_troop_renown", "trp_player", 100),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_2",
      [],
      "Increase_player_relation_with_all_factions_by_5.",
      [
        (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (faction_slot_eq, ":var0", 21, 0),
          (neq, ":var0", "fac_player_supporters_faction"),
          (call_script, "script_change_player_relation_with_faction", ":var0", 5),
        (try_end),
        (try_for_range, ":var0", "fac_confederate_renegades", "fac_minor_end"),
          (faction_slot_eq, ":var0", 21, 0),
          (neq, ":var0", "fac_player_supporters_faction"),
          (call_script, "script_change_player_relation_with_faction", ":var0", 5),
        (try_end),
        (try_for_range, ":var0", "fac_commoners", "fac_special_end"),
          (faction_slot_eq, ":var0", 21, 0),
          (neq, ":var0", "fac_player_supporters_faction"),
          (call_script, "script_change_player_relation_with_faction", ":var0", 5),
        (try_end),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_3",
      [],
      "Decrease_player_relation_with_all_factions_by_5.",
      [
        (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (faction_slot_eq, ":var0", 21, 0),
          (neq, ":var0", "fac_player_supporters_faction"),
          (call_script, "script_change_player_relation_with_faction", ":var0", -5),
        (try_end),
        (try_for_range, ":var0", "fac_confederate_renegades", "fac_minor_end"),
          (faction_slot_eq, ":var0", 21, 0),
          (neq, ":var0", "fac_player_supporters_faction"),
          (call_script, "script_change_player_relation_with_faction", ":var0", -5),
        (try_end),
        (try_for_range, ":var0", "fac_commoners", "fac_special_end"),
          (faction_slot_eq, ":var0", 21, 0),
          (neq, ":var0", "fac_player_supporters_faction"),
          (call_script, "script_change_player_relation_with_faction", ":var0", -5),
        (try_end),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_4",
      [],
      "Increase_player_honor_by_5.",
      [
        (call_script, "script_change_player_honor", 5),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_5",
      [],
      "Decrease_player_honor_by_5.",
      [
        (call_script, "script_change_player_honor", -5),
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_6",
      [],
      "Add_troops_to_your_army.",
      [
        (jump_to_menu, "mnu_camp_cheat_add_troops"),
      ]
      ),

      ("camp_action_7",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_cheat_add_troops", 0,
    "Select a troop to add to your party:",
    "none",
    [],
    [
      ("camp_cheat_troops_1",
      [],
      "Veteran_Volunteer.",
      [
        (party_add_members, "p_main_party", "trp_veteran_volunteer", 1),
        (display_message, "@One Veteran Volunteer has been added to your party."),
      ]
      ),

      ("camp_cheat_troops_2",
      [],
      "Carabinero.",
      [
        (party_add_members, "p_main_party", "trp_carabinero", 1),
        (display_message, "@One Carabinero has been added to your party."),
      ]
      ),

      ("camp_cheat_troops_3",
      [],
      "Comanche_Wind_Rider.",
      [
        (party_add_members, "p_main_party", "trp_comanche_wind_rider", 1),
        (display_message, "@One Comanche Wind Rider has been added to your party."),
      ]
      ),

      ("camp_cheat_troops_4",
      [],
      "Apache_Warrior.",
      [
        (party_add_members, "p_main_party", "trp_apache_warrior", 1),
        (display_message, "@One Apache Warrior has been added to your party."),
      ]
      ),

      ("camp_cheat_troops_back_1",
      [],
      "Back_to_cheat_menu.",
      [
        (jump_to_menu, "mnu_camp_cheat"),
      ]
      ),

      ("camp_cheat_troops_back_2",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_action", 0,
    "Choose an action:",
    "none",
    [],
    [
      ("kingdom_options",
      [],
      "Access_Kingdom_Options.",
      [
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("camp_recruit_prisoners",
      [
        (troops_can_join, 1),
        (store_current_hours, ":var0"),
        (val_sub, ":var0", 24),
        (gt, ":var0", "$g_prisoner_recruit_last_time"),
        (try_begin),
          (gt, "$g_prisoner_recruit_last_time", 0),
          (assign, "$g_prisoner_recruit_troop_id", 0),
          (assign, "$g_prisoner_recruit_size", 0),
          (assign, "$g_prisoner_recruit_last_time", 0),
        (try_end),
      ],
      "Recruit_some_of_your_prisoners_to_your_party.",
      [
        (jump_to_menu, "mnu_camp_recruit_prisoners"),
      ]
      ),

      ("action_body_paint",
      [],
      "Customize_your_body_paint.",
      [
        (assign, "$auto_presentation", "prsnt_body_design"),
        (change_screen_return),
      ]
      ),

      ("camp_customize_voice",
      [],
      "Customize_your_voice.",
      [
        (jump_to_menu, "mnu_camp_customize_voice"),
      ]
      ),

      ("action_read_book",
      [],
      "Select_a_book_to_read.",
      [
        (jump_to_menu, "mnu_camp_action_read_book"),
      ]
      ),

      ("action_modify_banner",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat:_Modify_your_banner.",
      [
        (start_presentation, "prsnt_banner_selection"),
      ]
      ),

      ("action_retire",
      [],
      "Retire_from_adventuring.",
      [
        (jump_to_menu, "mnu_retirement_verify"),
      ]
      ),

      ("action_test_scenes",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat:_Select_a_scene_to_test.",
      [
        (jump_to_menu, "mnu_scene_access"),
      ]
      ),

      ("camp_action_4",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_recruit_prisoners", 0,
    "You offer your prisoners freedom if they agree to join you as soldiers. {s18}",
    "none",
    [
      (assign, ":var0", 0),
      (party_get_num_prisoner_stacks, ":var1", "p_main_party"),
      (try_for_range, ":var2", 0, ":var1"),
        (party_prisoner_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
        (neg|troop_is_hero, ":var3"),
        (val_add, ":var0", 1),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (jump_to_menu, "mnu_camp_no_prisoners"),
      (else_try),
        (eq, "$g_prisoner_recruit_troop_id", 0),
        (store_current_hours, "$g_prisoner_recruit_last_time"),
        (store_random_in_range, ":var4", 0, 100),
        (store_skill_level, ":var5", "skl_persuasion", "trp_player"),
        (store_sub, ":var6", 15, ":var5"),
        (val_mul, ":var6", 4),
        (try_begin),
          (lt, ":var4", ":var6"),
          (assign, "$g_prisoner_recruit_troop_id", -7),
        (else_try),
          (assign, ":var0", 0),
          (party_get_num_prisoner_stacks, ":var1", "p_main_party"),
          (try_for_range, ":var2", 0, ":var1"),
            (party_prisoner_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
            (neg|troop_is_hero, ":var3"),
            (val_add, ":var0", 1),
          (try_end),
          (store_random_in_range, ":var7", 0, ":var0"),
          (try_for_range, ":var2", 0, ":var1"),
            (party_prisoner_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
            (neg|troop_is_hero, ":var3"),
            (val_sub, ":var7", 1),
            (lt, ":var7", 0),
            (assign, ":var1", 0),
            (assign, "$g_prisoner_recruit_troop_id", ":var3"),
            (party_prisoner_stack_get_size, "$g_prisoner_recruit_size", "p_main_party", ":var2"),
          (try_end),
        (try_end),
        (try_begin),
          (gt, "$g_prisoner_recruit_troop_id", 0),
          (party_get_free_companions_capacity, ":var8", "p_main_party"),
          (val_min, "$g_prisoner_recruit_size", ":var8"),
          (assign, reg1, "$g_prisoner_recruit_size"),
          (gt, "$g_prisoner_recruit_size", 0),
          (try_begin),
            (gt, "$g_prisoner_recruit_size", 1),
            (assign, reg2, 1),
          (else_try),
            (assign, reg2, 0),
          (try_end),
          (str_store_troop_name_by_count, s1, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
          (str_store_string, s18, "@{reg1} {s1} {reg2?accept:accepts} the offer."),
        (else_try),
          (str_store_string, s18, "@No one accepts the offer."),
        (try_end),
      (try_end),
    ],
    [
      ("camp_recruit_prisoners_accept",
      [
        (gt, "$g_prisoner_recruit_troop_id", 0),
      ],
      "Take_them.",
      [
        (remove_troops_from_prisoners, "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (party_add_members, "p_main_party", "$g_prisoner_recruit_troop_id", "$g_prisoner_recruit_size"),
        (store_mul, ":var0", -3, "$g_prisoner_recruit_size"),
        (call_script, "script_change_player_party_morale", ":var0"),
        (jump_to_menu, "mnu_camp"),
      ]
      ),

      ("camp_recruit_prisoners_reject",
      [
        (gt, "$g_prisoner_recruit_troop_id", 0),
      ],
      "Reject_them.",
      [
        (jump_to_menu, "mnu_camp"),
        (assign, "$g_prisoner_recruit_troop_id", 0),
        (assign, "$g_prisoner_recruit_size", 0),
      ]
      ),

      ("go_back",
      [
        (le, "$g_prisoner_recruit_troop_id", 0),
      ],
      "Go_back.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_no_prisoners", 0,
    "You have no prisoners to recruit from.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_customize_voice", 0,
    "You've managed to pick up a few dialects and languages and can change your voice at will. When commanding your troops, you currently sound like:^^ {s1}.^^From now on, you will sound like a...",
    "none",
    [
      (assign, reg1, "$g_player_voice"),
      (try_begin),
        (eq, reg1, 0),
        (str_store_string, s1, "@A Silent Killer"),
      (else_try),
        (eq, reg1, 1),
        (str_store_string, s1, "@An American Soldier"),
      (else_try),
        (eq, reg1, 2),
        (str_store_string, s1, "@An American Settler"),
      (else_try),
        (eq, reg1, 3),
        (str_store_string, s1, "@A Mexican Officer"),
      (else_try),
        (eq, reg1, 4),
        (str_store_string, s1, "@An Apache Warrior"),
      (else_try),
        (eq, reg1, 5),
        (str_store_string, s1, "@A Comanche Tribal Leader"),
      (else_try),
        (display_message, "@ERROR: player voice out of range: {reg1}"),
        (str_store_string, s1, "@ERROR"),
      (try_end),
    ],
    [
      ("customize_voice_cavalry",
      [],
      "American_Soldier.",
      [
        (assign, "$g_player_voice", 1),
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("customize_voice_cowboy",
      [],
      "American_Settler.",
      [
        (assign, "$g_player_voice", 2),
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("customize_voice_mexican",
      [],
      "Mexican_Officer.",
      [
        (assign, "$g_player_voice", 3),
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("customize_voice_apache",
      [],
      "Apache_Warrior.",
      [
        (assign, "$g_player_voice", 4),
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("customize_voice_comanche",
      [],
      "Comanche_Tribal_Leader.",
      [
        (assign, "$g_player_voice", 5),
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("customize_voice_none",
      [],
      "Silent_Killer.",
      [
        (assign, "$g_player_voice", 0),
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),

      ("customize_voice_no_change",
      [],
      "Go_Back.",
      [
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),
    ],
  ),

  ("camp_action_read_book", 0,
    "Choose a book to read:",
    "none",
    [],
    [
      ("action_read_book_1",
      [
        (player_has_item, "itm_book_tactics"),
        (item_slot_eq, "itm_book_tactics", 3, 0),
        (str_store_item_name, s1, "itm_book_tactics"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_tactics"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_2",
      [
        (player_has_item, "itm_book_persuasion"),
        (item_slot_eq, "itm_book_persuasion", 3, 0),
        (str_store_item_name, s1, "itm_book_persuasion"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_persuasion"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_3",
      [
        (player_has_item, "itm_book_leadership"),
        (item_slot_eq, "itm_book_leadership", 3, 0),
        (str_store_item_name, s1, "itm_book_leadership"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_leadership"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_4",
      [
        (player_has_item, "itm_book_intelligence"),
        (item_slot_eq, "itm_book_intelligence", 3, 0),
        (str_store_item_name, s1, "itm_book_intelligence"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_intelligence"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_5",
      [
        (player_has_item, "itm_book_trade"),
        (item_slot_eq, "itm_book_trade", 3, 0),
        (str_store_item_name, s1, "itm_book_trade"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_trade"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_6",
      [
        (player_has_item, "itm_book_weapon_mastery"),
        (item_slot_eq, "itm_book_weapon_mastery", 3, 0),
        (str_store_item_name, s1, "itm_book_weapon_mastery"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_weapon_mastery"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("action_read_book_7",
      [
        (player_has_item, "itm_book_engineering"),
        (item_slot_eq, "itm_book_engineering", 3, 0),
        (str_store_item_name, s1, "itm_book_engineering"),
      ],
      "{s1}.",
      [
        (assign, "$temp", "itm_book_engineering"),
        (jump_to_menu, "mnu_camp_action_read_book_start"),
      ]
      ),

      ("camp_action_4",
      [],
      "Back_to_camp_menu.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("camp_action_read_book_start", 0,
    "{s1}",
    "none",
    [
      (assign, ":var0", "$temp"),
      (str_store_item_name, s2, ":var0"),
      (try_begin),
        (store_attribute_level, ":var1", "trp_player", ca_intelligence),
        (item_get_slot, ":var2", ":var0", 4),
        (le, ":var2", ":var1"),
        (str_store_string, s1, "@You start reading {s2}. After a few pages, you feel you could learn a lot from this book. You decide to keep it close by and read whenever you have the time."),
        (assign, "$g_player_reading_book", ":var0"),
      (else_try),
        (str_store_string, s1, "@You flip through the pages of {s2}, but you find the text confusing and difficult to follow. Try as you might, it soon gives you a headache, and you're forced to give up the attempt."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("retirement_verify", 0,
    "You are at day {reg0}. Your current luck is {reg1}. Are you sure you want to retire?",
    "none",
    [
      (store_current_day, reg0),
      (assign, reg1, "$g_player_luck"),
    ],
    [
      ("retire_yes",
      [],
      "Yes.",
      [
        (start_presentation, "prsnt_retirement"),
      ]
      ),

      ("retire_no",
      [],
      "No.",
      [
        (jump_to_menu, "mnu_camp"),
      ]
      ),
    ],
  ),

  ("end_game", 0,
    "The decision is made, and you resolve to give up your adventurer's life and settle down. You sell off your weapons and a horse, gather up all your money, and ride off into the sunset....",
    "none",
    [],
    [
      ("end_game_bye",
      [],
      "Farewell.",
      [
        (change_screen_quit),
      ]
      ),
    ],
  ),

  ("pay_day", mnf_disable_all_keys|mnf_scale_picture,
    "{s1}.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_payment_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_payment"),
      (try_end),
      (call_script, "script_calculate_player_faction_wage"),
      (assign, ":var1", reg0),
      (assign, reg6, ":var1"),
      (assign, reg2, "$g_player_debt_to_party_members"),
      (store_add, reg3, reg6, reg2),
      (store_troop_gold, ":var2", "trp_player"),
      (assign, reg4, ":var2"),
      (val_add, ":var1", "$g_player_debt_to_party_members"),
      (call_script, "script_game_get_money_text", reg2),
      (str_store_string, s12, s1),
      (call_script, "script_game_get_money_text", reg3),
      (str_store_string, s13, s1),
      (call_script, "script_game_get_money_text", reg4),
      (str_store_string, s14, s1),
      (call_script, "script_game_get_money_text", reg6),
      (str_store_string, s16, s1),
      (try_begin),
        (ge, ":var2", ":var1"),
        (assign, "$g_player_debt_to_party_members", 0),
        (troop_remove_gold, "trp_player", ":var1"),
        (store_sub, reg5, reg4, reg3),
        (call_script, "script_game_get_money_text", reg5),
        (str_store_string, s15, s1),
        (str_store_string, s1, "@You paid {s13} of your {s14} to your men. You have {s15} left."),
      (else_try),
        (troop_remove_gold, "trp_player", ":var2"),
        (store_sub, ":var3", ":var1", ":var2"),
        (assign, reg5, ":var3"),
        (call_script, "script_game_get_money_text", reg5),
        (str_store_string, s15, s1),
        (str_store_string, s1, "@Your debt to your men amounted to {s13}, however you only had {s14}. Unpaid sum of {s15} is added as debt. Your party loses morale."),
        (assign, "$g_player_debt_to_party_members", ":var3"),
        (call_script, "script_objectionable_action", 2, "str_men_unpaid"),
      (try_end),
      (str_store_string, s1, "@This week's wages: {s16}^Earlier debts: {s12}^Total payment: {s13}^Current wealth: {s14}^^{s1}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return, 0),
      ]
      ),
    ],
  ),

  ("faction_cooldown", 0,
    "The passing of time over the last two weeks has caused some factions to become more neutral towards you.^^{s32}",
    "none",
    [
      (set_show_messages, 0),
      (str_clear, s32),
      (try_begin),
        (ge, "$player_honor", 100),
        (str_store_string, s32, "@{s32}Your honor has substantially adjusted this change."),
      (else_try),
        (ge, "$player_honor", 75),
        (str_store_string, s32, "@{s32}Your honor has greatly adjusted this change."),
      (else_try),
        (ge, "$player_honor", 50),
        (str_store_string, s32, "@{s32}Your honor has moderately adjusted this change."),
      (else_try),
        (ge, "$player_honor", 25),
        (str_store_string, s32, "@{s32}Your honor has slightly adjusted this change."),
      (else_try),
        (le, "$player_honor", -100),
        (str_store_string, s32, "@{s32}Your dishonor has substantially adjusted this change."),
      (else_try),
        (le, "$player_honor", -75),
        (str_store_string, s32, "@{s32}Your dishonor has greatly adjusted this change."),
      (else_try),
        (le, "$player_honor", -50),
        (str_store_string, s32, "@{s32}Your dishonor has moderately adjusted this change."),
      (else_try),
        (le, "$player_honor", -25),
        (str_store_string, s32, "@{s32}Your dishonor has slightly adjusted this change."),
      (else_try),
        (str_store_string, s32, "@{s32}Your honor did not affect this change."),
      (try_end),
      (str_store_string, s32, "@{s32}^^Your new relations are:^"),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var0", 21, 0),
        (neq, ":var0", "fac_player_supporters_faction"),
        (call_script, "script_faction_cooldown", ":var0"),
        (try_begin),
          (eq, reg3, 1),
          (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
          (assign, reg1, ":var1"),
          (str_store_faction_name, s4, ":var0"),
          (str_store_string, s32, "@{s32}^{s4}: {reg1} {s3}"),
        (try_end),
      (try_end),
      (str_store_string, s32, "@{s32}^"),
      (try_for_range, ":var0", "fac_confederate_renegades", "fac_minor_end"),
        (faction_slot_eq, ":var0", 21, 0),
        (neq, ":var0", "fac_player_supporters_faction"),
        (call_script, "script_faction_cooldown", ":var0"),
        (try_begin),
          (eq, reg3, 1),
          (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
          (assign, reg1, ":var1"),
          (str_store_faction_name, s4, ":var0"),
          (str_store_string, s32, "@{s32}^{s4}: {reg1} {s3}"),
        (try_end),
      (try_end),
      (str_store_string, s32, "@{s32}^"),
      (try_for_range, ":var0", "fac_commoners", "fac_special_end"),
        (faction_slot_eq, ":var0", 21, 0),
        (neq, ":var0", "fac_player_supporters_faction"),
        (call_script, "script_faction_cooldown", ":var0"),
        (try_begin),
          (eq, reg3, 1),
          (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
          (assign, reg1, ":var1"),
          (str_store_faction_name, s4, ":var0"),
          (str_store_string, s32, "@{s32}^{s4}: {reg1} {s3}"),
        (try_end),
      (try_end),
      (str_store_string, s32, "@{s32}^"),
      (set_show_messages, 1),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return, 0),
      ]
      ),
    ],
  ),

  ("cattle_herd", mnf_scale_picture,
    "You encounter a herd of cattle.",
    "none",
    [
      (play_sound, "snd_cow_moo"),
      (set_background_mesh, "mesh_pic_cattle"),
    ],
    [
      ("cattle_drive_away",
      [],
      "Drive_the_cattle_onward.",
      [
        (party_set_slot, "$g_encountered_party", 7, 1),
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_driven_by_party),
        (party_set_ai_object, "$g_encountered_party", "p_main_party"),
        (change_screen_return),
      ]
      ),

      ("cattle_stop",
      [],
      "Bring_the_herd_to_a_stop.",
      [
        (party_set_slot, "$g_encountered_party", 7, 0),
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_hold),
        (change_screen_return),
      ]
      ),

      ("cattle_kill",
      [
        (assign, ":var0", 1),
        (try_begin),
          (check_quest_active, "qst_move_cattle_herd"),
          (quest_slot_eq, "qst_move_cattle_herd", 8, "$g_encountered_party"),
          (assign, ":var0", 0),
        (try_end),
        (eq, ":var0", 1),
      ],
      "Slaughter_some_of_the_animals.",
      [
        (jump_to_menu, "mnu_cattle_herd_kill"),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("horses_herd", 0,
    "You encounter a herd of horses.",
    "none",
    [
      (play_sound, "snd_horse_snort"),
    ],
    [
      ("horses_drive_away",
      [],
      "Drive_the_horses_onward.",
      [
        (party_set_slot, "$g_encountered_party", 7, 1),
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_driven_by_party),
        (party_set_ai_object, "$g_encountered_party", "p_main_party"),
        (change_screen_return),
      ]
      ),

      ("horses_stop",
      [],
      "Bring_the_horses_to_a_stop.",
      [
        (party_set_slot, "$g_encountered_party", 7, 0),
        (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_hold),
        (change_screen_return),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("cattle_herd_kill", 0,
    "How many animals do you want to slaughter?",
    "none",
    [
      (party_get_num_companions, reg5, "$g_encountered_party"),
    ],
    [
      ("cattle_kill_1",
      [
        (ge, reg5, 1),
      ],
      "One.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 1),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_2",
      [
        (ge, reg5, 2),
      ],
      "Two.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 2),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_3",
      [
        (ge, reg5, 3),
      ],
      "Three.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 3),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_4",
      [
        (ge, reg5, 4),
      ],
      "Four.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 4),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("cattle_kill_5",
      [
        (ge, reg5, 5),
      ],
      "Five.",
      [
        (call_script, "script_kill_cattle_from_herd", "$g_encountered_party", 5),
        (jump_to_menu, "mnu_cattle_herd_kill_end"),
        (change_screen_loot, "trp_temp_troop"),
        (play_sound, "snd_cow_slaughter"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_cattle_herd"),
      ]
      ),
    ],
  ),

  ("cattle_herd_kill_end", 0,
    "You shouldn't be reading this.",
    "none",
    [
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("arena_duel_fight", 0,
    "You and your opponent prepare to fight for honor.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_simple_encounter"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("simple_encounter", mnf_enable_hot_keys|mnf_scale_picture,
    "{s2} You have {reg10} troops fit for battle against their {reg11}.",
    "none",
    [
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (assign, "$g_encounter_is_in_village", 0),
        (assign, "$g_encounter_type", 0),
        (try_begin),
          (party_slot_eq, "$g_enemy_party", 4, 5),
          (party_get_slot, ":var0", "$g_enemy_party", 5),
          (store_distance_to_party_from_party, ":var1", ":var0", "$g_enemy_party"),
          (try_begin),
            (lt, ":var1", 4),
            (assign, "$g_encounter_is_in_village", ":var0"),
            (assign, "$g_encounter_type", 1),
          (try_end),
        (try_end),
        (try_begin),
          (gt, "$g_player_raiding_village", 0),
          (assign, "$g_encounter_is_in_village", "$g_player_raiding_village"),
          (assign, "$g_encounter_type", 2),
          (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 1),
          (str_store_string, s1, "@Villagers"),
          (display_message, "str_s1_joined_battle_enemy"),
        (else_try),
          (eq, "$g_encounter_type", 1),
          (party_quick_attach_to_current_battle, "$g_encounter_is_in_village", 0),
          (str_store_string, s1, "@Villagers"),
          (display_message, "str_s1_joined_battle_friend"),
        (try_end),
        (call_script, "script_let_nearby_parties_join_current_battle", 0, 0),
        (call_script, "script_encounter_init_variables"),
        (assign, "$encountered_party_hostile", 0),
        (assign, "$encountered_party_friendly", 0),
        (try_begin),
          (gt, "$g_encountered_party_relation", 0),
          (assign, "$encountered_party_friendly", 1),
        (try_end),
        (try_begin),
          (this_or_next|lt, "$g_encountered_party_relation", 0),
          (party_slot_eq, "$g_encountered_party", 0, 21),
          (assign, "$encountered_party_hostile", 1),
          (try_begin),
            (encountered_party_is_attacker),
            (assign, "$cant_leave_encounter", 1),
          (try_end),
        (try_end),
        (assign, "$talk_context", 2),
        (call_script, "script_setup_party_meeting", "$g_encountered_party"),
      (else_try),
        (try_begin),
          (eq, "$cant_leave_encounter", 1),
          (call_script, "script_party_count_members_with_full_health", "p_main_party_backup"),
          (assign, ":var2", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_encountered_party_backup"),
          (val_add, ":var2", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_main_party"),
          (assign, ":var3", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
          (val_add, ":var3", reg0),
          (store_sub, ":var4", ":var2", 10),
          (lt, ":var3", ":var4"),
          (assign, "$cant_leave_encounter", 0),
        (try_end),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (try_end),
      (try_begin),
        (party_is_active, "$g_encountered_party"),
        (str_store_party_name, s1, "$g_encountered_party"),
        (try_begin),
          (eq, "$g_encounter_type", 0),
          (str_store_string, s2, "@You have encountered {s1}."),
        (else_try),
          (eq, "$g_encounter_type", 1),
          (str_store_party_name, s3, "$g_encounter_is_in_village"),
          (str_store_string, s2, "@You have engaged {s1} while they were raiding {s3}."),
        (else_try),
          (eq, "$g_encounter_type", 2),
          (str_store_party_name, s3, "$g_encounter_is_in_village"),
          (str_store_string, s2, "@You were caught by {s1} while your forces were raiding {s3}."),
        (try_end),
      (try_end),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":var5", reg0),
        (assign, ":var6", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (eq, ":var5", 0),
          (assign, ":var6", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var6", 1),
        (try_end),
        (this_or_next|eq, ":var6", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", -1),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, reg3, reg0),
        (assign, ":var7", 0),
        (try_begin),
          (eq, "$g_battle_result", -1),
          (eq, reg3, 0),
          (assign, ":var7", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (ge, "$g_enemy_fit_for_battle", 1),
          (le, "$g_friend_fit_for_battle", 0),
          (assign, ":var7", 1),
        (try_end),
        (this_or_next|eq, ":var7", 1),
        (eq, "$g_player_surrenders", 1),
        (assign, "$g_next_menu", "mnu_captivity_start_wilderness"),
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
      (try_begin),
        (this_or_next|eq, "$g_encountered_party_template", "pt_looters"),
        (this_or_next|eq, "$g_encountered_party_template", "pt_outlaws_american"),
        (eq, "$g_encountered_party_template", "pt_outlaws_mexican"),
        (set_background_mesh, "mesh_pic_outlaws"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_mountain_bandits"),
        (set_background_mesh, "mesh_pic_mountain_bandits"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_indian_raiders"),
        (set_background_mesh, "mesh_pic_indian_raiders"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_imperialists"),
        (set_background_mesh, "mesh_pic_imperialists"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_trappers"),
        (set_background_mesh, "mesh_pic_trappers"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_miners"),
        (set_background_mesh, "mesh_pic_miners"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_homesteaders"),
        (set_background_mesh, "mesh_pic_homesteaders"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_forest_bandits"),
        (set_background_mesh, "mesh_pic_forest_bandits"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_deserters"),
        (set_background_mesh, "mesh_pic_deserters"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_scalphunters"),
        (set_background_mesh, "mesh_pic_scalphunters"),
      (else_try),
        (eq, "$g_encountered_party_template", "pt_manhunters"),
        (set_background_mesh, "mesh_pic_vigilantes"),
      (else_try),
        (this_or_next|eq, "$g_encountered_party_template", "pt_merchant_caravan"),
        (this_or_next|eq, "$g_encountered_party_template", "pt_stagecoach"),
        (eq, "$g_encountered_party_template", "pt_kingdom_caravan_party"),
        (troop_get_type, ":var8", "trp_player"),
        (try_begin),
          (eq, ":var8", 3),
          (set_background_mesh, "mesh_pic_stagecoach_indian"),
        (else_try),
          (set_background_mesh, "mesh_pic_stagecoach"),
        (try_end),
      (else_try),
        (faction_get_slot, ":var9", "$g_encountered_party_faction", 9),
        (try_begin),
          (eq, ":var9", "fac_culture_1"),
          (set_background_mesh, "mesh_pic_faction_usa"),
        (else_try),
          (eq, ":var9", "fac_culture_2"),
          (set_background_mesh, "mesh_pic_faction_mexico"),
        (else_try),
          (eq, ":var9", "fac_culture_3"),
          (set_background_mesh, "mesh_pic_faction_apache"),
        (else_try),
          (eq, ":var9", "fac_culture_4"),
          (set_background_mesh, "mesh_pic_faction_comanche"),
        (else_try),
          (is_between, ":var9", "fac_culture_5", "fac_player_faction"),
          (set_background_mesh, "mesh_pic_faction_gang"),
        (try_end),
      (try_end),
    ],
    [
      ("encounter_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Charge_the_enemy.",
      [
        (try_begin),
          (eq, "$g_engaged_enemy", 0),
          (neq, "$cant_leave_encounter", 1),
          (try_begin),
            (eq, "$g_encountered_party_template", "pt_village_farmers"),
            (party_get_slot, ":var0", "$g_encountered_party", 123),
            (party_get_slot, ":var1", ":var0", 121),
            (party_get_slot, ":var2", ":var0", 7),
            (call_script, "script_change_player_relation_with_center", ":var0", -4),
            (call_script, "script_change_player_relation_with_center", ":var1", -2),
            (call_script, "script_change_player_relation_with_troop", ":var2", -2),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -2),
          (else_try),
            (eq, "$g_encountered_party_template", "pt_stagecoach"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -3),
          (else_try),
            (eq, "$g_encountered_party_template", "pt_merchant_caravan"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -3),
            (call_script, "script_add_log_entry", 3, "trp_player", -1, -1, "$g_encountered_party_faction"),
          (else_try),
            (eq, "$g_encountered_party_template", "pt_deserters"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -1),
          (else_try),
            (neq, "$g_encountered_party_faction", "fac_neutral"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -3),
          (try_end),
        (try_end),
        (assign, "$g_battle_result", 0),
        (assign, "$g_engaged_enemy", 1),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (try_begin),
          (eq, "$g_encounter_type", 1),
          (assign, "$g_village_raid_evil", 0),
          (set_jump_mission, "mt_village_raid"),
          (party_get_slot, ":var3", "$g_encounter_is_in_village", 10),
          (jump_to_scene, ":var3"),
        (else_try),
          (party_get_position, pos1, "p_main_party"),
          (party_get_position, pos2, "p_tull"),
          (get_distance_between_positions, ":var4", pos1, pos2),
          (lt, ":var4", 150),
          (assign, ":var3", "scn_tull"),
          (set_jump_mission, "mt_lead_charge"),
          (jump_to_scene, ":var3"),
        (else_try),
          (eq, "$g_encounter_type", 2),
          (assign, "$g_village_raid_evil", 0),
          (set_jump_mission, "mt_village_raid"),
          (party_get_slot, ":var3", "$g_encounter_is_in_village", 10),
          (jump_to_scene, ":var3"),
        (else_try),
          (try_begin),
            (assign, ":var5", -1),
            (try_for_range, ":var6", "p_village_1", "p_salt_mine"),
              (neg|troop_slot_eq, "trp_party_type_2", ":var6", 1),
              (store_distance_to_party_from_party, ":var7", p_main_party, ":var6"),
              (lt, ":var7", 4),
              (assign, ":var5", ":var6"),
            (try_end),
            (gt, ":var5", -1),
            (assign, "$g_village_raid_evil", 0),
            (set_jump_mission, "mt_village_raid"),
            (party_get_slot, ":var3", ":var5", 10),
            (jump_to_scene, ":var3"),
          (else_try),
            (set_jump_mission, "mt_lead_charge"),
            (try_begin),
              (this_or_next|eq, "$g_encountered_party_template", "pt_merchant_caravan"),
              (this_or_next|eq, "$g_encountered_party_template", "pt_village_caravan"),
              (eq, "$g_encountered_party_template", "pt_stagecoach"),
              (store_random_in_range, ":var8", "scn_stagecoach_ambush_desert", "scn_particle_test"),
            (else_try),
              (call_script, "script_setup_generic_battle_scene", 0),
              (assign, ":var8", reg0),
            (try_end),
            (store_random_in_range, ":var9", 1, 100),
            (try_begin),
              (gt, ":var9", 10),
              (try_begin),
                (assign, ":var10", 0),
                (call_script, "script_party_count_fit_for_battle", "p_main_party"),
                (val_add, ":var10", reg0),
                (call_script, "script_party_count_fit_for_battle", "p_collective_enemy"),
                (assign, ":var11", reg0),
                (val_add, ":var10", reg0),
                (try_begin),
                  (eq, "$cheat_mode", 1),
                  (assign, reg0, ":var10"),
                  (display_message, "@Total number of battle participants: {reg0}"),
                (try_end),
              (try_end),
              (try_begin),
                (this_or_next|le, ":var10", 20),
                (le, ":var11", 10),
                (call_script, "script_setup_random_scene", 1),
              (else_try),
                (call_script, "script_setup_random_scene", 0),
              (try_end),
            (else_try),
              (jump_to_scene, ":var8"),
            (try_end),
          (try_end),
        (try_end),
        (assign, "$g_next_menu", "mnu_simple_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("encounter_order_attack",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (ge, reg0, 4),
      ],
      "Order_your_troops_to_attack_without_you.",
      [
        (jump_to_menu, "mnu_order_attack_begin"),
      ]
      ),

      ("encounter_leave",
      [
        (eq, "$cant_leave_encounter", 0),
      ],
      "Leave.",
      [
        (try_begin),
          (eq, "$encountered_party_friendly", 0),
          (encountered_party_is_attacker),
          (call_script, "script_objectionable_action", 1, "str_flee_battle"),
        (try_end),
        (try_begin),
          (eq, "$encountered_party_friendly", 0),
          (encountered_party_is_attacker),
          (party_get_num_companion_stacks, ":var0", "p_encountered_party_backup"),
          (try_for_range, ":var1", 0, ":var0"),
            (party_stack_get_troop_id, ":var2", "p_encountered_party_backup", ":var1"),
            (is_between, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
            (store_troop_faction, ":var3", ":var2"),
            (call_script, "script_add_log_entry", 15, "trp_player", -1, ":var2", ":var3"),
          (try_end),
        (try_end),
        (leave_encounter),
        (change_screen_return),
      ]
      ),

      ("encounter_retreat",
      [
        (eq, "$cant_leave_encounter", 1),
        (call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
        (assign, ":var0", reg0),
        (val_add, ":var0", 4),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
        (assign, ":var1", reg0),
        (val_div, ":var1", 2),
        (val_div, ":var1", ":var0"),
        (val_max, ":var1", 1),
        (call_script, "script_party_count_fit_regulars", "p_main_party"),
        (assign, ":var2", reg0),
        (ge, ":var2", ":var1"),
      ],
      "Pull_back,_leaving_some_men_behind_to_cover_your_retreat.",
      [
        (jump_to_menu, "mnu_encounter_retreat_confirm"),
      ]
      ),

      ("encounter_surrender",
      [
        (eq, "$cant_leave_encounter", 1),
      ],
      "Surrender.",
      [
        (assign, "$g_player_surrenders", 1),
      ]
      ),
    ],
  ),

  ("encounter_retreat_confirm", 0,
    "As the party member with the highest tactics skill, ({reg2}), {reg3?you devise:{s3} devises} a plan that will allow you and your men to escape with your lives, but you'll have to leave {reg4} soldiers behind to stop the enemy from giving chase.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_tactics"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, reg2, ":var0"),
      (val_add, ":var0", 4),
      (call_script, "script_party_count_members_with_full_health", "p_collective_enemy", 0),
      (assign, ":var2", reg0),
      (val_div, ":var2", 2),
      (store_div, reg4, ":var2", ":var0"),
      (val_max, reg4, 1),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":var1"),
      (try_end),
    ],
    [
      ("leave_behind",
      [],
      "Go_on._The_sacrifice_of_these_men_will_save_the_rest.",
      [
        (assign, ":var0", reg4),
        (try_for_range, ":var1", 0, ":var0"),
          (call_script, "script_cf_party_remove_random_regular_troop", "p_main_party"),
          (assign, ":var2", reg0),
          (store_random_in_range, ":var3", 0, 100),
          (ge, ":var3", 30),
          (party_add_prisoners, "$g_encountered_party", ":var2", 1),
        (try_end),
        (call_script, "script_change_player_party_morale", -20),
        (jump_to_menu, "mnu_encounter_retreat"),
      ]
      ),

      ("dont_leave_behind",
      [],
      "No._We_leave_no_one_behind.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),
    ],
  ),

  ("encounter_retreat", 0,
    "You tell {reg4} of your troops to hold the enemy while you retreat with the rest of your party.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_objectionable_action", 1, "str_flee_battle"),
        (party_get_num_companion_stacks, ":var0", "p_encountered_party_backup"),
        (try_for_range, ":var1", 0, ":var0"),
          (party_stack_get_troop_id, ":var2", "p_encountered_party_backup", ":var1"),
          (is_between, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var3", ":var2"),
          (call_script, "script_add_log_entry", 16, "trp_player", -1, ":var2", ":var3"),
        (try_end),
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("order_attack_begin", 0,
    "Your troops prepare to attack the enemy.",
    "none",
    [],
    [
      ("order_attack_begin",
      [],
      "Order_the_attack_to_begin.",
      [
        (try_begin),
          (eq, "$g_engaged_enemy", 0),
          (neq, "$cant_leave_encounter", 1),
          (try_begin),
            (eq, "$g_encountered_party_template", "pt_village_farmers"),
            (party_get_slot, ":var0", "$g_encountered_party", 123),
            (party_get_slot, ":var1", ":var0", 121),
            (party_get_slot, ":var2", ":var0", 7),
            (call_script, "script_change_player_relation_with_center", ":var0", -4),
            (call_script, "script_change_player_relation_with_center", ":var1", -2),
            (call_script, "script_change_player_relation_with_troop", ":var2", -2),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -2),
          (else_try),
            (eq, "$g_encountered_party_template", "pt_stagecoach"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -3),
          (else_try),
            (eq, "$g_encountered_party_template", "pt_merchant_caravan"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -3),
            (call_script, "script_add_log_entry", 3, "trp_player", -1, -1, "$g_encountered_party_faction"),
          (else_try),
            (eq, "$g_encountered_party_template", "pt_deserters"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -1),
          (else_try),
            (neq, "$g_encountered_party_faction", "fac_neutral"),
            (call_script, "script_change_player_relation_with_faction", "$g_encountered_party_faction", -3),
          (try_end),
        (try_end),
        (assign, "$g_engaged_enemy", 1),
        (jump_to_menu, "mnu_order_attack_2"),
      ]
      ),

      ("call_back",
      [],
      "Call_them_back.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),
    ],
  ),

  ("order_attack_2", mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Enemy casualties: {s9}",
    "none",
    [
      (call_script, "script_party_calculate_strength", "p_main_party", 1),
      (assign, ":var0", reg0),
      (val_div, ":var0", 5),
      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":var1", reg0),
      (val_div, ":var1", 5),
      (inflict_casualties_to_party_group, "p_main_party", ":var1", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_encountered_party", ":var0", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0),
        (assign, ":var2", 0),
        (party_get_num_companion_stacks, ":var3", "p_collective_enemy"),
        (try_begin),
          (eq, ":var3", 0),
          (assign, ":var2", 1),
        (else_try),
          (party_stack_get_troop_id, ":var4", "p_collective_enemy", 0),
          (try_begin),
            (neg|troop_is_hero, ":var4"),
            (assign, ":var2", 1),
          (else_try),
            (troop_is_wounded, ":var4"),
            (assign, ":var2", 1),
          (try_end),
        (try_end),
        (eq, ":var2", 1),
        (assign, "$g_battle_result", 1),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_order_attack_success"),
      (else_try),
        (str_store_string, s4, "str_order_attack_continue"),
      (try_end),
    ],
    [
      ("order_attack_continue",
      [
        (eq, "$no_soldiers_left", 0),
      ],
      "Order_your_soldiers_to_continue_the_attack.",
      [
        (jump_to_menu, "mnu_order_attack_2"),
      ]
      ),

      ("order_retreat",
      [
        (eq, "$no_soldiers_left", 0),
      ],
      "Call_your_soldiers_back.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),

      ("continue",
      [
        (eq, "$no_soldiers_left", 1),
      ],
      "Continue...",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),
    ],
  ),

  ("battle_debrief", mnf_disable_all_keys|mnf_scale_picture,
    "{s11}^^Your Casualties:{s8}{s10}^^Enemy Casualties:{s9}",
    "none",
    [
      (try_begin),
        (eq, "$g_battle_result", 1),
        (call_script, "script_change_troop_renown", "trp_player", "$battle_renown_value"),
      (try_end),
      (call_script, "script_encounter_calculate_fit"),
      (call_script, "script_party_count_fit_regulars", "p_main_party"),
      (assign, "$playerparty_postbattle_regulars", reg0),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, "$g_battle_result", 1),
        (eq, "$g_enemy_fit_for_battle", 0),
        (str_store_string, s11, "@You were victorious!"),
        (try_begin),
          (try_begin),
            (eq, ":var0", 3),
            (set_background_mesh, "mesh_pic_victory_indian"),
          (else_try),
            (set_background_mesh, "mesh_pic_victory"),
          (try_end),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", -1),
        (ge, "$g_enemy_fit_for_battle", 1),
        (this_or_next|le, "$g_friend_fit_for_battle", 0),
        (le, "$playerparty_postbattle_regulars", 0),
        (str_store_string, s11, "@Your side lost the battle completely."),
        (try_begin),
          (eq, ":var0", 3),
          (set_background_mesh, "mesh_pic_defeat_indian"),
        (else_try),
          (set_background_mesh, "mesh_pic_defeat"),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", -1),
        (str_store_string, s11, "@You're too wounded to fight and your companions carry you away."),
        (try_begin),
          (eq, ":var0", 3),
          (set_background_mesh, "mesh_pic_wounded_indian"),
        (else_try),
          (set_background_mesh, "mesh_pic_wounded"),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", 1),
        (str_store_string, s11, "@You have defeated the enemy."),
        (try_begin),
          (try_begin),
            (eq, ":var0", 3),
            (set_background_mesh, "mesh_pic_victory_indian"),
          (else_try),
            (set_background_mesh, "mesh_pic_victory"),
          (try_end),
        (try_end),
      (else_try),
        (eq, "$g_battle_result", 0),
        (str_store_string, s11, "@You have retreated from the fight."),
        (try_begin),
          (eq, ":var0", 3),
          (set_background_mesh, "mesh_pic_retreat_indian"),
        (else_try),
          (set_background_mesh, "mesh_pic_retreat"),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$playerparty_prebattle_regulars", 9),
        (store_add, ":var1", 3, "$g_battle_result"),
        (store_div, ":var2", "$playerparty_prebattle_regulars", ":var1"),
        (lt, "$playerparty_postbattle_regulars", ":var2"),
        (call_script, "script_objectionable_action", 2, "str_excessive_casualties"),
      (try_end),
      (call_script, "script_print_casualties_to_s0", "p_player_casualties", 0),
      (str_store_string_reg, s8, s0),
      (call_script, "script_print_casualties_to_s0", "p_enemy_casualties", 0),
      (str_store_string_reg, s9, s0),
      (str_clear, s10),
      (try_begin),
        (eq, "$any_allies_at_the_last_battle", 1),
        (call_script, "script_print_casualties_to_s0", "p_ally_casualties", 0),
        (str_store_string, s10, "@^^Ally Casualties:{s0}"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "$g_next_menu"),
      ]
      ),
    ],
  ),

  ("total_victory", 0,
    "You shouldn't be reading this... {s9}",
    "none",
    [
      (assign, ":var0", 0),
      (try_begin),
        (eq, "$thanked_by_ally_leader", 0),
        (assign, "$thanked_by_ally_leader", 1),
        (gt, "$g_ally_party", 0),
        (store_add, ":var1", "$g_starting_strength_friends", "$g_starting_strength_enemy_party"),
        (val_sub, ":var1", "$g_starting_strength_main_party"),
        (store_sub, ":var2", "$g_starting_strength_friends", "$g_starting_strength_main_party"),
        (store_mul, ":var3", ":var2", 100),
        (val_add, ":var1", 1),
        (val_div, ":var3", ":var1"),
        (store_sub, ":var4", 100, ":var3"),
        (store_mul, ":var5", ":var4", "$g_starting_strength_enemy_party"),
        (val_div, ":var5", 3000),
        (val_min, ":var5", 4),
        (store_mul, "$g_relation_boost", ":var4", ":var4"),
        (val_div, "$g_relation_boost", 700),
        (val_clamp, "$g_relation_boost", 0, 20),
        (party_get_num_companion_stacks, ":var6", "$g_ally_party"),
        (gt, ":var6", 0),
        (store_faction_of_party, ":var7", "$g_ally_party"),
        (call_script, "script_change_player_relation_with_faction", ":var7", ":var5"),
        (party_stack_get_troop_id, ":var8", "$g_ally_party"),
        (party_stack_get_troop_dna, ":var9", "$g_ally_party"),
        (try_begin),
          (troop_is_hero, ":var8"),
          (troop_get_slot, ":var10", ":var8", 22),
          (assign, ":var11", "$g_relation_boost"),
          (try_begin),
            (lt, ":var10", -5),
            (val_div, ":var11", 3),
          (try_end),
          (call_script, "script_change_player_relation_with_troop", ":var8", ":var11"),
        (try_end),
        (assign, "$talk_context", 13),
        (call_script, "script_setup_troop_meeting", ":var8", ":var9"),
      (else_try),
        (assign, ":var0", 0),
        (party_get_num_companion_stacks, ":var12", "p_encountered_party_backup"),
        (try_for_range, ":var13", "$last_defeated_hero", ":var12"),
          (eq, ":var0", 0),
          (party_stack_get_troop_id, ":var14", "p_encountered_party_backup", ":var13"),
          (party_stack_get_troop_dna, ":var15", "p_encountered_party_backup", ":var13"),
          (troop_is_hero, ":var14"),
          (store_add, "$last_defeated_hero", ":var13", 1),
          (call_script, "script_remove_troop_from_prison", ":var14"),
          (troop_set_slot, ":var14", 10, -1),
          (store_troop_faction, ":var16", ":var14"),
          (try_begin),
            (call_script, "script_cf_check_hero_can_escape_from_player", ":var14"),
            (str_store_troop_name, s1, ":var14"),
            (str_store_faction_name, s3, ":var16"),
            (str_store_string, s17, "@{s1} of {s3} managed to escape."),
            (display_log_message, "@{s17}"),
            (jump_to_menu, "mnu_enemy_slipped_away"),
            (assign, ":var0", 1),
          (else_try),
            (assign, "$talk_context", 9),
            (call_script, "script_setup_troop_meeting", ":var14", ":var15"),
            (assign, ":var0", 1),
          (try_end),
        (try_end),
        (eq, ":var0", 1),
      (else_try),
        (assign, ":var0", 0),
        (party_get_num_prisoner_stacks, ":var17", "p_encountered_party_backup"),
        (try_for_range, ":var13", "$last_freed_hero", ":var17"),
          (eq, ":var0", 0),
          (party_prisoner_stack_get_troop_id, ":var14", "p_encountered_party_backup", ":var13"),
          (troop_is_hero, ":var14"),
          (party_prisoner_stack_get_troop_dna, ":var15", "p_encountered_party_backup", ":var13"),
          (store_add, "$last_freed_hero", ":var13", 1),
          (assign, "$talk_context", 8),
          (call_script, "script_setup_troop_meeting", ":var14", ":var15"),
          (assign, ":var0", 1),
        (try_end),
        (eq, ":var0", 1),
      (else_try),
        (eq, "$capture_screen_shown", 0),
        (assign, "$capture_screen_shown", 1),
        (party_clear, "p_temp_party"),
        (assign, "$g_move_heroes", 0),
        (call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "p_collective_enemy"),
        (call_script, "script_party_add_party_prisoners", "p_temp_party", "p_collective_enemy"),
        (try_begin),
          (call_script, "script_party_calculate_strength", "p_collective_friends_backup", 0),
          (assign, ":var18", reg0),
          (gt, ":var18", 0),
          (call_script, "script_party_calculate_strength", "p_main_party_backup", 0),
          (assign, ":var19", reg0),
          (store_sub, ":var20", ":var18", ":var19"),
          (store_mul, ":var21", ":var20", 1000),
          (val_div, ":var21", ":var18"),
          (assign, "$pin_number", ":var21"),
          (party_clear, "p_temp_party_2"),
          (call_script, "script_move_members_with_ratio", "p_temp_party", "p_temp_party_2"),
          (try_begin),
            (gt, "$g_ally_party", 0),
            (distribute_party_among_party_group, "p_temp_party_2", "$g_ally_party"),
          (try_end),
        (try_end),
        (party_get_num_companions, ":var22", "p_temp_party"),
        (party_get_num_prisoners, ":var23", "p_temp_party"),
        (store_add, ":var24", ":var22", ":var23"),
        (gt, ":var24", 0),
        (change_screen_exchange_with_party, "p_temp_party"),
      (else_try),
        (eq, "$loot_screen_shown", 0),
        (assign, "$loot_screen_shown", 1),
        (try_begin),
          (gt, "$g_ally_party", 0),
          (call_script, "script_party_add_party", "$g_ally_party", "p_temp_party"),
        (else_try),
          (party_get_num_attached_parties, ":var25", "p_main_party"),
          (gt, ":var25", 0),
          (party_get_attached_party_with_rank, ":var26", "p_main_party", 0),
          (call_script, "script_party_add_party", ":var26", "p_temp_party"),
        (try_end),
        (troop_clear_inventory, "trp_temp_troop"),
        (call_script, "script_party_calculate_loot", "p_encountered_party_backup"),
        (gt, reg0, 0),
        (call_script, "script_replace_standard_ammo", "trp_temp_troop"),
        (call_script, "script_override_unuseable_items_sub", "trp_temp_troop"),
        (troop_sort_inventory, "trp_temp_troop"),
        (change_screen_loot, "trp_temp_troop"),
      (else_try),
        (try_begin),
          (le, "$g_ally_party", 0),
          (end_current_battle),
        (try_end),
        (call_script, "script_party_give_xp_and_gold", "p_encountered_party_backup"),
        (try_begin),
          (eq, "$g_enemy_party", 0),
          (display_message, "str_error_string"),
        (try_end),
        (call_script, "script_event_player_defeated_enemy_party", "$g_enemy_party"),
        (call_script, "script_clear_party_group", "$g_enemy_party"),
        (try_begin),
          (eq, "$g_next_menu", -1),
          (call_script, "script_post_battle_personality_clash_check"),
          (party_stack_get_troop_id, ":var27", "p_encountered_party_backup", 0),
          (try_begin),
            (is_between, ":var27", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
            (neg|is_between, "$g_encountered_party", "p_town_1", "p_salt_mine"),
            (store_troop_faction, ":var28", ":var27"),
            (try_begin),
              (eq, "$g_ally_party", 0),
              (call_script, "script_add_log_entry", 11, "trp_player", -1, ":var27", ":var28"),
              (try_begin),
                (eq, "$cheat_mode", 1),
                (display_message, "@Victory comment. Player was alone"),
              (try_end),
            (else_try),
              (ge, "$g_strength_contribution_of_player", 40),
              (call_script, "script_add_log_entry", 11, "trp_player", -1, ":var27", ":var28"),
              (try_begin),
                (eq, "$cheat_mode", 1),
                (display_message, "@Ordinary victory comment. The player provided at least 40 percent forces."),
              (try_end),
            (else_try),
              (gt, "$g_starting_strength_enemy_party", 1000),
              (call_script, "script_get_closest_center", "p_main_party"),
              (assign, ":var29", reg0),
              (call_script, "script_add_log_entry", 19, "trp_player", ":var29", -1, ":var28"),
              (try_begin),
                (eq, "$cheat_mode", 1),
                (display_message, "@Player participation comment. The enemy had at least 1k starting strength."),
              (try_end),
            (else_try),
              (eq, "$cheat_mode", 1),
              (display_message, "@No victory comment. The battle was small, and the player provided less than 40 percent of allied strength"),
            (try_end),
          (try_end),
          (val_add, "$g_total_victories", 1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      []
      ),
    ],
  ),

  ("enemy_slipped_away", 0,
    "{s17}",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_total_victory"),
      ]
      ),
    ],
  ),

  ("total_defeat", 0,
    "You shouldn't be reading this...",
    "none",
    [
      (play_track, "track_capture", 1),
      (party_get_num_prisoner_stacks, ":var0", "p_main_party"),
      (try_for_range, ":var1", 0, ":var0"),
        (party_prisoner_stack_get_troop_id, ":var2", "p_main_party", ":var1"),
        (troop_is_hero, ":var2"),
        (call_script, "script_remove_troop_from_prison", ":var2"),
      (try_end),
      (call_script, "script_loot_player_items", "$g_enemy_party"),
      (assign, "$g_move_heroes", 0),
      (party_clear, "p_temp_party"),
      (call_script, "script_party_add_party_prisoners", "p_temp_party", "p_main_party"),
      (call_script, "script_party_prisoners_add_party_companions", "p_temp_party", "p_main_party"),
      (distribute_party_among_party_group, "p_temp_party", "$g_enemy_party"),
      (call_script, "script_party_remove_all_companions", "p_main_party"),
      (assign, "$g_move_heroes", 1),
      (call_script, "script_party_remove_all_prisoners", "p_main_party"),
      (val_add, "$g_total_defeats", 1),
      (try_begin),
        (store_random_in_range, ":var3", 0, 100),
        (ge, ":var3", "$g_player_luck"),
        (jump_to_menu, "mnu_permanent_damage"),
      (else_try),
        (try_begin),
          (eq, "$g_next_menu", -1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$g_ally_party", 0),
        (call_script, "script_party_wound_all_members", "$g_ally_party"),
      (try_end),
      (party_get_num_companion_stacks, ":var4", "p_encountered_party_backup"),
      (try_for_range, ":var1", 0, ":var4"),
        (party_stack_get_troop_id, ":var2", "p_encountered_party_backup", ":var1"),
        (is_between, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (store_troop_faction, ":var5", ":var2"),
        (call_script, "script_add_log_entry", 14, "trp_player", -1, ":var2", ":var5"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("permanent_damage", mnf_disable_all_keys,
    "{s0}",
    "none",
    [
      (assign, ":var0", 1),
      (try_for_range, ":var1", 0, ":var0"),
        (store_random_in_range, ":var2", 0, 4),
        (store_attribute_level, ":var3", "trp_player", ":var2"),
        (try_begin),
          (gt, ":var3", 3),
          (neq, ":var2", 3),
          (try_begin),
            (eq, ":var2", 0),
            (str_store_string, s0, "@Some of your tendons have been damaged in the battle. You lose 1 strength."),
          (else_try),
            (eq, ":var2", 1),
            (str_store_string, s0, "@You took a nasty wound which will cause you to limp slightly even after it heals. Your lose 1 agility."),
          (else_try),
            (str_store_string, s0, "@You have trouble thinking straight after the battle, perhaps from a particularly hard hit to your head, and frequent headaches now plague your existence. Your intelligence is reduced by 1."),
          (try_end),
        (else_try),
          (lt, ":var0", 200),
          (val_add, ":var0", 1),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var0", 200),
        (try_begin),
          (eq, "$g_next_menu", -1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      (else_try),
        (troop_raise_attribute, "trp_player", ":var2", -1),
      (try_end),
    ],
    [
      ("s0",
      [
        (store_random_in_range, ":var0", 0, 4),
        (try_begin),
          (eq, ":var0", 0),
          (str_store_string, s0, "@Perhaps I'm getting unlucky..."),
        (else_try),
          (eq, ":var0", 1),
          (str_store_string, s0, "@Retirement is starting to sound better and better."),
        (else_try),
          (eq, ":var0", 2),
          (str_store_string, s0, "@No matter! I will persevere!"),
        (else_try),
          (eq, ":var0", 3),
          (troop_get_type, ":var1", "trp_player"),
          (try_begin),
            (eq, ":var1", 1),
            (str_store_string, s0, "@What did I do to deserve this?"),
          (else_try),
            (str_store_string, s0, "@I suppose it'll make for a good story, at least..."),
          (try_end),
        (try_end),
      ],
      "{s0}",
      [
        (try_begin),
          (eq, "$g_next_menu", -1),
          (leave_encounter),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "$g_next_menu"),
        (try_end),
      ]
      ),
    ],
  ),

  ("pre_join", 0,
    "You come across a battle between {s2} and {s1}. You decide to...",
    "none",
    [
      (str_store_party_name, s1, "$g_encountered_party"),
      (str_store_party_name, s2, "$g_encountered_party_2"),
    ],
    [
      ("pre_join_help_attackers",
      [],
      "Move_in_to_help_the_{s2}.",
      [
        (select_enemy, 0),
        (assign, "$g_enemy_party", "$g_encountered_party"),
        (assign, "$g_ally_party", "$g_encountered_party_2"),
        (jump_to_menu, "mnu_join_battle"),
      ]
      ),

      ("pre_join_help_defenders",
      [],
      "Rush_to_the_aid_of_the_{s1}.",
      [
        (select_enemy, 1),
        (assign, "$g_enemy_party", "$g_encountered_party_2"),
        (assign, "$g_ally_party", "$g_encountered_party"),
        (jump_to_menu, "mnu_join_battle"),
      ]
      ),

      ("pre_join_leave",
      [],
      "Don't_get_involved.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("join_battle", 0,
    "You are helping {s2} against {s1}. You have {reg10} troops fit for battle against the enemy's {reg11}.",
    "none",
    [
      (str_store_party_name, s1, "$g_enemy_party"),
      (str_store_party_name, s2, "$g_ally_party"),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (call_script, "script_encounter_init_variables"),
      (else_try),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (try_end),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":var0", reg0),
        (assign, ":var1", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (eq, ":var0", 0),
          (assign, ":var1", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var1", 1),
        (try_end),
        (this_or_next|eq, ":var1", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", -1),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
        (assign, ":var2", reg0),
        (assign, ":var3", 0),
        (try_begin),
          (eq, "$g_battle_result", -1),
          (eq, ":var2", 0),
          (assign, ":var3", 1),
        (try_end),
        (this_or_next|eq, ":var3", 1),
        (eq, "$g_player_surrenders", 1),
        (leave_encounter),
        (change_screen_return),
      (try_end),
    ],
    [
      ("join_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Charge_the_enemy.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (assign, "$g_battle_result", 0),
        (try_begin),
          (eq, "$g_engaged_enemy", 0),
          (store_faction_of_party, ":var0", "$g_ally_party"),
          (store_faction_of_party, ":var1", "$g_enemy_party"),
          (call_script, "script_change_player_relation_with_faction", ":var0", 3),
          (call_script, "script_change_player_relation_with_faction", ":var1", -3),
        (try_end),
        (assign, "$g_engaged_enemy", 1),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (set_jump_mission, "mt_lead_charge"),
        (try_begin),
          (this_or_next|eq, "$g_encountered_party_template", "pt_merchant_caravan"),
          (this_or_next|eq, "$g_encountered_party_template", "pt_village_caravan"),
          (eq, "$g_encountered_party_template", "pt_stagecoach"),
          (store_random_in_range, ":var2", "scn_stagecoach_ambush_desert", "scn_particle_test"),
        (else_try),
          (call_script, "script_setup_generic_battle_scene", 0),
          (assign, ":var2", reg0),
        (try_end),
        (store_random_in_range, ":var3", 1, 100),
        (try_begin),
          (gt, ":var3", 10),
          (try_begin),
            (assign, ":var4", 0),
            (call_script, "script_party_count_fit_for_battle", "p_main_party"),
            (val_add, ":var4", reg0),
            (call_script, "script_party_count_fit_for_battle", "p_collective_friends"),
            (val_add, ":var4", reg0),
            (call_script, "script_party_count_fit_for_battle", "p_collective_enemy"),
            (assign, ":var5", reg0),
            (val_add, ":var4", reg0),
            (try_begin),
              (eq, "$cheat_mode", 1),
              (assign, reg0, ":var4"),
              (display_message, "@Total number of battle participants: {reg0}"),
            (try_end),
          (try_end),
          (try_begin),
            (this_or_next|le, ":var4", 20),
            (le, ":var5", 10),
            (call_script, "script_setup_random_scene", 1),
          (else_try),
            (call_script, "script_setup_random_scene", 0),
          (try_end),
        (else_try),
          (jump_to_scene, ":var2"),
        (try_end),
        (assign, "$g_next_menu", "mnu_join_battle"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("join_order_attack",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (ge, reg0, 3),
      ],
      "Order_your_troops_to_attack_with_your_allies_while_you_stay_back.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (eq, "$g_engaged_enemy", 0),
          (store_faction_of_party, ":var0", "$g_ally_party"),
          (store_faction_of_party, ":var1", "$g_enemy_party"),
          (call_script, "script_change_player_relation_with_faction", ":var0", 3),
          (call_script, "script_change_player_relation_with_faction", ":var1", -3),
        (try_end),
        (assign, "$g_engaged_enemy", 1),
        (jump_to_menu, "mnu_join_order_attack"),
      ]
      ),

      ("join_leave",
      [],
      "Leave.",
      [
        (try_begin),
          (neg|troop_is_wounded, "trp_player"),
          (call_script, "script_objectionable_action", 1, "str_flee_battle"),
          (party_stack_get_troop_id, ":var0", "$g_enemy_party", 0),
          (call_script, "script_add_log_entry", 15, "trp_player", -1, ":var0", -1),
          (display_message, "@Player retreats from battle"),
        (try_end),
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("join_order_attack", mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allied casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (call_script, "script_party_calculate_strength", "p_main_party", 1),
      (assign, ":var0", reg0),
      (val_div, ":var0", 5),
      (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
      (assign, ":var1", reg0),
      (val_div, ":var1", 5),
      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":var2", reg0),
      (val_div, ":var2", 5),
      (assign, ":var3", ":var2"),
      (val_mul, ":var3", ":var0"),
      (val_div, ":var3", ":var1"),
      (val_sub, ":var2", ":var3"),
      (inflict_casualties_to_party_group, "p_main_party", ":var3", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_enemy_party", ":var1", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),
      (call_script, "script_collect_friendly_parties"),
      (inflict_casualties_to_party_group, "$g_ally_party", ":var2", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_join_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0),
        (assign, "$g_battle_result", 1),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_join_order_attack_success"),
      (else_try),
        (str_store_string, s4, "str_join_order_attack_continue"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_join_battle"),
      ]
      ),
    ],
  ),

  ("zendar", mnf_auto_enter,
    "You enter the town of Zendar.",
    "none",
    [
      (reset_price_rates, 0),
      (set_price_rate_for_item, "itm_tools", 70),
      (set_price_rate_for_item, "itm_deer_hide", 140),
    ],
    [
      ("zendar_enter",
      [],
      "none",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_zendar_center"),
        (change_screen_mission),
      ]
,
      "Door_to_the_town_center."
      ),

      ("zendar_tavern",
      [],
      "none",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_the_happy_boar"),
        (change_screen_mission),
      ]
,
      "Door_to_the_tavern."
      ),

      ("zendar_merchant",
      [],
      "none",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_zendar_merchant"),
        (change_screen_mission),
      ]
,
      "Door_to_the_merchant."
      ),

      ("zendar_arena",
      [],
      "none",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_zendar_arena"),
        (change_screen_mission),
      ]
,
      "Door_to_the_arena."
      ),

      ("town_1_leave",
      [],
      "none",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("salt_mine", mnf_auto_enter,
    "You enter the salt mine.",
    "none",
    [
      (reset_price_rates, 0),
      (set_price_rate_for_item, "itm_deer_hide", 55),
    ],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_town_center"),
        (jump_to_scene, "scn_salt_mine"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("four_ways_inn", mnf_auto_enter,
    "You arrive at the Four Ways Inn.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_camera_test"),
        (jump_to_scene, "scn_four_ways_inn"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("test_scene", mnf_auto_enter,
    "You enter the test scene.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_test_scene"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("battlefields", 0,
    "Select a field...",
    "none",
    [],
    [
      ("enter_f1",
      [],
      "Field_1",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_1"),
        (change_screen_mission),
      ]
      ),

      ("enter_f2",
      [],
      "Field_2",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_2"),
        (change_screen_mission),
      ]
      ),

      ("enter_f3",
      [],
      "Field_3",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_3"),
        (change_screen_mission),
      ]
      ),

      ("enter_f4",
      [],
      "Field_4",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_4"),
        (change_screen_mission),
      ]
      ),

      ("enter_f5",
      [],
      "Field_5",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "scn_field_5"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("dhorak_keep", 0,
    "You enter the Dhorak Keep",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_town_center"),
        (jump_to_scene, "scn_dhorak_keep"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("target", mnf_auto_enter,
    "You enter a secret criminal hideout.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (try_begin),
          (check_quest_active, "qst_hideout"),
          (set_jump_mission, "mt_hideout"),
          (modify_visitors_at_site, "scn_hideout"),
          (reset_visitors),
          (store_random_in_range, ":var0", 2, 5),
          (set_visitors, 1, "trp_thief", 1),
          (set_visitors, 2, "trp_fighter_woman", 1),
          (set_visitors, 3, "trp_horse_thief", ":var0"),
          (set_visitors, 4, "trp_burglar", 1),
          (set_visitors, 5, "trp_hired_sharpshooter", 1),
        (else_try),
          (check_quest_active, "qst_hideout2"),
          (set_jump_mission, "mt_hideout2"),
          (modify_visitors_at_site, "scn_hideout"),
          (reset_visitors),
          (store_character_level, ":var1", "trp_player"),
          (store_random_in_range, ":var0", 3, ":var1"),
          (set_visitors, 0, "trp_deputy_sheriff", 1),
          (set_visitors, 1, "trp_state_militia", ":var0"),
          (set_visitors, 2, "trp_county_militia", 10),
          (set_visitors, 3, "trp_horse_thief", 5),
          (set_visitors, 4, "trp_hired_sharpshooter", 1),
        (try_end),
        (jump_to_scene, "scn_hideout"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("steamboat_heist", mnf_auto_enter,
    "Your travels come to an abrupt halt as the steamer runs aground on one of the rivers many shifting sandbars.  You await below deck as the crew works to free the vessel.  You're about to nod off when you hear the cry of 'BANDITS! BANDITS!'  You grab your weapons and rush on deck as the first shots begin to fly.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_steamboat_ambush"),
        (modify_visitors_at_site, "scn_steamboat2"),
        (reset_visitors),
        (store_random_in_range, ":var0", 2, 5),
        (store_random_in_range, ":var1", 2, 6),
        (set_visitors, 1, "trp_regular", ":var1"),
        (set_visitors, 2, "trp_hired_sharpshooter", 1),
        (set_visitors, 3, "trp_hired_sharpshooter", 1),
        (set_visitors, 4, "trp_burglar", ":var0"),
        (set_visitors, 5, "trp_rustler", ":var1"),
        (jump_to_scene, "scn_steamboat2"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("steamboat_heist2", mnf_auto_enter,
    "Your steamboat was ambushed by egg suckin, chicken stealin, gutter trash.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_steamboat_ambush2"),
        (modify_visitors_at_site, "scn_steamboat2"),
        (reset_visitors),
        (store_random_in_range, ":var0", 2, 5),
        (store_random_in_range, ":var1", 2, 6),
        (set_visitors, 1, "trp_regular", ":var1"),
        (set_visitors, 2, "trp_hired_sharpshooter", 1),
        (set_visitors, 3, "trp_hired_sharpshooter", 1),
        (set_visitors, 4, "trp_burglar", ":var0"),
        (set_visitors, 5, "trp_rustler", ":var1"),
        (jump_to_scene, "scn_steamboat2"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("steamboat_ambush", mnf_auto_enter,
    "Your travels come to an abrupt halt as the steamer runs aground on one of the rivers many shifting sandbars.  You await below deck as the crew works to free the vessel.  You're about to nod off when you hear the cry of 'BANDITS! BANDITS!'  You grab your weapons and rush on deck as the first shots begin to fly.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_steamboat_ambush"),
        (modify_visitors_at_site, "scn_steamboat2"),
        (reset_visitors),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (store_random_in_range, ":var0", 2, reg0),
        (set_visitors, 1, "trp_regular", ":var0"),
        (set_visitors, 2, "trp_mountain_bandit", ":var0"),
        (set_visitors, 3, "trp_burglar", ":var0"),
        (try_begin),
          (lt, reg0, 10),
          (set_visitors, 4, "trp_hired_sharpshooter", 1),
        (else_try),
          (set_visitors, 4, "trp_dynamite_thrower", 1),
        (try_end),
        (try_begin),
          (lt, ":var0", 5),
          (set_visitors, 5, "trp_mountain_bandit", ":var0"),
        (try_end),
        (jump_to_scene, "scn_steamboat2"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("steamboat_ambush2", mnf_auto_enter,
    "Your steamboat was ambushed by local gangs.",
    "none",
    [],
    [
      ("enter",
      [],
      "Enter.",
      [
        (set_jump_mission, "mt_steamboat_ambush2"),
        (modify_visitors_at_site, "scn_steamboat2"),
        (reset_visitors),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (store_random_in_range, ":var0", 2, reg0),
        (set_visitors, 1, "trp_regular", ":var0"),
        (set_visitors, 2, "trp_mountain_bandit", ":var0"),
        (set_visitors, 3, "trp_burglar", ":var0"),
        (try_begin),
          (lt, reg0, 10),
          (set_visitors, 4, "trp_hired_sharpshooter", 1),
        (else_try),
          (set_visitors, 4, "trp_dynamite_thrower", 1),
        (try_end),
        (try_begin),
          (lt, ":var0", 5),
          (set_visitors, 5, "trp_mountain_bandit", ":var0"),
        (try_end),
        (jump_to_scene, "scn_steamboat2"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("join_siege_outside", mnf_scale_picture,
    "{s1} has come under siege by {s2}.",
    "none",
    [
      (str_store_party_name, s1, "$g_encountered_party"),
      (str_store_party_name, s2, "$g_encountered_party_2"),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_siege_sighted_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
    ],
    [
      ("approach_besiegers",
      [
        (store_faction_of_party, ":var0", "$g_encountered_party_2"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (ge, ":var1", 0),
        (store_faction_of_party, ":var0", "$g_encountered_party"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (lt, ":var1", 0),
      ],
      "Approach_the_siege_camp.",
      [
        (jump_to_menu, "mnu_besiegers_camp_with_allies"),
      ]
      ),

      ("pass_through_siege",
      [
        (store_faction_of_party, ":var0", "$g_encountered_party"),
        (store_relation, ":var1", ":var0", "fac_player_supporters_faction"),
        (ge, ":var1", 0),
      ],
      "Pass_through_the_siege_lines_and_enter_{s1}.",
      [
        (jump_to_menu, "mnu_cut_siege_without_fight"),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("cut_siege_without_fight", 0,
    "The besiegers let you approach the gates without challenge.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (this_or_next|eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
          (eq, "$g_encountered_party_faction", "$players_kingdom"),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (jump_to_menu, "mnu_castle_outside"),
        (try_end),
      ]
      ),
    ],
  ),

  ("besiegers_camp_with_allies", 0,
    "{s1} remains under siege. The banners of {s2} fly above the camp of the besiegers, where you and your men are welcomed.",
    "none",
    [
      (str_store_party_name, s1, "$g_encountered_party"),
      (str_store_party_name, s2, "$g_encountered_party_2"),
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", "$g_encountered_party_2"),
      (select_enemy, 0),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (call_script, "script_encounter_init_variables"),
      (try_end),
      (try_begin),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (else_try),
        (assign, ":var0", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":var0", 1),
        (else_try),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var0", 1),
        (try_end),
        (this_or_next|eq, ":var0", 1),
        (eq, "$g_enemy_surrenders", 1),
        (call_script, "script_party_wound_all_members", "$g_enemy_party"),
        (leave_encounter),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
        (assign, ":var1", reg0),
        (eq, "$g_battle_result", -1),
        (eq, ":var1", 0),
        (leave_encounter),
        (change_screen_return),
      (try_end),
    ],
    [
      ("talk_to_siege_commander",
      [],
      "_Request_a_meeting_with_the_commander.",
      [
        (modify_visitors_at_site, "scn_conversation_scene"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (party_stack_get_troop_id, ":var0", "$g_encountered_party_2", 0),
        (party_stack_get_troop_dna, ":var1", "$g_encountered_party_2", 0),
        (set_visitor, 17, ":var0", ":var1"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, "scn_conversation_scene"),
        (assign, "$talk_context", 4),
        (change_screen_map_conversation, ":var0"),
      ]
      ),

      ("join_siege_with_allies",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Join_the_next_assault.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", 1, "$g_encountered_party"),
          (add_xp_as_reward, 250),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          (faction_get_slot, ":var0", "$players_kingdom", 7),
          (str_store_troop_name_link, s9, ":var0"),
          (setup_quest_text, "qst_follow_army"),
          (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
          (call_script, "script_start_quest", "qst_follow_army", ":var0"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (try_begin),
            (troop_get_slot, ":var1", "trp_party_source_party", "$g_encountered_party"),
            (gt, ":var1", 0),
            (party_get_slot, ":var2", ":var1", 10),
          (else_try),
            (party_get_slot, ":var2", "$g_encountered_party", 10),
          (try_end),
        (else_try),
          (party_get_slot, ":var2", "$g_encountered_party", 10),
        (try_end),
        (call_script, "script_calculate_battle_advantage"),
        (val_mul, reg0, 2),
        (val_div, reg0, 3),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (try_begin),
          (set_jump_mission, "mt_town_attack"),
        (else_try),
          (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (try_end),
        (jump_to_scene, ":var2"),
        (assign, "$g_siege_final_menu", "mnu_besiegers_camp_with_allies"),
        (assign, "$g_siege_battle_state", 1),
        (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("join_siege_stay_back",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (ge, reg0, 3),
      ],
      "Order_your_soldiers_to_join_the_next_assault_without_you.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (try_begin),
          (check_quest_active, "qst_join_siege_with_army"),
          (quest_slot_eq, "qst_join_siege_with_army", 1, "$g_encountered_party"),
          (add_xp_as_reward, 100),
          (call_script, "script_end_quest", "qst_join_siege_with_army"),
          (faction_get_slot, ":var0", "$players_kingdom", 7),
          (str_store_troop_name_link, s9, ":var0"),
          (setup_quest_text, "qst_follow_army"),
          (str_store_string, s2, "@{s9} wants you to follow his army until further notice."),
          (call_script, "script_start_quest", "qst_follow_army", ":var0"),
          (assign, "$g_player_follow_army_warnings", 0),
        (try_end),
        (jump_to_menu, "mnu_castle_attack_walls_with_allies_simulate"),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("castle_outside", 0,
    "You are outside {s2}.{s11} {s3} {s4}",
    "none",
    [
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, s2, "$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),
      (assign, "$all_doors_locked", 1),
      (assign, "$current_town", "$g_encountered_party"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (call_script, "script_let_nearby_parties_join_current_battle", 1, 0),
        (call_script, "script_encounter_init_variables"),
        (assign, "$entry_to_town_forbidden", 0),
        (assign, "$sneaked_into_town", 0),
        (assign, "$town_entered", 0),
        (assign, "$encountered_party_hostile", 0),
        (assign, "$encountered_party_friendly", 0),
        (try_begin),
          (gt, "$g_player_besiege_town", 0),
          (neq, "$g_player_besiege_town", "$g_encountered_party"),
          (party_slot_eq, "$g_player_besiege_town", 54, "p_main_party"),
          (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
          (assign, "$g_player_besiege_town", -1),
        (try_end),
        (try_begin),
          (lt, "$g_encountered_party_relation", 0),
          (assign, "$entry_to_town_forbidden", 1),
        (try_end),
        (assign, "$cant_sneak_into_town", 0),
        (try_begin),
          (eq, "$current_town", "$last_sneak_attempt_town"),
          (store_current_hours, reg2),
          (val_sub, reg2, "$last_sneak_attempt_time"),
          (lt, reg2, 12),
          (assign, "$cant_sneak_into_town", 1),
        (try_end),
      (else_try),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (try_end),
      (str_clear, s4),
      (try_begin),
        (eq, "$entry_to_town_forbidden", 1),
        (try_begin),
          (eq, "$cant_sneak_into_town", 1),
          (str_store_string, s4, "str_sneaking_to_town_impossible"),
        (else_try),
          (str_store_string, s4, "str_entrance_to_town_forbidden"),
        (try_end),
      (try_end),
      (party_get_slot, ":var0", "$current_town", 7),
      (store_faction_of_party, ":var1", "$current_town"),
      (str_store_faction_name, s9, ":var1"),
      (try_begin),
        (ge, ":var0", 0),
        (str_store_troop_name, s8, ":var0"),
        (str_store_string, s7, "@{s8} of {s9}"),
      (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 2),
        (try_begin),
          (eq, ":var0", "trp_player"),
          (str_store_string, s11, "@ You control this fort."),
        (else_try),
          (ge, ":var0", 0),
          (str_store_string, s11, "@ This fort is under the control of {s7}."),
        (else_try),
          (str_store_string, s11, "@ This fort seems to be controlled by no one."),
        (try_end),
      (else_try),
        (try_begin),
          (eq, ":var0", "trp_player"),
          (str_store_string, s11, "@ You control this town."),
        (else_try),
          (ge, ":var0", 0),
          (str_store_string, s11, "@ This town is under the control of {s7}."),
        (else_try),
          (str_store_string, s11, "@ The townsfolk here have declared their independence."),
        (try_end),
      (try_end),
      (party_get_num_companions, reg7, "p_collective_enemy"),
      (assign, "$castle_undefended", 0),
      (str_clear, s3),
      (try_begin),
        (eq, reg7, 0),
        (assign, "$castle_undefended", 1),
        (str_store_string, s3, "str_castle_is_abondened"),
      (else_try),
        (eq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (str_store_string, s3, "str_place_is_occupied_by_player"),
      (else_try),
        (lt, "$g_encountered_party_relation", 0),
        (str_store_string, s3, "str_place_is_occupied_by_enemy"),
      (else_try),
      (try_end),
      (try_begin),
        (eq, "$g_leave_town_outside", 1),
        (assign, "$g_leave_town_outside", 0),
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return),
      (else_try),
        (check_quest_active, "qst_escort_lady"),
        (quest_slot_eq, "qst_escort_lady", 1, "$g_encountered_party"),
        (quest_get_slot, ":var2", "qst_escort_lady", 4),
        (modify_visitors_at_site, "scn_conversation_scene"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, ":var2"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, "scn_conversation_scene"),
        (assign, "$talk_context", 10),
        (change_screen_map_conversation, ":var2"),
      (else_try),
        (check_quest_active, "qst_kidnapped_girl"),
        (quest_slot_eq, "qst_kidnapped_girl", 12, "$g_encountered_party"),
        (quest_slot_eq, "qst_kidnapped_girl", 11, 3),
        (modify_visitors_at_site, "scn_conversation_scene"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, "trp_kidnapped_girl"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, "scn_conversation_scene"),
        (assign, "$talk_context", 10),
        (change_screen_map_conversation, "trp_kidnapped_girl"),
      (else_try),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
        (jump_to_menu, "mnu_town"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 7, "trp_player"),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (jump_to_menu, "mnu_enter_your_own_castle"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (ge, "$g_encountered_party_relation", 0),
        (this_or_next|eq, "$castle_undefended", 1),
        (eq, "$g_permitted_to_center", 1),
        (jump_to_menu, "mnu_town"),
      (else_try),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (ge, "$g_encountered_party_relation", 0),
        (jump_to_menu, "mnu_town"),
      (else_try),
        (eq, "$g_player_besiege_town", "$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
      (try_end),
    ],
    [
      ("approach_gates",
      [
        (this_or_next|eq, "$entry_to_town_forbidden", 1),
        (party_slot_eq, "$g_encountered_party", 0, 2),
      ],
      "Approach_the_gates_and_hail_the_guard.",
      [
        (jump_to_menu, "mnu_castle_guard"),
      ]
      ),

      ("town_sneak",
      [
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (eq, "$entry_to_town_forbidden", 1),
        (eq, "$cant_sneak_into_town", 0),
      ],
      "Disguise_yourself_and_try_to_sneak_into_the_town.",
      [
        (faction_get_slot, ":var0", "$g_encountered_party_faction", 30),
        (party_get_num_companions, ":var1", "p_main_party"),
        (party_get_num_prisoners, ":var2", "p_main_party"),
        (val_add, ":var1", ":var2"),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (store_add, ":var3", ":var0", ":var1"),
        (store_random_in_range, ":var4", 0, 100),
        (try_begin),
          (this_or_next|ge, ":var4", ":var3"),
          (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
          (assign, "$g_last_defeated_bandits_town", 0),
          (assign, "$sneaked_into_town", 1),
          (assign, "$town_entered", 1),
          (jump_to_menu, "mnu_sneak_into_town_suceeded"),
        (else_try),
          (jump_to_menu, "mnu_sneak_into_town_caught"),
        (try_end),
      ]
      ),

      ("castle_start_siege",
      [
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 1),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (str_store_string, s6, "@town"),
        (else_try),
          (party_slot_eq, "$g_encountered_party", 0, 2),
          (str_store_string, s6, "@fort"),
        (else_try),
          (str_store_string, s6, "@hotel"),
        (try_end),
      ],
      "Besiege_this_{s6}.",
      [
        (assign, "$g_player_besiege_town", "$g_encountered_party"),
        (store_relation, ":var0", "fac_player_supporters_faction", "$g_encountered_party_faction"),
        (val_min, ":var0", -40),
        (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var0"),
        (call_script, "script_update_all_notes"),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("cheat_castle_start_siege",
      [
        (eq, "$cheat_mode", 1),
        (this_or_next|party_slot_eq, "$g_encountered_party", 54, -1),
        (party_slot_eq, "$g_encountered_party", 54, "p_main_party"),
        (store_relation, ":var0", "$g_encountered_party_faction", "fac_player_supporters_faction"),
        (ge, ":var0", 0),
        (lt, "$g_encountered_party_2", 1),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 1),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (assign, reg6, 1),
        (else_try),
          (assign, reg6, 0),
        (try_end),
      ],
      "CHEAT:_Besiege_the_{reg6?town:castle}...",
      [
        (assign, "$g_player_besiege_town", "$g_encountered_party"),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("castle_leave",
      [],
      "Leave.",
      [
        (change_screen_return, 0),
      ]
      ),

      ("castle_cheat_interior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT!_Interior.",
      [
        (set_jump_mission, "mt_ai_training"),
        (party_get_slot, ":var0", "$current_town", 11),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_exterior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT!_Exterior.",
      [
        (set_jump_mission, "mt_ai_training"),
        (party_get_slot, ":var0", "$current_town", 10),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_town_walls",
      [
        (eq, "$cheat_mode", 1),
        (party_slot_eq, "$current_town", 0, 3),
      ],
      "CHEAT!_Town_Walls.",
      [
        (party_get_slot, ":var0", "$current_town", 18),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("castle_guard", 0,
    "You approach the gate. The men on the walls watch you closely.",
    "none",
    [],
    [
      ("request_shelter",
      [
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (ge, "$g_encountered_party_relation", 0),
      ],
      "Request_entry_to_the_fort.",
      [
        (party_get_slot, ":var0", "$g_encountered_party", 7),
        (try_begin),
          (lt, ":var0", 0),
          (jump_to_menu, "mnu_castle_entry_granted"),
        (else_try),
          (call_script, "script_troop_get_player_relation", ":var0"),
          (assign, ":var1", reg0),
          (try_begin),
            (gt, ":var1", -15),
            (jump_to_menu, "mnu_castle_entry_granted"),
          (else_try),
            (jump_to_menu, "mnu_castle_entry_denied"),
          (try_end),
        (try_end),
      ]
      ),

      ("request_meeting_commander",
      [],
      "Request_a_meeting_with_someone.",
      [
        (jump_to_menu, "mnu_castle_meeting"),
      ]
      ),

      ("guard_leave",
      [],
      "Leave.",
      [
        (change_screen_return, 0),
      ]
      ),
    ],
  ),

  ("castle_entry_granted", 0,
    "After a brief wait, the guards open the gates for you and allow your party inside.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("castle_entry_denied", 0,
    "The commander of this fort has forbidden you from coming inside these walls, and the guard sergeant informs you that his men will fire if you attempt to come any closer.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_castle_guard"),
      ]
      ),
    ],
  ),

  ("castle_meeting", 0,
    "With whom do you want to meet?",
    "none",
    [
      (assign, "$num_castle_meeting_troops", 0),
      (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var0", 2, 2),
        (call_script, "script_get_troop_attached_party", ":var0"),
        (eq, "$g_encountered_party", reg0),
        (troop_set_slot, "trp_temp_array_a", "$num_castle_meeting_troops", ":var0"),
        (val_add, "$num_castle_meeting_troops", 1),
      (try_end),
    ],
    [
      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 0),
        (troop_get_slot, ":var0", "trp_temp_array_a", 0),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 0),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 1),
        (troop_get_slot, ":var0", "trp_temp_array_a", 1),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 1),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 2),
        (troop_get_slot, ":var0", "trp_temp_array_a", 2),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 2),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("guard_meet_s5",
      [
        (gt, "$num_castle_meeting_troops", 3),
        (troop_get_slot, ":var0", "trp_temp_array_a", 3),
        (str_store_troop_name, s5, ":var0"),
      ],
      "{s5}.",
      [
        (troop_get_slot, "$castle_meeting_selected_troop", "trp_temp_array_a", 3),
        (jump_to_menu, "mnu_castle_meeting_selected"),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_castle_guard"),
      ]
      ),
    ],
  ),

  ("castle_meeting_selected", 0,
    "Your request for a meeting is relayed inside, and finally {s6} appears in the courtyard to speak with you.",
    "none",
    [
      (str_store_troop_name, s6, "$castle_meeting_selected_troop"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_castle_outside"),
        (modify_visitors_at_site, "scn_conversation_scene"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, "$castle_meeting_selected_troop"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, "scn_conversation_scene"),
        (assign, "$talk_context", 3),
        (change_screen_map_conversation, "$castle_meeting_selected_troop"),
      ]
      ),
    ],
  ),

  ("castle_besiege", mnf_scale_picture,
    "You are laying siege to {s1}. {s2} {s3}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_siege_sighted_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
      (assign, "$g_siege_force_wait", 0),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 54, -1),
        (party_set_slot, "$g_encountered_party", 54, "p_main_party"),
        (store_current_hours, ":var1"),
        (party_set_slot, "$g_encountered_party", 64, ":var1"),
        (assign, "$g_siege_method", 0),
        (assign, "$g_siege_sallied_out_once", 0),
      (try_end),
      (party_get_slot, ":var2", "$g_encountered_party", 53),
      (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
      (assign, ":var3", reg0),
      (assign, reg7, ":var3"),
      (assign, reg8, ":var2"),
      (store_div, reg3, ":var2", ":var3"),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (assign, reg6, 1),
      (else_try),
        (assign, reg6, 0),
      (try_end),
      (try_begin),
        (gt, reg3, 0),
        (str_store_string, s2, "@The {reg6?town's:castle's} food stores should last for {reg3} more days."),
      (else_try),
        (str_store_string, s2, "@The {reg6?town's:castle's} food stores have run out and the defenders are starving."),
      (try_end),
      (str_store_string, s3, "str_empty_string"),
      (try_begin),
        (ge, "$g_siege_method", 1),
        (store_current_hours, ":var1"),
        (try_begin),
          (lt, ":var1", "$g_siege_method_finish_hours"),
          (store_sub, reg9, "$g_siege_method_finish_hours", ":var1"),
          (try_begin),
            (eq, "$g_siege_method", 1),
            (str_store_string, s3, "@You're preparing to attack the walls. The work should finish in {reg9} hours."),
          (else_try),
            (eq, "$g_siege_method", 2),
            (str_store_string, s3, "@Your forces are building a siege tower. They estimate another {reg9} hours to complete the build."),
          (try_end),
        (else_try),
          (try_begin),
            (eq, "$g_siege_method", 1),
            (str_store_string, s3, "@You are ready to attack the walls at any time."),
          (else_try),
            (eq, "$g_siege_method", 2),
            (str_store_string, s3, "@The siege tower is built and ready to make an assault."),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (eq, "$g_castle_left_to_player", 1),
        (assign, "$g_castle_left_to_player", 0),
        (store_faction_of_party, ":var4", "$g_encountered_party"),
        (party_set_faction, "$g_encountered_party", "fac_neutral"),
        (party_get_num_attached_parties, ":var5", "$g_encountered_party"),
        (try_for_range_backwards, ":var6", 0, ":var5"),
          (party_get_attached_party_with_rank, ":var7", "$g_encountered_party", ":var6"),
          (party_detach, ":var7"),
          (party_get_slot, ":var8", ":var7", 0),
          (eq, ":var8", 13),
          (store_faction_of_party, ":var9", ":var7"),
          (call_script, "script_get_closest_walled_center_of_faction", ":var7", ":var9"),
          (try_begin),
            (gt, reg0, 0),
            (call_script, "script_party_set_ai_state", ":var7", 7, reg0),
          (else_try),
            (call_script, "script_party_set_ai_state", ":var7", 4, "$g_encountered_party"),
          (try_end),
        (try_end),
        (call_script, "script_party_remove_all_companions", "$g_encountered_party"),
        (change_screen_return),
        (party_collect_attachments_to_party, "$g_encountered_party", "p_collective_enemy"),
        (call_script, "script_party_copy", "p_encountered_party_backup", "p_collective_enemy"),
        (party_set_faction, "$g_encountered_party", ":var4"),
      (try_end),
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (str_store_party_name, s1, "$g_encountered_party"),
      (call_script, "script_encounter_calculate_fit"),
      (assign, reg11, "$g_enemy_fit_for_battle"),
      (assign, reg10, "$g_friend_fit_for_battle"),
      (try_begin),
        (eq, "$g_leave_encounter", 1),
        (change_screen_return),
      (else_try),
        (call_script, "script_party_count_fit_regulars", "p_collective_enemy"),
        (assign, ":var10", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (assign, ":var10", 1),
        (else_try),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var10", 1),
        (try_end),
        (this_or_next|eq, ":var10", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", "mnu_castle_taken"),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":var11", reg0),
        (eq, "$g_battle_result", -1),
        (eq, ":var11", 0),
        (assign, "$g_next_menu", "mnu_captivity_start_castle_defeat"),
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
    ],
    [
      ("siege_request_meeting",
      [
        (eq, "$cant_talk_to_enemy", 0),
      ],
      "Call_for_a_meeting_with_the_fort_commander.",
      [
        (assign, "$cant_talk_to_enemy", 1),
        (assign, "$g_enemy_surrenders", 0),
        (assign, "$g_castle_left_to_player", 0),
        (assign, "$talk_context", 7),
        (party_get_num_attached_parties, ":var0", "$g_encountered_party"),
        (try_begin),
          (gt, ":var0", 0),
          (party_get_attached_party_with_rank, ":var1", "$g_encountered_party", 0),
          (call_script, "script_setup_party_meeting", ":var1"),
        (else_try),
          (call_script, "script_setup_party_meeting", "$g_encountered_party"),
        (try_end),
      ]
      ),

      ("wait_24_hours",
      [],
      "Wait_until_tomorrow.",
      [
        (assign, "$auto_besiege_town", "$g_encountered_party"),
        (assign, "$g_siege_force_wait", 1),
        (store_time_of_day, ":var0"),
        (val_add, ":var0", 1),
        (assign, ":var1", 31),
        (val_sub, ":var1", ":var0"),
        (val_mod, ":var1", 24),
        (val_add, ":var1", 1),
        (rest_for_hours_interactive, ":var1", 5, 1),
        (assign, "$cant_talk_to_enemy", 0),
        (change_screen_return),
      ]
      ),

      ("castle_lead_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
        (ge, "$g_siege_method", 1),
        (gt, "$g_friend_fit_for_battle", 3),
        (store_current_hours, ":var0"),
        (ge, ":var0", "$g_siege_method_finish_hours"),
      ],
      "Lead_your_soldiers_in_an_assault.",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (try_begin),
            (troop_get_slot, ":var0", "trp_party_source_party", "$g_encountered_party"),
            (gt, ":var0", 0),
            (party_get_slot, ":var1", ":var0", 10),
          (else_try),
            (party_get_slot, ":var1", "$g_encountered_party", 10),
          (try_end),
        (else_try),
          (party_get_slot, ":var1", "$g_encountered_party", 10),
        (try_end),
        (call_script, "script_calculate_battle_advantage"),
        (assign, ":var2", reg0),
        (val_mul, ":var2", 2),
        (val_div, ":var2", 3),
        (set_battle_advantage, ":var2"),
        (set_party_battle_mode),
        (assign, "$g_siege_battle_state", 1),
        (assign, ":var3", 0),
        (try_begin),
          (eq, 0, 1),
          (le, ":var2", -4),
          (eq, "$g_siege_sallied_out_once", 0),
          (set_jump_mission, "mt_castle_attack_walls_defenders_sally"),
          (assign, "$g_siege_battle_state", 0),
          (assign, ":var3", 1),
        (else_try),
          (set_jump_mission, "mt_town_attack"),
        (else_try),
          (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (try_end),
        (assign, "$cant_talk_to_enemy", 0),
        (assign, "$g_siege_final_menu", "mnu_castle_besiege"),
        (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
        (assign, "$g_siege_method", 0),
        (jump_to_scene, ":var1"),
        (try_begin),
          (eq, ":var3", 1),
          (jump_to_menu, "mnu_siege_attack_meets_sally"),
        (else_try),
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
        (try_end),
      ]
      ),

      ("attack_stay_back",
      [
        (ge, "$g_siege_method", 1),
        (gt, "$g_friend_fit_for_battle", 3),
        (store_current_hours, ":var0"),
        (ge, ":var0", "$g_siege_method_finish_hours"),
      ],
      "Order_your_soldiers_to_attack_while_you_stay_back...",
      [
        (assign, "$cant_talk_to_enemy", 0),
        (jump_to_menu, "mnu_castle_attack_walls_simulate"),
      ]
      ),

      ("build_ladders",
      [
        (party_slot_eq, "$current_town", 27, 0),
        (eq, "$g_siege_method", 0),
      ],
      "Prepare_to_attack.",
      [
        (jump_to_menu, "mnu_construct_ladders"),
      ]
      ),

      ("build_siege_tower",
      [
        (party_slot_eq, "$current_town", 27, 1),
        (eq, "$g_siege_method", 0),
      ],
      "Prepare_siege_equipment.",
      [
        (jump_to_menu, "mnu_construct_siege_tower"),
      ]
      ),

      ("cheat_castle_lead_attack",
      [
        (eq, "$cheat_mode", 1),
        (eq, "$g_siege_method", 0),
      ],
      "CHEAT:_Instant_build_equipments.",
      [
        (assign, "$g_siege_method", 1),
        (assign, "$g_siege_method_finish_hours", 0),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("lift_siege",
      [],
      "Abandon_the_siege.",
      [
        (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
        (assign, "$g_player_besiege_town", -1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("siege_attack_meets_sally", 0,
    "The defenders sally out to meet your assault.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("castle_besiege_inner_battle", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_siege_sighted_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
      (assign, ":var1", "$g_battle_result"),
      (call_script, "script_encounter_calculate_fit"),
      (str_store_string, s1, "@As a last defensive effort, you retreat to the main hall of the keep. You and your remaining soldiers will put up a desperate fight here. If you are defeated, there's no other place to fall back to."),
      (str_store_string, s1, "@You've been driven away from the walls. Now the attackers are pouring into the streets. IF you can defeat them, you can perhaps turn the tide and save the day."),
      (try_begin),
        (this_or_next|neq, ":var1", 1),
        (this_or_next|le, "$g_friend_fit_for_battle", 0),
        (le, "$g_enemy_fit_for_battle", 0),
        (jump_to_menu, "$g_siege_final_menu"),
      (else_try),
        (call_script, "script_encounter_calculate_fit"),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (try_begin),
          (eq, "$g_siege_battle_state", 0),
          (eq, ":var1", 1),
          (assign, "$g_battle_result", 0),
          (jump_to_menu, "$g_siege_final_menu"),
        (else_try),
          (eq, "$g_siege_battle_state", 1),
          (eq, ":var1", 1),
          (str_store_string, s1, "@You've breached the town walls, but the stubborn defenders continue to resist you in the streets! You'll have to deal with them before you can attack the keep at the heart of the town."),
        (else_try),
          (eq, "$g_siege_battle_state", 2),
          (eq, ":var1", 1),
          (str_store_string, s1, "@The town centre is yours, but the remaining defenders have retreated to the castle. It must fall before you can complete your victory."),
        (else_try),
          (jump_to_menu, "$g_siege_final_menu"),
        (try_end),
      (else_try),
        (try_begin),
          (eq, "$g_siege_battle_state", 0),
          (eq, ":var1", 1),
          (assign, "$g_battle_result", 0),
          (jump_to_menu, "$g_siege_final_menu"),
        (else_try),
          (eq, "$g_siege_battle_state", 1),
          (eq, ":var1", 1),
          (str_store_string, s1, "@The remaining defenders have retreated to the fort tower as a last defense. You must go in and crush any remaining resistance."),
        (else_try),
          (jump_to_menu, "$g_siege_final_menu"),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (try_begin),
            (eq, "$g_siege_battle_state", 1),
            (party_get_slot, ":var0", "$g_encountered_party", 10),
            (set_jump_mission, "mt_besiege_inner_battle_town_center"),
          (else_try),
            (party_get_slot, ":var0", "$g_encountered_party", 11),
            (set_jump_mission, "mt_besiege_inner_battle_castle"),
          (try_end),
        (else_try),
          (party_get_slot, ":var0", "$g_encountered_party", 11),
          (set_jump_mission, "mt_besiege_inner_battle_castle"),
        (try_end),
        (set_party_battle_mode),
        (jump_to_scene, ":var0"),
        (val_add, "$g_siege_battle_state", 1),
        (assign, "$g_next_menu", "mnu_castle_besiege_inner_battle"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("construct_ladders", 0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that it will take {reg4} hours to prepare for the assault.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, reg2, ":var0"),
      (store_sub, reg4, 14, ":var0"),
      (val_mul, reg4, 2),
      (val_div, reg4, 3),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":var1"),
      (try_end),
    ],
    [
      ("build_ladders_cont",
      [],
      "Do_it.",
      [
        (assign, "$g_siege_method", 1),
        (store_current_hours, ":var0"),
        (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
        (store_sub, ":var1", 14, reg0),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (store_add, "$g_siege_method_finish_hours", ":var0", ":var1"),
        (assign, "$auto_besiege_town", "$current_town"),
        (rest_for_hours_interactive, 96, 5, 1),
        (change_screen_return),
      ]
      ),

      ("go_back",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),
    ],
  ),

  ("construct_siege_tower", 0,
    "As the party member with the highest Engineer skill ({reg2}), {reg3?you estimate:{s3} estimates} that using sappers/artillery will take {reg4} hours.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, reg2, ":var0"),
      (store_sub, reg4, 15, ":var0"),
      (val_mul, reg4, 6),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":var1"),
      (try_end),
    ],
    [
      ("build_siege_tower_cont",
      [],
      "Continue.",
      [
        (assign, "$g_siege_method", 2),
        (store_current_hours, ":var0"),
        (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
        (store_sub, ":var1", 15, reg0),
        (val_mul, ":var1", 6),
        (store_add, "$g_siege_method_finish_hours", ":var0", ":var1"),
        (assign, "$auto_besiege_town", "$current_town"),
        (rest_for_hours_interactive, 240, 5, 1),
        (change_screen_return),
      ]
      ),

      ("go_back",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),
    ],
  ),

  ("castle_attack_walls_simulate", mnf_disable_all_keys|mnf_scale_picture,
    "{s4}^^Your casualties:{s8}^^Enemy casualties were: {s9}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_siege_sighted_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
      (call_script, "script_party_calculate_strength", "p_main_party", 1),
      (assign, ":var1", reg0),
      (val_div, ":var1", 10),
      (call_script, "script_party_calculate_strength", "$g_encountered_party", 0),
      (assign, ":var2", reg0),
      (val_div, ":var2", 4),
      (inflict_casualties_to_party_group, "p_main_party", ":var2", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_encountered_party", ":var1", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "$g_encountered_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),
    ],
  ),

  ("castle_attack_walls_with_allies_simulate", mnf_disable_all_keys|mnf_scale_picture,
    "{s4}^^Your casualties: {s8}^^Allied casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_siege_sighted_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_siege_sighted"),
      (try_end),
      (call_script, "script_party_calculate_strength", "p_main_party", 1),
      (assign, ":var1", reg0),
      (val_div, ":var1", 10),
      (call_script, "script_party_calculate_strength", "p_collective_friends", 0),
      (assign, ":var2", reg0),
      (val_div, ":var2", 10),
      (val_max, ":var2", 1),
      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":var3", reg0),
      (val_div, ":var3", 4),
      (assign, ":var4", ":var3"),
      (val_mul, ":var4", ":var1"),
      (val_div, ":var4", ":var2"),
      (val_sub, ":var3", ":var4"),
      (inflict_casualties_to_party_group, "p_main_party", ":var4", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_enemy_party", ":var2", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),
      (call_script, "script_collect_friendly_parties"),
      (inflict_casualties_to_party_group, "$g_ally_party", ":var3", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
      (assign, "$no_soldiers_left", 0),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (str_store_string, s4, "str_attack_walls_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0),
        (assign, "$no_soldiers_left", 1),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_attack_walls_success"),
      (else_try),
        (str_store_string, s4, "str_attack_walls_continue"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_besiegers_camp_with_allies"),
      ]
      ),
    ],
  ),

  ("castle_taken_by_friends", 0,
    "Nothing to see here.",
    "none",
    [
      (party_clear, "$g_encountered_party"),
      (party_stack_get_troop_id, ":var0", "$g_encountered_party_2", 0),
      (party_set_slot, "$g_encountered_party", 28, ":var0"),
      (store_troop_faction, ":var1", ":var0"),
      (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
      (call_script, "script_give_center_to_faction", "$g_encountered_party", ":var1"),
      (call_script, "script_add_log_entry", 18, "trp_player", "$g_encountered_party", 0, "$g_encountered_party_faction"),
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("castle_taken", mnf_disable_all_keys,
    "{s3} has fallen to your troops, and you now have full control of the {reg2?town:fort}.{reg1? It would seem that there is nothing stopping you from taking it for yourself...:}",
    "none",
    [
      (party_clear, "$g_encountered_party"),
      (call_script, "script_lift_siege", "$g_encountered_party", 0),
      (assign, "$g_player_besiege_town", -1),
      (call_script, "script_add_log_entry", 10, "trp_player", "$g_encountered_party", 0, "$g_encountered_party_faction"),
      (party_set_slot, "$g_encountered_party", 28, "trp_player"),
      (call_script, "script_change_center_prosperity", "$g_encountered_party", -5),
      (call_script, "script_change_troop_renown", "trp_player", 5),
      (call_script, "script_add_log_entry", 10, "trp_player", "$g_encountered_party", -1, "$g_encountered_party_faction"),
      (try_begin),
        (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "$players_kingdom"),
        (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "$players_kingdom"),
        (jump_to_menu, "mnu_castle_taken_2"),
      (else_try),
        (call_script, "script_give_center_to_faction", "$g_encountered_party", "fac_player_supporters_faction"),
        (call_script, "script_order_best_besieger_party_to_guard_center", "$g_encountered_party", "fac_player_supporters_faction"),
        (str_store_party_name, s3, "$g_encountered_party"),
        (assign, reg1, 0),
        (try_begin),
          (faction_slot_eq, "fac_player_supporters_faction", 10, "trp_player"),
          (assign, reg1, 1),
        (try_end),
      (try_end),
      (assign, reg2, 0),
      (try_begin),
        (is_between, "$g_encountered_party", "p_town_1", "p_castle_1"),
        (assign, reg2, 1),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("castle_taken_2", mnf_disable_all_keys,
    "{s3} has fallen to your troops, and you now have full control of the fort. It is time to send word to {s9} about your victory. {s5}",
    "none",
    [
      (str_store_party_name, s3, "$g_encountered_party"),
      (str_clear, s5),
      (faction_get_slot, ":var0", "$players_kingdom", 10),
      (str_store_troop_name, s9, ":var0"),
      (try_begin),
        (eq, "$player_has_homage", 0),
        (assign, reg8, 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 3),
          (assign, reg8, 1),
        (try_end),
        (str_store_string, s5, "@However, since you are not a sworn follower of {s9}, there is no chance he would recognize you as the commander of this {reg8?town:fort}."),
      (try_end),
    ],
    [
      ("castle_taken_claim",
      [
        (eq, "$player_has_homage", 1),
      ],
      "Request_that_{s3}_be_awarded_to_you.",
      [
        (party_set_slot, "$g_encountered_party", 28, "trp_player"),
        (assign, "$g_castle_requested_by_player", "$current_town"),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      ]
      ),

      ("castle_taken_no_claim",
      [],
      "Ask_no_rewards.",
      [
        (party_set_slot, "$g_encountered_party", 28, -1),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("requested_castle_granted_to_player", mnf_scale_picture,
    "You receive a message from your leader, {s3}.^^ {reg18?She:He} has decided to grant control of {s2}{reg3? and the nearby village of {s4}:} to you, with all due incomes and titles, to hold in {reg18?her:his} name for as long as you maintain your oath of homage.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (faction_get_slot, ":var1", "$players_kingdom", 10),
      (str_store_troop_name, s3, ":var1"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (try_begin),
        (party_slot_eq, "$g_center_to_give_to_player", 0, 2),
        (assign, reg3, 1),
        (try_for_range, ":var2", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var2", 120, "$g_center_to_give_to_player"),
          (str_store_party_name, s4, ":var2"),
        (try_end),
      (else_try),
        (assign, reg3, 0),
      (try_end),
      (troop_get_type, reg4, ":var1"),
      (call_script, "script_troop_get_gender_to_reg18", ":var1"),
    ],
    [
      ("continue",
      [],
      "Continue.",
      [
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (jump_to_menu, "mnu_give_center_to_player_2"),
      ]
      ),
    ],
  ),

  ("requested_castle_granted_to_another", mnf_scale_picture,
    "You receive a message from your leader, {s3}.^^ 'Great work taking over {s2}. You're doing a good job out there. You asked me to grant you control of it, but I'm afraid I can't do that, as you already hold significant control over other places. Instead I have sent you {reg6} cents to cover the expenses of your campaign, but {s2} I give to {s5}.' ",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (faction_get_slot, ":var1", "$players_kingdom", 10),
      (str_store_troop_name, s3, ":var1"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (party_get_slot, ":var2", "$g_center_to_give_to_player", 7),
      (str_store_troop_name, s5, ":var2"),
      (assign, reg6, 900),
    ],
    [
      ("accept_decision",
      [],
      "Accept_the_decision.",
      [
        (call_script, "script_troop_add_gold", "trp_player", reg6),
        (change_screen_return),
      ]
      ),

      ("leave_faction",
      [],
      "You_have_been_wronged!_Renounce_you_oath_to_your_country!_",
      [
        (jump_to_menu, "mnu_leave_faction"),
        (call_script, "script_troop_add_gold", "trp_player", reg6),
      ]
      ),
    ],
  ),

  ("leave_faction", 0,
    "Renouncing your oath is a grave act. Your government may condemn you and confiscate your lands and holdings. However, if you return them of your own free will, they may let the betrayal go without a punishment",
    "none",
    [],
    [
      ("leave_faction_give_back",
      [],
      "Renounce_your_oath_and_give_up_your_holdings.",
      [
        (call_script, "script_player_leave_faction", 1),
        (change_screen_return),
      ]
      ),

      ("leave_faction_hold",
      [
        (str_store_party_name, s2, "$g_center_to_give_to_player"),
      ],
      "Renounce_your_oath_and_hold_on_to_your_lands,_including_{s2}.",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 10),
        (call_script, "script_add_log_entry", 23, "trp_player", -1, ":var0", "$players_kingdom"),
        (assign, "$players_oath_renounced_against_kingdom", "$players_kingdom"),
        (assign, "$players_oath_renounced_given_center", 0),
        (store_current_hours, "$players_oath_renounced_begin_time"),
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (call_script, "script_player_leave_faction", 0),
        (try_for_range, ":var1", "p_town_1", "p_village_1"),
          (store_faction_of_party, ":var2", ":var1"),
          (party_set_slot, ":var1", 155, ":var2"),
        (try_end),
        (party_set_slot, "$g_center_to_give_to_player", 155, "$players_oath_renounced_against_kingdom"),
        (change_screen_return),
      ]
      ),

      ("leave_faction_cancel",
      [],
      "Remain_loyal_and_accept_the_decision.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("give_center_to_player", mnf_scale_picture,
    "Your general offers to extend your control of land! {s1} sends word that he is willing to grant control of {s2} to you in payment for your loyal service. What is your answer?",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (store_faction_of_party, ":var1", "$g_center_to_give_to_player"),
      (faction_get_slot, ":var2", ":var1", 10),
      (str_store_troop_name, s1, ":var2"),
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
    ],
    [
      ("give_center_to_player_accept",
      [],
      "Accept_the_offer.",
      [
        (call_script, "script_give_center_to_lord", "$g_center_to_give_to_player", "trp_player", 0),
        (jump_to_menu, "mnu_give_center_to_player_2"),
      ]
      ),

      ("give_center_to_player_reject",
      [],
      "Reject._You_have_no_interest_in_controlling_{s2}.",
      [
        (party_set_slot, "$g_center_to_give_to_player", 7, -3),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("give_center_to_player_2", 0,
    "With a brief ceremony, you are officially confirmed as the new protector of {s2}{reg3? and its bound village {s4}:}. You can now claim the rents and revenues, draft soldiers from the populace, and manage the lands as you see fit. However, you are also expected to defend it and your people from harm, as well as maintaining the rule of law and order.",
    "none",
    [
      (str_store_party_name, s2, "$g_center_to_give_to_player"),
      (assign, reg3, 0),
      (try_begin),
        (party_slot_eq, "$g_center_to_give_to_player", 0, 2),
        (try_for_range, ":var0", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var0", 120, "$g_center_to_give_to_player"),
          (str_store_party_name, s4, ":var0"),
          (assign, reg3, 1),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("oath_fulfilled", 0,
    "You had a contract with {s1} to serve him for a certain duration. Your contract has now expired. What will you do?",
    "none",
    [
      (faction_get_slot, ":var0", "$players_kingdom", 10),
      (str_store_troop_name, s1, ":var0"),
    ],
    [
      ("renew_oath",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 10),
        (str_store_troop_name, s1, ":var0"),
      ],
      "Renew_your_contract_with_{s1}_for_another_month.",
      [
        (store_current_day, ":var0"),
        (store_add, "$mercenary_service_next_renew_day", ":var0", 30),
        (change_screen_return),
      ]
      ),

      ("dont_renew_oath",
      [],
      "Become_free_of_your_bond.",
      [
        (call_script, "script_player_leave_faction", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("siege_started_defender", 0,
    "{s1} is launching an assault against the walls of {s2}. You have {reg10} troops fit for battle against the enemy's {reg11}. You decide to...",
    "none",
    [
      (select_enemy, 1),
      (assign, "$g_enemy_party", "$g_encountered_party_2"),
      (assign, "$g_ally_party", "$g_encountered_party"),
      (str_store_party_name, s1, "$g_enemy_party"),
      (str_store_party_name, s2, "$g_ally_party"),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$g_siege_first_encounter", 1),
        (call_script, "script_let_nearby_parties_join_current_battle", 0, 1),
        (call_script, "script_encounter_init_variables"),
      (try_end),
      (try_begin),
        (eq, "$g_siege_first_encounter", 0),
        (try_begin),
          (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
          (assign, ":var0", reg0),
          (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
          (assign, ":var1", reg0),
          (assign, ":var2", 0),
          (try_begin),
            (eq, "$g_battle_result", 1),
            (eq, ":var0", 0),
            (assign, ":var2", 1),
          (else_try),
            (eq, "$g_engaged_enemy", 1),
            (le, "$g_enemy_fit_for_battle", 0),
            (ge, "$g_friend_fit_for_battle", 1),
            (assign, ":var2", 1),
          (try_end),
          (this_or_next|eq, ":var2", 1),
          (eq, "$g_enemy_surrenders", 1),
          (assign, "$g_next_menu", -1),
          (jump_to_menu, "mnu_total_victory"),
        (else_try),
          (assign, ":var3", 0),
          (try_begin),
            (this_or_next|eq, "$g_battle_result", -1),
            (troop_is_wounded, "trp_player"),
            (eq, ":var1", 0),
            (assign, ":var3", 1),
          (try_end),
          (this_or_next|eq, ":var3", 1),
          (eq, "$g_player_surrenders", 1),
          (assign, "$g_next_menu", "mnu_captivity_start_under_siege_defeat"),
          (jump_to_menu, "mnu_total_defeat"),
        (else_try),
          (assign, ":var4", 0),
          (try_begin),
            (eq, "$g_battle_result", 1),
            (assign, ":var4", 1),
          (else_try),
            (eq, "$g_battle_result", 0),
            (store_div, ":var5", "$g_enemy_fit_for_battle", 3),
            (lt, ":var5", "$g_friend_fit_for_battle"),
            (assign, ":var4", 1),
          (else_try),
            (store_random_in_range, ":var6", 0, 100),
            (lt, ":var6", 10),
            (neq, "$new_encounter", 1),
            (assign, ":var4", 1),
          (try_end),
          (try_begin),
            (eq, ":var4", 1),
            (party_get_slot, ":var7", "$g_encountered_party", 65),
            (val_add, ":var7", 100),
            (party_set_slot, "$g_encountered_party", 65, ":var7"),
            (party_set_slot, "$g_enemy_party", 2, 1),
            (try_for_range, ":var8", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
              (troop_slot_eq, ":var8", 2, 2),
              (neg|troop_slot_ge, ":var8", 8, 0),
              (troop_get_slot, ":var9", ":var8", 10),
              (gt, ":var9", 0),
              (party_slot_eq, ":var9", 4, 1),
              (party_slot_eq, ":var9", 5, "$g_encountered_party"),
              (party_slot_eq, ":var9", 8, 1),
              (call_script, "script_party_set_ai_state", ":var9", -1, -1),
              (call_script, "script_party_set_ai_state", ":var9", 1, "$g_encountered_party"),
            (try_end),
            (display_message, "@The enemy has been forced to retreat. The assault is over, but the siege continues."),
            (assign, "$g_battle_simulation_cancel_for_party", "$g_encountered_party"),
            (leave_encounter),
            (change_screen_return),
            (assign, "$g_battle_simulation_auto_enter_town_after_battle", "$g_encountered_party"),
          (try_end),
        (try_end),
      (try_end),
      (assign, "$g_siege_first_encounter", 0),
      (assign, "$new_encounter", 0),
    ],
    [
      ("siege_defender_join_battle",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Join_the_battle.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (assign, "$g_battle_result", 0),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (try_begin),
            (troop_get_slot, ":var0", "trp_party_source_party", "$g_encountered_party"),
            (gt, ":var0", 0),
            (party_get_slot, ":var1", ":var0", 10),
          (else_try),
            (party_get_slot, ":var1", "$g_encountered_party", 10),
          (try_end),
        (else_try),
          (party_get_slot, ":var1", "$g_encountered_party", 10),
        (try_end),
        (call_script, "script_calculate_battle_advantage"),
        (val_mul, reg0, 2),
        (val_div, reg0, 3),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (try_begin),
          (set_jump_mission, "mt_town_attack"),
        (else_try),
          (set_jump_mission, "mt_castle_attack_walls_ladder"),
        (try_end),
        (jump_to_scene, ":var1"),
        (assign, "$g_next_menu", "mnu_siege_started_defender"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("siege_defender_troops_join_battle",
      [
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (this_or_next|troop_is_wounded, "trp_player"),
        (ge, reg0, 3),
      ],
      "Order_your_men_to_join_the_battle_without_you.",
      [
        (party_set_next_battle_simulation_time, "$g_encountered_party", -1),
        (select_enemy, 1),
        (assign, "$g_enemy_party", "$g_encountered_party_2"),
        (assign, "$g_ally_party", "$g_encountered_party"),
        (assign, "$g_siege_join", 1),
        (jump_to_menu, "mnu_siege_join_defense"),
      ]
      ),
    ],
  ),

  ("siege_join_defense", mnf_disable_all_keys,
    "{s4}^^Your casualties: {s8}^^Allies' casualties: {s9}^^Enemy casualties: {s10}",
    "none",
    [
      (try_begin),
        (eq, "$g_siege_join", 1),
        (call_script, "script_party_calculate_strength", "p_main_party", 1),
        (assign, ":var0", reg0),
        (val_div, ":var0", 5),
      (else_try),
        (assign, ":var0", 0),
      (try_end),
      (call_script, "script_party_calculate_strength", "p_collective_ally", 0),
      (assign, ":var1", reg0),
      (val_div, ":var1", 5),
      (call_script, "script_party_calculate_strength", "p_collective_enemy", 0),
      (assign, ":var2", reg0),
      (val_div, ":var2", 10),
      (store_add, ":var3", ":var0", ":var1"),
      (assign, ":var4", ":var2"),
      (val_mul, ":var4", ":var0"),
      (val_div, ":var4", ":var3"),
      (val_sub, ":var2", ":var4"),
      (inflict_casualties_to_party_group, "p_main_party", ":var4", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s8, s0),
      (inflict_casualties_to_party_group, "$g_ally_party", ":var2", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s9, s0),
      (party_collect_attachments_to_party, "$g_ally_party", "p_collective_ally"),
      (inflict_casualties_to_party_group, "$g_enemy_party", ":var3", "p_temp_casualties"),
      (call_script, "script_print_casualties_to_s0", "p_temp_casualties", 0),
      (str_store_string_reg, s10, s0),
      (party_collect_attachments_to_party, "$g_enemy_party", "p_collective_enemy"),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (le, reg0, 0),
        (str_store_string, s4, "str_siege_defender_order_attack_failure"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (le, reg0, 0),
        (assign, "$g_battle_result", 1),
        (str_store_string, s4, "str_siege_defender_order_attack_success"),
      (else_try),
        (str_store_string, s4, "str_siege_defender_order_attack_continue"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_siege_started_defender"),
      ]
      ),
    ],
  ),

  ("enter_your_own_castle", 0,
    "As you approach, you are spotted by the fort guards, who welcome you and open the gates for their commander.",
    "none",
    [
      (str_store_party_name, s2, "$current_town"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("village", mnf_enable_hot_keys,
    "{s10}{s11}{s6}{s7}",
    "none",
    [
      (assign, "$current_town", "$g_encountered_party"),
      (call_script, "script_update_center_recon_notes", "$current_town"),
      (assign, "$g_defending_against_siege", 0),
      (assign, "$g_battle_result", 0),
      (assign, "$qst_collect_taxes_currently_collecting", 0),
      (assign, "$qst_train_peasants_against_bandits_currently_training", 0),
      (try_begin),
        (gt, "$auto_enter_menu_in_center", 0),
        (jump_to_menu, "$auto_enter_menu_in_center"),
        (assign, "$auto_enter_menu_in_center", 0),
      (try_end),
      (try_begin),
        (neq, "$g_player_raiding_village", "$current_town"),
        (assign, "$g_player_raiding_village", 0),
      (else_try),
        (jump_to_menu, "mnu_village_loot_continue"),
      (try_end),
      (try_begin),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
      (try_end),
      (str_store_party_name, s2, "$current_town"),
      (party_get_slot, ":var0", "$current_town", 7),
      (store_faction_of_party, ":var1", "$current_town"),
      (str_store_faction_name, s9, ":var1"),
      (try_begin),
        (ge, ":var0", 0),
        (str_store_troop_name, s8, ":var0"),
        (str_store_string, s7, "@{s8} of {s9}"),
      (try_end),
      (str_clear, s10),
      (try_begin),
        (neg|party_slot_eq, "$current_town", 35, 2),
        (str_store_string, s60, s2),
        (party_get_slot, ":var2", "$current_town", 50),
        (val_add, ":var2", 5),
        (store_div, ":var3", ":var2", 10),
        (store_add, ":var4", "str_village_prosperity_0", ":var3"),
        (str_store_string, s10, ":var4"),
      (try_end),
      (str_clear, s11),
      (try_begin),
        (party_slot_eq, "$current_town", 35, 2),
      (else_try),
        (eq, ":var0", "trp_player"),
        (str_store_string, s11, "@ This village and the surrounding lands are under your control."),
      (else_try),
        (ge, ":var0", 0),
        (str_store_string, s11, "@ You remember that this village and the surrounding lands are controlled by {s7}."),
      (else_try),
        (str_store_string, s11, "@ These lands are under no control."),
      (try_end),
      (str_clear, s7),
      (try_begin),
        (neg|party_slot_eq, "$current_town", 35, 2),
        (party_get_slot, ":var5", "$current_town", 26),
        (call_script, "script_describe_center_relation_to_s3", ":var5"),
        (assign, reg9, ":var5"),
        (str_store_string, s7, "@ {s3} ({reg9})."),
      (try_end),
      (str_clear, s6),
      (try_begin),
        (party_slot_ge, "$current_town", 39, 1),
        (party_get_slot, ":var6", "$current_town", 39),
        (store_random_in_range, "$qst_eliminate_bandits_infesting_village_num_villagers", 25, 30),
        (store_random_in_range, "$qst_eliminate_bandits_infesting_village_num_bandits", 15, 35),
        (assign, reg8, "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (str_store_troop_name_by_count, s35, ":var6", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (str_store_string, s6, "@ The village is infested by {reg8} {s35}."),
        (try_begin),
          (eq, ":var6", "trp_forest_bandit"),
          (set_background_mesh, "mesh_pic_forest_bandits"),
        (else_try),
          (eq, ":var6", "trp_mountain_bandit"),
          (set_background_mesh, "mesh_pic_mountain_bandits"),
        (else_try),
          (set_background_mesh, "mesh_pic_outlaws"),
        (try_end),
      (else_try),
        (party_slot_eq, "$current_town", 35, 2),
        (str_store_string, s6, "@ The village has been looted. A handful of souls scatter as you pass through the burnt out houses."),
        (try_begin),
          (neq, "$g_player_raid_complete", 1),
          (play_track, "track_Ghost_Processional", 1),
        (try_end),
        (set_background_mesh, "mesh_pic_looted_village"),
      (else_try),
        (party_slot_eq, "$current_town", 35, 1),
        (str_store_string, s6, "@ The village is being raided."),
      (else_try),
        (is_between, "$current_town", "p_bank_1", "p_salt_mine"),
        (set_background_mesh, "mesh_pic_bank"),
      (else_try),
        (party_get_slot, ":var7", "$current_town", 19),
        (try_begin),
          (eq, ":var7", "fac_culture_1"),
          (set_background_mesh, "mesh_pic_village_usa"),
        (else_try),
          (eq, ":var7", "fac_culture_2"),
          (set_background_mesh, "mesh_pic_village_mexico"),
        (else_try),
          (this_or_next|eq, ":var7", "fac_culture_3"),
          (eq, ":var7", "fac_culture_4"),
          (set_background_mesh, "mesh_pic_village_indian"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, "$g_player_raid_complete", 1),
        (assign, "$g_player_raid_complete", 0),
        (jump_to_menu, "mnu_village_loot_complete"),
      (else_try),
        (party_get_slot, ":var8", "$current_town", 34),
        (gt, ":var8", 0),
      (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (party_get_slot, ":var9", "$current_town", 47),
        (gt, ":var9", 0),
        (jump_to_menu, "mnu_center_tax"),
      (try_end),
      (try_begin),
        (eq, "$g_leave_town", 1),
        (assign, "$g_leave_town", 0),
        (change_screen_return),
      (try_end),
      (try_begin),
        (store_time_of_day, ":var10"),
        (ge, ":var10", 5),
        (lt, ":var10", 21),
        (assign, "$town_nighttime", 0),
      (else_try),
        (assign, "$town_nighttime", 1),
      (try_end),
      (try_begin),
        (eq, 0, 1),
        (ge, ":var5", 0),
        (troop_get_slot, ":var11", "trp_party_source_party", "$current_town"),
        (ge, ":var11", 1),
        (str_store_party_name, s1, ":var11"),
        (display_message, "@{s1}"),
        (start_encounter, ":var11"),
        (try_begin),
          (party_slot_eq, ":var11", 0, 3),
          (jump_to_menu, "mnu_town"),
          (display_message, "@town"),
        (else_try),
          (party_slot_eq, ":var11", 0, 4),
          (jump_to_menu, "mnu_village"),
          (display_message, "@village"),
        (try_end),
      (try_end),
    ],
    [
      ("village_manage",
      [
        (neg|party_slot_eq, "$current_town", 35, 2),
        (neg|party_slot_eq, "$current_town", 35, 1),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 7, "trp_player"),
      ],
      "Manage_this_village.",
      [
        (assign, "$g_next_menu", "mnu_village"),
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("recruit_volunteers",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (call_script, "script_cf_village_recruit_volunteers_cond"),
        (store_faction_of_party, ":var0", "$current_town"),
        (assign, ":var1", 0),
        (try_begin),
          (this_or_next|eq, "$players_kingdom", 0),
          (neg|faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 1),
          (assign, ":var1", 1),
        (else_try),
          (gt, "$players_kingdom", 0),
          (faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 0),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 0),
      ],
      "Recruit_Volunteers.",
      [
        (jump_to_menu, "mnu_no_random_strangers"),
      ]
      ),

      ("recruit_volunteers",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (call_script, "script_cf_village_recruit_volunteers_cond"),
        (store_faction_of_party, ":var0", "$current_town"),
        (assign, ":var1", 0),
        (try_begin),
          (this_or_next|eq, "$players_kingdom", 0),
          (neg|faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 1),
          (assign, ":var1", 1),
        (else_try),
          (gt, "$players_kingdom", 0),
          (faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 0),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 1),
      ],
      "Recruit_Volunteers.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (jump_to_menu, "mnu_recruit_volunteers"),
        (try_end),
      ]
      ),

      ("village_center",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (neg|party_slot_eq, "$current_town", 35, 2),
        (neg|party_slot_eq, "$current_town", 35, 1),
        (neg|party_slot_ge, "$current_town", 39, 1),
      ],
      "Go_to_the_village_center.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 10),
          (modify_visitors_at_site, ":var0"),
          (reset_visitors),
          (party_get_slot, ":var1", "$current_town", 25),
          (set_visitor, 11, ":var1"),
          (try_for_range, ":var2", 0, 8),
            (call_script, "script_center_set_walker_to_type", "$current_town", ":var2", 0),
          (try_end),
          (call_script, "script_init_town_walkers"),
          (try_begin),
            (check_quest_active, "qst_hunt_down_fugitive"),
            (neg|is_currently_night),
            (quest_slot_eq, "qst_hunt_down_fugitive", 1, "$current_town"),
            (neg|check_quest_succeeded, "qst_hunt_down_fugitive"),
            (neg|check_quest_failed, "qst_hunt_down_fugitive"),
            (set_visitor, 45, "trp_fugitive_original"),
          (else_try),
            (check_quest_active, "qst_wanted_fugitive"),
            (neg|is_currently_night),
            (quest_slot_eq, "qst_wanted_fugitive", 1, "$current_town"),
            (neg|check_quest_succeeded, "qst_wanted_fugitive"),
            (neg|check_quest_failed, "qst_wanted_fugitive"),
            (call_script, "script_get_correct_fugitive_troop_to_reg0"),
            (assign, ":var3", reg0),
            (set_visitor, 45, ":var3"),
          (try_end),
          (try_for_range, ":var4", 0, "trp_end"),
            (troop_slot_eq, ":var4", 142, ":var0"),
            (troop_get_slot, ":var5", ":var4", 143),
            (set_visitor, ":var5", ":var4"),
          (try_end),
          (set_jump_mission, "mt_village_center"),
          (jump_to_scene, ":var0"),
          (change_screen_mission),
        (try_end),
      ]
,
      "Door_to_the_village_center."
      ),

      ("village_buy_food",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
      ],
      "Buy_supplies_from_the_locals.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 25),
          (change_screen_trade, ":var0"),
        (try_end),
      ]
      ),

      ("village_attack_bandits",
      [
        (party_slot_ge, "$current_town", 39, 1),
      ],
      "Attack_the_bandits.",
      [
        (party_get_slot, ":var0", "$current_town", 39),
        (party_get_slot, ":var1", "$current_town", 10),
        (store_faction_of_party, ":var2", "$current_town"),
        (modify_visitors_at_site, ":var1"),
        (reset_visitors),
        (set_visitors, 0, ":var0", "$qst_eliminate_bandits_infesting_village_num_bandits"),
        (try_begin),
          (eq, ":var2", "fac_kingdom_3"),
          (set_visitors, 2, "trp_apache_rabbit_hunter", "$qst_eliminate_bandits_infesting_village_num_villagers"),
        (else_try),
          (eq, ":var2", "fac_kingdom_4"),
          (set_visitors, 2, "trp_comanche_buffalo_hunter", "$qst_eliminate_bandits_infesting_village_num_villagers"),
        (else_try),
          (set_visitors, 2, "trp_settler_1", "$qst_eliminate_bandits_infesting_village_num_villagers"),
        (try_end),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission, "mt_village_attack_bandits"),
        (jump_to_scene, ":var1"),
        (assign, "$g_next_menu", "mnu_village_infest_bandits_result"),
        (jump_to_menu, "mnu_battle_debrief"),
        (assign, "$g_mt_mode", 1),
        (change_screen_mission),
      ]
      ),

      ("village_wait",
      [
        (party_slot_eq, "$current_town", 130, 1),
        (party_slot_eq, "$current_town", 7, "trp_player"),
      ],
      "Wait_here_for_some_time.",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_last_rest_center", "$current_town"),
        (rest_for_hours_interactive, 168, 5, 1),
        (change_screen_return),
      ]
      ),

      ("collect_taxes_qst",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (check_quest_active, "qst_collect_taxes"),
        (quest_get_slot, ":var0", "qst_collect_taxes", 6),
        (quest_slot_eq, "qst_collect_taxes", 1, "$current_town"),
        (neg|quest_slot_eq, "qst_collect_taxes", 11, 4),
        (str_store_troop_name, s1, ":var0"),
        (quest_get_slot, reg5, "qst_collect_taxes", 11),
      ],
      "{reg5?Continue_collecting_taxes:Collect_taxes}_due_to_{s1}.",
      [
        (jump_to_menu, "mnu_collect_taxes"),
      ]
      ),

      ("train_peasants_against_bandits_qst",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (check_quest_active, "qst_train_peasants_against_bandits"),
        (neg|check_quest_concluded, "qst_train_peasants_against_bandits"),
        (quest_slot_eq, "qst_train_peasants_against_bandits", 1, "$current_town"),
      ],
      "Train_the_peasants.",
      [
        (jump_to_menu, "mnu_train_peasants_against_bandits"),
      ]
      ),

      ("bank_speak",
      [
        (troop_slot_eq, "trp_party_type_2", "$current_town", 1),
      ],
      "Speak_to_the_bank_head.",
      [
        (party_get_slot, ":var0", "$current_town", 25),
        (jump_to_menu, "mnu_village"),
        (modify_visitors_at_site, "scn_barretts_house"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 17, ":var0"),
        (set_jump_mission, "mt_conversation_encounter"),
        (jump_to_scene, "scn_barretts_house"),
        (assign, "$talk_context", 15),
        (change_screen_map_conversation, ":var0"),
      ]
      ),

      ("village_hostile_action",
      [
        (party_slot_eq, "$current_town", 35, 0),
        (call_script, "script_refresh_village_defenders", "$current_town"),
        (neg|party_slot_ge, "$current_town", 39, 1),
      ],
      "Take_a_hostile_action.",
      [
        (jump_to_menu, "mnu_village_hostile_action"),
      ]
      ),

      ("village_reports",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT!_Show_reports.",
      [
        (jump_to_menu, "mnu_center_reports"),
      ]
      ),

      ("village_leave",
      [],
      "Leave...",
      [
        (change_screen_return, 0),
      ]
      ),
    ],
  ),

  ("no_random_strangers", mnf_enable_hot_keys,
    "The village leader claims you have no right to request volunteers from {s1}.  Your request is denied.",
    "none",
    [
      (store_faction_of_party, ":var0", "$current_town"),
      (str_store_faction_name, s1, ":var0"),
    ],
    [
      ("continue",
      [],
      "Continue.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("recruit_volunteers_town", 0,
    "{s18}",
    "none",
    [
      (party_get_slot, ":var0", "$current_town", 222),
      (party_get_slot, ":var1", "$current_town", 223),
      (party_get_free_companions_capacity, ":var2", "p_main_party"),
      (val_min, ":var1", ":var2"),
      (party_get_slot, ":var0", "$current_town", 222),
      (store_faction_of_party, ":var3", "$current_town"),
      (store_character_level, ":var4", ":var0"),
      (try_begin),
        (ge, ":var4", 13),
        (val_mul, ":var4", 10),
      (try_end),
      (store_add, ":var5", ":var4", 90),
      (try_begin),
        (eq, ":var3", "$players_kingdom"),
        (val_mul, ":var5", 3),
        (val_div, ":var5", 4),
      (try_end),
      (store_troop_gold, ":var6", "trp_player"),
      (store_div, ":var7", ":var6", ":var5"),
      (val_min, ":var1", ":var7"),
      (assign, reg5, ":var1"),
      (try_begin),
        (le, ":var1", 0),
        (str_store_string, s18, "@No one here seems to be willing to join your party."),
      (else_try),
        (store_mul, reg6, ":var1", ":var5"),
        (str_store_troop_name_by_count, s3, ":var0", ":var1"),
        (try_begin),
          (eq, reg5, 1),
          (str_store_string, s18, "@One {s3} volunteer to follow you."),
        (else_try),
          (str_store_string, s18, "@{reg5} {s3} volunteers to follow you."),
        (try_end),
        (party_get_slot, ":var8", "$current_town", 19),
        (try_begin),
          (eq, ":var8", "fac_culture_1"),
          (set_background_mesh, "mesh_pic_recruit_usa"),
        (else_try),
          (eq, ":var8", "fac_culture_2"),
          (set_background_mesh, "mesh_pic_recruit_mexico"),
        (else_try),
          (eq, ":var8", "fac_culture_3"),
          (set_background_mesh, "mesh_pic_recruit_apache"),
        (else_try),
          (eq, ":var8", "fac_culture_4"),
          (set_background_mesh, "mesh_pic_recruit_comanche"),
        (else_try),
          (eq, ":var8", "fac_culture_5"),
          (set_background_mesh, "mesh_pic_recruit_gang_bandit"),
        (else_try),
          (eq, ":var8", "fac_culture_6"),
          (set_background_mesh, "mesh_pic_recruit_gang_lawmen"),
        (else_try),
          (eq, ":var8", "fac_culture_7"),
          (set_background_mesh, "mesh_pic_recruit_gang_outlaw"),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [
        (le, reg5, 0),
      ],
      "Continue...",
      [
        (party_set_slot, "$current_town", 223, 0),
        (jump_to_menu, "mnu_town"),
      ]
      ),

      ("recruit_them",
      [
        (gt, reg5, 0),
      ],
      "Recruit_them_({reg6}_cents).",
      [
        (call_script, "script_town_recruit_volunteers"),
        (jump_to_menu, "mnu_town"),
      ]
      ),

      ("forget_it",
      [
        (gt, reg5, 0),
      ],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("recruit_volunteers_castle", 0,
    "{s18}",
    "none",
    [
      (party_get_slot, ":var0", "$current_town", 222),
      (party_get_slot, ":var1", "$current_town", 223),
      (party_get_free_companions_capacity, ":var2", "p_main_party"),
      (val_min, ":var1", ":var2"),
      (party_get_slot, ":var0", "$current_town", 222),
      (store_faction_of_party, ":var3", "$current_town"),
      (store_character_level, ":var4", ":var0"),
      (try_begin),
        (ge, ":var4", 13),
        (val_mul, ":var4", 10),
      (try_end),
      (store_add, ":var5", ":var4", 90),
      (try_begin),
        (eq, ":var3", "$players_kingdom"),
        (val_mul, ":var5", 3),
        (val_div, ":var5", 4),
      (try_end),
      (store_troop_gold, ":var6", "trp_player"),
      (store_div, ":var7", ":var6", ":var5"),
      (val_min, ":var1", ":var7"),
      (assign, reg5, ":var1"),
      (try_begin),
        (le, ":var1", 0),
        (str_store_string, s18, "@No one here seems to be willing to join your party."),
      (else_try),
        (store_mul, reg6, ":var1", ":var5"),
        (str_store_troop_name_by_count, s3, ":var0", ":var1"),
        (try_begin),
          (eq, reg5, 1),
          (str_store_string, s18, "@One {s3} volunteer to follow you."),
        (else_try),
          (str_store_string, s18, "@{reg5} {s3} volunteers to follow you."),
        (try_end),
        (party_get_slot, ":var8", "$current_town", 19),
        (try_begin),
          (eq, ":var8", "fac_culture_1"),
          (set_background_mesh, "mesh_pic_recruit_usa"),
        (else_try),
          (eq, ":var8", "fac_culture_2"),
          (set_background_mesh, "mesh_pic_recruit_mexico"),
        (else_try),
          (eq, ":var8", "fac_culture_3"),
          (set_background_mesh, "mesh_pic_recruit_apache"),
        (else_try),
          (eq, ":var8", "fac_culture_4"),
          (set_background_mesh, "mesh_pic_recruit_comanche"),
        (else_try),
          (eq, ":var8", "fac_culture_5"),
          (set_background_mesh, "mesh_pic_recruit_gang_bandit"),
        (else_try),
          (eq, ":var8", "fac_culture_6"),
          (set_background_mesh, "mesh_pic_recruit_gang_lawmen"),
        (else_try),
          (eq, ":var8", "fac_culture_7"),
          (set_background_mesh, "mesh_pic_recruit_gang_outlaw"),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [
        (le, reg5, 0),
      ],
      "Continue...",
      [
        (party_set_slot, "$current_town", 223, 0),
        (jump_to_menu, "mnu_town"),
      ]
      ),

      ("recruit_them",
      [
        (gt, reg5, 0),
      ],
      "Recruit_them_({reg6}_cents).",
      [
        (call_script, "script_castle_recruit_volunteers"),
        (jump_to_menu, "mnu_town"),
      ]
      ),

      ("forget_it",
      [
        (gt, reg5, 0),
      ],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("village_hostile_action", 0,
    "What action do you have in mind?",
    "none",
    [],
    [
      ("village_take_food",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (party_get_slot, ":var0", "$current_town", 25),
        (assign, ":var1", 0),
        (try_for_range, ":var2", 10, 74),
          (troop_get_inventory_slot, ":var3", ":var0", ":var2"),
          (ge, ":var3", 0),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 1),
      ],
      "Force_the_locals_to_give_you_supplies.",
      [
        (jump_to_menu, "mnu_village_take_food_confirm"),
      ]
      ),

      ("village_steal_cattle",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 35, 0),
        (party_slot_eq, "$current_town", 46, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (party_get_slot, ":var0", "$current_town", 45),
        (neg|party_slot_eq, "$current_town", 7, "trp_player"),
        (gt, ":var0", 0),
      ],
      "Steal_cattle.",
      [
        (jump_to_menu, "mnu_village_steal_cattle_confirm"),
      ]
      ),

      ("village_steal_horses",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (party_get_slot, ":var0", "$current_town", 50),
        (neg|party_slot_eq, "$current_town", 7, "trp_player"),
        (ge, ":var0", 10),
      ],
      "Steal_horses.",
      [
        (jump_to_menu, "mnu_village_steal_horses_confirm"),
      ]
      ),

      ("village_loot",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
        (store_faction_of_party, ":var0", "$current_town"),
        (store_relation, ":var1", "fac_player_supporters_faction", ":var0"),
        (lt, ":var1", 0),
      ],
      "Loot_and_burn_this_village.",
      [
        (jump_to_menu, "mnu_village_start_attack"),
      ]
      ),

      ("bank_loot",
      [
        (troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 35, 0),
        (neg|party_slot_ge, "$current_town", 39, 1),
      ],
      "Rob_this_bank.",
      [
        (jump_to_menu, "mnu_rob_bank_confirm"),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("rob_bank_confirm", 0,
    "The bank of {s1} is well guarded. You and one of your companions will enter the bank, blow up the safe and flee.",
    "none",
    [
      (str_store_party_name, s1, "$current_town"),
    ],
    [
      ("bank_enter",
      [],
      "Enter_the_bank.",
      [
        (rest_for_hours_interactive, 1, 5, 0),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (assign, "$auto_enter_menu_in_center", "mnu_rob_bank"),
        (change_screen_return),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_village_hostile_action"),
      ]
      ),
    ],
  ),

  ("rob_bank", 0,
    "The safe is open! Take as much as you can and get out of the town!",
    "none",
    [
      (store_random_in_range, reg1, 0, 4),
      (val_add, reg1, "snd_cannon_shot1"),
      (play_sound, reg1),
    ],
    [
      ("continue",
      [],
      "Continue.",
      [
        (try_begin),
          (party_slot_ge, "$current_town", 26, -55),
          (try_begin),
            (party_slot_eq, "$current_town", 7, "trp_player"),
            (call_script, "script_change_player_relation_with_center", "$current_town", -1),
          (else_try),
            (call_script, "script_change_player_relation_with_center", "$current_town", -10),
          (try_end),
        (try_end),
        (party_get_slot, ":var0", "$current_town", 7),
        (try_begin),
          (gt, ":var0", 1),
          (call_script, "script_change_player_relation_with_troop", ":var0", -15),
        (try_end),
        (store_faction_of_party, ":var1", "$current_town"),
        (try_begin),
          (call_script, "script_change_player_relation_with_faction", ":var1", -7),
        (try_end),
        (party_get_slot, ":var2", "$current_town", 25),
        (party_get_skill_level, ":var3", "p_main_party", "skl_looting"),
        (val_mul, ":var3", 3),
        (store_sub, ":var4", 70, ":var3"),
        (try_for_range, ":var5", 10, 74),
          (store_random_in_range, ":var6", 0, 100),
          (lt, ":var6", ":var4"),
          (troop_set_inventory_slot, ":var2", ":var5", -1),
        (try_end),
        (call_script, "script_add_log_entry", 2, "trp_player", "$current_town", -1, -1),
        (jump_to_menu, "mnu_rob_bank_fight"),
        (call_script, "script_replace_standard_ammo", ":var2"),
        (call_script, "script_override_unuseable_items_sub", ":var2"),
        (troop_sort_inventory, ":var2"),
        (change_screen_loot, ":var2"),
      ]
      ),
    ],
  ),

  ("rob_bank_fight", 0,
    " ",
    "none",
    [
      (assign, "$all_doors_locked", 1),
      (troop_get_slot, ":var0", "trp_party_source_party", "$current_town"),
      (party_get_slot, ":var1", ":var0", 10),
      (modify_visitors_at_site, ":var1"),
      (reset_visitors),
      (set_visitor, 0, "trp_player"),
      (store_faction_of_party, ":var2", "$current_town"),
      (faction_get_slot, ":var3", ":var2", 42),
      (faction_get_slot, ":var4", ":var2", 43),
      (try_begin),
        (gt, ":var3", 0),
        (gt, ":var4", 0),
        (assign, reg0, ":var4"),
        (assign, reg1, ":var4"),
        (assign, reg2, ":var3"),
        (assign, reg3, ":var3"),
      (else_try),
      (try_end),
      (assign, reg4, -1),
      (shuffle_range, 0, 4),
      (set_visitors, 1, reg0, 2),
      (set_visitors, 2, reg1, 2),
      (set_visitors, 3, reg2, 2),
      (set_visitors, 4, reg3, 2),
      (party_get_num_companion_stacks, ":var5", "p_main_party"),
      (assign, ":var6", -1),
      (try_for_range_backwards, ":var7", 0, ":var5"),
        (party_stack_get_troop_id, ":var8", "p_main_party", ":var7"),
        (troop_is_hero, ":var8"),
        (gt, ":var8", 0),
        (assign, ":var6", ":var8"),
      (try_end),
      (try_begin),
        (ge, ":var6", 0),
        (try_begin),
          (set_visitor, 9, ":var6"),
        (try_end),
      (else_try),
        (party_stack_get_troop_id, ":var8", "p_main_party", 1),
        (gt, ":var8", 0),
        (try_begin),
          (set_visitor, 9, ":var8"),
        (try_end),
      (try_end),
      (set_jump_mission, "mt_rob_bank_fight"),
      (set_passage_menu, "mnu_sneak_into_town_caught_ran_away"),
      (jump_to_scene, ":var1"),
      (change_screen_mission),
    ],
    [
    ],
    [],
  ),

  ("recruit_volunteers", 0,
    "{s18}",
    "none",
    [
      (party_get_slot, ":var0", "$current_town", 222),
      (party_get_slot, ":var1", "$current_town", 223),
      (party_get_free_companions_capacity, ":var2", "p_main_party"),
      (val_min, ":var1", ":var2"),
      (party_get_slot, ":var0", "$current_town", 222),
      (store_faction_of_party, ":var3", "$current_town"),
      (store_character_level, ":var4", ":var0"),
      (try_begin),
        (ge, ":var4", 13),
        (val_mul, ":var4", 10),
      (try_end),
      (store_add, ":var5", ":var4", 90),
      (try_begin),
        (eq, ":var3", "$players_kingdom"),
        (val_mul, ":var5", 3),
        (val_div, ":var5", 4),
      (try_end),
      (store_troop_gold, ":var6", "trp_player"),
      (store_div, ":var7", ":var6", ":var5"),
      (val_min, ":var1", ":var7"),
      (assign, reg5, ":var1"),
      (try_begin),
        (eq, ":var1", 0),
        (str_store_string, s18, "@No one here seems to be willing to join your party."),
      (else_try),
        (store_mul, reg6, ":var1", ":var5"),
        (str_store_troop_name_by_count, s3, ":var0", ":var1"),
        (try_begin),
          (eq, reg5, 1),
          (str_store_string, s18, "@One {s3} volunteers to follow you."),
        (else_try),
          (str_store_string, s18, "@{reg5} {s3} volunteer to follow you."),
        (try_end),
        (party_get_slot, ":var8", "$current_town", 19),
        (try_begin),
          (eq, ":var8", "fac_culture_1"),
          (set_background_mesh, "mesh_pic_recruit_usa"),
        (else_try),
          (eq, ":var8", "fac_culture_2"),
          (set_background_mesh, "mesh_pic_recruit_mexico"),
        (else_try),
          (eq, ":var8", "fac_culture_3"),
          (set_background_mesh, "mesh_pic_recruit_apache"),
        (else_try),
          (eq, ":var8", "fac_culture_4"),
          (set_background_mesh, "mesh_pic_recruit_comanche"),
        (else_try),
          (eq, ":var8", "fac_culture_5"),
          (set_background_mesh, "mesh_pic_recruit_gang_bandit"),
        (else_try),
          (eq, ":var8", "fac_culture_6"),
          (set_background_mesh, "mesh_pic_recruit_gang_lawmen"),
        (else_try),
          (eq, ":var8", "fac_culture_7"),
          (set_background_mesh, "mesh_pic_recruit_gang_outlaw"),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [
        (eq, reg5, 0),
      ],
      "Continue...",
      [
        (party_set_slot, "$current_town", 223, -1),
        (jump_to_menu, "mnu_village"),
      ]
      ),

      ("recruit_them",
      [
        (gt, reg5, 0),
      ],
      "Recruit_them_({reg6}_cents).",
      [
        (call_script, "script_village_recruit_volunteers_recruit"),
        (jump_to_menu, "mnu_village"),
      ]
      ),

      ("forget_it",
      [
        (gt, reg5, 0),
      ],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_hunt_down_fugitive_defeated", 0,
    "A heavy blow from the fugitive sends you to the ground, and your vision spins and goes dark. Time passes. When you open your eyes again you find yourself battered and bloody, but luckily none of the wounds appear to be lethal.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_infest_bandits_result", mnf_scale_picture,
    "{s9}",
    "none",
    [
      (try_begin),
        (eq, "$g_battle_result", 1),
        (jump_to_menu, "mnu_village_infestation_removed"),
      (else_try),
        (str_store_string, s9, "@Try as you might, you could not defeat the bandits. Infuriated, they raze the village to the ground to punish the locals, and then leave the burning wasteland behind to find greener pastures to plunder."),
        (set_background_mesh, "mesh_pic_looted_village"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (party_set_slot, "$g_encountered_party", 39, 0),
        (call_script, "script_village_set_state", "$current_town", 2),
        (party_set_slot, "$current_town", 36, 0),
        (party_set_slot, "$current_town", 37, 0),
        (try_begin),
          (check_quest_active, "qst_eliminate_bandits_infesting_village"),
          (quest_slot_eq, "qst_eliminate_bandits_infesting_village", 1, "$g_encountered_party"),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -5),
          (call_script, "script_fail_quest", "qst_eliminate_bandits_infesting_village"),
        (else_try),
          (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
          (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", 1, "$g_encountered_party"),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -4),
          (call_script, "script_fail_quest", "qst_deal_with_bandits_at_lords_village"),
        (else_try),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
        (try_end),
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_infestation_removed", mnf_disable_all_keys,
    "In a battle worthy of song, you and your men drive the bandits out of the village, making it safe once more. The villagers have little left in the way of wealth after their ordeal, but they offer you all they can find.",
    "none",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 39),
      (party_set_slot, "$g_encountered_party", 39, 0),
      (party_clear, "p_temp_party"),
      (party_add_members, "p_temp_party", ":var0", "$qst_eliminate_bandits_infesting_village_num_bandits"),
      (assign, "$g_strength_contribution_of_player", 50),
      (call_script, "script_party_give_xp_and_gold", "p_temp_party"),
      (try_begin),
        (check_quest_active, "qst_eliminate_bandits_infesting_village"),
        (quest_slot_eq, "qst_eliminate_bandits_infesting_village", 1, "$g_encountered_party"),
        (call_script, "script_end_quest", "qst_eliminate_bandits_infesting_village"),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 5),
      (else_try),
        (check_quest_active, "qst_deal_with_bandits_at_lords_village"),
        (quest_slot_eq, "qst_deal_with_bandits_at_lords_village", 1, "$g_encountered_party"),
        (call_script, "script_succeed_quest", "qst_deal_with_bandits_at_lords_village"),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
      (else_try),
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 4),
      (try_end),
      (party_get_slot, ":var1", "$current_town", 25),
      (try_for_range, ":var2", 10, 74),
        (store_random_in_range, ":var3", 0, 100),
        (lt, ":var3", 70),
        (troop_set_inventory_slot, ":var1", ":var2", -1),
      (try_end),
    ],
    [
      ("village_bandits_defeated_accept",
      [],
      "Take_it_as_your_just_due.",
      [
        (jump_to_menu, "mnu_village"),
        (party_get_slot, ":var0", "$current_town", 25),
        (call_script, "script_replace_standard_ammo", "trp_temp_troop"),
        (call_script, "script_override_unuseable_items_sub", "trp_temp_troop"),
        (troop_sort_inventory, ":var0"),
        (change_screen_loot, ":var0"),
      ]
      ),

      ("village_bandits_defeated_cont",
      [],
      "Refuse,_stating_that_they_need_these_items_more_than_you_do.",
      [
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("center_manage", 0,
    "{s19}^{reg6?^^You are currently building {s7}. The building will be completed after {reg8} day{reg9?s:}.:}",
    "none",
    [
      (assign, ":var0", 0),
      (str_clear, s18),
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (assign, ":var1", 130),
        (assign, ":var2", 143),
        (str_store_string, s17, "@village"),
      (else_try),
        (assign, ":var1", 142),
        (assign, ":var2", 144),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (troop_slot_eq, "trp_party_type_2", "$g_encountered_party", 2),
        (str_store_string, s17, "@hotel"),
      (else_try),
        (assign, ":var1", 142),
        (assign, ":var2", 144),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (str_store_string, s17, "@town"),
      (else_try),
        (str_store_string, s17, "@fort"),
      (try_end),
      (try_for_range, ":var3", ":var1", ":var2"),
        (party_slot_ge, "$g_encountered_party", ":var3", 1),
        (val_add, ":var0", 1),
        (call_script, "script_get_improvement_details", ":var3"),
        (try_begin),
          (eq, ":var0", 1),
          (str_store_string, s18, "@{s0}"),
        (else_try),
          (str_store_string, s18, "@{s18}, {s0}"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var0", 0),
        (str_store_string, s19, "@The {s17} has no improvements."),
      (else_try),
        (str_store_string, s19, "@The {s17} has the following improvements:{s18}."),
      (try_end),
      (assign, reg6, 0),
      (try_begin),
        (party_get_slot, ":var4", "$g_encountered_party", 124),
        (gt, ":var4", 0),
        (call_script, "script_get_improvement_details", ":var4"),
        (str_store_string, s7, s0),
        (assign, reg6, 1),
        (store_current_hours, ":var5"),
        (party_get_slot, ":var6", "$g_encountered_party", 125),
        (val_sub, ":var6", ":var5"),
        (store_div, reg8, ":var6", 24),
        (val_max, reg8, 1),
        (store_sub, reg9, reg8, 1),
      (try_end),
    ],
    [
      ("center_build_manor",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 130, 0),
      ],
      "Build_a_manor.",
      [
        (assign, "$g_improvement_type", 130),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_hotel",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 131, 0),
      ],
      "Build_a_hotel.",
      [
        (assign, "$g_improvement_type", 131),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_stable",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 131, 1),
        (party_slot_eq, "$g_encountered_party", 132, 0),
      ],
      "Build_a_livery_stable.",
      [
        (assign, "$g_improvement_type", 132),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_waystation",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 132, 1),
        (party_slot_eq, "$g_encountered_party", 133, 0),
      ],
      "Build_a_way_station.",
      [
        (assign, "$g_improvement_type", 133),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_saloon",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 131, 1),
        (party_slot_eq, "$g_encountered_party", 134, 0),
      ],
      "Build_a_saloon.",
      [
        (assign, "$g_improvement_type", 134),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_gambling",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 134, 1),
        (party_slot_eq, "$g_encountered_party", 135, 0),
      ],
      "Build_gambling_tables.",
      [
        (assign, "$g_improvement_type", 135),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_bordello",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 135, 1),
        (party_slot_eq, "$g_encountered_party", 136, 0),
      ],
      "Build_a_bordello.",
      [
        (assign, "$g_improvement_type", 136),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_prospectors",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 137, 0),
      ],
      "Build_placer_mining.",
      [
        (assign, "$g_improvement_type", 137),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_sluice",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 137, 1),
        (party_slot_eq, "$g_encountered_party", 138, 0),
      ],
      "Build_sluice_mining.",
      [
        (assign, "$g_improvement_type", 138),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_fish_pond",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 138, 1),
        (party_slot_eq, "$g_encountered_party", 139, 0),
      ],
      "Build_industrial_mining.",
      [
        (assign, "$g_improvement_type", 139),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_watch_tower",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 140, 0),
      ],
      "Build_a_watch_tower.",
      [
        (assign, "$g_improvement_type", 140),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_school",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 0, 4),
        (party_slot_eq, "$g_encountered_party", 141, 0),
      ],
      "Build_a_school.",
      [
        (assign, "$g_improvement_type", 141),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_messenger_post",
      [
        (eq, reg6, 0),
        (party_slot_eq, "$g_encountered_party", 142, 0),
      ],
      "Build_a_messenger_post.",
      [
        (assign, "$g_improvement_type", 142),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("center_build_prisoner_tower",
      [
        (eq, reg6, 0),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 3),
        (party_slot_eq, "$g_encountered_party", 0, 2),
        (party_slot_eq, "$g_encountered_party", 143, 0),
      ],
      "Build_a_jailhouse.",
      [
        (assign, "$g_improvement_type", 143),
        (jump_to_menu, "mnu_center_improve"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "$g_next_menu"),
      ]
      ),
    ],
  ),

  ("center_improve", 0,
    "{s19} As the party member with the highest engineer skill ({reg2}), {reg3?you reckon:{s3} reckons} that building the {s4} will cost you {reg5} cents and will take {reg6} days.",
    "none",
    [
      (call_script, "script_get_improvement_details", "$g_improvement_type"),
      (assign, ":var0", reg0),
      (str_store_string, s4, s0),
      (str_store_string, s19, s1),
      (call_script, "script_get_max_skill_of_player_party", "skl_engineer"),
      (assign, ":var1", reg0),
      (assign, ":var2", reg1),
      (assign, reg2, ":var1"),
      (store_sub, ":var3", 20, ":var1"),
      (val_mul, ":var0", ":var3"),
      (val_div, ":var0", 20),
      (store_div, ":var4", ":var0", 150),
      (val_add, ":var4", 3),
      (assign, reg5, ":var0"),
      (assign, reg6, ":var4"),
      (try_begin),
        (eq, ":var2", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s3, ":var2"),
      (try_end),
    ],
    [
      ("improve_cont",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", reg5),
      ],
      "Go_on.",
      [
        (troop_remove_gold, "trp_player", reg5),
        (party_set_slot, "$g_encountered_party", 124, "$g_improvement_type"),
        (store_current_hours, ":var0"),
        (store_mul, ":var1", reg6, 24),
        (val_add, ":var1", ":var0"),
        (party_set_slot, "$g_encountered_party", 125, ":var1"),
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("forget_it",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", reg5),
      ],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("improve_not_enough_gold",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (lt, ":var0", reg5),
      ],
      "I_don't_have_enough_money_for_that.",
      [
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),
    ],
  ),

  ("town_bandits_failed", mnf_disable_all_keys,
    "{s4} {s5}",
    "none",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (store_div, ":var1", ":var0", 30),
      (store_random_in_range, ":var2", 40, 100),
      (val_add, ":var1", ":var2"),
      (val_min, ":var1", ":var0"),
      (troop_remove_gold, "trp_player", ":var1"),
      (party_set_slot, "$current_town", 149, 0),
      (party_get_num_companions, ":var3", "p_main_party"),
      (str_store_string, s4, "@The assasins beat you down and leave you for dead. ."),
      (str_store_string, s4, "@You have fallen. The bandits quickly search your body for every coin they can find, then vanish into the night. They have left you alive, if only barely."),
      (try_begin),
        (gt, ":var3", 2),
        (str_store_string, s5, "@Luckily some of your companions come to search for you when you do not return, and find you lying by the side of the road. They hurry you to safety and dress your wounds."),
      (else_try),
        (str_store_string, s5, "@Luckily some passing townspeople find you lying by the side of the road, and recognise you as something other than a simple beggar. They carry you to the nearest inn and dress your wounds."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("town_bandits_succeeded", mnf_disable_all_keys,
    "Your attackers fall before you as wheat to a scythe! Soon you stand alone in the road while most of them lie unconscious, dead or dying. Searching the bodies, you find a purse which must have belonged to a previous victim of these brutes.",
    "none",
    [
      (party_set_slot, "$current_town", 149, 0),
      (assign, "$g_last_defeated_bandits_town", "$g_encountered_party"),
      (try_begin),
        (check_quest_active, "qst_deal_with_night_bandits"),
        (neg|check_quest_succeeded, "qst_deal_with_night_bandits"),
        (quest_slot_eq, "qst_deal_with_night_bandits", 1, "$g_encountered_party"),
        (call_script, "script_succeed_quest", "qst_deal_with_night_bandits"),
      (try_end),
      (store_mul, ":var0", "$num_center_bandits", 117),
      (add_xp_to_troop, ":var0", "trp_player"),
      (store_random_in_range, ":var1", 25, 100),
      (store_mul, ":var2", "$num_center_bandits", ":var1"),
      (call_script, "script_troop_add_gold", "trp_player", ":var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_steal_cattle_confirm", 0,
    "As the party member with the highest looting skill ({reg2}), {reg3?you reckon:{s1} reckons} that you can steal as many as {reg4} heads of village's cattle.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
      (assign, reg2, reg0),
      (assign, ":var0", reg1),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var0"),
      (try_end),
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, reg4, reg0),
    ],
    [
      ("village_steal_cattle_confirm",
      [],
      "Go_on.",
      [
        (rest_for_hours_interactive, 3, 5, 1),
        (assign, "$auto_menu", "mnu_village_steal_cattle"),
        (change_screen_return),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_steal_cattle", mnf_disable_all_keys,
    "{s1}",
    "none",
    [
      (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
      (assign, ":var0", reg0),
      (val_add, ":var0", 1),
      (store_random_in_range, ":var1", 0, ":var0"),
      (party_set_slot, "$current_town", 46, 1),
      (party_get_slot, ":var2", "$current_town", 7),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":var3", reg0),
        (store_random_in_range, ":var4", 0, 100),
        (this_or_next|le, ":var4", ":var3"),
        (le, ":var1", 0),
        (call_script, "script_change_player_relation_with_center", "$current_town", -3),
        (try_begin),
          (lt, ":var3", 25),
          (str_store_string, s1, "@Forget the cattle! Prepare to fight for you live!"),
          (display_log_message, "@You fail to steal any cattle. The locals caught you in the act and some of them gather to arms.", 0xB22222),
          (call_script, "script_calculate_battle_advantage"),
          (set_battle_advantage, reg0),
          (set_party_battle_mode),
          (assign, "$g_battle_result", 0),
          (set_jump_mission, "mt_village_raid"),
          (party_get_slot, ":var5", "$current_town", 10),
          (jump_to_scene, ":var5"),
          (assign, "$g_next_menu", "mnu_auto_return_to_map"),
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
        (else_try),
          (str_store_string, s1, "@You fail to steal any cattle. The locals caught you in the act but are too weak to resist."),
        (try_end),
      (else_try),
        (assign, reg17, ":var1"),
        (store_sub, reg12, ":var1", 1),
        (try_begin),
          (gt, ":var2", 0),
          (call_script, "script_change_player_relation_with_troop", ":var2", -3),
        (try_end),
        (call_script, "script_change_player_relation_with_center", "$current_town", -5),
        (call_script, "script_change_center_prosperity", "$current_town", -15),
        (str_store_string, s1, "@You drive away {reg17} {reg12?heads:head} of cattle from the village's herd."),
        (call_script, "script_create_cattle_herd", "$current_town", ":var1"),
        (party_get_slot, ":var6", "$current_town", 45),
        (val_sub, ":var6", ":var1"),
        (party_set_slot, "$current_town", 45, ":var6"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_steal_horses_confirm", 0,
    "As the party member with the highest looting skill ({reg2}), {reg3?you reckon:{s1} reckons} that you can steal as many as {reg4} village's horses.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
      (assign, reg2, reg0),
      (assign, ":var0", reg1),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var0"),
      (try_end),
      (store_add, reg4, reg2, 2),
    ],
    [
      ("village_steal_horses_confirm",
      [],
      "Go_on.",
      [
        (rest_for_hours_interactive, 3, 5, 1),
        (assign, "$auto_menu", "mnu_village_steal_horses"),
        (change_screen_return),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_steal_horses", mnf_disable_all_keys,
    "{s1}",
    "none",
    [
      (store_faction_of_party, ":var0", "$current_town"),
      (call_script, "script_get_max_skill_of_player_party", "skl_looting"),
      (assign, reg2, reg0),
      (store_add, ":var1", reg2, 2),
      (assign, ":var2", ":var1"),
      (val_add, ":var2", 1),
      (store_random_in_range, ":var3", 0, ":var2"),
      (party_get_slot, ":var4", "$current_town", 7),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, ":var5", reg0),
        (store_random_in_range, ":var6", 0, 100),
        (this_or_next|le, ":var6", ":var5"),
        (le, ":var3", 0),
        (call_script, "script_change_player_relation_with_center", "$current_town", -3),
        (try_begin),
          (lt, ":var5", 25),
          (str_store_string, s1, "@Forget the horses! Prepare to fight for your life!"),
          (display_log_message, "@You fail to steal any horses. The locals caught you in the act and gather to arms.", 0xB22222),
          (call_script, "script_calculate_battle_advantage"),
          (set_battle_advantage, reg0),
          (set_party_battle_mode),
          (assign, "$g_battle_result", 0),
          (set_jump_mission, "mt_village_raid"),
          (party_get_slot, ":var7", "$current_town", 10),
          (jump_to_scene, ":var7"),
          (assign, "$g_next_menu", "mnu_auto_return_to_map"),
          (jump_to_menu, "mnu_battle_debrief"),
          (change_screen_mission),
          (change_screen_mission),
        (else_try),
          (str_store_string, s1, "@You fail to steal any horses. The locals caught you in the act but are too weak to resist."),
        (try_end),
      (else_try),
        (assign, reg17, ":var3"),
        (try_begin),
          (gt, ":var4", 0),
          (call_script, "script_change_player_relation_with_troop", ":var4", -3),
        (try_end),
        (call_script, "script_change_player_relation_with_center", "$current_town", -5),
        (call_script, "script_change_center_prosperity", "$current_town", -10),
        (str_store_string, s1, "@You drive away {reg17} horses from the village's herd."),
        (try_for_range, ":var8", 0, ":var3"),
          (try_begin),
            (this_or_next|eq, ":var0", "fac_kingdom_3"),
            (eq, ":var0", "fac_kingdom_4"),
            (store_random_in_range, ":var9", "itm_feral_horse", "itm_appaloosa_blue_roan"),
          (else_try),
            (store_random_in_range, ":var9", "itm_feral_horse", "itm_standardbred_chestnut"),
          (try_end),
          (troop_add_items, "trp_player", ":var9", 1),
        (try_end),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_take_food_confirm", 0,
    "It will be difficult to force and threaten the locals into giving their precious supplies. You think you will need at least one hour.",
    "none",
    [],
    [
      ("village_take_food_confirm_go_ahead",
      [],
      "Go_ahead.",
      [
        (rest_for_hours_interactive, 1, 5, 0),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (assign, "$auto_enter_menu_in_center", "mnu_village_take_food"),
        (change_screen_return),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_village_hostile_action"),
      ]
      ),
    ],
  ),

  ("village_take_food", 0,
    "The villagers grudgingly bring out what they have for you.",
    "none",
    [
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (assign, ":var0", reg0),
      (call_script, "script_party_count_members_with_full_health", "$current_town"),
      (assign, ":var1", reg0),
      (try_begin),
        (lt, ":var0", 6),
        (ge, ":var1", 40),
        (neg|party_slot_eq, "$current_town", 7, "trp_player"),
        (jump_to_menu, "mnu_village_start_attack"),
      (try_end),
    ],
    [
      ("take_supplies",
      [],
      "Take_the_supplies.",
      [
        (try_begin),
          (party_slot_ge, "$current_town", 26, -55),
          (try_begin),
            (party_slot_eq, "$current_town", 7, "trp_player"),
            (call_script, "script_change_player_relation_with_center", "$current_town", -1),
          (else_try),
            (call_script, "script_change_player_relation_with_center", "$current_town", -3),
          (try_end),
        (try_end),
        (party_get_slot, ":var0", "$current_town", 7),
        (try_begin),
          (gt, ":var0", 1),
          (call_script, "script_change_player_relation_with_troop", ":var0", -1),
        (try_end),
        (party_get_slot, ":var1", "$current_town", 25),
        (party_get_skill_level, ":var2", "p_main_party", "skl_looting"),
        (val_mul, ":var2", 3),
        (store_sub, ":var3", 70, ":var2"),
        (try_for_range, ":var4", 10, 74),
          (store_random_in_range, ":var5", 0, 100),
          (lt, ":var5", ":var3"),
          (troop_set_inventory_slot, ":var1", ":var4", -1),
        (try_end),
        (call_script, "script_objectionable_action", 3, "str_steal_from_villagers"),
        (call_script, "script_add_log_entry", 2, "trp_player", "$current_town", -1, -1),
        (jump_to_menu, "mnu_village"),
        (call_script, "script_replace_standard_ammo", "trp_temp_troop"),
        (call_script, "script_override_unuseable_items_sub", "trp_temp_troop"),
        (troop_sort_inventory, ":var1"),
        (change_screen_loot, ":var1"),
      ]
      ),

      ("let_them_keep_it",
      [],
      "Let_them_keep_it.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("village_start_attack", mnf_disable_all_keys,
    "{s1}.",
    "none",
    [
      (try_begin),
        (troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (str_store_string, s1, "@The bank's guards will resist you. You won't get into the bank without defeating them."),
      (else_try),
        (str_store_string, s1, "@Some of the angry villagers grab their weapons and prepare to resist you. It looks like you'll have a fight on your hands if you continue."),
      (try_end),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (assign, ":var0", reg0),
      (call_script, "script_party_count_members_with_full_health", "$current_town"),
      (assign, ":var1", reg0),
      (try_begin),
        (gt, ":var0", 25),
        (jump_to_menu, "mnu_village_loot_no_resist"),
      (else_try),
        (this_or_next|eq, ":var1", 0),
        (eq, "$g_battle_result", 1),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (store_random_in_range, ":var2", -30, -15),
          (call_script, "script_change_player_relation_with_center", "$current_town", ":var2"),
          (party_get_slot, ":var3", "$current_town", 7),
          (gt, ":var3", 0),
          (call_script, "script_change_player_relation_with_troop", ":var3", -3),
        (try_end),
        (jump_to_menu, "mnu_village_loot_no_resist"),
      (else_try),
        (eq, "$g_battle_result", -1),
        (jump_to_menu, "mnu_village_loot_defeat"),
      (try_end),
    ],
    [
      ("village_raid_attack",
      [],
      "Charge_them.",
      [
        (store_random_in_range, ":var0", -10, -5),
        (call_script, "script_change_player_relation_with_center", "$current_town", ":var0"),
        (try_begin),
          (party_get_slot, ":var1", "$current_town", 7),
          (gt, ":var1", 0),
          (call_script, "script_change_player_relation_with_troop", ":var1", -3),
        (try_end),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (assign, "$g_battle_result", 0),
        (assign, "$g_village_raid_evil", 1),
        (set_jump_mission, "mt_village_raid"),
        (try_begin),
          (troop_slot_eq, "trp_party_type_2", "$current_town", 1),
          (troop_get_slot, ":var2", "trp_party_source_party", "$current_town"),
          (party_get_slot, ":var3", ":var2", 10),
        (else_try),
          (party_get_slot, ":var3", "$current_town", 10),
        (try_end),
        (jump_to_scene, ":var3"),
        (assign, "$g_next_menu", "mnu_village_start_attack"),
        (call_script, "script_objectionable_action", 3, "str_loot_village"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("village_raid_leave",
      [],
      "Leave_this_village_alone.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_loot_no_resist", 0,
    "The villagers here are few and frightened, and they quickly scatter and run before you. The village is at your mercy.",
    "none",
    [],
    [
      ("village_loot_2",
      [],
      "Plunder_the_village,_then_raze_it.",
      [
        (call_script, "script_village_set_state", "$current_town", 1),
        (party_set_slot, "$current_town", 34, "p_main_party"),
        (assign, "$g_player_raiding_village", "$current_town"),
        (rest_for_hours, 3, 5, 1),
        (change_screen_return),
      ]
      ),

      ("village_raid_leave",
      [],
      "Leave_this_village_alone.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_loot_complete", mnf_disable_all_keys,
    "On your orders your troops sack the village, pillaging everything of any value, and then put the buildings to the torch. From the coins and valuables that are found, you get your share of {reg1} cents.",
    "none",
    [
      (party_get_slot, ":var0", "$current_town", 7),
      (try_begin),
        (gt, ":var0", 0),
        (call_script, "script_change_player_relation_with_troop", ":var0", -5),
      (try_end),
      (store_random_in_range, ":var1", -40, -20),
      (call_script, "script_change_player_relation_with_center", "$current_town", ":var1"),
      (store_faction_of_party, ":var2", "$current_town"),
      (store_relation, ":var3", ":var2", "fac_player_supporters_faction"),
      (try_begin),
        (lt, ":var3", 0),
        (call_script, "script_change_player_relation_with_faction", ":var2", -3),
      (try_end),
      (store_random_in_range, ":var4", 10, 20),
      (call_script, "script_change_player_party_morale", ":var4"),
      (store_random_in_range, reg1, 100, 500),
      (call_script, "script_troop_add_gold", "trp_player", reg1),
      (call_script, "script_objectionable_action", 3, "str_loot_village"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_close"),
        (call_script, "script_calculate_amount_of_cattle_can_be_stolen", "$current_town"),
        (assign, ":var0", reg0),
        (val_mul, ":var0", 3),
        (val_div, ":var0", 2),
        (party_get_slot, ":var1", "$current_town", 45),
        (val_min, ":var0", ":var1"),
        (val_add, ":var0", 1),
        (store_random_in_range, ":var2", 0, ":var0"),
        (try_begin),
          (gt, ":var2", 0),
          (call_script, "script_create_cattle_herd", "$current_town", ":var2"),
          (val_sub, ":var1", ":var2"),
          (party_set_slot, "$current_town", 45, ":var1"),
        (try_end),
        (troop_clear_inventory, "trp_temp_troop"),
        (reset_item_probabilities, 100),
        (troop_add_merchandise, "trp_temp_troop", itp_type_goods, 45),
        (call_script, "script_replace_standard_ammo", "trp_temp_troop"),
        (call_script, "script_override_unuseable_items_sub", "trp_temp_troop"),
        (troop_sort_inventory, "trp_temp_troop"),
        (change_screen_loot, "trp_temp_troop"),
      ]
      ),
    ],
  ),

  ("village_loot_defeat", 0,
    "Fighting with courage and determination, the villagers manage to hold together and drive off your forces.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("village_loot_continue", 0,
    "Do you wish to continue looting this village?",
    "none",
    [],
    [
      ("disembark_yes",
      [],
      "Yes.",
      [
        (rest_for_hours, 3, 5, 1),
        (change_screen_return),
      ]
      ),

      ("disembark_no",
      [],
      "No.",
      [
        (call_script, "script_village_set_state", "$current_town", 0),
        (party_set_slot, "$current_town", 34, -1),
        (assign, "$g_player_raiding_village", 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("close", 0,
    "Nothing.",
    "none",
    [
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("center_tax", mnf_disable_all_keys,
    "For this town you receive {reg2} cents in rents and {reg3} cents from trade.",
    "none",
    [
      (str_clear, s3),
      (try_begin),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (party_get_slot, ":var0", "$current_town", 47),
        (party_get_slot, ":var1", "$current_town", 48),
        (store_add, ":var2", ":var0", ":var1"),
        (assign, reg1, ":var2"),
        (assign, reg2, ":var0"),
        (assign, reg3, ":var1"),
        (call_script, "script_troop_add_gold", "trp_player", ":var2"),
        (party_set_slot, "$current_town", 47, 0),
        (party_set_slot, "$current_town", 48, 0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (party_slot_eq, "$current_town", 0, 4),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
      ]
      ),
    ],
  ),

  ("town", mnf_enable_hot_keys,
    "{s10}{s11}{s12}{s13}",
    "none",
    [
      (try_begin),
        (eq, "$sneaked_into_town", 1),
        (call_script, "script_music_set_situation_with_culture", 16384),
      (else_try),
        (call_script, "script_music_set_situation_with_culture", 8192),
      (try_end),
      (store_encountered_party, "$current_town"),
      (call_script, "script_update_center_recon_notes", "$current_town"),
      (assign, "$g_defending_against_siege", 0),
      (str_clear, s3),
      (party_get_battle_opponent, ":var0", "$current_town"),
      (store_faction_of_party, ":var1", "$g_encountered_party"),
      (store_relation, ":var2", ":var1", "fac_player_supporters_faction"),
      (try_begin),
        (gt, ":var0", 0),
        (ge, ":var2", 0),
        (store_faction_of_party, ":var3", ":var0"),
        (store_relation, ":var4", ":var3", "fac_player_supporters_faction"),
        (lt, ":var4", 0),
        (assign, "$g_defending_against_siege", 1),
        (assign, "$g_siege_first_encounter", 1),
        (jump_to_menu, "mnu_siege_started_defender"),
      (try_end),
      (assign, "$qst_collect_taxes_currently_collecting", 0),
      (try_begin),
        (gt, "$quest_auto_menu", 0),
        (jump_to_menu, "$quest_auto_menu"),
        (assign, "$quest_auto_menu", 0),
      (try_end),
      (try_begin),
        (eq, "$g_town_assess_trade_goods_after_rest", 1),
        (assign, "$g_town_assess_trade_goods_after_rest", 0),
        (jump_to_menu, "mnu_town_trade_assessment"),
      (try_end),
      (assign, "$talk_context", 0),
      (assign, "$all_doors_locked", 0),
      (try_begin),
        (eq, "$g_town_visit_after_rest", 1),
        (assign, "$g_town_visit_after_rest", 0),
        (assign, "$town_entered", 1),
      (try_end),
      (try_begin),
        (eq, "$g_leave_town", 1),
        (assign, "$g_leave_town", 0),
        (assign, "$g_permitted_to_center", 0),
        (leave_encounter),
        (change_screen_return),
      (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (party_get_slot, ":var5", "$current_town", 47),
        (gt, ":var5", 0),
        (jump_to_menu, "mnu_center_tax"),
      (try_end),
      (str_store_party_name, s2, "$current_town"),
      (party_get_slot, ":var6", "$current_town", 7),
      (store_faction_of_party, ":var7", "$current_town"),
      (str_store_faction_name, s9, ":var7"),
      (try_begin),
        (ge, ":var6", 0),
        (str_store_troop_name, s8, ":var6"),
        (str_store_string, s7, "@{s8} of {s9}"),
      (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (str_store_string, s60, s2),
        (party_get_slot, ":var8", "$current_town", 50),
        (val_add, ":var8", 5),
        (store_div, ":var9", ":var8", 10),
        (store_add, ":var10", "str_town_prosperity_0", ":var9"),
        (str_store_string, s10, ":var10"),
      (else_try),
        (str_store_string, s10, "@You are at {s2}."),
      (try_end),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 2),
        (try_begin),
          (eq, ":var6", "trp_player"),
          (str_store_string, s11, "@ You control this fort."),
        (else_try),
          (ge, ":var6", 0),
          (str_store_string, s11, "@ This fort is under the control of {s7}."),
        (else_try),
          (str_store_string, s11, "@ This fort seems to be controlled by no one."),
        (try_end),
      (else_try),
        (try_begin),
          (eq, ":var6", "trp_player"),
          (str_store_string, s11, "@ You control this town."),
        (else_try),
          (ge, ":var6", 0),
          (str_store_string, s11, "@ This town is under the control of {s7}."),
        (else_try),
          (str_store_string, s11, "@ The townsfolk here have declared their independence."),
        (try_end),
      (try_end),
      (str_clear, s12),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (party_get_slot, ":var11", "$current_town", 26),
        (call_script, "script_describe_center_relation_to_s3", ":var11"),
        (assign, reg9, ":var11"),
        (str_store_string, s12, "@ {s3} ({reg9})."),
      (try_end),
      (str_clear, s13),
      (try_begin),
        (eq, "$sneaked_into_town", 1),
        (str_store_string, s13, "@ You have successfully sneaked in."),
      (try_end),
      (try_begin),
        (store_time_of_day, reg12),
        (ge, reg12, 5),
        (lt, reg12, 21),
        (assign, "$town_nighttime", 0),
      (else_try),
        (assign, "$town_nighttime", 1),
        (party_slot_eq, "$current_town", 0, 3),
        (str_store_string, s13, "str_town_nighttime"),
      (try_end),
      (try_begin),
        (party_slot_ge, "$current_town", 150, 1),
        (neg|is_currently_night),
        (party_set_slot, "$current_town", 150, 1),
        (str_store_string, s13, "@{s13} A tournament will be held here soon."),
      (try_end),
      (assign, "$castle_undefended", 0),
      (party_get_num_companions, ":var12", "p_collective_enemy"),
      (try_begin),
        (eq, ":var12", 0),
        (assign, "$castle_undefended", 1),
      (try_end),
    ],
    [
      ("recruit_volunteers",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (party_slot_ge, "$current_town", 223, 0),
        (party_slot_ge, "$current_town", 222, 1),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (this_or_next|eq, "$players_kingdom", 0),
        (eq, "$sneaked_into_town", 1),
        (store_faction_of_party, ":var0", "$current_town"),
        (assign, ":var1", 0),
        (try_begin),
          (this_or_next|eq, "$players_kingdom", 0),
          (neg|faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 1),
          (assign, ":var1", 1),
        (else_try),
          (gt, "$players_kingdom", 0),
          (faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 0),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 1),
      ],
      "Recruit_Volunteers.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (jump_to_menu, "mnu_recruit_volunteers_town"),
        (try_end),
      ]
      ),

      ("recruit_volunteers",
      [
        (party_slot_eq, "$current_town", 0, 2),
        (party_slot_ge, "$current_town", 223, 0),
        (party_slot_ge, "$current_town", 222, 1),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$players_kingdom", 0),
        (store_faction_of_party, ":var0", "$current_town"),
        (assign, ":var1", 0),
        (try_begin),
          (this_or_next|eq, "$players_kingdom", 0),
          (neg|faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 1),
          (assign, ":var1", 1),
        (else_try),
          (gt, "$players_kingdom", 0),
          (faction_slot_eq, "$players_kingdom", 100, 0),
          (faction_slot_eq, ":var0", 100, 0),
          (assign, ":var1", 1),
        (try_end),
        (eq, ":var1", 1),
      ],
      "Recruit_Volunteers.",
      [
        (jump_to_menu, "mnu_recruit_volunteers_castle"),
      ]
      ),

      ("castle_castle",
      [
        (party_slot_eq, "$current_town", 0, 2),
      ],
      "Go_to_the_Commander's_hall.",
      [
        (try_begin),
          (eq, "$all_doors_locked", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_court", "$current_town"),
        (try_end),
      ]
,
      "Door_to_the_castle."
      ),

      ("hotel_castle",
      [
        (troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 0, 3),
        (eq, "$entry_to_town_forbidden", 0),
      ],
      "Enter_the_hotel.",
      [
        (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (eq, "$sneaked_into_town", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_court", "$current_town"),
        (try_end),
      ]
,
      "Door_to_the_hotel."
      ),

      ("town_castle",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 1),
        (party_slot_eq, "$current_town", 0, 3),
        (try_begin),
          (troop_slot_eq, "trp_party_type_2", "$current_town", 2),
          (assign, "$entry_to_town_forbidden", 0),
        (try_end),
        (eq, "$entry_to_town_forbidden", 0),
      ],
      "Go_to_the_commander's_room.",
      [
        (try_begin),
          (this_or_next|eq, "$all_doors_locked", 1),
          (eq, "$sneaked_into_town", 1),
          (display_message, "str_door_locked", 0xFFFFAAAA),
        (else_try),
          (assign, "$town_entered", 1),
          (call_script, "script_enter_court", "$current_town"),
        (try_end),
      ]
,
      "Door_to_the_castle."
      ),

      ("town_center",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 2),
        (party_slot_eq, "$current_town", 0, 3),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$sneaked_into_town", 1),
      ],
      "Take_a_walk_around_the_streets.",
      [
        (mission_tpl_entry_clear_override_items, "mt_town_center", 0),
        (mission_tpl_entry_clear_override_items, "mt_town_center", 1),
        (mission_tpl_entry_set_override_flags, "mt_town_center", 0, 256),
        (call_script, "script_enter_town", -1),
      ]
,
      "Door_to_the_town_center."
      ),

      ("town_center_2",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 2),
        (party_slot_eq, "$current_town", 0, 3),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$sneaked_into_town", 1),
      ],
      "Visit_the_saloon.",
      [
        (mission_tpl_entry_clear_override_items, "mt_town_center", 0),
        (mission_tpl_entry_clear_override_items, "mt_town_center", 1),
        (try_begin),
          (mission_tpl_entry_set_override_flags, "mt_town_center", 50, 256),
        (try_end),
        (call_script, "script_enter_town", 50),
      ]
,
      "Hand_over_your_weapons_and_step_in."
      ),

      ("town_castle_2",
      [
        (eq, "$current_town", "p_town_2"),
        (eq, "$entry_to_town_forbidden", 0),
        (eq, 0, 1),
      ],
      "Go_to_the_station.",
      [
        (assign, "$auto_enter_town", "p_bl_station"),
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return, 0),
      ]
      ),

      ("town_fast_travel",
      [
        (this_or_next|eq, "$current_town", "p_town_1"),
        (this_or_next|eq, "$current_town", "p_town_2"),
        (this_or_next|eq, "$current_town", "p_town_4"),
        (this_or_next|eq, "$current_town", "p_town_5"),
        (eq, "$current_town", "p_town_6"),
        (eq, "$entry_to_town_forbidden", 0),
      ],
      "Check_transportation_options.",
      [
        (jump_to_menu, "mnu_fast_travel"),
      ]
      ),

      ("castle_inspect",
      [
        (party_slot_eq, "$current_town", 0, 2),
      ],
      "Take_a_walk_around_the_courtyard.",
      [
        (assign, "$talk_context", 0),
        (party_get_slot, ":var0", "$current_town", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (try_begin),
          (neq, "$g_encountered_party_faction", "fac_player_supporters_faction"),
          (faction_get_slot, ":var1", "$g_encountered_party_faction", 51),
          (set_visitor, 24, ":var1"),
        (try_end),
        (assign, ":var2", 40),
        (party_get_num_companion_stacks, ":var3", "$g_encountered_party"),
        (try_for_range, ":var4", 0, ":var3"),
          (lt, ":var2", 47),
          (party_stack_get_troop_id, ":var5", "$g_encountered_party", ":var4"),
          (neg|troop_is_hero, ":var5"),
          (party_stack_get_size, ":var6", "$g_encountered_party", ":var4"),
          (party_stack_get_num_wounded, ":var7", "$g_encountered_party", ":var4"),
          (val_sub, ":var6", ":var7"),
          (gt, ":var6", 0),
          (party_stack_get_troop_dna, ":var8", "$g_encountered_party", ":var4"),
          (set_visitor, ":var2", ":var5", ":var8"),
          (val_add, ":var2", 1),
        (try_end),
        (try_begin),
          (eq, "$town_entered", 0),
          (assign, "$town_entered", 1),
        (try_end),
        (set_jump_entry, 1),
        (set_jump_mission, "mt_castle_visit"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
,
      "To_the_fort_courtyard."
      ),

      ("trade_with_merchants",
      [
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 2),
        (party_slot_eq, "$current_town", 0, 3),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$sneaked_into_town", 1),
      ],
      "Go_to_the_marketplace.",
      [
        (try_begin),
          (call_script, "script_cf_enter_center_location_bandit_check"),
        (else_try),
          (jump_to_menu, "mnu_town_trade"),
        (try_end),
      ]
      ),

      ("walled_center_manage",
      [
        (neg|party_slot_eq, "$current_town", 35, 5),
        (party_slot_eq, "$current_town", 7, "trp_player"),
        (assign, reg0, 1),
        (try_begin),
          (party_slot_eq, "$current_town", 0, 3),
          (troop_slot_eq, "trp_party_type_2", "$current_town", 2),
          (str_store_string, s6, "@hotel"),
        (else_try),
          (party_slot_eq, "$current_town", 0, 3),
          (str_store_string, s6, "@town"),
        (else_try),
          (party_slot_eq, "$current_town", 0, 2),
          (str_store_string, s6, "@fort"),
        (try_end),
      ],
      "Manage_this_{s6}.",
      [
        (assign, "$g_next_menu", "mnu_town"),
        (jump_to_menu, "mnu_center_manage"),
      ]
      ),

      ("castle_station_troops",
      [
        (party_slot_eq, "$current_town", 7, "trp_player"),
      ],
      "Station_a_garrison_here...",
      [
        (change_screen_exchange_members, 1),
      ]
      ),

      ("town_outlaw_sneak",
      [
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (neg|troop_slot_eq, "trp_party_type_2", "$current_town", 2),
        (store_faction_of_party, ":var0", "$current_town"),
        (store_relation, reg0, "fac_player_supporters_faction", ":var0"),
        (lt, reg0, 0),
        (eq, "$sneaked_into_town", 0),
      ],
      "Disguise_yourself_and_try_to_sneak_into_the_town.",
      [
        (faction_get_slot, ":var0", "$g_encountered_party_faction", 30),
        (party_get_num_companions, ":var1", "p_main_party"),
        (party_get_num_prisoners, ":var2", "p_main_party"),
        (val_add, ":var1", ":var2"),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (store_add, ":var3", ":var0", ":var1"),
        (store_random_in_range, ":var4", 0, 100),
        (try_begin),
          (this_or_next|ge, ":var4", ":var3"),
          (eq, "$g_last_defeated_bandits_town", "$g_encountered_party"),
          (assign, "$g_last_defeated_bandits_town", 0),
          (assign, "$sneaked_into_town", 1),
          (assign, "$town_entered", 1),
          (jump_to_menu, "mnu_sneak_into_town_suceeded"),
        (else_try),
          (jump_to_menu, "mnu_sneak_into_town_caught"),
        (try_end),
      ]
      ),

      ("castle_wait",
      [
        (this_or_next|ge, "$g_encountered_party_relation", 0),
        (this_or_next|eq, "$entry_to_town_forbidden", 0),
        (eq, "$castle_undefended", 1),
        (assign, ":var0", 1),
        (str_clear, s1),
        (try_begin),
          (eq, "$elpaso_house_bought", 1),
          (eq, "$current_town", "p_town_1"),
        (else_try),
          (neg|party_slot_eq, "$current_town", 7, "trp_player"),
          (party_get_num_companions, ":var1", "p_main_party"),
          (store_div, reg1, ":var1", 4),
          (val_add, reg1, 1),
          (val_mul, reg1, 10),
          (str_store_string, s1, "@ ({reg1} cents per night)"),
          (store_troop_gold, ":var2", "trp_player"),
          (lt, ":var2", reg1),
          (assign, ":var0", 0),
        (try_end),
        (eq, ":var0", 1),
      ],
      "Wait_here_for_some_time{s1}.",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
        (rest_for_hours_interactive, 168, 5, 0),
        (change_screen_return),
      ]
      ),

      ("castle_enter_dungeon",
      [
        (troop_slot_eq, "trp_party_type_2", "$current_town", 2),
        (this_or_next|check_quest_active, "qst_rescue_lord_by_replace"),
        (check_quest_active, "qst_deliver_message_to_prisoner_lord"),
        (this_or_next|quest_slot_eq, "qst_rescue_lord_by_replace", 1, "$g_encountered_party"),
        (quest_slot_eq, "qst_deliver_message_to_prisoner_lord", 1, "$g_encountered_party"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 100),
      ],
      "Enter_Prison.",
      [
        (troop_remove_gold, "trp_player", 100),
        (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
      ]
      ),

      ("collect_taxes_qst",
      [
        (check_quest_active, "qst_collect_taxes"),
        (quest_slot_eq, "qst_collect_taxes", 1, "$current_town"),
        (neg|quest_slot_eq, "qst_collect_taxes", 11, 4),
        (quest_get_slot, ":var0", "qst_collect_taxes", 6),
        (str_store_troop_name, s1, ":var0"),
        (quest_get_slot, reg5, "qst_collect_taxes", 11),
      ],
      "{reg5?Continue_collecting_taxes:Collect_taxes}_due_to_{s1}.",
      [
        (jump_to_menu, "mnu_collect_taxes"),
      ]
      ),

      ("town_hostile_action",
      [
        (party_get_slot, ":var0", "$current_town", 7),
        (neq, ":var0", "trp_player"),
      ],
      "Take_a_hostile_action.",
      [
        (jump_to_menu, "mnu_friendly_town_hostile_action"),
      ]
      ),

      ("town_leave",
      [],
      "Leave...",
      [
        (assign, "$g_permitted_to_center", 0),
        (change_screen_return, 0),
      ]
,
      "Leave_Area."
      ),

      ("town_alley",
      [
        (party_slot_eq, "$current_town", 0, 3),
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT:_Go_to_the_alley.",
      [
        (party_get_slot, reg11, "$current_town", 17),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, reg11),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_interior_2",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT:_Interior.",
      [
        (set_jump_mission, "mt_ai_training"),
        (party_get_slot, ":var0", "$current_town", 11),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_town_exterior",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT:_Exterior.",
      [
        (try_begin),
          (party_slot_eq, "$current_town", 0, 2),
          (party_get_slot, ":var0", "$current_town", 10),
        (else_try),
          (party_get_slot, ":var0", "$current_town", 10),
        (try_end),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("castle_cheat_dungeon",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT:_Prison.",
      [
        (call_script, "script_enter_dungeon", "$current_town", "mt_visit_town_castle"),
      ]
      ),

      ("castle_cheat_town_walls_2",
      [
        (eq, "$cheat_mode", 1),
        (party_slot_eq, "$current_town", 0, 3),
      ],
      "CHEAT:_Town_Walls.",
      [
        (party_get_slot, ":var0", "$current_town", 18),
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("center_reports",
      [
        (eq, "$cheat_mode", 1),
      ],
      "CHEAT:_Show_reports.",
      [
        (jump_to_menu, "mnu_center_reports"),
      ]
      ),
    ],
  ),

  ("friendly_town_hostile_action", 0,
    "What action do you have in mind?",
    "none",
    [],
    [
      ("town_start_siege",
      [
        (party_slot_eq, "$g_encountered_party", 54, -1),
        (lt, "$g_encountered_party_2", 1),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 1),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 3),
          (str_store_string, s6, "@town"),
        (else_try),
          (party_slot_eq, "$g_encountered_party", 0, 2),
          (str_store_string, s6, "@fort"),
        (else_try),
          (str_store_string, s6, "@hotel"),
        (try_end),
      ],
      "Besiege_this_{s6}.",
      [
        (assign, "$g_player_besiege_town", "$g_encountered_party"),
        (store_relation, ":var0", "fac_player_supporters_faction", "$g_encountered_party_faction"),
        (val_min, ":var0", -40),
        (call_script, "script_set_player_relation_with_faction", "$g_encountered_party_faction", ":var0"),
        (call_script, "script_update_all_notes"),
        (jump_to_menu, "mnu_castle_besiege"),
      ]
      ),

      ("forget_it",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("fast_travel", 0,
    "The following transportation options are available.",
    "none",
    [],
    [
      ("ferry_from_port_1",
      [
        (eq, "$current_town", "p_town_5"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 200),
      ],
      "Take_steamboat_to_El_Paso_($2).",
      [
        (assign, "$g_destination", "p_town_1"),
        (troop_remove_gold, "trp_player", 200),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("ferry_from_port_2",
      [
        (eq, "$current_town", "p_town_5"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 500),
      ],
      "Take_steamboat_to_Buena_Fortuna_($5).",
      [
        (assign, "$g_destination", "p_town_6"),
        (troop_remove_gold, "trp_player", 500),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("ferry_from_port_3",
      [
        (eq, "$current_town", "p_town_1"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 200),
      ],
      "Take_steamboat_to_El_Rio_($2).",
      [
        (assign, "$g_destination", "p_town_5"),
        (troop_remove_gold, "trp_player", 200),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("ferry_from_port_4",
      [
        (eq, "$current_town", "p_town_1"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 700),
      ],
      "Take_steamboat_to_Buena_Fortuna_($7).",
      [
        (assign, "$g_destination", "p_town_6"),
        (troop_remove_gold, "trp_player", 700),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("ferry_from_port_5",
      [
        (eq, "$current_town", "p_town_6"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 500),
      ],
      "Take_steamboat_to_El_Rio_($5).",
      [
        (assign, "$g_destination", "p_town_5"),
        (troop_remove_gold, "trp_player", 500),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("ferry_from_port_6",
      [
        (eq, "$current_town", "p_town_6"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 700),
      ],
      "Take_steamboat_to_El_Paso_($7).",
      [
        (assign, "$g_destination", "p_town_1"),
        (troop_remove_gold, "trp_player", 700),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("train_from_town_1",
      [
        (eq, "$current_town", "p_town_1"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 200),
      ],
      "Take_train_to_Bishop's_Lodge_($2).",
      [
        (assign, "$g_destination", "p_town_2"),
        (troop_remove_gold, "trp_player", 200),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("train_from_town_2",
      [
        (eq, "$current_town", "p_town_1"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 200),
      ],
      "Take_train_to_San_Casteabro_($2).",
      [
        (assign, "$g_destination", "p_town_4"),
        (troop_remove_gold, "trp_player", 200),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("train_from_town_3",
      [
        (eq, "$current_town", "p_town_2"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 200),
      ],
      "Take_train_to_El_Paso_($2).",
      [
        (assign, "$g_destination", "p_town_1"),
        (troop_remove_gold, "trp_player", 200),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("train_from_town_4",
      [
        (eq, "$current_town", "p_town_2"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 400),
      ],
      "Take_train_to_San_Casteabro_($4).",
      [
        (assign, "$g_destination", "p_town_4"),
        (troop_remove_gold, "trp_player", 400),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("train_from_town_5",
      [
        (eq, "$current_town", "p_town_4"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 200),
      ],
      "Take_train_to_El_Paso_($2).",
      [
        (assign, "$g_destination", "p_town_1"),
        (troop_remove_gold, "trp_player", 200),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("train_from_town_6",
      [
        (eq, "$current_town", "p_town_4"),
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 400),
      ],
      "Take_train_to_Bishop's_Lodge_($4).",
      [
        (assign, "$g_destination", "p_town_2"),
        (troop_remove_gold, "trp_player", 400),
        (jump_to_menu, "mnu_fast_travel_depart"),
      ]
      ),

      ("fast_travel_go_back",
      [],
      "Go_back",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("fast_travel_depart", mnf_scale_picture,
    "You depart on your journey.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (set_camera_follow_party, "$g_destination"),
        (store_random_in_range, ":var0", 16, 20),
        (call_script, "script_stay_captive_for_hours", ":var0"),
        (assign, "$auto_menu", "mnu_fast_travel_arrival_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("fast_travel_arrival_check", 0,
    "stub",
    "none",
    [
      (jump_to_menu, "mnu_fast_travel_arrive"),
    ],
    [
    ],
    [],
  ),

  ("fast_travel_arrive", 0,
    "You arrive at your destination.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (party_relocate_near_party, "p_main_party", "$g_destination", 1),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("town_tournament_lost", 0,
    "You have been eliminated from the tournament.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town_tournament_won_by_another"),
      ]
      ),
    ],
  ),

  ("town_tournament_won", mnf_disable_all_keys,
    "You have won the tournament of {s3}! You are filled with pride as the crowd cheers your name. In addition to honour, fame and glory, you earn a prize of {reg9} cents. {s8}",
    "none",
    [
      (str_store_party_name, s3, "$current_town"),
      (call_script, "script_change_troop_renown", "trp_player", 20),
      (call_script, "script_change_player_relation_with_center", "$current_town", 1),
      (assign, reg9, 200),
      (add_xp_to_troop, 250, "trp_player"),
      (troop_add_gold, "trp_player", reg9),
      (str_clear, s8),
      (store_add, ":var0", "$g_tournament_bet_placed", "$g_tournament_bet_win_amount"),
      (try_begin),
        (gt, "$g_tournament_bet_win_amount", 0),
        (assign, reg8, ":var0"),
        (str_store_string, s8, "@Moreover, you earn {reg8} cents from the clever bets you placed on yourself..."),
      (try_end),
      (troop_add_gold, "trp_player", ":var0"),
      (assign, ":var1", 0),
      (store_div, ":var1", "$g_tournament_bet_win_amount", 5),
      (party_get_slot, ":var2", "$current_town", 51),
      (val_sub, ":var2", ":var1"),
      (val_max, ":var2", 250),
      (party_set_slot, "$current_town", 51, ":var2"),
      (call_script, "script_play_victorious_sound"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("town_tournament_won_by_another", mnf_disable_all_keys,
    "As the only fighter to remain undefeated this day, {s1} wins the lists and the glory of this tournament.",
    "none",
    [
      (call_script, "script_get_num_tournament_participants"),
      (store_sub, ":var0", reg0, 1),
      (call_script, "script_remove_tournament_participants_randomly", ":var0"),
      (call_script, "script_sort_tournament_participant_troops"),
      (troop_get_slot, ":var1", "trp_tournament_participants", 0),
      (str_store_troop_name, s1, ":var1"),
      (try_begin),
        (troop_is_hero, ":var1"),
        (call_script, "script_change_troop_renown", ":var1", 20),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("town_tournament", mnf_disable_all_keys,
    "{s1}You are at tier {reg0} of the tournament, with {reg1} participants remaining. In the next round, there will be {reg2} teams with {reg3} {reg4?fighters:fighter} each.",
    "none",
    [
      (party_set_slot, "$current_town", 150, 0),
      (call_script, "script_sort_tournament_participant_troops"),
      (call_script, "script_get_num_tournament_participants"),
      (assign, ":var0", reg0),
      (try_begin),
        (neg|troop_slot_eq, "trp_tournament_participants", 0, 0),
        (assign, ":var1", 0),
        (store_div, ":var1", "$g_tournament_bet_placed", 5),
        (party_get_slot, ":var2", "$current_town", 51),
        (val_add, ":var2", ":var1"),
        (val_min, ":var2", 4000),
        (party_set_slot, "$current_town", 51, ":var2"),
        (jump_to_menu, "mnu_town_tournament_lost"),
      (else_try),
        (eq, ":var0", 1),
        (jump_to_menu, "mnu_town_tournament_won"),
      (else_try),
        (try_begin),
          (le, "$g_tournament_next_num_teams", 0),
          (call_script, "script_get_random_tournament_team_amount_and_size"),
          (assign, "$g_tournament_next_num_teams", reg0),
          (assign, "$g_tournament_next_team_size", reg1),
        (try_end),
        (assign, reg2, "$g_tournament_next_num_teams"),
        (assign, reg3, "$g_tournament_next_team_size"),
        (store_sub, reg4, reg3, 1),
        (str_clear, s1),
        (try_begin),
          (eq, "$g_tournament_player_team_won", 1),
          (str_store_string, s1, "@Victory is yours! You have won this melee, but now you must prepare yourself for the next round. "),
        (else_try),
          (eq, "$g_tournament_player_team_won", 0),
          (str_store_string, s1, "@You have been bested in this melee, but the master of ceremonies declares a recognition of your skill and bravery, allowing you to take part in the next round. "),
        (try_end),
        (assign, reg1, ":var0"),
        (store_add, reg0, "$g_tournament_cur_tier", 1),
      (try_end),
    ],
    [
      ("tournament_view_participants",
      [],
      "View_participants.",
      [
        (jump_to_menu, "mnu_tournament_participants"),
      ]
      ),

      ("tournament_bet",
      [
        (neq, "$g_tournament_cur_tier", "$g_tournament_last_bet_tier"),
      ],
      "Place_a_bet_on_yourself.",
      [
        (jump_to_menu, "mnu_tournament_bet"),
      ]
      ),

      ("tournament_join_next_fight",
      [],
      "Fight_in_the_next_round.",
      [
        (party_get_slot, ":var0", "$current_town", 16),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (val_add, "$g_tournament_cur_tier", 1),
        (store_mul, "$g_tournament_num_participants_for_fight", "$g_tournament_next_num_teams", "$g_tournament_next_team_size"),
        (troop_set_slot, "trp_tournament_participants", 0, -1),
        (troop_set_slot, "trp_temp_array_a", 0, "trp_player"),
        (try_for_range, ":var1", 1, "$g_tournament_num_participants_for_fight"),
          (call_script, "script_get_random_tournament_participant"),
          (troop_set_slot, "trp_temp_array_a", ":var1", reg0),
        (try_end),
        (call_script, "script_shuffle_troop_slots", "trp_temp_array_a", 0, "$g_tournament_num_participants_for_fight"),
        (try_for_range, ":var1", 0, 4),
          (troop_set_slot, "trp_temp_array_b", ":var1", ":var1"),
        (try_end),
        (call_script, "script_shuffle_troop_slots", "trp_temp_array_b", 0, 4),
        (assign, ":var2", 0),
        (try_for_range, ":var3", 0, "$g_tournament_next_num_teams"),
          (troop_get_slot, ":var4", "trp_temp_array_b", ":var3"),
          (try_for_range, ":var1", 0, 8),
            (troop_set_slot, "trp_temp_array_c", ":var1", ":var1"),
          (try_end),
          (call_script, "script_shuffle_troop_slots", "trp_temp_array_c", 0, 8),
          (try_for_range, ":var5", 0, "$g_tournament_next_team_size"),
            (store_mul, ":var6", ":var4", 8),
            (troop_get_slot, ":var7", "trp_temp_array_c", ":var5"),
            (val_add, ":var6", ":var7"),
            (troop_get_slot, ":var8", "trp_temp_array_a", ":var2"),
            (set_visitor, ":var6", ":var8"),
            (val_add, ":var2", 1),
          (try_end),
        (try_end),
        (assign, "$g_tournament_next_num_teams", 0),
        (assign, "$g_tournament_next_team_size", 0),
        (assign, "$g_mt_mode", 3),
        (party_get_slot, ":var9", "$current_town", 61),
        (assign, ":var10", 0),
        (assign, ":var11", "p_castle_1"),
        (try_for_range, ":var12", "p_town_1", ":var11"),
          (try_begin),
            (eq, ":var12", "$current_town"),
            (assign, ":var11", 0),
          (else_try),
            (party_slot_eq, ":var12", 61, ":var9"),
            (val_add, ":var10", 1),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var9", "fac_kingdom_1"),
          (store_mod, ":var13", ":var10", 4),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 100, 100, 0, 0, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (else_try),
            (eq, ":var13", 2),
            (call_script, "script_set_items_for_tournament", 100, 0, 100, 0, 0, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (else_try),
            (eq, ":var13", 3),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 40, 0, 0, 0, "itm_arena_armor_red", "itm_tourney_helm_red"),
          (try_end),
        (else_try),
          (eq, ":var9", "fac_kingdom_2"),
          (store_mod, ":var13", ":var10", 4),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 0, 0, 0, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 100, 50, 0, 0, 0, 20, 30, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
          (else_try),
            (eq, ":var13", 2),
            (call_script, "script_set_items_for_tournament", 100, 0, 50, 0, 0, 20, 30, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
          (else_try),
            (eq, ":var13", 3),
            (call_script, "script_set_items_for_tournament", 40, 80, 50, 20, 30, 0, 60, 0, "itm_arena_armor_red", "itm_steppe_helmet_red"),
          (try_end),
        (else_try),
          (eq, ":var9", "fac_kingdom_3"),
          (store_mod, ":var13", ":var10", 2),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 100, 0, 0, 0, 0, 40, 60, 0, "itm_arena_tunic_red", "itm_steppe_helmet_red"),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 100, 50, 25, 0, 0, 30, 50, 0, "itm_arena_tunic_red", "itm_steppe_helmet_red"),
          (try_end),
        (else_try),
          (eq, ":var9", "fac_kingdom_4"),
          (store_mod, ":var13", ":var10", 3),
          (try_begin),
            (eq, ":var13", 0),
            (call_script, "script_set_items_for_tournament", 0, 0, 50, 80, 0, 0, 0, 0, "itm_arena_armor_red", -1),
          (else_try),
            (eq, ":var13", 1),
            (call_script, "script_set_items_for_tournament", 0, 0, 50, 80, 50, 0, 0, 0, "itm_arena_armor_red", -1),
          (else_try),
            (eq, ":var13", 2),
            (call_script, "script_set_items_for_tournament", 40, 0, 0, 100, 0, 0, 0, 0, "itm_arena_armor_red", -1),
          (try_end),
        (else_try),
          (call_script, "script_set_items_for_tournament", 25, 100, 60, 0, 30, 0, 30, 50, "itm_arena_tunic_red", "itm_arena_helmet_red"),
        (try_end),
        (set_jump_mission, "mt_arena_melee_fight"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("leave_tournament",
      [],
      "Withdraw_from_the_tournament.",
      [
        (jump_to_menu, "mnu_tournament_withdraw_verify"),
      ]
      ),
    ],
  ),

  ("tournament_withdraw_verify", 0,
    "Are you sure you want to withdraw from the tournament?",
    "none",
    [],
    [
      ("tournament_withdraw_yes",
      [],
      "Yes._This_is_a_pointless_affectation.",
      [
        (jump_to_menu, "mnu_town_tournament_won_by_another"),
      ]
      ),

      ("tournament_withdraw_no",
      [],
      "No,_not_as_long_as_there_is_a_chance_of_victory!",
      [
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),
    ],
  ),

  ("tournament_bet", 0,
    "The odds against you are {reg5} to {reg6}.{reg1? You have already bet {reg1} cents on yourself, and if you win, you will earn {reg2} cents.:} How much do you want to bet?",
    "none",
    [
      (assign, reg1, "$g_tournament_bet_placed"),
      (store_add, reg2, "$g_tournament_bet_win_amount", "$g_tournament_bet_placed"),
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":var0", reg0),
      (assign, ":var1", 100000),
      (assign, ":var2", 1),
      (assign, ":var3", 1),
      (try_for_range, ":var4", 1, 50),
        (try_for_range, ":var5", 1, 50),
          (store_mul, ":var6", 100, ":var4"),
          (val_div, ":var6", ":var5"),
          (store_sub, ":var7", ":var0", ":var6"),
          (val_abs, ":var7"),
          (lt, ":var7", ":var1"),
          (assign, ":var1", ":var7"),
          (assign, ":var2", ":var5"),
          (assign, ":var3", ":var4"),
        (try_end),
      (try_end),
      (assign, reg5, ":var3"),
      (assign, reg6, ":var2"),
    ],
    [
      ("bet_100_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 100),
      ],
      "100_cents.",
      [
        (assign, "$temp", 100),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_50_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 50),
      ],
      "50_cents.",
      [
        (assign, "$temp", 50),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_20_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 20),
      ],
      "20_cents.",
      [
        (assign, "$temp", 20),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_10_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 10),
      ],
      "10_cents.",
      [
        (assign, "$temp", 10),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("bet_5_denars",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", 5),
      ],
      "5_cents.",
      [
        (assign, "$temp", 5),
        (jump_to_menu, "mnu_tournament_bet_confirm"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),
    ],
  ),

  ("tournament_bet_confirm", 0,
    "If you bet {reg1} cents, you will earn {reg2} cents if you win the tournament. Is that all right?",
    "none",
    [
      (call_script, "script_get_win_amount_for_tournament_bet"),
      (assign, ":var0", reg0),
      (val_mul, ":var0", "$temp"),
      (val_div, ":var0", 100),
      (assign, reg1, "$temp"),
      (assign, reg2, ":var0"),
    ],
    [
      ("tournament_bet_accept",
      [],
      "Go_ahead.",
      [
        (call_script, "script_tournament_place_bet", "$temp"),
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),

      ("tournament_bet_cancel",
      [],
      "Forget_it.",
      [
        (jump_to_menu, "mnu_tournament_bet"),
      ]
      ),
    ],
  ),

  ("tournament_participants", 0,
    "You ask one of the criers for the names of the tournament participants. They are:^{s11}",
    "none",
    [
      (str_clear, s11),
      (call_script, "script_sort_tournament_participant_troops"),
      (call_script, "script_get_num_tournament_participants"),
      (assign, ":var0", reg0),
      (try_for_range, ":var1", 0, ":var0"),
        (troop_get_slot, ":var2", "trp_tournament_participants", ":var1"),
        (str_store_troop_name, s12, ":var2"),
        (str_store_string, s11, "@{s11}^{s12}"),
      (try_end),
    ],
    [
      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_town_tournament"),
      ]
      ),
    ],
  ),

  ("collect_taxes", mnf_disable_all_keys,
    "As the party member with the highest trade skill ({reg2}), {reg3?you expect:{s1} expects} that collecting taxes from here will take {reg4} days...",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
      (assign, ":var0", reg0),
      (assign, reg2, reg0),
      (assign, ":var1", reg1),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var1"),
      (try_end),
      (assign, ":var2", 3000),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 3),
        (assign, ":var2", 6000),
      (try_end),
      (try_begin),
        (quest_slot_eq, "qst_collect_taxes", 11, 0),
        (store_add, ":var3", ":var0", 30),
        (try_begin),
          (party_slot_eq, "$current_town", 0, 3),
          (store_div, "$qst_collect_taxes_total_hours", 5040, ":var3"),
        (else_try),
          (store_div, "$qst_collect_taxes_total_hours", 2160, ":var3"),
        (try_end),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (val_add, reg0, 20),
        (val_mul, "$qst_collect_taxes_total_hours", 20),
        (val_div, "$qst_collect_taxes_total_hours", reg0),
        (quest_set_slot, "qst_collect_taxes", 10, "$qst_collect_taxes_total_hours"),
        (store_div, ":var4", "$qst_collect_taxes_total_hours", 20),
        (store_div, ":var5", "$qst_collect_taxes_total_hours", 4),
        (assign, ":var6", ":var5"),
        (store_mul, ":var7", "$qst_collect_taxes_total_hours", 3),
        (val_div, ":var7", 4),
        (val_mul, ":var2", 2),
        (store_div, "$qst_collect_taxes_hourly_income", ":var2", "$qst_collect_taxes_total_hours"),
        (store_random_in_range, "$qst_collect_taxes_menu_counter", ":var4", ":var5"),
        (store_random_in_range, "$qst_collect_taxes_unrest_counter", ":var6", ":var7"),
        (assign, "$qst_collect_taxes_halve_taxes", 0),
      (try_end),
      (quest_get_slot, ":var8", "qst_collect_taxes", 10),
      (store_div, ":var9", ":var8", 24),
      (val_mul, ":var9", 24),
      (try_begin),
        (lt, ":var9", ":var8"),
        (val_add, ":var9", 24),
      (try_end),
      (val_div, ":var9", 24),
      (assign, reg4, ":var9"),
    ],
    [
      ("start_collecting",
      [],
      "Start_collecting.",
      [
        (assign, "$qst_collect_taxes_currently_collecting", 1),
        (try_begin),
          (quest_slot_eq, "qst_collect_taxes", 11, 0),
          (quest_set_slot, "qst_collect_taxes", 11, 1),
        (try_end),
        (rest_for_hours_interactive, 1000, 5, 0),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (change_screen_return),
      ]
      ),

      ("collect_later",
      [],
      "Put_it_off_until_later.",
      [
        (try_begin),
          (party_slot_eq, "$current_town", 0, 3),
          (jump_to_menu, "mnu_town"),
        (else_try),
          (jump_to_menu, "mnu_village"),
        (try_end),
      ]
      ),
    ],
  ),

  ("collect_taxes_complete", mnf_disable_all_keys,
    "You've collected {reg3} cents in taxes from {s3}. {s19} will be expecting you to take the money to him.",
    "none",
    [
      (str_store_party_name, s3, "$current_town"),
      (quest_get_slot, ":var0", "qst_collect_taxes", 6),
      (str_store_troop_name, s19, ":var0"),
      (quest_get_slot, reg3, "qst_collect_taxes", 22),
      (try_begin),
        (eq, "$qst_collect_taxes_halve_taxes", 0),
        (call_script, "script_change_player_relation_with_center", "$current_town", -2),
      (try_end),
      (call_script, "script_succeed_quest", "qst_collect_taxes"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("collect_taxes_rebels_killed", 0,
    "Your quick action and strong arm have successfully put down the revolt. Surely, anyone with a mind to rebel against you will think better of it after this.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("collect_taxes_failed", mnf_disable_all_keys,
    "You could collect only {reg3} cents as tax from {s3} before the revolt broke out. {s1} won't be happy, but some silver will placate him better than nothing at all...",
    "none",
    [
      (str_store_party_name, s3, "$current_town"),
      (quest_get_slot, ":var0", "qst_collect_taxes", 6),
      (str_store_troop_name, s1, ":var0"),
      (quest_get_slot, reg3, "qst_collect_taxes", 22),
      (call_script, "script_fail_quest", "qst_collect_taxes"),
      (quest_set_slot, "qst_collect_taxes", 11, 4),
      (rest_for_hours, 0, 0, 0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("collect_taxes_revolt_warning", 0,
    "The people of {s3} are outraged at your demands and decry it as nothing more than extortion. They're getting very restless, and they may react badly if you keep pressing them.",
    "none",
    [
      (str_store_party_name, s3, "$current_town"),
    ],
    [
      ("continue_collecting_taxes",
      [],
      "Ignore_them_and_continue.",
      [
        (change_screen_return),
      ]
      ),

      ("halve_taxes",
      [
        (quest_get_slot, ":var0", "qst_collect_taxes", 6),
        (str_store_troop_name, s1, ":var0"),
      ],
      "Agree_to_reduce_your_collection_by_half._({s1}_may_be_upset)",
      [
        (assign, "$qst_collect_taxes_halve_taxes", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("collect_taxes_revolt", 0,
    "You are interrupted while collecting the taxes at {s3}. A large band of angry {reg9?peasants:townsmen} is marching nearer, shouting about the exorbitant taxes and waving torches and weapons. It looks like they aim to fight you!",
    "none",
    [
      (str_store_party_name, s3, "$current_town"),
      (assign, reg9, 0),
      (try_begin),
        (party_slot_eq, "$current_town", 0, 4),
        (assign, reg9, 1),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (set_jump_mission, "mt_back_alley_revolt"),
        (quest_get_slot, ":var0", "qst_collect_taxes", 1),
        (try_begin),
          (party_slot_eq, ":var0", 0, 3),
          (party_get_slot, ":var1", ":var0", 17),
        (else_try),
          (party_get_slot, ":var1", ":var0", 10),
        (try_end),
        (modify_visitors_at_site, ":var1"),
        (reset_visitors),
        (assign, ":var2", 6),
        (store_character_level, ":var3", "trp_player"),
        (val_div, ":var3", 5),
        (val_add, ":var2", ":var3"),
        (set_visitors, 1, "trp_tax_rebel", ":var2"),
        (jump_to_scene, ":var1"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits", 0,
    "As the party member with the highest training skill ({reg2}), {reg3?you expect:{s1} expects} that getting some locals ready for practice will take {reg4} hours.",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_trainer"),
      (assign, ":var0", reg0),
      (assign, reg2, reg0),
      (assign, ":var1", reg1),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var1"),
      (try_end),
      (store_sub, ":var2", 20, ":var0"),
      (val_mul, ":var2", 3),
      (val_div, ":var2", 5),
      (store_sub, reg4, ":var2", "$qst_train_peasants_against_bandits_num_hours_trained"),
    ],
    [
      ("make_preparation",
      [],
      "Train_them.",
      [
        (assign, "$qst_train_peasants_against_bandits_currently_training", 1),
        (rest_for_hours_interactive, 1000, 5, 0),
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_visit_after_rest", 1),
        (change_screen_return),
      ]
      ),

      ("train_later",
      [],
      "Put_it_off_until_later.",
      [
        (jump_to_menu, "mnu_village"),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_ready", 0,
    "You put the locals through the basics of soldiering, discipline and obedience. You think {reg0} of them {reg1?have:has} fully grasped the training and {reg1?are:is} ready for some practice.",
    "none",
    [
      (store_character_level, ":var0", "trp_player"),
      (val_div, ":var0", 10),
      (val_add, ":var0", 1),
      (quest_get_slot, ":var1", "qst_train_peasants_against_bandits", 10),
      (quest_get_slot, ":var2", "qst_train_peasants_against_bandits", 11),
      (val_sub, ":var1", ":var2"),
      (assign, ":var3", ":var0"),
      (val_min, ":var3", ":var1"),
      (val_add, ":var3", 1),
      (store_random_in_range, ":var4", 1, ":var3"),
      (assign, "$g_train_peasants_against_bandits_num_peasants", ":var4"),
      (assign, reg0, ":var4"),
      (store_sub, reg1, ":var4", 1),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", ":var4"),
    ],
    [
      ("peasant_start_practice",
      [],
      "Start_the_practice_fight.",
      [
        (set_jump_mission, "mt_village_training"),
        (store_faction_of_party, ":var0", "$current_town"),
        (quest_get_slot, ":var1", "qst_train_peasants_against_bandits", 1),
        (party_get_slot, ":var2", ":var1", 10),
        (modify_visitors_at_site, ":var2"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (try_begin),
          (eq, ":var0", "fac_kingdom_3"),
          (set_visitors, 1, "trp_apache_rabbit_hunter", "$g_train_peasants_against_bandits_num_peasants"),
        (else_try),
          (eq, ":var0", "fac_kingdom_4"),
          (set_visitors, 1, "trp_comanche_buffalo_hunter", "$g_train_peasants_against_bandits_num_peasants"),
        (else_try),
          (set_visitors, 1, "trp_settler_1", "$g_train_peasants_against_bandits_num_peasants"),
        (try_end),
        (set_jump_entry, 11),
        (jump_to_scene, ":var2"),
        (jump_to_menu, "mnu_train_peasants_against_bandits_training_result"),
        (music_set_situation, 0),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_training_result", mnf_disable_all_keys,
    "{s0}",
    "none",
    [
      (assign, reg5, "$g_train_peasants_against_bandits_num_peasants"),
      (str_store_troop_name_by_count, s0, "trp_trainee_peasant", "$g_train_peasants_against_bandits_num_peasants"),
      (try_begin),
        (eq, "$g_train_peasants_against_bandits_training_succeeded", 0),
        (str_store_string, s0, "@You were beaten. The locals are heartened by their success, but the lesson you wanted to teach them probably didn't get through..."),
      (else_try),
        (str_store_string, s0, "@After beating your last opponent, you explain to the locals how to better defend themselves against such an attack. Hopefully they'll take the experience on board and will be prepared next time."),
        (quest_get_slot, ":var0", "qst_train_peasants_against_bandits", 11),
        (val_add, ":var0", "$g_train_peasants_against_bandits_num_peasants"),
        (quest_set_slot, "qst_train_peasants_against_bandits", 11, ":var0"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (quest_get_slot, ":var0", "qst_train_peasants_against_bandits", 11),
          (quest_slot_eq, "qst_train_peasants_against_bandits", 10, ":var0"),
          (jump_to_menu, "mnu_train_peasants_against_bandits_attack"),
        (else_try),
          (change_screen_map),
        (try_end),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_attack", 0,
    "As you get ready to continue the training, a sentry from the village runs up to you, shouting alarums. The bandits have been spotted on the horizon, riding hard for {s3}. The elder begs that you organize your newly-trained militia and face them.",
    "none",
    [
      (str_store_party_name, s3, "$current_town"),
    ],
    [
      ("peasants_against_bandits_attack_resist",
      [],
      "Prepare_for_a_fight!",
      [
        (store_random_in_range, ":var0", 0, 3),
        (store_faction_of_party, ":var1", "$current_town"),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var2", "trp_looter_2"),
        (else_try),
          (eq, ":var0", 1),
          (assign, ":var2", "trp_mountain_bandit"),
        (else_try),
          (assign, ":var2", "trp_forest_bandit"),
        (try_end),
        (party_get_slot, ":var3", "$g_encountered_party", 10),
        (modify_visitors_at_site, ":var3"),
        (reset_visitors),
        (store_character_level, ":var4", "trp_player"),
        (val_div, ":var4", 2),
        (store_add, ":var5", ":var4", 16),
        (store_add, ":var6", ":var5", 6),
        (store_random_in_range, ":var0", ":var5", ":var6"),
        (set_visitors, 0, ":var2", ":var0"),
        (assign, ":var7", ":var6"),
        (try_begin),
          (eq, ":var1", "fac_kingdom_3"),
          (set_visitors, 2, "trp_apache_rabbit_hunter", ":var7"),
        (else_try),
          (eq, ":var1", "fac_kingdom_4"),
          (set_visitors, 2, "trp_comanche_buffalo_hunter", ":var7"),
        (else_try),
          (set_visitors, 2, "trp_settler_1", ":var7"),
        (try_end),
        (set_party_battle_mode),
        (set_battle_advantage, 0),
        (assign, "$g_battle_result", 0),
        (set_jump_mission, "mt_village_attack_bandits"),
        (jump_to_scene, ":var3"),
        (assign, "$g_next_menu", "mnu_train_peasants_against_bandits_attack_result"),
        (jump_to_menu, "mnu_battle_debrief"),
        (assign, "$g_mt_mode", 2),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_attack_result", mnf_disable_all_keys|mnf_scale_picture,
    "{s9}",
    "none",
    [
      (try_begin),
        (eq, "$g_battle_result", 1),
        (str_store_string, s9, "@The bandits are broken! Those few who remain alive and conscious run off with their tails between their legs, terrified of the locals and their new champion."),
        (call_script, "script_succeed_quest", "qst_train_peasants_against_bandits"),
        (jump_to_menu, "mnu_train_peasants_against_bandits_success"),
      (else_try),
        (call_script, "script_fail_quest", "qst_train_peasants_against_bandits"),
        (str_store_string, s9, "@Try as you might, you could not defeat the bandits. Infuriated, they raze the village to the ground to punish the locals, and then leave the burning wasteland behind to find greener pastures to plunder."),
        (set_background_mesh, "mesh_pic_looted_village"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (call_script, "script_village_set_state", "$current_town", 2),
          (party_set_slot, "$current_town", 36, 0),
          (party_set_slot, "$current_town", 37, 0),
          (call_script, "script_change_player_relation_with_center", "$g_encountered_party", -3),
          (call_script, "script_end_quest", "qst_train_peasants_against_bandits"),
        (try_end),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("train_peasants_against_bandits_success", mnf_disable_all_keys,
    "The bandits are broken! Those few who remain run off with their tails between their legs, terrified of the villagers and their new champion. The villagers have little left in the way of wealth after their ordeal, but they offer you all they can find to show their gratitude.",
    "none",
    [
      (party_clear, "p_temp_party"),
      (call_script, "script_end_quest", "qst_train_peasants_against_bandits"),
      (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 4),
      (party_get_slot, ":var0", "$current_town", 25),
      (try_for_range, ":var1", 10, 74),
        (store_random_in_range, ":var2", 0, 100),
        (lt, ":var2", 50),
        (troop_set_inventory_slot, ":var0", ":var1", -1),
      (try_end),
      (call_script, "script_add_log_entry", 4, "trp_player", "$current_town", -1, -1),
    ],
    [
      ("village_bandits_defeated_accept",
      [],
      "Take_it_as_your_just_due.",
      [
        (jump_to_menu, "mnu_auto_return_to_map"),
        (party_get_slot, ":var0", "$current_town", 25),
        (troop_sort_inventory, ":var0"),
        (change_screen_loot, ":var0"),
      ]
      ),

      ("village_bandits_defeated_cont",
      [],
      "Refuse,_stating_that_they_need_these_items_more_than_you_do.",
      [
        (call_script, "script_change_player_relation_with_center", "$g_encountered_party", 3),
        (call_script, "script_change_player_honor", 1),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("disembark", 0,
    "Do you wish to disembark?",
    "none",
    [],
    [
      ("disembark_yes",
      [],
      "Yes.",
      [
        (assign, "$g_player_icon_state", 0),
        (party_set_flags, "p_main_party", 512, 0),
        (party_get_position, pos1, "p_main_party"),
        (party_set_position, "p_main_party", pos0),
        (assign, "$g_main_ship_party", -1),
        (change_screen_return),
      ]
      ),

      ("disembark_no",
      [],
      "No.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("ship_reembark", 0,
    "Do you wish to embark?",
    "none",
    [],
    [
      ("reembark_yes",
      [],
      "Yes.",
      [
        (assign, "$g_player_icon_state", 2),
        (party_set_flags, "p_main_party", 512, 1),
        (party_get_position, pos1, "p_main_party"),
        (map_get_water_position_around_position, pos2, pos1, 6),
        (party_set_position, "p_main_party", pos2),
        (assign, "$g_main_ship_party", "$g_encountered_party"),
        (disable_party, "$g_encountered_party"),
        (str_store_troop_name, s1, "trp_player"),
        (party_set_name, "$g_main_ship_party", "@{s1}'s Steamboat"),
        (change_screen_return),
      ]
      ),

      ("reembark_no",
      [],
      "No.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("center_reports", 0,
    "Town Name: {s1}^Rent Income: {reg1} cents^Tariff Income: {reg2} cents^Food Stock: for {reg3} days",
    "none",
    [
      (party_get_slot, ":var0", "$g_encountered_party", 53),
      (call_script, "script_center_get_food_consumption", "$g_encountered_party"),
      (assign, ":var1", reg0),
      (store_div, reg3, ":var0", ":var1"),
      (str_store_party_name, s1, "$g_encountered_party"),
      (party_get_slot, reg1, "$g_encountered_party", 47),
      (party_get_slot, reg2, "$g_encountered_party", 48),
    ],
    [
      ("to_price_and_productions",
      [],
      "Show_prices_and_productions.",
      [
        (jump_to_menu, "mnu_price_and_production"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 4),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
      ]
      ),
    ],
  ),

  ("price_and_production", 0,
    "Productions are:^{s1}^^Price factors are:^{s2}",
    "none",
    [
      (str_store_string, s1, "@ "),
      (str_store_string, s2, "@ "),
      (try_for_range, ":var0", "itm_smoked_fish", "itm_gold_bar"),
        (store_sub, ":var1", ":var0", "itm_smoked_fish"),
        (val_add, ":var1", 205),
        (store_sub, ":var2", ":var0", "itm_smoked_fish"),
        (val_add, ":var2", 234),
        (party_get_slot, ":var3", "$g_encountered_party", ":var1"),
        (party_get_slot, ":var4", "$g_encountered_party", ":var2"),
        (str_store_item_name, s3, ":var0"),
        (assign, reg1, ":var3"),
        (str_store_string, s1, "@^{s3} = {reg1}{s1}"),
        (assign, reg1, ":var4"),
        (str_store_string, s2, "@^{s3} = {reg1}{s2}"),
      (try_end),
    ],
    [
      ("go_back_dot",
      [],
      "Go_back.",
      [
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 4),
          (jump_to_menu, "mnu_village"),
        (else_try),
          (jump_to_menu, "mnu_town"),
        (try_end),
      ]
      ),
    ],
  ),

  ("town_trade", 0,
    "You head towards the marketplace.",
    "none",
    [],
    [
      ("assess_prices",
      [
        (eq, 0, 1),
      ],
      "Assess_the_local_prices.",
      [
        (jump_to_menu, "mnu_town_trade_assessment_begin"),
      ]
      ),

      ("trade_with_arms_merchant",
      [
        (party_slot_ge, "$current_town", 21, 1),
      ],
      "Trade_with_the_weapons_seller.",
      [
        (party_get_slot, ":var0", "$current_town", 21),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("trade_with_armor_merchant",
      [
        (party_slot_ge, "$current_town", 22, 1),
      ],
      "Trade_with_the_outfitter.",
      [
        (party_get_slot, ":var0", "$current_town", 22),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("trade_with_horse_merchant",
      [
        (party_slot_ge, "$current_town", 24, 1),
      ],
      "Trade_with_the_horse_trader.",
      [
        (party_get_slot, ":var0", "$current_town", 24),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("trade_with_goods_merchant",
      [
        (party_slot_ge, "$current_town", 23, 1),
      ],
      "Trade_with_the_supplier.",
      [
        (party_get_slot, ":var0", "$current_town", 23),
        (change_screen_trade, ":var0"),
      ]
      ),

      ("back_to_town_menu",
      [],
      "Head_back.",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("town_trade_assessment_begin", 0,
    "You overhear several discussions about the price of trade goods across the local area. You listen closely, trying to work out the best deals around.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$auto_enter_town", "$current_town"),
        (assign, "$g_town_assess_trade_goods_after_rest", 1),
        (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
        (val_div, reg0, 2),
        (store_sub, ":var0", 6, reg0),
        (assign, "$g_last_rest_center", "$current_town"),
        (assign, "$g_last_rest_payment_until", -1),
        (rest_for_hours, ":var0", 5, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("town_trade_assessment", mnf_disable_all_keys,
    "As the party member with the highest trade skill ({reg2}), {reg3?you try to figure out:{s1} tries to figure out} the best goods to trade in. {s2}",
    "none",
    [
      (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, ":var2", 0),
      (assign, ":var3", -1),
      (assign, ":var4", -1),
      (assign, ":var5", 0),
      (assign, ":var6", -1),
      (assign, ":var7", -1),
      (assign, ":var8", 0),
      (assign, ":var9", -1),
      (assign, ":var10", -1),
      (assign, ":var11", 0),
      (store_sub, ":var12", "p_castle_1", "p_town_1"),
      (store_sub, ":var13", "itm_gold_bar", "itm_smoked_fish"),
      (store_mul, ":var14", ":var12", ":var13"),
      (val_mul, ":var14", ":var0"),
      (val_div, ":var14", 20),
      (assign, ":var15", "$g_encountered_party"),
      (try_for_range, ":var16", 0, ":var14"),
        (store_random_in_range, ":var17", "itm_smoked_fish", "itm_gold_bar"),
        (store_random_in_range, ":var18", "p_town_1", "p_castle_1"),
        (assign, ":var19", 0),
        (try_begin),
          (eq, ":var17", ":var3"),
          (eq, ":var18", ":var4"),
          (val_add, ":var19", 1),
        (else_try),
          (eq, ":var17", ":var6"),
          (eq, ":var18", ":var7"),
          (val_add, ":var19", 1),
        (else_try),
          (eq, ":var17", ":var9"),
          (eq, ":var18", ":var10"),
          (val_add, ":var19", 1),
        (try_end),
        (eq, ":var19", 0),
        (store_item_value, ":var20", ":var17"),
        (assign, "$g_encountered_party", ":var15"),
        (call_script, "script_game_get_item_buy_price_factor", ":var17"),
        (store_mul, ":var21", ":var20", reg0),
        (val_div, ":var21", 100),
        (val_max, ":var21", 1),
        (assign, "$g_encountered_party", ":var18"),
        (call_script, "script_game_get_item_sell_price_factor", ":var17"),
        (store_mul, ":var22", ":var20", reg0),
        (val_div, ":var22", 100),
        (val_max, ":var22", 1),
        (store_sub, ":var23", ":var22", ":var21"),
        (try_begin),
          (gt, ":var23", ":var5"),
          (val_add, ":var2", 1),
          (val_min, ":var2", 3),
          (assign, ":var9", ":var6"),
          (assign, ":var10", ":var7"),
          (assign, ":var11", ":var8"),
          (assign, ":var6", ":var3"),
          (assign, ":var7", ":var4"),
          (assign, ":var8", ":var5"),
          (assign, ":var3", ":var17"),
          (assign, ":var4", ":var18"),
          (assign, ":var5", ":var23"),
        (else_try),
          (gt, ":var23", ":var8"),
          (val_add, ":var2", 1),
          (val_min, ":var2", 3),
          (assign, ":var9", ":var6"),
          (assign, ":var10", ":var7"),
          (assign, ":var11", ":var8"),
          (assign, ":var6", ":var17"),
          (assign, ":var7", ":var18"),
          (assign, ":var8", ":var23"),
        (else_try),
          (gt, ":var23", ":var11"),
          (val_add, ":var2", 1),
          (val_min, ":var2", 3),
          (assign, ":var9", ":var17"),
          (assign, ":var10", ":var18"),
          (assign, ":var11", ":var23"),
        (try_end),
      (try_end),
      (assign, "$g_encountered_party", ":var15"),
      (str_clear, s3),
      (assign, reg2, ":var0"),
      (try_begin),
        (eq, ":var1", "trp_player"),
        (assign, reg3, 1),
      (else_try),
        (assign, reg3, 0),
        (str_store_troop_name, s1, ":var1"),
      (try_end),
      (try_begin),
        (le, ":var2", 0),
        (str_store_string, s2, "@However, {reg3?You are:{s1} is} unable to find any trade goods that would bring a profit."),
      (else_try),
        (try_begin),
          (ge, ":var9", 0),
          (assign, reg6, ":var11"),
          (str_store_item_name, s4, ":var9"),
          (str_store_party_name, s5, ":var10"),
          (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} cents per item.{s3}"),
        (try_end),
        (try_begin),
          (ge, ":var6", 0),
          (assign, reg6, ":var8"),
          (str_store_item_name, s4, ":var6"),
          (str_store_party_name, s5, ":var7"),
          (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} cents per item.{s3}"),
        (try_end),
        (try_begin),
          (ge, ":var3", 0),
          (assign, reg6, ":var5"),
          (str_store_item_name, s4, ":var3"),
          (str_store_party_name, s5, ":var4"),
          (str_store_string, s3, "@^Buying {s4} here and selling it at {s5} would bring a profit of {reg6} cents per item.{s3}"),
        (try_end),
        (str_store_string, s2, "@{reg3?You find:{s1} finds} out the following:^{s3}"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town_trade"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_suceeded", 0,
    "Disguised to look like one of the locals, you fool the guards and make your way into the town.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$sneaked_into_town", 1),
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_caught", 0,
    "As you try to sneak in, one of the guards recognizes you and raises the alarm! You must fight your way out!",
    "none",
    [
      (assign, "$auto_menu", "mnu_captivity_start_castle_surrender"),
    ],
    [
      ("sneak_caught_fight",
      [],
      "Try_to_fight_your_way_out!",
      [
        (assign, "$all_doors_locked", 1),
        (party_get_slot, ":var0", "$current_town", 10),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (store_faction_of_party, ":var1", "$current_town"),
        (faction_get_slot, ":var2", ":var1", 42),
        (faction_get_slot, ":var3", ":var1", 43),
        (faction_get_slot, ":var4", ":var1", 44),
        (faction_get_slot, ":var5", ":var1", 45),
        (store_relation, ":var6", ":var1", "fac_player_supporters_faction"),
        (try_begin),
          (le, ":var6", -80),
          (gt, ":var5", 0),
          (gt, ":var4", 0),
          (assign, reg0, ":var5"),
          (assign, reg1, ":var5"),
          (assign, reg2, ":var4"),
          (assign, reg3, ":var4"),
        (else_try),
          (le, ":var6", -40),
          (gt, ":var3", 0),
          (gt, ":var4", 0),
          (assign, reg0, ":var4"),
          (assign, reg1, ":var4"),
          (assign, reg2, ":var3"),
          (assign, reg3, ":var3"),
        (else_try),
          (gt, ":var2", 0),
          (gt, ":var3", 0),
          (assign, reg0, ":var3"),
          (assign, reg1, ":var3"),
          (assign, reg2, ":var2"),
          (assign, reg3, ":var2"),
        (try_end),
        (assign, reg4, -1),
        (shuffle_range, 0, 5),
        (set_visitor, 1, reg0),
        (set_visitor, 2, reg1),
        (set_visitor, 3, reg2),
        (set_visitor, 4, reg3),
        (set_jump_mission, "mt_sneak_caught_fight"),
        (set_passage_menu, "mnu_town"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("sneak_caught_surrender",
      [],
      "Surrender.",
      [
        (jump_to_menu, "mnu_captivity_start_castle_surrender"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_caught_dispersed_guards", 0,
    "You drive off the guards and cover your trail before running off, easily losing your pursuers in the maze of streets.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$sneaked_into_town", 1),
        (assign, "$town_entered", 1),
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("sneak_into_town_caught_ran_away", 0,
    "You make your way back through the gates and quickly retreat to the safety of the hills.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$auto_menu", -1),
        (store_encountered_party, "$last_sneak_attempt_town"),
        (store_current_hours, "$last_sneak_attempt_time"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("enemy_offer_ransom_for_prisoner", 0,
    "{s2} offers you a sum of {reg12} cents in silver if you are willing to sell him {s1}.",
    "none",
    [
      (call_script, "script_calculate_ransom_amount_for_troop", "$g_ransom_offer_troop"),
      (assign, reg12, reg0),
      (str_store_troop_name, s1, "$g_ransom_offer_troop"),
      (store_troop_faction, ":var0", "$g_ransom_offer_troop"),
      (str_store_faction_name, s2, ":var0"),
    ],
    [
      ("ransom_accept",
      [],
      "Accept_the_offer.",
      [
        (troop_add_gold, "trp_player", reg12),
        (party_remove_prisoners, "$g_ransom_offer_party", "$g_ransom_offer_troop", 1),
        (call_script, "script_remove_troop_from_prison", "$g_ransom_offer_troop"),
        (change_screen_return),
      ]
      ),

      ("ransom_reject",
      [],
      "Reject_the_offer.",
      [
        (call_script, "script_change_player_relation_with_troop", "$g_ransom_offer_troop", -4),
        (call_script, "script_change_player_honor", -1),
        (assign, "$g_ransom_offer_rejected", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("training_ground", 0,
    "You approach a training field where you can practice your martial skills. What kind of training do you want to do?",
    "none",
    [
      (store_add, "$g_training_ground_melee_training_scene", "scn_training_ground_ranged_melee_1", "$g_encountered_party"),
      (val_sub, "$g_training_ground_melee_training_scene", "p_training_ground_1"),
      (try_begin),
        (ge, "$g_training_ground_training_count", 3),
        (assign, "$g_training_ground_training_count", 0),
        (rest_for_hours, 1, 5, 1),
        (assign, "$auto_enter_town", "$g_encountered_party"),
        (change_screen_return),
      (try_end),
    ],
    [
      ("camp_trainer",
      [],
      "Speak_with_the_melee_trainer.",
      [
        (set_jump_mission, "mt_training_ground_trainer_talk"),
        (modify_visitors_at_site, "$g_training_ground_melee_training_scene"),
        (reset_visitors),
        (set_jump_entry, 5),
        (jump_to_scene, "$g_training_ground_melee_training_scene"),
        (change_screen_mission),
        (music_set_situation, 0),
      ]
      ),

      ("camp_train_melee",
      [
        (neg|troop_is_wounded, "trp_player"),
        (call_script, "script_party_count_fit_for_battle", "p_main_party"),
        (gt, reg0, 1),
      ],
      "Sparring_practice.",
      [
        (assign, "$g_mt_mode", 1),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_1"),
        (music_set_situation, 0),
      ]
      ),

      ("camp_train_archery",
      [],
      "Ranged_weapon_practice.",
      [
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_1"),
        (music_set_situation, 0),
      ]
      ),

      ("camp_train_mounted",
      [],
      "Horseback_practice.",
      [
        (assign, "$g_mt_mode", 3),
        (jump_to_menu, "mnu_training_ground_selection_details_mounted"),
        (music_set_situation, 0),
      ]
      ),

      ("go_to_track",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat:_Go_to_track.",
      [
        (set_jump_mission, "mt_ai_training"),
        (store_add, ":var0", "scn_training_ground_horse_track_1", "$g_encountered_party"),
        (val_sub, ":var0", "p_training_ground_1"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),

      ("go_to_range",
      [
        (eq, "$cheat_mode", 1),
      ],
      "Cheat:_Go_to_range.",
      [
        (set_jump_mission, "mt_ai_training"),
        (jump_to_scene, "$g_training_ground_melee_training_scene"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_melee_1", 0,
    "How many opponents will you go against?",
    "none",
    [
      (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
      (troop_get_slot, "$temp", "trp_stack_selection_amounts", 1),
      (assign, "$temp_2", 1),
    ],
    [
      ("camp_train_melee_num_men_1",
      [
        (ge, "$temp", 1),
      ],
      "One.",
      [
        (assign, "$temp", 1),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("camp_train_melee_num_men_2",
      [
        (ge, "$temp", 2),
      ],
      "Two.",
      [
        (assign, "$temp", 2),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("camp_train_melee_num_men_3",
      [
        (ge, "$temp", 3),
      ],
      "Three.",
      [
        (assign, "$temp", 3),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("camp_train_melee_num_men_4",
      [
        (ge, "$temp", 4),
      ],
      "Four.",
      [
        (assign, "$temp", 4),
        (jump_to_menu, "mnu_training_ground_selection_details_melee_2"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_melee_2", 0,
    "Choose your opponent #{reg1}:",
    "none",
    [
      (assign, reg1, "$temp_2"),
      (troop_get_slot, "$temp_3", "trp_stack_selection_amounts", 0),
    ],
    [
      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 1),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 1),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 2),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 2),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 3),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 3),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 4),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 4),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 5),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 5),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 6),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 6),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 7),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 7),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 8),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 8),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 9),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 9),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 10),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 10),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 11),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 11),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 12),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 12),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 13),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 13),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 14),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 14),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 15),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 15),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 16),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 16),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 17),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 17),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 18),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 18),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 19),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 19),
      ]
      ),

      ("s0",
      [
        (call_script, "script_cf_training_ground_sub_routine_1_for_melee_details", 20),
      ],
      "{s0}",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", 20),
      ]
      ),

      ("training_ground_selection_details_melee_random",
      [],
      "Choose_randomly.",
      [
        (call_script, "script_training_ground_sub_routine_2_for_melee_details", -1),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_mounted", 0,
    "What kind of weapon do you want to train with?",
    "none",
    [],
    [
      ("camp_train_mounted_details_1",
      [],
      "One_handed_weapon.",
      [
        (call_script, "script_start_training_at_training_ground", 2, 0),
      ]
      ),

      ("camp_train_mounted_details_2",
      [],
      "Polearm.",
      [
        (call_script, "script_start_training_at_training_ground", 4, 0),
      ]
      ),

      ("camp_train_mounted_details_3",
      [],
      "Bow.",
      [
        (call_script, "script_start_training_at_training_ground", 8, 0),
      ]
      ),

      ("camp_train_mounted_details_4",
      [],
      "Rifle.",
      [
        (call_script, "script_start_training_at_training_ground", 9, 0),
      ]
      ),

      ("camp_train_mounted_details_5",
      [],
      "Pistol.",
      [
        (call_script, "script_start_training_at_training_ground", 16, 0),
      ]
      ),

      ("camp_train_mounted_details_6",
      [],
      "Thrown_weapon.",
      [
        (call_script, "script_start_training_at_training_ground", 10, 0),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_ranged_1", 0,
    "What kind of ranged weapon do you want to train with?",
    "none",
    [],
    [
      ("camp_train_ranged_weapon_bow",
      [],
      "Bow_and_arrows.",
      [
        (assign, "$g_mt_mode", 2),
        (assign, "$temp", 8),
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
      ]
      ),

      ("camp_train_ranged_weapon_crossbow",
      [],
      "Rifle.",
      [
        (assign, "$g_mt_mode", 2),
        (assign, "$temp", 9),
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
      ]
      ),

      ("camp_train_ranged_weapon_pistol",
      [],
      "Pistol.",
      [
        (assign, "$g_mt_mode", 2),
        (assign, "$temp", 16),
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
      ]
      ),

      ("camp_train_ranged_weapon_thrown",
      [],
      "Throwing_Knives.",
      [
        (assign, "$g_mt_mode", 2),
        (assign, "$temp", 10),
        (jump_to_menu, "mnu_training_ground_selection_details_ranged_2"),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_selection_details_ranged_2", 0,
    "What range do you want to practice at?",
    "none",
    [],
    [
      ("camp_train_ranged_details_1",
      [],
      "10_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 10),
      ]
      ),

      ("camp_train_ranged_details_2",
      [],
      "20_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 20),
      ]
      ),

      ("camp_train_ranged_details_3",
      [],
      "30_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 30),
      ]
      ),

      ("camp_train_ranged_details_4",
      [],
      "40_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 40),
      ]
      ),

      ("camp_train_ranged_details_5",
      [
        (eq, "$g_mt_mode", 2),
      ],
      "50_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 50),
      ]
      ),

      ("camp_train_ranged_details_6",
      [
        (eq, "$g_mt_mode", 2),
      ],
      "60_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 60),
      ]
      ),

      ("camp_train_ranged_details_7",
      [
        (eq, "$g_mt_mode", 2),
      ],
      "70_yards.",
      [
        (call_script, "script_start_training_at_training_ground", "$temp", 70),
      ]
      ),

      ("go_back_dot",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("training_ground_description", 0,
    "{s0}",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (set_jump_mission, "mt_training_ground_training"),
        (jump_to_scene, "$g_training_ground_training_scene"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("training_ground_training_result", mnf_disable_all_keys,
    "{s7}{s2}",
    "none",
    [
      (store_skill_level, ":var0", "skl_trainer", "trp_player"),
      (store_add, ":var1", 5, ":var0"),
      (call_script, "script_write_fit_party_members_to_stack_selection", "p_main_party", 1),
      (str_clear, s2),
      (troop_get_slot, ":var2", "trp_stack_selection_amounts", 1),
      (troop_get_slot, ":var3", "trp_stack_selection_amounts", 0),
      (try_begin),
        (gt, "$g_training_ground_training_success_ratio", 0),
        (store_mul, ":var4", "$g_training_ground_training_success_ratio", "$g_training_ground_training_success_ratio"),
        (try_begin),
          (eq, "$g_training_ground_training_success_ratio", 100),
          (val_mul, ":var4", 2),
        (try_end),
        (try_begin),
          (eq, "$g_mt_mode", 1),
          (val_div, ":var4", 2),
        (try_end),
        (val_div, ":var4", 10),
        (try_begin),
          (gt, ":var2", 8),
          (val_mul, ":var4", 3),
          (assign, ":var5", ":var2"),
          (convert_to_fixed_point, ":var5"),
          (store_sqrt, ":var5", ":var5"),
          (convert_to_fixed_point, ":var4"),
          (val_div, ":var4", ":var5"),
        (try_end),
        (store_mul, ":var6", ":var4", ":var1"),
        (val_div, ":var6", 10),
        (party_get_num_companion_stacks, ":var7", "p_main_party"),
        (store_add, ":var8", ":var3", 2),
        (try_for_range, ":var9", 2, ":var8"),
          (troop_get_slot, ":var10", "trp_stack_selection_amounts", ":var9"),
          (troop_get_slot, ":var11", "trp_stack_selection_ids", ":var9"),
          (assign, ":var12", ":var7"),
          (try_for_range, ":var13", 0, ":var12"),
            (party_stack_get_troop_id, ":var14", "p_main_party", ":var13"),
            (eq, ":var14", ":var11"),
            (assign, ":var12", 0),
            (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":var11", ":var13", ":var10", ":var6"),
            (str_store_troop_name_by_count, s1, ":var11", ":var10"),
            (assign, reg1, ":var10"),
            (str_store_string, s2, "@{s2}^{reg1} {s1} earned {reg0} experience."),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$g_mt_mode", 1),
          (store_mul, ":var15", ":var4", 3),
          (val_div, ":var15", 2),
          (try_for_range, ":var16", 0, "$g_training_ground_training_num_enemies"),
            (troop_get_slot, ":var11", "trp_temp_array_a", ":var16"),
            (assign, ":var12", ":var7"),
            (try_for_range, ":var13", 0, ":var12"),
              (party_stack_get_troop_id, ":var14", "p_main_party", ":var13"),
              (eq, ":var14", ":var11"),
              (assign, ":var12", 0),
              (call_script, "script_cf_training_ground_sub_routine_for_training_result", ":var11", ":var13", 1, ":var15"),
              (str_store_troop_name, s1, ":var11"),
              (str_store_string, s2, "@{s2}^{s1} earned an additional {reg0} experience."),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (call_script, "script_cf_training_ground_sub_routine_for_training_result", "trp_player", -1, 1, ":var4"),
          (str_store_string, s2, "@^You earned {reg0} experience.{s2}"),
        (try_end),
      (try_end),
      (try_begin),
        (eq, "$g_training_ground_training_success_ratio", 0),
        (str_store_string, s7, "@The training didn't go well at all."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 25),
        (str_store_string, s7, "@The training didn't go well at all."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 50),
        (str_store_string, s7, "@The training didn't go very well."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 75),
        (str_store_string, s7, "@The training went quite well."),
      (else_try),
        (lt, "$g_training_ground_training_success_ratio", 99),
        (str_store_string, s7, "@The training went very well."),
      (else_try),
        (str_store_string, s7, "@The training went perfectly."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_training_ground"),
      ]
      ),
    ],
  ),

  ("marshall_selection_candidate_ask", 0,
    "{s15} will soon select a new marshall for {s23}. Some of the commanders have suggested your name as a likely candidate.",
    "none",
    [
      (try_begin),
        (eq, "$g_presentation_marshall_selection_ended", 1),
        (change_screen_return),
      (try_end),
      (faction_get_slot, ":var0", "$players_kingdom", 10),
      (str_store_troop_name, s15, ":var0"),
      (str_store_faction_name, s23, "$players_kingdom"),
    ],
    [
      ("marshall_candidate_accept",
      [],
      "Let_{s15}_learn_that_you_are_willing_to_serve_as_marshall.",
      [
        (start_presentation, "prsnt_marshall_selection"),
      ]
      ),

      ("marshall_candidate_reject",
      [],
      "Tell_everyone_that_you_are_too_busy_these_days.",
      [
        (try_begin),
          (eq, "$g_presentation_marshall_selection_max_renown_2_troop", "trp_player"),
          (assign, "$g_presentation_marshall_selection_max_renown_2", "$g_presentation_marshall_selection_max_renown_3"),
          (assign, "$g_presentation_marshall_selection_max_renown_2_troop", "$g_presentation_marshall_selection_max_renown_3_troop"),
        (else_try),
          (assign, "$g_presentation_marshall_selection_max_renown_1", "$g_presentation_marshall_selection_max_renown_2"),
          (assign, "$g_presentation_marshall_selection_max_renown_1_troop", "$g_presentation_marshall_selection_max_renown_2_troop"),
          (assign, "$g_presentation_marshall_selection_max_renown_2", "$g_presentation_marshall_selection_max_renown_3"),
          (assign, "$g_presentation_marshall_selection_max_renown_2_troop", "$g_presentation_marshall_selection_max_renown_3_troop"),
        (try_end),
        (start_presentation, "prsnt_marshall_selection"),
      ]
      ),
    ],
  ),

  ("captivity_avoid_wilderness", 0,
    "Suddenly all the world goes black around you. Many hours later you regain your consciousness and find yourself at the spot you fell. Your enemies must have taken you up for dead and left you there. However, it seems that none of your wounds were lethal, and although you feel awful, you find out that can still walk. You get up and try to look for any other survivors from your party.",
    "none",
    [],
    [
    ],
    [],
  ),

  ("captivity_start_wilderness", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (try_begin),
        (eq, "$g_player_surrenders", 1),
        (jump_to_menu, "mnu_captivity_start_wilderness_surrender"),
      (else_try),
        (jump_to_menu, "mnu_captivity_start_wilderness_defeat"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_wilderness_surrender", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_wilderness_defeat", 0,
    "Your enemies take you prisoner.",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_wilderness_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_chain_gang", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (jump_to_menu, "mnu_captivity_chain_gang"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_castle_surrender", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_castle_defeat", 0,
    "Stub",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_start_under_siege_defeat", 0,
    "Your enemies take you prisoner.",
    "none",
    [
      (assign, "$g_player_is_captive", 1),
      (assign, "$auto_menu", -1),
      (assign, "$capturer_party", "$g_encountered_party"),
      (jump_to_menu, "mnu_captivity_castle_taken_prisoner"),
    ],
    [
    ],
    [],
  ),

  ("captivity_wilderness_taken_prisoner", mnf_scale_picture,
    "{s1}",
    "none",
    [
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 21),
        (str_store_string, s1, "@The bounty hunters have taken you alive. You have no idea where you are headed from here, but you assume they will be taking you in to claim their reward."),
      (else_try),
        (str_store_string, s1, "@Your enemies take you prisoner."),
      (try_end),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_prisoner_wilderness_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_wilderness"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_for_range, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
          (main_party_has_troop, ":var0"),
          (store_random_in_range, ":var1", 0, 100),
          (lt, ":var1", 30),
          (remove_member_from_party, ":var0", "p_main_party"),
          (troop_set_slot, ":var0", 2, 0),
          (troop_set_slot, ":var0", 82, 1),
          (assign, "$last_lost_companion", ":var0"),
          (store_faction_of_party, ":var2", "$g_encountered_party"),
          (troop_set_slot, ":var0", 83, ":var2"),
          (troop_set_health, ":var0", 100),
          (store_random_in_range, ":var3", "p_town_1", "p_castle_1"),
          (troop_set_slot, ":var0", 12, ":var3"),
          (assign, ":var4", 1000),
          (try_for_range, ":var5", "p_town_1", "p_castle_1"),
            (store_faction_of_party, ":var6", ":var5"),
            (store_relation, ":var7", ":var6", "fac_player_faction"),
            (ge, ":var7", 0),
            (store_distance_to_party_from_party, ":var8", ":var5", "p_main_party"),
            (lt, ":var8", ":var4"),
            (assign, ":var4", ":var8"),
            (troop_set_slot, ":var0", 12, ":var5"),
          (try_end),
        (try_end),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 21),
          (assign, ":var9", 0),
          (assign, ":var10", 1000),
          (try_for_range, ":var11", "p_town_1", "p_castle_1"),
            (store_faction_of_party, ":var6", ":var11"),
            (store_relation, ":var7", ":var6", "fac_player_faction"),
            (le, ":var7", -1),
            (store_distance_to_party_from_party, ":var8", ":var11", "p_main_party"),
            (lt, ":var8", ":var10"),
            (assign, ":var10", ":var8"),
            (assign, ":var9", ":var11"),
          (try_end),
          (try_begin),
            (neq, ":var9", 0),
            (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_travel_to_party),
            (party_set_ai_object, "$g_encountered_party", ":var9"),
          (else_try),
            (party_set_ai_behavior, "$g_encountered_party", ai_bhvr_patrol_location),
            (party_set_ai_object, "$g_encountered_party", "$g_encountered_party"),
          (try_end),
        (try_end),
        (set_camera_follow_party, "$capturer_party"),
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, ":var12", 18, 30),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":var12"),
        (assign, "$auto_menu", "mnu_captivity_wilderness_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_wilderness_check", 0,
    "stub",
    "none",
    [
      (jump_to_menu, "mnu_captivity_end_wilderness_escape"),
    ],
    [
    ],
    [],
  ),

  ("captivity_end_wilderness_escape", mnf_scale_picture,
    "{s0}",
    "none",
    [
      (try_begin),
        (party_slot_eq, "$g_encountered_party", 0, 21),
        (str_store_string, s0, "@After painful days of being dragged about as a prisoner, you find a chance and escape from the bounty hunters.^^Unfortunately, they have noticed your escape and are giving chase!"),
      (else_try),
        (str_store_string, s0, "@After painful days of being dragged about as a prisoner, you find a chance and escape from your captors!"),
      (try_end),
      (play_cue_track, "track_And_Awaken"),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_escape_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_escape_1"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 0),
        (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
        (try_end),
        (try_begin),
          (party_slot_eq, "$g_encountered_party", 0, 21),
          (party_set_ai_behavior, "$capturer_party", ai_bhvr_attack_party),
          (party_set_ai_object, "$capturer_party", "p_main_party"),
        (else_try),
          (call_script, "script_set_parties_around_player_ignore_player", 2, 4),
        (try_end),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_bounty_claimed_taken_prisoner", 0,
    "{s0}",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_prisoner_man_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
      (try_begin),
        (get_party_ai_object, ":var1", "$capturer_party"),
        (str_store_party_name, s1, ":var1"),
        (party_get_template_id, ":var2", "$capturer_party"),
        (try_begin),
          (eq, ":var2", "pt_bounty_hunters_dishonorable"),
          (str_store_string, s2, "@outlaws"),
        (else_try),
          (eq, ":var2", "pt_bounty_hunters_dishonorable"),
          (str_store_string, s2, "@commoners"),
        (try_end),
        (str_store_string, s0, "@The bounty hunters have finally stopped. It seems that the {s2} who posted the bounty on your head have arranged for you to be handed over to {s1}.^^"),
        (str_store_string, s0, "@{s0}You see the bounty hunters and guards exchange money and shake hands. Then a bag is placed over your head and you are led away to your cell."),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 1),
        (get_party_ai_object, ":var0", "$capturer_party"),
        (assign, ":var1", "$capturer_party"),
        (assign, "$capturer_party", ":var0"),
        (set_camera_follow_party, "$capturer_party"),
        (remove_party, ":var1"),
        (store_random_in_range, ":var2", 16, 22),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":var2"),
        (assign, "$auto_menu", "mnu_captivity_bounty_claimed_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_bounty_claimed_check", 0,
    "stub",
    "none",
    [
      (jump_to_menu, "mnu_captivity_end_bounty_claimed_escape"),
    ],
    [
    ],
    [],
  ),

  ("captivity_end_bounty_claimed_escape", mnf_scale_picture,
    "Despite being closely guarded due to your bounty, a nearby disturbance finally gives you the opportunity you were waiting for! You manage to free yourself and sneak away while your guards are distracted.",
    "none",
    [
      (play_cue_track, "track_And_Awaken"),
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_escape_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_escape_1"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 0),
        (call_script, "script_set_parties_around_player_ignore_player", 2, 4),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_castle_taken_prisoner", 0,
    "You are quickly surrounded by deputies who take away your weapons. With curses and insults, they throw you into the jail where you must while away the miserable days of your captivity.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_prisoner_man_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, ":var0", 16, 22),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":var0"),
        (assign, "$auto_menu", "mnu_captivity_castle_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_rescue_lord_taken_prisoner", 0,
    "You remain in disguise for as long as possible before revealing yourself. The guards are outraged and beat you savagely before throwing you back into the cell for God knows how long...",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_prisoner_man_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, ":var0", 16, 22),
        (call_script, "script_event_player_captured_as_prisoner"),
        (call_script, "script_stay_captive_for_hours", ":var0"),
        (assign, "$auto_menu", "mnu_captivity_castle_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_castle_check", 0,
    "stub",
    "none",
    [
      (store_random_in_range, reg7, 0, 10),
      (try_begin),
        (lt, reg7, 4),
        (store_random_in_range, "$player_ransom_amount", 3, 6),
        (val_mul, "$player_ransom_amount", 100),
        (store_troop_gold, reg3, "trp_player"),
        (gt, reg3, "$player_ransom_amount"),
        (jump_to_menu, "mnu_captivity_end_propose_ransom"),
      (else_try),
        (lt, reg7, 7),
        (jump_to_menu, "mnu_captivity_end_exchanged_with_prisoner"),
      (else_try),
        (jump_to_menu, "mnu_captivity_castle_remain"),
      (try_end),
    ],
    [
    ],
    [],
  ),

  ("captivity_end_exchanged_with_prisoner", 0,
    "After days of imprisonment, you are finally set free when your captors exchange you with another prisoner.",
    "none",
    [
      (play_cue_track, "track_And_Awaken"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 0),
        (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 2),
        (try_end),
        (call_script, "script_set_parties_around_player_ignore_player", 2, 12),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_end_propose_ransom", 0,
    "You spend long hours in the sunless dank of the county jail, more than you can count. Suddenly one of your captors enters your cell with an offer; he proposes to free you in return for {s1} of your hidden wealth. You decide to...",
    "none",
    [
      (call_script, "script_game_get_money_text", reg5),
      (store_character_level, ":var0", "trp_player"),
      (store_mul, "$player_ransom_amount", ":var0", 60),
      (val_add, "$player_ransom_amount", 200),
      (assign, reg5, "$player_ransom_amount"),
    ],
    [
      ("captivity_end_ransom_accept",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", "$player_ransom_amount"),
      ],
      "Accept_the_offer.",
      [
        (play_cue_track, "track_And_Awaken"),
        (assign, "$g_player_is_captive", 0),
        (troop_remove_gold, "trp_player", "$player_ransom_amount"),
        (try_begin),
          (party_is_active, "$capturer_party"),
          (party_relocate_near_party, "p_main_party", "$capturer_party", 1),
        (try_end),
        (call_script, "script_set_parties_around_player_ignore_player", 2, 6),
        (assign, "$g_player_icon_state", 0),
        (set_camera_follow_party, "p_main_party"),
        (rest_for_hours, 0, 0, 0),
        (change_screen_return),
      ]
      ),

      ("captivity_end_ransom_deny",
      [],
      "Refuse_him,_wait_for_something_better.",
      [
        (assign, "$g_player_is_captive", 1),
        (store_random_in_range, reg8, 16, 22),
        (call_script, "script_stay_captive_for_hours", reg8),
        (assign, "$auto_menu", "mnu_captivity_castle_check"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captivity_castle_remain", mnf_disable_all_keys|mnf_scale_picture,
    "More days pass in the darkness of your cell. You get through them as best you can, enduring the kicks and curses of the guards, watching your underfed body waste away more and more...",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_prisoner_man_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_prisoner_man"),
      (try_end),
      (store_random_in_range, ":var1", 16, 22),
      (call_script, "script_stay_captive_for_hours", ":var1"),
      (assign, "$auto_menu", "mnu_captivity_castle_check"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$g_player_is_captive", 1),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_quest_report_to_army", mnf_scale_picture,
    "{s8} sends word that he wishes you to join his new military campaign. You need to bring at least {reg13} troops to the army, and are instructed to raise more men posthaste if you do not have enough.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (quest_get_slot, ":var1", "qst_report_to_army", 2),
      (quest_get_slot, ":var2", "qst_report_to_army", 10),
      (call_script, "script_get_information_about_troops_position", ":var1", 0),
      (str_clear, s9),
      (try_begin),
        (eq, reg0, 1),
        (str_store_string, s9, s1),
      (try_end),
      (str_store_troop_name, s8, ":var1"),
      (assign, reg13, ":var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (quest_get_slot, ":var0", "qst_report_to_army", 2),
        (quest_get_slot, ":var1", "qst_report_to_army", 10),
        (str_store_troop_name_link, s13, ":var0"),
        (assign, reg13, ":var1"),
        (setup_quest_text, "qst_report_to_army"),
        (str_store_string, s2, "@{s13} asked you to report to him with at least {reg13} troops."),
        (call_script, "script_start_quest", "qst_report_to_army", ":var0"),
        (call_script, "script_report_quest_troop_positions", "qst_report_to_army", ":var0", 3),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_quest_messenger", mnf_scale_picture,
    "{s8} sends word that he wishes to speak with you about a task he needs performed. He requests you to come and see him as soon as possible.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (faction_get_slot, ":var1", "$players_kingdom", 7),
      (str_store_troop_name, s8, ":var1"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_quest_join_siege_order", mnf_scale_picture,
    "{s8} sends word that you are to join the siege of {s9} in preparation for a full assault. Your troops are to take {s9} at all costs.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (faction_get_slot, ":var1", "$players_kingdom", 7),
      (quest_get_slot, ":var2", "qst_join_siege_with_army", 1),
      (str_store_troop_name, s8, ":var1"),
      (str_store_party_name, s9, ":var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (call_script, "script_end_quest", "qst_follow_army"),
        (quest_get_slot, ":var0", "qst_join_siege_with_army", 1),
        (faction_get_slot, ":var1", "$players_kingdom", 7),
        (str_store_troop_name_link, s13, ":var1"),
        (str_store_party_name_link, s14, ":var0"),
        (setup_quest_text, "qst_join_siege_with_army"),
        (str_store_string, s2, "@{s13} ordered you to join the assault against {s14}."),
        (call_script, "script_start_quest", "qst_join_siege_with_army", ":var1"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_army_follow_failed", mnf_scale_picture,
    "You have disobeyed orders and failed to follow {s8}. In anger he has disbanded you from the army, and sends a stern warning that your actions will not be forgotten.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (faction_get_slot, ":var1", "$players_kingdom", 7),
      (str_store_troop_name, s8, ":var1"),
      (call_script, "script_abort_quest", "qst_follow_army", 1),
      (call_script, "script_change_player_relation_with_troop", ":var1", -3),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("invite_player_to_faction_without_center", mnf_scale_picture,
    "You receive an offer of employment.^^ {s8} of {s9} has sent a messenger to bring you an invititation in his own hand. If you accept, you'll be an employed military commander of {s9}, and in return {s8} asks you to swear an oath to him and fight in his military campaigns, although he offers you no lands or titles. He may be displeased if you don't accept the offer.",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", 10),
      (str_store_troop_name, s8, "$g_invite_faction_lord"),
      (str_store_faction_name, s9, "$g_invite_faction"),
    ],
    [
      ("faction_accept",
      [],
      "Accept!",
      [
        (str_store_troop_name, s1, "$g_invite_faction_lord"),
        (setup_quest_text, "qst_join_faction"),
        (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        (str_store_faction_name_link, s4, "$g_invite_faction"),
        (quest_set_slot, "qst_join_faction", 6, "$g_invite_faction_lord"),
        (quest_set_slot, "qst_join_faction", 23, 30),
        (str_store_string, s2, "@Find and speak with {s3} of {s4} to give him your oath of homage."),
        (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
      ]
      ),

      ("faction_reject",
      [],
      "Decline_the_invitation.",
      [
        (call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        (call_script, "script_change_player_relation_with_faction", "$g_invite_faction", -10),
        (assign, "$g_invite_faction", 0),
        (assign, "$g_invite_faction_lord", 0),
        (assign, "$g_invite_offered_center", 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("invite_player_to_faction", mnf_scale_picture,
    "You receive an offer of employment.^^ {s8} of {s9} has sent a messenger to bring you an invititation in his own hand. If you accept, you'll be an employed military commander of {s9}, and in return {s8} asks you to swear an oath of homage to him and fight in his military campaigns, offering you control of {s2} for your loyal service. He will surely be offended if you do not take the offer...",
    "none",
    [
      (troop_get_type, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", 3),
        (set_background_mesh, "mesh_pic_messenger_indian"),
      (else_try),
        (set_background_mesh, "mesh_pic_messenger"),
      (try_end),
      (faction_get_slot, "$g_invite_faction_lord", "$g_invite_faction", 10),
      (str_store_troop_name, s8, "$g_invite_faction_lord"),
      (str_store_faction_name, s9, "$g_invite_faction"),
      (str_store_party_name, s2, "$g_invite_offered_center"),
    ],
    [
      ("faction_accept",
      [],
      "Accept!",
      [
        (str_store_troop_name, s1, "$g_invite_faction_lord"),
        (setup_quest_text, "qst_join_faction"),
        (str_store_troop_name_link, s3, "$g_invite_faction_lord"),
        (str_store_faction_name_link, s4, "$g_invite_faction"),
        (quest_set_slot, "qst_join_faction", 6, "$g_invite_faction_lord"),
        (quest_set_slot, "qst_join_faction", 23, 30),
        (str_store_string, s2, "@Find and speak with {s3} of {s4} to give him your oath of homage."),
        (call_script, "script_start_quest", "qst_join_faction", "$g_invite_faction_lord"),
        (call_script, "script_report_quest_troop_positions", "qst_join_faction", "$g_invite_faction_lord", 3),
        (jump_to_menu, "mnu_invite_player_to_faction_accepted"),
      ]
      ),

      ("faction_reject",
      [],
      "Decline_the_invitation.",
      [
        (call_script, "script_change_player_relation_with_troop", "$g_invite_faction_lord", -3),
        (assign, "$g_invite_faction", 0),
        (assign, "$g_invite_faction_lord", 0),
        (assign, "$g_invite_offered_center", 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("invite_player_to_faction_accepted", 0,
    "In order to become a commander, you must swear an oath of homage to {s3}. You will have to find him and give him your oath in person. {s5}",
    "none",
    [
      (call_script, "script_get_information_about_troops_position", "$g_invite_faction_lord", 0),
      (str_store_troop_name, s3, "$g_invite_faction_lord"),
      (str_store_string, s5, "@{s1}"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("question_peace_offer", 0,
    "You Receive a Peace Offer^^{s1} offers you a peace agreement. What is your answer?",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
    ],
    [
      ("peace_offer_accept",
      [],
      "Accept",
      [
        (call_script, "script_diplomacy_start_peace_between_kingdoms", "fac_player_supporters_faction", "$g_notification_menu_var1", 1),
        (change_screen_return),
      ]
      ),

      ("peace_offer_reject",
      [],
      "Reject",
      [
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", -5),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_faction_active", 0,
    "You now posess land in your name without being tied to any faction, as a masterless warlord who knows no higher authority. Enjoy this freedom, but know that the autorities of the land will not look to you kindly and will make every attempt to dispose of you. You may find life very difficult without the protection of the state.",
    "none",
    [
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_player_faction_deactive", 0,
    "You no longer hold any land.",
    "none",
    [
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "fac_player_supporters_faction", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_center_under_siege", 0,
    "{s1} has been besieged by {s2} of {s3}!",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":var0", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":var0"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_village_raided", 0,
    "Enemies have Laid Waste to a Fief^^{s1} has been raided by {s2} of {s3}!",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":var0", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":var0"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_village_raid_started", 0,
    "Your Village is under Attack!^^{s2} of {s3} is laying waste to {s1}.",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_troop_name, s2, "$g_notification_menu_var2"),
      (store_troop_faction, ":var0", "$g_notification_menu_var2"),
      (str_store_faction_name, s3, ":var0"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_one_faction_left", 0,
    "Wild West is subdued by One Kingdom^^{s1} defeated all rivals and stands as the sole master of the land.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_oath_renounced_faction_defeated", 0,
    "Your Old Faction was Defeated^^You won the battle against {s1}! This ends your struggle which started after you renounced your oath to them.",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_center_lost", 0,
    "An Estate was Lost^^You have lost {s1} to {s2}.",
    "none",
    [
      (str_store_party_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 62),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (set_game_menu_tableau_mesh, "tableau_center_note_mesh", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_troop_left_players_faction", 0,
    "Betrayal!^^{s1} has left {s2} and joined {s3}.",
    "none",
    [
      (str_store_troop_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$players_kingdom"),
      (str_store_faction_name, s3, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 55),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
      (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_troop_joined_players_faction", 0,
    "Good news!^^ {s1} has left {s2} and joined {s3}.",
    "none",
    [
      (str_store_troop_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (str_store_faction_name, s3, "$players_kingdom"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 55),
      (position_set_y, pos0, 20),
      (position_set_z, pos0, 100),
      (set_game_menu_tableau_mesh, "tableau_troop_note_mesh", "$g_notification_menu_var1", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_war_declared", 0,
    "Declaration of War^^{s1} declared war against {s2}!",
    "none",
    [
      (try_begin),
        (eq, "$g_notification_menu_var1", "fac_player_supporters_faction"),
        (str_store_faction_name, s1, "$g_notification_menu_var2"),
        (str_store_string, s2, "@you"),
      (else_try),
        (eq, "$g_notification_menu_var2", "fac_player_supporters_faction"),
        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_string, s2, "@you"),
      (else_try),
        (str_store_faction_name, s1, "$g_notification_menu_var1"),
        (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (try_end),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":var0", "$g_notification_menu_var1", "fac_player_supporters_faction"),
      (store_sub, ":var1", "$g_notification_menu_var2", "fac_player_supporters_faction"),
      (val_mul, ":var0", 128),
      (val_add, ":var0", ":var1"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":var0", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_peace_declared", 0,
    "Peace Agreement^^{s1} and {s2} have made peace!",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (str_store_faction_name, s2, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (store_sub, ":var0", "$g_notification_menu_var1", "fac_player_supporters_faction"),
      (store_sub, ":var1", "$g_notification_menu_var2", "fac_player_supporters_faction"),
      (val_mul, ":var0", 128),
      (val_add, ":var0", ":var1"),
      (set_game_menu_tableau_mesh, "tableau_2_factions_mesh", ":var0", pos0),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_faction_defeated", 0,
    "Faction Eliminated^^{s1} is no more!",
    "none",
    [
      (str_store_faction_name, s1, "$g_notification_menu_var1"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_begin),
          (is_between, "$supported_pretender", 0, 0),
          (troop_slot_eq, "$supported_pretender", 14, "$g_notification_menu_var1"),
          (try_for_range, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
            (store_troop_faction, ":var1", ":var0"),
            (eq, ":var1", "fac_player_supporters_faction"),
            (troop_set_faction, ":var0", "$g_notification_menu_var1"),
          (try_end),
          (try_for_parties, ":var2"),
            (store_faction_of_party, ":var1", ":var2"),
            (eq, ":var1", "fac_player_supporters_faction"),
            (party_set_faction, ":var2", "$g_notification_menu_var1"),
          (try_end),
          (assign, "$players_kingdom", "$g_notification_menu_var1"),
          (call_script, "script_add_notification_menu", "mnu_notification_rebels_switched_to_faction", "$g_notification_menu_var1", "$supported_pretender"),
          (faction_set_slot, "$g_notification_menu_var1", 21, 0),
          (faction_set_slot, "fac_player_supporters_faction", 21, 2),
          (faction_get_slot, ":var3", "$g_notification_menu_var1", 10),
          (troop_set_slot, ":var3", 55, "fac_commoners"),
          (faction_set_slot, "$g_notification_menu_var1", 10, "$supported_pretender"),
          (faction_set_slot, "$g_notification_menu_var1", 7, "trp_player"),
          (faction_set_slot, "$g_notification_menu_var1", 4, 0),
          (faction_set_slot, "$g_notification_menu_var1", 5, -1),
          (troop_set_slot, "$supported_pretender", 2, 2),
          (party_remove_members, "p_main_party", "$supported_pretender", 1),
          (call_script, "script_set_player_relation_with_faction", "$g_notification_menu_var1", 0),
          (try_for_range, ":var4", "fac_player_supporters_faction", "fac_kingdoms_end"),
            (faction_slot_eq, ":var4", 21, 0),
            (neq, ":var4", "$g_notification_menu_var1"),
            (store_relation, ":var5", ":var4", "fac_player_supporters_faction"),
            (set_relation, ":var4", "$g_notification_menu_var1", ":var5"),
          (try_end),
          (assign, "$supported_pretender", 0),
          (assign, "$supported_pretender_old_faction", 0),
          (assign, "$g_recalculate_ais", 1),
          (call_script, "script_update_all_notes"),
        (try_end),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("notification_rebels_switched_to_faction", 0,
    "Rebellion Success^^ Your rebellion is victorious! Your faction now has the sole claim to the title of {s11}, with {s12} as the single ruler.",
    "none",
    [
      (str_store_faction_name, s11, "$g_notification_menu_var1"),
      (str_store_troop_name, s12, "$g_notification_menu_var2"),
      (set_fixed_point_multiplier, 100),
      (position_set_x, pos0, 65),
      (position_set_y, pos0, 30),
      (position_set_z, pos0, 170),
      (try_begin),
        (is_between, "$g_notification_menu_var1", "fac_kingdom_1", "fac_kingdoms_end"),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (else_try),
        (set_game_menu_tableau_mesh, "tableau_faction_note_mesh_banner", "$g_notification_menu_var1", pos0),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (assign, "$talk_context", 15),
        (start_map_conversation, "$g_notification_menu_var2"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kill_local_merchant_begin", 0,
    "You spot your victim and follow him, observing as he turns a corner into a dark alley. This will surely be your best opportunity to attack him.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (set_jump_mission, "mt_back_alley_kill_local_merchant"),
        (party_get_slot, ":var0", "$qst_kill_local_merchant_center", 17),
        (modify_visitors_at_site, ":var0"),
        (reset_visitors),
        (set_visitor, 0, "trp_player"),
        (set_visitor, 1, "trp_local_merchant"),
        (jump_to_menu, "mnu_town"),
        (jump_to_scene, ":var0"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("auto_return_to_map", 0,
    "stub",
    "none",
    [
      (change_screen_map),
    ],
    [
    ],
    [],
  ),

  ("scene_access", 0,
    "select the scene",
    "none",
    [],
    [
      ("leave",
      [],
      "Leave",
      [
        (change_screen_return),
      ]
      ),

      ("scene_enter_01",
      [],
      "enter_stagecoach_ambush_-_desert",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_stagecoach_ambush_desert"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_02",
      [],
      "enter_stagecoach_ambush_-_desert1",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_stagecoach_ambush_desert1"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_03",
      [],
      "enter_stagecoach_ambush_-_steppe",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_stagecoach_ambush_steppe"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_04",
      [],
      "enter_stagecoach_ambush_-_forest",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_stagecoach_ambush_forest"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_05",
      [],
      "enter_stagecoach_ambush_-_canyon",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_stagecoach_ambush_canyon"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_06",
      [],
      "enter_particle_test",
      [
        (mission_tpl_entry_clear_override_items, "mt_town_default", 0),
        (mission_tpl_entry_set_override_flags, "mt_town_default", 0, 256),
        (troop_set_inventory_slot, "trp_player", ek_item_0, "itm_springfield"),
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_particle_test"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_07",
      [],
      "enter_canyon_steamboat_heist_scene",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_steamboat"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_08",
      [],
      "enter_canyon_steamboat_ambush_scene",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_steamboat2"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_09",
      [],
      "enter_train_heist_scene",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_train_heist"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_10",
      [],
      "enter_canyon_ambush_scene",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_canyon_ambush"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_11",
      [],
      "enter_generic_battle_plain_1",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_generic_battle_plain_01"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_12",
      [],
      "enter_generic_battle_plain_2",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_generic_battle_plain_02"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_13",
      [],
      "enter_generic_battle_plain_3",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_generic_battle_plain_03"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_14",
      [],
      "enter_generic_battle_plain_forest_1",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_generic_battle_plain_forest_01"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),

      ("scene_enter_15",
      [],
      "enter_generic_battle_steppe_1",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_generic_battle_steppe_01"),
        (change_screen_mission),
      ]
,
      "access_scene"
      ),
    ],
  ),

  ("train_job_complete", mnf_disable_all_keys,
    "You've escorted the train to its destination. A man at the train station pays you the money.",
    "none",
    [
      (troop_add_gold, "trp_player", 500),
      (add_xp_to_troop, 1500, "trp_player"),
      (call_script, "script_change_troop_renown", "trp_player", 10),
      (call_script, "script_change_player_relation_with_center", "p_town_2", 2),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (rest_for_hours_interactive, 3, 5, 1),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("train_job_failed", mnf_disable_all_keys,
    "You failed to protect the train and it's been robbed. You barely made it alive. There's always another train in a day or two...",
    "none",
    [
      (call_script, "script_change_player_relation_with_center", "p_town_2", -2),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (rest_for_hours_interactive, 6, 5, 1),
        (change_screen_map),
      ]
      ),
    ],
  ),

  ("barrett_duel_lost", 0,
    "A shot in your right shoulder from the old man sends you to the ground, and your vision spins and goes dark. Time passes. When you open your eyes again you find yourself battered and bloody, but luckily none of the wounds appear to be lethal.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (jump_to_menu, "mnu_town"),
      ]
      ),
    ],
  ),

  ("custom_battle_custom", mnf_disable_all_keys,
    "Your Faction:",
    "none",
    [
      (faction_set_slot, "fac_culture_1", 1, "trp_recruit"),
      (faction_set_slot, "fac_culture_1", 2, "trp_recluta"),
      (faction_set_slot, "fac_culture_2", 1, "trp_recluta"),
      (faction_set_slot, "fac_culture_2", 2, "trp_comanche_buffalo_hunter"),
      (faction_set_slot, "fac_culture_4", 1, "trp_comanche_buffalo_hunter"),
      (faction_set_slot, "fac_culture_4", 2, "trp_apache_rabbit_hunter"),
      (faction_set_slot, "fac_culture_3", 1, "trp_apache_rabbit_hunter"),
      (faction_set_slot, "fac_culture_3", 2, "trp_vagabond"),
      (faction_set_slot, "fac_culture_5", 1, "trp_vagabond"),
      (faction_set_slot, "fac_culture_5", 2, "trp_local_militia"),
      (faction_set_slot, "fac_culture_6", 1, "trp_local_militia"),
      (faction_set_slot, "fac_culture_6", 2, "trp_gambler"),
      (faction_set_slot, "fac_culture_7", 1, "trp_gambler"),
      (faction_set_slot, "fac_culture_7", 2, "trp_faction_troops_end"),
    ],
    [
      ("culture_1",
      [
        (str_store_faction_name, s1, "fac_culture_1"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_1"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom2"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 0),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_2",
      [
        (str_store_faction_name, s1, "fac_culture_2"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_2"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom2"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 0),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_3",
      [
        (str_store_faction_name, s1, "fac_culture_3"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_3"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom2"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 0),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_4",
      [
        (str_store_faction_name, s1, "fac_culture_4"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_4"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom2"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 0),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_5",
      [
        (str_store_faction_name, s1, "fac_culture_5"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_5"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom2"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 0),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_6",
      [
        (str_store_faction_name, s1, "fac_culture_6"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_6"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom2"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 0),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_7",
      [
        (str_store_faction_name, s1, "fac_culture_7"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_7"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom2"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 0),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),
    ],
  ),

  ("custom_battle_select_troops", mnf_disable_all_keys,
    "Select the troop:",
    "none",
    [
      (faction_get_slot, "$first_troop", "$custom_battle_culture", 1),
      (faction_get_slot, "$last_troop", "$custom_battle_culture", 2),
    ],
    [
      ("troop_1",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 0),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 0),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("troop_2",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 1),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 1),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("troop_3",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 2),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 2),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("troop_4",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 3),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 3),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("troop_5",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 4),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 4),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("troop_6",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 5),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 5),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("troop_7",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 6),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 6),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("troop_8",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 7),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (str_store_troop_name, s1, ":var1"),
      ],
      "{s1}",
      [
        (assign, ":var0", -1),
        (assign, ":var1", -1),
        (try_for_range, ":var2", 1, "trp_deer"),
          (is_between, ":var2", "$first_troop", "$last_troop"),
          (val_add, ":var0", 1),
          (store_sub, ":var3", ":var0", 7),
          (eq, ":var3", "$first_troop_no"),
          (assign, ":var1", ":var2"),
        (try_end),
        (ge, ":var1", 0),
        (assign, "$custom_battle_troop", ":var1"),
        (jump_to_menu, "mnu_custom_battle_select_number"),
      ]
      ),

      ("next",
      [],
      "Next",
      [
        (val_add, "$first_troop_no", 8),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("previous",
      [],
      "Previous",
      [
        (val_sub, "$first_troop_no", 8),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("continue",
      [],
      "Continue",
      [
        (jump_to_menu, "$custom_battle_next_menu"),
      ]
      ),
    ],
  ),

  ("custom_battle_select_number", mnf_disable_all_keys,
    "Select the number:",
    "none",
    [
      (val_add, "$custom_battle_entry", 1),
    ],
    [
      ("0",
      [],
      "0",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 0),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("1",
      [],
      "1",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 1),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("2",
      [],
      "2",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 2),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("3",
      [],
      "3",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 3),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("4",
      [],
      "4",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 4),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("5",
      [],
      "5",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 5),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("7",
      [],
      "7",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 7),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("10",
      [],
      "10",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitors, "$custom_battle_entry", "$custom_battle_troop", 10),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),
    ],
  ),

  ("custom_battle_custom2", mnf_disable_all_keys,
    "The enemy Faction:",
    "none",
    [],
    [
      ("culture_1",
      [
        (str_store_faction_name, s1, "fac_culture_1"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_1"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom3"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 15),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_2",
      [
        (str_store_faction_name, s1, "fac_culture_2"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_2"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom3"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 15),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_3",
      [
        (str_store_faction_name, s1, "fac_culture_3"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_3"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom3"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 15),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_4",
      [
        (str_store_faction_name, s1, "fac_culture_4"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_4"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom3"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 15),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_5",
      [
        (str_store_faction_name, s1, "fac_culture_5"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_5"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom3"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 15),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_6",
      [
        (str_store_faction_name, s1, "fac_culture_6"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_6"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom3"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 15),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),

      ("culture_7",
      [
        (str_store_faction_name, s1, "fac_culture_7"),
      ],
      "{s1}",
      [
        (assign, "$custom_battle_culture", "fac_culture_7"),
        (assign, "$custom_battle_next_menu", "mnu_custom_battle_custom3"),
        (assign, "$first_troop_no", 0),
        (assign, "$custom_battle_entry", 15),
        (assign, "$g_custom_battle_scene", "scn_random_scene_plain"),
        (jump_to_menu, "mnu_custom_battle_select_troops"),
      ]
      ),
    ],
  ),

  ("custom_battle_custom3", mnf_disable_all_keys,
    "Select your own character:",
    "none",
    [],
    [
      ("qb_hero_robert",
      [],
      "Remington_Robert",
      [
        (set_player_troop, "trp_qb_hero_robert"),
        (assign, "$g_player_troop", "trp_qb_hero_robert"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_barrett",
      [],
      "Mr._Barrett",
      [
        (set_player_troop, "trp_qb_hero_barrett"),
        (assign, "$g_player_troop", "trp_qb_hero_barrett"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_no_name",
      [],
      "Man_with_No_Name",
      [
        (set_player_troop, "trp_qb_hero_no_name"),
        (assign, "$g_player_troop", "trp_qb_hero_no_name"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_buffalo_hump",
      [],
      "Chief_Buffalo_Hump",
      [
        (set_player_troop, "trp_qb_hero_buffalo_hump"),
        (assign, "$g_player_troop", "trp_qb_hero_buffalo_hump"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_me",
      [],
      "Mysterious_European",
      [
        (set_player_troop, "trp_qb_hero_european"),
        (assign, "$g_player_troop", "trp_qb_hero_european"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_luke_tanglewood",
      [],
      "Luke_Tanglewood",
      [
        (set_player_troop, "trp_qb_hero_luke_tanglewood"),
        (assign, "$g_player_troop", "trp_qb_hero_luke_tanglewood"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_farmer",
      [],
      "Mr._Murphy",
      [
        (set_player_troop, "trp_qb_hero_farmer"),
        (assign, "$g_player_troop", "trp_qb_hero_farmer"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_farmer_wife",
      [],
      "Mrs._Murphy",
      [
        (set_player_troop, "trp_qb_hero_farmer_wife"),
        (assign, "$g_player_troop", "trp_qb_hero_farmer_wife"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),

      ("qb_hero_hobo",
      [],
      "Clive_the_Hobo",
      [
        (set_player_troop, "trp_qb_hero_hobo"),
        (assign, "$g_player_troop", "trp_qb_hero_hobo"),
        (jump_to_menu, "mnu_custom_battle_custom4"),
      ]
      ),
    ],
  ),

  ("custom_battle_custom4", mnf_disable_all_keys,
    "Done!",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue",
      [
        (modify_visitors_at_site, "$g_custom_battle_scene"),
        (set_visitor, 0, "$g_player_troop"),
        (set_jump_mission, "mt_custom_battle_custom"),
        (jump_to_menu, "mnu_custom_battle_end"),
        (jump_to_scene, "$g_custom_battle_scene"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("custom_battle_gettysburg", mnf_disable_all_keys,
    "Choose your scenario:",
    "none",
    [],
    [
      ("custom_battle_scenario_12_1",
      [],
      "Day_1:_McPherson_Ridge",
      [
        (assign, "$g_custom_battle_scenario", 10),
        (jump_to_menu, "mnu_custom_battle_2"),
      ]
      ),

      ("go_back",
      [],
      "Go_back",
      [
        (jump_to_menu, "mnu_start_game_3"),
      ]
      ),
    ],
  ),

  ("mine", mnf_auto_enter,
    "You enter the abandoned mine.",
    "none",
    [],
    [
      ("mine_enter",
      [],
      "none",
      [
        (modify_visitors_at_site, "scn_mine_1"),
        (reset_visitors),
        (set_visitor, 16, "trp_jack_twist"),
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_mine_1"),
        (change_screen_mission),
      ]
,
      "Door_to_the_town_center."
      ),

      ("mine_interior",
      [],
      "none",
      [
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_mine_1_interior"),
        (change_screen_mission),
      ]
,
      "Enter_the_mine."
      ),

      ("mine_leave",
      [],
      "none",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("graveyard", mnf_auto_enter,
    "You enter the graveyard.",
    "none",
    [],
    [
      ("graveyard_enter",
      [],
      "none",
      [
        (modify_visitors_at_site, "scn_graveyard_1"),
        (reset_visitors),
        (try_begin),
          (check_quest_active, "qst_graveyard_duel"),
          (set_visitor, 19, "trp_gy_duel_master"),
          (try_for_range, ":var0", 20, 35),
            (set_visitor, ":var0", "trp_vagabond"),
          (try_end),
        (try_end),
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_graveyard_1"),
        (change_screen_mission),
      ]
,
      "Door_to_the_town_center."
      ),

      ("graveyard_leave",
      [],
      "none",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("old_cabin", mnf_auto_enter,
    "You approach the old cabin.",
    "none",
    [
      (set_background_mesh, "mesh_pic_old_cabin"),
    ],
    [
      ("old_cabin_enter",
      [],
      "none",
      [
        (modify_visitors_at_site, "scn_old_cabin"),
        (reset_visitors),
        (try_for_range, ":var0", 0, "trp_end"),
          (troop_slot_eq, ":var0", 142, "scn_old_cabin"),
          (troop_get_slot, ":var1", ":var0", 143),
          (set_visitor, ":var1", ":var0"),
        (try_end),
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_old_cabin"),
        (change_screen_mission),
      ]
,
      "Door_to_the_town_center."
      ),

      ("old_cabin_leave",
      [],
      "none",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("ambushed_encounter_pre_battle", 0,
    "Having already spotted the ambush, you manuever your army into a favorable position.^^From here you can attack with your full army and still retain the option to withdraw.  However, you can also still choose to fall into the enemy's ambush if you wish.",
    "none",
    [
      (try_begin),
        (eq, "$g_current_ambush_detected", 0),
        (party_slot_eq, "$g_encountered_party", 4, 17),
        (jump_to_menu, "mnu_ambushed_encounter"),
      (else_try),
        (neg|party_slot_eq, "$g_encountered_party", 4, 17),
        (jump_to_menu, "mnu_simple_encounter"),
      (try_end),
    ],
    [
      ("ambushed_attack_prevent_ambush",
      [
        (eq, "$g_current_ambush_detected", 1),
      ],
      "Prevent_yourself_from_being_ambushed_and_attack_the_enemy.",
      [
        (jump_to_menu, "mnu_simple_encounter"),
      ]
      ),

      ("ambushed_allow_ambush",
      [],
      "Allow_yourself_to_be_ambushed.",
      [
        (assign, "$g_current_ambush_detected", 0),
        (jump_to_menu, "mnu_ambushed_encounter"),
      ]
      ),
    ],
  ),

  ("ambushed_encounter", 0,
    "{s4}",
    "none",
    [
      (assign, "$g_enemy_party", "$g_encountered_party"),
      (assign, "$g_ally_party", -1),
      (call_script, "script_encounter_calculate_fit"),
      (try_begin),
        (eq, "$new_encounter", 1),
        (assign, "$new_encounter", 0),
        (assign, "$g_encounter_is_in_village", 0),
        (call_script, "script_separate_regulars_from_party", "p_main_party", "p_main_party_separated"),
        (call_script, "script_encounter_init_variables"),
        (assign, "$encountered_party_friendly", 0),
        (assign, "$encountered_party_hostile", 1),
        (assign, "$cant_leave_encounter", 1),
        (assign, "$talk_context", 2),
        (call_script, "script_setup_party_meeting", "$g_encountered_party"),
      (try_end),
      (try_begin),
        (party_is_active, "$g_encountered_party"),
        (str_store_party_name, s1, "$g_encountered_party"),
      (try_end),
      (store_party_size, ":var0", "p_main_party"),
      (try_begin),
        (gt, ":var0", 1),
        (str_store_string, s2, "@You and your companions"),
      (else_try),
        (str_store_string, s2, "@You"),
      (try_end),
      (store_party_size, ":var0", "p_main_party_separated"),
      (try_begin),
        (gt, ":var0", 0),
        (str_store_string, s3, "@ have been separated from your troops and must fight alone!"),
      (else_try),
        (str_store_string, s3, "@ must prepare to make your stand!"),
      (try_end),
      (str_store_string, s4, "@You have been ambushed by {s1}!^^{s2}{s3}"),
      (try_begin),
        (call_script, "script_party_count_members_with_full_health", "p_collective_enemy"),
        (assign, ":var1", reg0),
        (assign, ":var2", 0),
        (try_begin),
          (eq, "$g_battle_result", 1),
          (eq, ":var1", 0),
          (assign, ":var2", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (le, "$g_enemy_fit_for_battle", 0),
          (ge, "$g_friend_fit_for_battle", 1),
          (assign, ":var2", 1),
        (try_end),
        (this_or_next|eq, ":var2", 1),
        (eq, "$g_enemy_surrenders", 1),
        (assign, "$g_next_menu", -1),
        (call_script, "script_party_add_party", "p_main_party", "p_main_party_separated"),
        (jump_to_menu, "mnu_total_victory"),
      (else_try),
        (call_script, "script_party_count_members_with_full_health", "p_main_party"),
        (assign, reg3, reg0),
        (assign, ":var3", 0),
        (try_begin),
          (eq, "$g_battle_result", -1),
          (eq, reg3, 0),
          (assign, ":var3", 1),
        (else_try),
          (eq, "$g_engaged_enemy", 1),
          (ge, "$g_enemy_fit_for_battle", 1),
          (le, "$g_friend_fit_for_battle", 0),
          (assign, ":var3", 1),
        (try_end),
        (this_or_next|eq, ":var3", 1),
        (eq, "$g_player_surrenders", 1),
        (assign, "$g_next_menu", "mnu_captivity_start_wilderness"),
        (jump_to_menu, "mnu_total_defeat"),
      (try_end),
    ],
    [
      ("ambushed_attack",
      [
        (neg|troop_is_wounded, "trp_player"),
      ],
      "Fight_through_the_ambush.",
      [
        (assign, "$g_battle_result", 0),
        (assign, "$g_engaged_enemy", 1),
        (call_script, "script_calculate_renown_value"),
        (call_script, "script_calculate_battle_advantage"),
        (set_battle_advantage, reg0),
        (set_party_battle_mode),
        (set_jump_mission, "mt_lead_charge"),
        (call_script, "script_setup_random_scene", 1),
        (assign, "$g_next_menu", "mnu_ambushed_encounter"),
        (jump_to_menu, "mnu_battle_debrief"),
        (change_screen_mission),
      ]
      ),

      ("ambushed_surrender",
      [],
      "Surrender.",
      [
        (assign, "$g_player_surrenders", 1),
      ]
      ),
    ],
  ),

  ("bl_station", mnf_auto_enter,
    "You enter the station.",
    "none",
    [],
    [
      ("old_cabin_enter",
      [],
      "none",
      [
        (modify_visitors_at_site, "scn_old_cabin"),
        (reset_visitors),
        (try_for_range, ":var0", 0, "trp_end"),
          (troop_slot_eq, ":var0", 142, "scn_old_cabin"),
          (troop_get_slot, ":var1", ":var0", 143),
          (set_visitor, ":var1", ":var0"),
        (try_end),
        (set_jump_mission, "mt_town_default"),
        (jump_to_scene, "scn_bl_station"),
        (change_screen_mission),
      ]
      ),

      ("old_cabin_leave",
      [],
      "none",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("tull", mnf_auto_enter,
    "You approach the city of Tull.",
    "none",
    [
      (set_background_mesh, "mesh_pic_tull"),
    ],
    [
      ("tull_enter",
      [],
      "_",
      [
        (modify_visitors_at_site, "scn_tull"),
        (reset_visitors),
        (try_for_range, ":var0", 0, "trp_end"),
          (troop_slot_eq, ":var0", 142, "scn_tull"),
          (troop_get_slot, ":var1", ":var0", 143),
          (set_visitor, ":var1", ":var0"),
        (try_end),
        (try_begin),
          (eq, "$tull_zombie_spawned", 0),
          (try_for_range, ":var1", 6, 19),
            (set_visitor, ":var1", "trp_undead_farmer"),
          (try_end),
        (try_end),
        (set_jump_mission, "mt_tull"),
        (jump_to_scene, "scn_tull"),
        (change_screen_mission),
      ]
,
      "Door_to_the_town_center."
      ),

      ("tull_leave",
      [],
      "_",
      [
        (leave_encounter),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("captured_in_town", mnf_scale_picture,
    "You are captured and thrown in jail. When you awaken, bloodied but still alive, the sheriff drags you off to the courthouse. You face charges of:{s20}Taking into consideration your criminal record and the severity of your crimes, the judge posts your bail at {s1}. What do you do?",
    "none",
    [
      (set_background_mesh, "mesh_pic_prisoner_man"),
      (call_script, "script_game_get_money_text", "$bail_amount"),
    ],
    [
      ("skip_town",
      [
        (store_troop_gold, ":var0", "trp_player"),
        (ge, ":var0", "$bail_amount"),
      ],
      "Pay_your_bail_and_skip_town.",
      [
        (troop_remove_gold, "trp_player", "$bail_amount"),
        (change_screen_return),
      ]
      ),

      ("plead_guilty",
      [],
      "Plead_guilty_and_await_sentencing.",
      [
        (jump_to_menu, "mnu_captivity_start_chain_gang"),
      ]
      ),
    ],
  ),

  ("captivity_chain_gang", mnf_scale_picture,
    "You plead guilty, and the judge sentences you to life imprisonment. You are ridden to the outskirts of town and impressed in the local chain gang.",
    "none",
    [],
    [
      ("continue",
      [],
      "Continue...",
      [
        (try_for_range, ":var0", "trp_npc1", "trp_kingdom_heroes_including_player_begin"),
          (main_party_has_troop, ":var0"),
          (remove_member_from_party, ":var0", "p_main_party"),
          (troop_set_slot, ":var0", 2, 0),
          (troop_set_slot, ":var0", 82, 1),
          (assign, "$last_lost_companion", ":var0"),
          (troop_set_health, ":var0", 100),
          (store_random_in_range, ":var1", "p_town_1", "p_castle_1"),
          (troop_set_slot, ":var0", 12, ":var1"),
          (assign, ":var2", 1000),
          (try_for_range, ":var3", "p_town_1", "p_castle_1"),
            (store_faction_of_party, ":var4", ":var3"),
            (store_relation, ":var5", ":var4", "fac_player_faction"),
            (ge, ":var5", 0),
            (store_distance_to_party_from_party, ":var6", ":var3", "p_main_party"),
            (lt, ":var6", ":var2"),
            (assign, ":var2", ":var6"),
            (troop_set_slot, ":var0", 12, ":var3"),
          (try_end),
        (try_end),
        (store_faction_of_party, ":var7", "$current_town"),
        (try_begin),
          (eq, ":var7", "fac_kingdom_1"),
          (assign, "$g_join_chain_gang", 1),
        (else_try),
          (eq, ":var7", "fac_kingdom_2"),
          (assign, "$g_join_chain_gang", 2),
        (try_end),
        (rest_for_hours, 24, 5, 0),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("deer_herd", mnf_scale_picture,
    "You encounter a herd of mule deer. There's about one minute per hunting session before deer start spreading out and escape so make your shots count!",
    "none",
    [
      (try_begin),
        (gt, "$num_buffalos_killed", 0),
        (troop_clear_inventory, "trp_temp_troop"),
        (troop_add_items, "trp_temp_troop", "itm_deer_meat", "$num_buffalos_killed"),
        (troop_add_items, "trp_temp_troop", "itm_deer_hide", "$num_buffalos_killed"),
        (party_get_num_companions, ":var0", "$g_encountered_party"),
        (try_begin),
          (ge, "$num_buffalos_killed", ":var0"),
          (remove_party, "$g_encountered_party"),
          (jump_to_menu, "mnu_auto_return_to_map"),
        (else_try),
          (party_remove_members, "$g_encountered_party", "trp_deer", "$num_buffalos_killed"),
        (try_end),
        (assign, "$num_buffalos_killed", 0),
        (troop_sort_inventory, "trp_temp_troop"),
        (change_screen_loot, "trp_temp_troop"),
      (try_end),
      (set_background_mesh, "mesh_pic_deer_herd"),
    ],
    [
      ("deer_kill",
      [
        (party_get_num_companions, ":var0", "$g_encountered_party"),
        (assign, reg1, ":var0"),
        (try_begin),
          (le, ":var0", 0),
          (disable_menu_option),
        (try_end),
      ],
      "Hunt_{reg1}_of_the_animals.",
      [
        (modify_visitors_at_site, "scn_generic_battle_steppe_02"),
        (reset_visitors),
        (set_jump_mission, "mt_buffalo_hunting"),
        (jump_to_scene, "scn_generic_battle_steppe_02"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (remove_party, "$g_encountered_party"),
        (display_message, "@All Deer Escaped!"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("deer_herd_kill_end", 0,
    "You shouldn't be reading this.",
    "none",
    [
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("buffalo_herd", mnf_scale_picture,
    "You encounter a herd of great buffalo. There's about one minute per hunting session before buffalo start spreading out and escape so make your shots count!",
    "none",
    [
      (try_begin),
        (gt, "$num_buffalos_killed", 0),
        (troop_clear_inventory, "trp_temp_troop"),
        (troop_add_items, "trp_temp_troop", "itm_cattle_meat", "$num_buffalos_killed"),
        (troop_add_items, "trp_temp_troop", "itm_flour", "$num_buffalos_killed"),
        (party_get_num_companions, ":var0", "$g_encountered_party"),
        (try_begin),
          (ge, "$num_buffalos_killed", ":var0"),
          (remove_party, "$g_encountered_party"),
          (jump_to_menu, "mnu_auto_return_to_map"),
        (else_try),
          (party_remove_members, "$g_encountered_party", "trp_buffalo", "$num_buffalos_killed"),
        (try_end),
        (assign, "$num_buffalos_killed", 0),
        (troop_sort_inventory, "trp_temp_troop"),
        (change_screen_loot, "trp_temp_troop"),
      (try_end),
      (set_background_mesh, "mesh_pic_buffalo_herd"),
    ],
    [
      ("buffalo_kill",
      [
        (party_get_num_companions, ":var0", "$g_encountered_party"),
        (assign, reg1, ":var0"),
        (try_begin),
          (le, ":var0", 0),
          (disable_menu_option),
        (try_end),
      ],
      "Hunt_{reg1}_of_the_animals.",
      [
        (set_jump_mission, "mt_buffalo_hunting"),
        (modify_visitors_at_site, "scn_generic_battle_desert_02"),
        (reset_visitors),
        (party_get_num_companion_stacks, ":var0", "p_main_party"),
        (assign, ":var1", -1),
        (try_for_range_backwards, ":var2", 0, ":var0"),
          (party_stack_get_troop_id, ":var3", "p_main_party", ":var2"),
          (troop_is_hero, ":var3"),
          (gt, ":var3", 0),
          (assign, ":var1", ":var3"),
        (try_end),
        (try_begin),
          (ge, ":var1", 0),
          (set_visitor, 1, ":var1"),
        (else_try),
          (party_stack_get_troop_id, ":var3", "p_main_party", 1),
          (gt, ":var3", 0),
          (set_visitor, 1, ":var3"),
        (try_end),
        (jump_to_scene, "scn_generic_battle_steppe_01"),
        (change_screen_mission),
      ]
      ),

      ("leave",
      [],
      "Leave.",
      [
        (remove_party, "$g_encountered_party"),
        (display_message, "@Buffalos Escaped!"),
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("buffalo_herd_kill_end", 0,
    "You shouldn't be reading this.",
    "none",
    [
      (change_screen_return),
    ],
    [
    ],
    [],
  ),

  ("hunting_bandits_failed", mnf_disable_all_keys,
    "{s4} {s5}",
    "none",
    [
      (store_troop_gold, ":var0", "trp_player"),
      (store_div, ":var1", ":var0", 30),
      (store_random_in_range, ":var2", 40, 100),
      (val_add, ":var1", ":var2"),
      (val_min, ":var1", ":var0"),
      (troop_remove_gold, "trp_player", ":var1"),
      (party_set_slot, "$g_encountered_party", 149, 0),
      (party_get_num_companions, ":var3", "p_main_party"),
      (str_store_string, s4, "@The bandits beat you down and leave you for dead. ."),
      (str_store_string, s4, "@You have fallen. The bandits quickly search your body for every coin they can find, then vanish into the plains. They have left you alive, if only barely."),
      (try_begin),
        (gt, ":var3", 2),
        (str_store_string, s5, "@Luckily some of your companions come to search for you when you do not return, and find you lying by the side of the road. They hurry you to safety and dress your wounds."),
      (else_try),
        (str_store_string, s5, "@Luckily a passing trapper finds you lying by the side of the road, and recognise you as a honest person. He carries you to the nearest hut and dresses your wounds."),
      (try_end),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("hunting_bandits_succeeded", mnf_disable_all_keys,
    "Your attackers fall before you as wheat to a scythe! Soon you stand alone in the ground while most of them lie unconscious, dead or dying. Searching the bodies, you find a purse which must have belonged to a previous victim of these brutes.",
    "none",
    [
      (party_set_slot, "$g_encountered_party", 149, 0),
      (store_mul, ":var0", 3, 117),
      (add_xp_to_troop, ":var0", "trp_player"),
      (store_random_in_range, ":var1", 25, 100),
      (store_mul, ":var2", "$num_center_bandits", ":var1"),
      (call_script, "script_troop_add_gold", "trp_player", ":var2"),
    ],
    [
      ("continue",
      [],
      "Continue...",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("kingdom_options", 0,
    "In this menu you can access kingdom options.",
    "none",
    [],
    [
      ("change_name",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 10),
        (try_begin),
          (this_or_next|neq, ":var0", "trp_player"),
          (eq, "$players_kingdom", 0),
          (disable_menu_option),
        (try_end),
      ],
      "Rename_your_faction_after_yourself.",
      [
        (str_store_troop_name, s1, "trp_player"),
        (faction_set_name, "fac_player_supporters_faction", "@{s1}"),
        (call_script, "script_update_all_notes"),
        (change_screen_map),
      ]
      ),

      ("change_color",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 10),
        (try_begin),
          (this_or_next|neq, ":var0", "trp_player"),
          (eq, "$players_kingdom", 0),
          (disable_menu_option),
        (try_end),
      ],
      "Choose_your_faction's_color.",
      [
        (jump_to_menu, "mnu_custom_settlement_color_menu"),
      ]
      ),

      ("choose_faction_culture",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 10),
        (try_begin),
          (this_or_next|neq, ":var0", "trp_player"),
          (eq, "$players_kingdom", 0),
          (disable_menu_option),
        (try_end),
      ],
      "Choose_your_faction's_culture.",
      [
        (jump_to_menu, "mnu_customize_faction_culture"),
      ]
      ),

      ("exit_faction",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 10),
        (try_begin),
          (this_or_next|eq, ":var0", "trp_player"),
          (eq, "$players_kingdom", 0),
          (disable_menu_option),
        (try_end),
      ],
      "Leave_the_army_or_gang_you_are_currently_fighting_for.",
      [
        (faction_get_slot, ":var0", "$players_kingdom", 10),
        (call_script, "script_change_player_relation_with_faction", "$players_kingdom", -20),
        (call_script, "script_change_player_relation_with_troop", ":var0", -15),
        (try_for_range, ":var1", "trp_kingdom_1_lord", "trp_knight_1_1_wife"),
          (store_troop_faction, ":var2", ":var1"),
          (eq, ":var2", "$players_kingdom"),
          (call_script, "script_change_player_relation_with_troop", ":var0", -8),
        (try_end),
        (call_script, "script_player_leave_faction", 1),
        (change_screen_return),
      ]
      ),

      ("back",
      [],
      "Go_back.",
      [
        (jump_to_menu, "mnu_camp_action"),
      ]
      ),
    ],
  ),

  ("custom_settlement_color_menu", 0,
    "Pick a colour:",
    "none",
    [],
    [
      ("custom_settlement_color_option_ri",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (try_begin),
          (gt, ":var0", 15597568),
          (disable_menu_option),
        (try_end),
      ],
      "Increase_Red",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (val_add, ":var0", 1114112),
        (faction_set_slot, "fac_player_supporters_faction", 91, ":var0"),
        (faction_set_color, "fac_player_supporters_faction", ":var0"),
        (display_message, "@(Current faction colour)", ":var0"),
      ]
      ),

      ("custom_settlement_color_option_rd",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (try_begin),
          (lt, ":var0", 1114112),
          (disable_menu_option),
        (try_end),
      ],
      "Decrease_Red",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (val_sub, ":var0", 1114112),
        (faction_set_slot, "fac_player_supporters_faction", 91, ":var0"),
        (faction_set_color, "fac_player_supporters_faction", ":var0"),
        (display_message, "@(Current faction colour)", ":var0"),
      ]
      ),

      ("custom_settlement_color_option_gi",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (store_div, ":var1", ":var0", 65536),
        (val_mul, ":var1", 65536),
        (val_sub, ":var0", ":var1"),
        (try_begin),
          (gt, ":var0", 60928),
          (disable_menu_option),
        (try_end),
      ],
      "Increase_Green",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (val_add, ":var0", 4352),
        (faction_set_slot, "fac_player_supporters_faction", 91, ":var0"),
        (faction_set_color, "fac_player_supporters_faction", ":var0"),
        (display_message, "@(Current faction colour)", ":var0"),
      ]
      ),

      ("custom_settlement_color_option_gd",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (store_div, ":var1", ":var0", 65536),
        (val_mul, ":var1", 65536),
        (val_sub, ":var0", ":var1"),
        (try_begin),
          (lt, ":var0", 4352),
          (disable_menu_option),
        (try_end),
      ],
      "Decrease_Green",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (val_sub, ":var0", 4352),
        (faction_set_slot, "fac_player_supporters_faction", 91, ":var0"),
        (faction_set_color, "fac_player_supporters_faction", ":var0"),
        (display_message, "@(Current faction colour)", ":var0"),
      ]
      ),

      ("custom_settlement_color_option_bi",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (store_div, ":var1", ":var0", 256),
        (val_mul, ":var1", 256),
        (val_sub, ":var0", ":var1"),
        (try_begin),
          (gt, ":var0", 238),
          (disable_menu_option),
        (try_end),
      ],
      "Increase_Blue",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (val_add, ":var0", 17),
        (faction_set_slot, "fac_player_supporters_faction", 91, ":var0"),
        (faction_set_color, "fac_player_supporters_faction", ":var0"),
        (display_message, "@(Current faction colour)", ":var0"),
      ]
      ),

      ("custom_settlement_color_option_bd",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (store_div, ":var1", ":var0", 256),
        (val_mul, ":var1", 256),
        (val_sub, ":var0", ":var1"),
        (try_begin),
          (lt, ":var0", 17),
          (disable_menu_option),
        (try_end),
      ],
      "Decrease_Blue",
      [
        (faction_get_slot, ":var0", "fac_player_supporters_faction", 91),
        (val_sub, ":var0", 17),
        (faction_set_slot, "fac_player_supporters_faction", 91, ":var0"),
        (faction_set_color, "fac_player_supporters_faction", ":var0"),
        (display_message, "@(Current faction colour)", ":var0"),
      ]
      ),

      ("settlement_action_grade_exit",
      [],
      "That_will_do_for_now.",
      [
        (change_screen_return),
      ]
      ),
    ],
  ),

  ("customize_faction_culture", 0,
    "You can choose the culture of your faction. This will affect which troops volunteer to join your cause in your settlements. You currently have adapoted the culture of :^^ {s1}.^^From now on, your culture will be that of ...",
    "none",
    [
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 9),
      (try_begin),
        (eq, ":var0", "fac_culture_1"),
        (str_store_string, s1, "@The United States"),
      (else_try),
        (eq, ":var0", "fac_culture_2"),
        (str_store_string, s1, "@Mexico"),
      (else_try),
        (eq, ":var0", "fac_culture_3"),
        (str_store_string, s1, "@The Apache"),
      (else_try),
        (eq, ":var0", "fac_culture_4"),
        (str_store_string, s1, "@The Comanche"),
      (else_try),
        (eq, ":var0", "fac_culture_5"),
        (str_store_string, s1, "@The Mexican Banda"),
      (else_try),
        (eq, ":var0", "fac_culture_6"),
        (str_store_string, s1, "@The American Lawmen"),
      (else_try),
        (eq, ":var0", "fac_culture_7"),
        (str_store_string, s1, "@The American Gang"),
      (else_try),
        (display_message, "@ERROR: player faction out of range."),
        (str_store_string, s1, "@ERROR"),
      (try_end),
    ],
    [
      ("customize_faction_culture_usa",
      [],
      "The_United_States.",
      [
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_1"),
        (call_script, "script_faction_update_culture_of_owned_centers", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("customize_faction_culture_mexico",
      [],
      "Mexico.",
      [
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_2"),
        (call_script, "script_faction_update_culture_of_owned_centers", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("customize_faction_culture_apache",
      [],
      "The_Apache.",
      [
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_3"),
        (call_script, "script_faction_update_culture_of_owned_centers", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("customize_faction_culture_comanche",
      [],
      "The_Comanche.",
      [
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_4"),
        (call_script, "script_faction_update_culture_of_owned_centers", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("customize_faction_culture_banda",
      [],
      "The_Mexican_Banda.",
      [
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_5"),
        (call_script, "script_faction_update_culture_of_owned_centers", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("customize_faction_culture_lawmen",
      [],
      "The_American_Lawmen.",
      [
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_6"),
        (call_script, "script_faction_update_culture_of_owned_centers", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("customize_faction_culture_gang",
      [],
      "The_American_Gang.",
      [
        (faction_set_slot, "fac_player_supporters_faction", 9, "fac_culture_7"),
        (call_script, "script_faction_update_culture_of_owned_centers", "fac_player_supporters_faction"),
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),

      ("customize_faction_culture_no_change",
      [],
      "Go_Back.",
      [
        (jump_to_menu, "mnu_kingdom_options"),
      ]
      ),
    ],
  ),

  ("choose_scenes_0", 0,
    "Choose a scene: (Page 1 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_13"),
      ]
      ),

      ("choose_scene_0",
      [],
      "barretts_house:_indoors",
      [
        (jump_to_scene, "scn_barretts_house"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_1",
      [],
      "bl_station:_generate",
      [
        (jump_to_scene, "scn_bl_station"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_2",
      [],
      "camp_scene:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_camp_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_3",
      [],
      "camp_scene_horse_track:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_camp_scene_horse_track"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_4",
      [],
      "canyon_ambush:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_canyon_ambush"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_5",
      [],
      "castle_10_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_10_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_6",
      [],
      "castle_10_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_10_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_7",
      [],
      "castle_10_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_10_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_8",
      [],
      "castle_11_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_11_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_9",
      [],
      "castle_11_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_11_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_10",
      [],
      "castle_11_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_11_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_11",
      [],
      "castle_12_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_12_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_12",
      [],
      "castle_12_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_12_interior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_13", 0,
    "Choose a scene: (Page 2 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_26"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_0"),
      ]
      ),

      ("choose_scene_13",
      [],
      "castle_12_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_12_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_14",
      [],
      "castle_1_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_1_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_15",
      [],
      "castle_1_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_1_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_16",
      [],
      "castle_1_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_1_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_17",
      [],
      "castle_2_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_2_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_18",
      [],
      "castle_2_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_2_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_19",
      [],
      "castle_2_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_2_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_20",
      [],
      "castle_3_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_3_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_21",
      [],
      "castle_3_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_3_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_22",
      [],
      "castle_3_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_3_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_23",
      [],
      "castle_4_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_4_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_24",
      [],
      "castle_4_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_4_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_25",
      [],
      "castle_4_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_4_prison"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_26", 0,
    "Choose a scene: (Page 3 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_39"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_13"),
      ]
      ),

      ("choose_scene_26",
      [],
      "castle_5_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_5_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_27",
      [],
      "castle_5_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_5_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_28",
      [],
      "castle_5_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_5_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_29",
      [],
      "castle_6_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_6_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_30",
      [],
      "castle_6_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_6_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_31",
      [],
      "castle_6_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_6_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_32",
      [],
      "castle_7_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_7_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_33",
      [],
      "castle_7_interior:_generate",
      [
        (jump_to_scene, "scn_castle_7_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_34",
      [],
      "castle_7_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_7_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_35",
      [],
      "castle_8_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_8_exterior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_36",
      [],
      "castle_8_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_8_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_37",
      [],
      "castle_8_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_8_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_38",
      [],
      "castle_9_exterior:_generate",
      [
        (jump_to_scene, "scn_castle_9_exterior"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_39", 0,
    "Choose a scene: (Page 4 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_52"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_26"),
      ]
      ),

      ("choose_scene_39",
      [],
      "castle_9_interior:_indoors",
      [
        (jump_to_scene, "scn_castle_9_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_40",
      [],
      "castle_9_prison:_indoors",
      [
        (jump_to_scene, "scn_castle_9_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_41",
      [],
      "chain_gang_escape:_generate",
      [
        (jump_to_scene, "scn_chain_gang_escape"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_42",
      [],
      "conversation_scene",
      [
        (jump_to_scene, "scn_conversation_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_43",
      [],
      "dhorak_keep:_generate",
      [
        (jump_to_scene, "scn_dhorak_keep"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_44",
      [],
      "field_1:_generate",
      [
        (jump_to_scene, "scn_field_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_45",
      [],
      "field_2:_generate",
      [
        (jump_to_scene, "scn_field_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_46",
      [],
      "field_3:_generate",
      [
        (jump_to_scene, "scn_field_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_47",
      [],
      "field_4:_generate",
      [
        (jump_to_scene, "scn_field_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_48",
      [],
      "field_5:_generate",
      [
        (jump_to_scene, "scn_field_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_49",
      [],
      "four_ways_inn:_generate",
      [
        (jump_to_scene, "scn_four_ways_inn"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_50",
      [],
      "generic_battle_desert_01:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_desert_01"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_51",
      [],
      "generic_battle_desert_02:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_desert_02"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_52", 0,
    "Choose a scene: (Page 5 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_65"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_39"),
      ]
      ),

      ("choose_scene_52",
      [],
      "generic_battle_desert_03:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_desert_03"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_53",
      [],
      "generic_battle_desert_04:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_desert_04"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_54",
      [],
      "generic_battle_plain_01:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_plain_01"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_55",
      [],
      "generic_battle_plain_02:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_plain_02"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_56",
      [],
      "generic_battle_plain_03:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_plain_03"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_57",
      [],
      "generic_battle_plain_forest_01:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_plain_forest_01"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_58",
      [],
      "generic_battle_steppe_01:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_steppe_01"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_59",
      [],
      "generic_battle_steppe_02:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_steppe_02"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_60",
      [],
      "generic_battle_steppe_03:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_steppe_03"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_61",
      [],
      "generic_battle_steppe_forest_01:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_steppe_forest_01"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_62",
      [],
      "generic_battle_steppe_forest_02:_generate|auto_entry_points",
      [
        (jump_to_scene, "scn_generic_battle_steppe_forest_02"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_63",
      [],
      "graveyard_1:_generate",
      [
        (jump_to_scene, "scn_graveyard_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_64",
      [],
      "hideout:_generate",
      [
        (jump_to_scene, "scn_hideout"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_65", 0,
    "Choose a scene: (Page 6 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_78"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_52"),
      ]
      ),

      ("choose_scene_65",
      [],
      "mine_1:_generate",
      [
        (jump_to_scene, "scn_mine_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_66",
      [],
      "mine_1_interior:_indoors",
      [
        (jump_to_scene, "scn_mine_1_interior"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_67",
      [],
      "novice_ground:_indoors",
      [
        (jump_to_scene, "scn_novice_ground"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_68",
      [],
      "old_cabin:_generate",
      [
        (jump_to_scene, "scn_old_cabin"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_69",
      [],
      "particle_test:_generate",
      [
        (jump_to_scene, "scn_particle_test"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_70",
      [],
      "quick_battle_1:_generate",
      [
        (jump_to_scene, "scn_quick_battle_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_71",
      [],
      "quick_battle_10:_generate",
      [
        (jump_to_scene, "scn_quick_battle_10"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_72",
      [],
      "quick_battle_2:_generate",
      [
        (jump_to_scene, "scn_quick_battle_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_73",
      [],
      "quick_battle_3:_generate",
      [
        (jump_to_scene, "scn_quick_battle_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_74",
      [],
      "quick_battle_4:_generate",
      [
        (jump_to_scene, "scn_quick_battle_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_75",
      [],
      "quick_battle_5:_generate",
      [
        (jump_to_scene, "scn_quick_battle_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_76",
      [],
      "quick_battle_6:_generate",
      [
        (jump_to_scene, "scn_quick_battle_6"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_77",
      [],
      "quick_battle_7:_generate",
      [
        (jump_to_scene, "scn_quick_battle_7"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_78", 0,
    "Choose a scene: (Page 7 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_91"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_65"),
      ]
      ),

      ("choose_scene_78",
      [],
      "quick_battle_8:_generate",
      [
        (jump_to_scene, "scn_quick_battle_8"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_79",
      [],
      "quick_battle_9:_generate",
      [
        (jump_to_scene, "scn_quick_battle_9"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_80",
      [],
      "quick_battle_alamo:_generate",
      [
        (jump_to_scene, "scn_quick_battle_alamo"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_81",
      [],
      "quick_battle_gettysburg_1:_generate",
      [
        (jump_to_scene, "scn_quick_battle_gettysburg_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_82",
      [],
      "random_scene:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_83",
      [],
      "random_scene_desert:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_desert"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_84",
      [],
      "random_scene_desert_forest:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_desert_forest"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_85",
      [],
      "random_scene_desert_forest_small:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_desert_forest_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_86",
      [],
      "random_scene_desert_small:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_desert_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_87",
      [],
      "random_scene_plain:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_plain"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_88",
      [],
      "random_scene_plain_forest:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_plain_forest"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_89",
      [],
      "random_scene_plain_forest_small:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_plain_forest_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_90",
      [],
      "random_scene_plain_small:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_plain_small"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_91", 0,
    "Choose a scene: (Page 8 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_104"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_78"),
      ]
      ),

      ("choose_scene_91",
      [],
      "random_scene_steppe:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_steppe"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_92",
      [],
      "random_scene_steppe_forest:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_steppe_forest"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_93",
      [],
      "random_scene_steppe_forest_small:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_steppe_forest_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_94",
      [],
      "random_scene_steppe_small:_randomize|generate|auto_entry_points",
      [
        (jump_to_scene, "scn_random_scene_steppe_small"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_95",
      [],
      "reserved10",
      [
        (jump_to_scene, "scn_reserved10"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_96",
      [],
      "reserved11",
      [
        (jump_to_scene, "scn_reserved11"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_97",
      [],
      "reserved12:_indoors",
      [
        (jump_to_scene, "scn_reserved12"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_98",
      [],
      "reserved4:_generate",
      [
        (jump_to_scene, "scn_reserved4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_99",
      [],
      "reserved5:_generate",
      [
        (jump_to_scene, "scn_reserved5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_100",
      [],
      "reserved6:_generate",
      [
        (jump_to_scene, "scn_reserved6"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_101",
      [],
      "reserved7:_generate",
      [
        (jump_to_scene, "scn_reserved7"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_102",
      [],
      "reserved8:_generate",
      [
        (jump_to_scene, "scn_reserved8"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_103",
      [],
      "reserved9:_indoors",
      [
        (jump_to_scene, "scn_reserved9"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_104", 0,
    "Choose a scene: (Page 9 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_117"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_91"),
      ]
      ),

      ("choose_scene_104",
      [],
      "salt_mine:_generate",
      [
        (jump_to_scene, "scn_salt_mine"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_105",
      [],
      "stagecoach_ambush_canyon:_generate",
      [
        (jump_to_scene, "scn_stagecoach_ambush_canyon"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_106",
      [],
      "stagecoach_ambush_desert:_generate",
      [
        (jump_to_scene, "scn_stagecoach_ambush_desert"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_107",
      [],
      "stagecoach_ambush_desert1:_generate",
      [
        (jump_to_scene, "scn_stagecoach_ambush_desert1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_108",
      [],
      "stagecoach_ambush_forest:_generate",
      [
        (jump_to_scene, "scn_stagecoach_ambush_forest"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_109",
      [],
      "stagecoach_ambush_steppe:_generate",
      [
        (jump_to_scene, "scn_stagecoach_ambush_steppe"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_110",
      [],
      "steamboat:_generate",
      [
        (jump_to_scene, "scn_steamboat"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_111",
      [],
      "steamboat2:_generate",
      [
        (jump_to_scene, "scn_steamboat2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_112",
      [],
      "test_scene:_generate",
      [
        (jump_to_scene, "scn_test_scene"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_113",
      [],
      "the_happy_boar:_indoors",
      [
        (jump_to_scene, "scn_the_happy_boar"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_114",
      [],
      "town_10_alley:_generate",
      [
        (jump_to_scene, "scn_town_10_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_115",
      [],
      "town_10_arena:_generate",
      [
        (jump_to_scene, "scn_town_10_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_116",
      [],
      "town_10_castle:_indoors",
      [
        (jump_to_scene, "scn_town_10_castle"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_117", 0,
    "Choose a scene: (Page 10 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_130"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_104"),
      ]
      ),

      ("choose_scene_117",
      [],
      "town_10_center:_generate",
      [
        (jump_to_scene, "scn_town_10_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_118",
      [],
      "town_10_prison:_indoors",
      [
        (jump_to_scene, "scn_town_10_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_119",
      [],
      "town_10_store:_indoors",
      [
        (jump_to_scene, "scn_town_10_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_120",
      [],
      "town_10_store:_indoors",
      [
        (jump_to_scene, "scn_town_10_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_121",
      [],
      "town_10_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_10_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_122",
      [],
      "town_10_walls:_generate",
      [
        (jump_to_scene, "scn_town_10_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_123",
      [],
      "town_11_alley:_generate",
      [
        (jump_to_scene, "scn_town_11_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_124",
      [],
      "town_11_arena:_generate",
      [
        (jump_to_scene, "scn_town_11_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_125",
      [],
      "town_11_castle:_indoors",
      [
        (jump_to_scene, "scn_town_11_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_126",
      [],
      "town_11_center:_generate",
      [
        (jump_to_scene, "scn_town_11_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_127",
      [],
      "town_11_prison:_indoors",
      [
        (jump_to_scene, "scn_town_11_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_128",
      [],
      "town_11_store:_indoors",
      [
        (jump_to_scene, "scn_town_11_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_129",
      [],
      "town_11_store:_indoors",
      [
        (jump_to_scene, "scn_town_11_store"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_130", 0,
    "Choose a scene: (Page 11 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_143"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_117"),
      ]
      ),

      ("choose_scene_130",
      [],
      "town_11_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_11_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_131",
      [],
      "town_11_walls:_generate",
      [
        (jump_to_scene, "scn_town_11_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_132",
      [],
      "town_12_alley:_generate",
      [
        (jump_to_scene, "scn_town_12_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_133",
      [],
      "town_12_arena:_generate",
      [
        (jump_to_scene, "scn_town_12_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_134",
      [],
      "town_12_castle:_indoors",
      [
        (jump_to_scene, "scn_town_12_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_135",
      [],
      "town_12_center:_generate",
      [
        (jump_to_scene, "scn_town_12_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_136",
      [],
      "town_12_prison:_indoors",
      [
        (jump_to_scene, "scn_town_12_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_137",
      [],
      "town_12_store:_indoors",
      [
        (jump_to_scene, "scn_town_12_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_138",
      [],
      "town_12_store:_indoors",
      [
        (jump_to_scene, "scn_town_12_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_139",
      [],
      "town_12_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_12_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_140",
      [],
      "town_12_walls:_generate",
      [
        (jump_to_scene, "scn_town_12_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_141",
      [],
      "town_13_alley:_generate",
      [
        (jump_to_scene, "scn_town_13_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_142",
      [],
      "town_13_arena:_generate",
      [
        (jump_to_scene, "scn_town_13_arena"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_143", 0,
    "Choose a scene: (Page 12 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_156"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_130"),
      ]
      ),

      ("choose_scene_143",
      [],
      "town_13_castle:_indoors",
      [
        (jump_to_scene, "scn_town_13_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_144",
      [],
      "town_13_center:_generate",
      [
        (jump_to_scene, "scn_town_13_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_145",
      [],
      "town_13_prison:_indoors",
      [
        (jump_to_scene, "scn_town_13_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_146",
      [],
      "town_13_store:_indoors",
      [
        (jump_to_scene, "scn_town_13_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_147",
      [],
      "town_13_store:_indoors",
      [
        (jump_to_scene, "scn_town_13_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_148",
      [],
      "town_13_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_13_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_149",
      [],
      "town_13_walls:_generate",
      [
        (jump_to_scene, "scn_town_13_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_150",
      [],
      "town_14_alley:_generate",
      [
        (jump_to_scene, "scn_town_14_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_151",
      [],
      "town_14_arena:_generate",
      [
        (jump_to_scene, "scn_town_14_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_152",
      [],
      "town_14_castle:_indoors",
      [
        (jump_to_scene, "scn_town_14_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_153",
      [],
      "town_14_center:_generate",
      [
        (jump_to_scene, "scn_town_14_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_154",
      [],
      "town_14_prison:_indoors",
      [
        (jump_to_scene, "scn_town_14_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_155",
      [],
      "town_14_store:_indoors",
      [
        (jump_to_scene, "scn_town_14_store"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_156", 0,
    "Choose a scene: (Page 13 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_169"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_143"),
      ]
      ),

      ("choose_scene_156",
      [],
      "town_14_store:_indoors",
      [
        (jump_to_scene, "scn_town_14_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_157",
      [],
      "town_14_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_14_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_158",
      [],
      "town_14_walls:_generate",
      [
        (jump_to_scene, "scn_town_14_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_159",
      [],
      "town_15_alley:_generate",
      [
        (jump_to_scene, "scn_town_15_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_160",
      [],
      "town_15_arena:_generate",
      [
        (jump_to_scene, "scn_town_15_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_161",
      [],
      "town_15_castle:_indoors",
      [
        (jump_to_scene, "scn_town_15_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_162",
      [],
      "town_15_center:_generate",
      [
        (jump_to_scene, "scn_town_15_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_163",
      [],
      "town_15_prison:_indoors",
      [
        (jump_to_scene, "scn_town_15_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_164",
      [],
      "town_15_store:_indoors",
      [
        (jump_to_scene, "scn_town_15_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_165",
      [],
      "town_15_store:_indoors",
      [
        (jump_to_scene, "scn_town_15_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_166",
      [],
      "town_15_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_15_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_167",
      [],
      "town_15_walls:_generate",
      [
        (jump_to_scene, "scn_town_15_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_168",
      [],
      "town_16_alley:_generate",
      [
        (jump_to_scene, "scn_town_16_alley"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_169", 0,
    "Choose a scene: (Page 14 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_182"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_156"),
      ]
      ),

      ("choose_scene_169",
      [],
      "town_16_arena:_generate",
      [
        (jump_to_scene, "scn_town_16_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_170",
      [],
      "town_16_castle:_indoors",
      [
        (jump_to_scene, "scn_town_16_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_171",
      [],
      "town_16_center:_generate",
      [
        (jump_to_scene, "scn_town_16_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_172",
      [],
      "town_16_prison:_indoors",
      [
        (jump_to_scene, "scn_town_16_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_173",
      [],
      "town_16_store:_indoors",
      [
        (jump_to_scene, "scn_town_16_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_174",
      [],
      "town_16_store:_indoors",
      [
        (jump_to_scene, "scn_town_16_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_175",
      [],
      "town_16_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_16_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_176",
      [],
      "town_16_walls:_generate",
      [
        (jump_to_scene, "scn_town_16_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_177",
      [],
      "town_17_alley:_generate",
      [
        (jump_to_scene, "scn_town_17_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_178",
      [],
      "town_17_arena:_generate",
      [
        (jump_to_scene, "scn_town_17_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_179",
      [],
      "town_17_castle:_indoors",
      [
        (jump_to_scene, "scn_town_17_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_180",
      [],
      "town_17_center:_generate",
      [
        (jump_to_scene, "scn_town_17_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_181",
      [],
      "town_17_prison:_indoors",
      [
        (jump_to_scene, "scn_town_17_prison"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_182", 0,
    "Choose a scene: (Page 15 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_195"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_169"),
      ]
      ),

      ("choose_scene_182",
      [],
      "town_17_store:_indoors",
      [
        (jump_to_scene, "scn_town_17_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_183",
      [],
      "town_17_store:_indoors",
      [
        (jump_to_scene, "scn_town_17_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_184",
      [],
      "town_17_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_17_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_185",
      [],
      "town_17_walls:_generate",
      [
        (jump_to_scene, "scn_town_17_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_186",
      [],
      "town_18_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_18_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_187",
      [],
      "town_1_alley:_generate",
      [
        (jump_to_scene, "scn_town_1_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_188",
      [],
      "town_1_arena:_generate",
      [
        (jump_to_scene, "scn_town_1_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_189",
      [],
      "town_1_castle:_indoors",
      [
        (jump_to_scene, "scn_town_1_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_190",
      [],
      "town_1_center:_generate",
      [
        (jump_to_scene, "scn_town_1_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_191",
      [],
      "town_1_prison:_indoors",
      [
        (jump_to_scene, "scn_town_1_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_192",
      [],
      "town_1_store:_indoors",
      [
        (jump_to_scene, "scn_town_1_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_193",
      [],
      "town_1_store:_indoors",
      [
        (jump_to_scene, "scn_town_1_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_194",
      [],
      "town_1_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_1_tavern"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_195", 0,
    "Choose a scene: (Page 16 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_208"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_182"),
      ]
      ),

      ("choose_scene_195",
      [],
      "town_1_walls:_generate",
      [
        (jump_to_scene, "scn_town_1_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_196",
      [],
      "town_2_alley:_generate",
      [
        (jump_to_scene, "scn_town_2_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_197",
      [],
      "town_2_arena:_generate",
      [
        (jump_to_scene, "scn_town_2_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_198",
      [],
      "town_2_castle:_indoors",
      [
        (jump_to_scene, "scn_town_2_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_199",
      [],
      "town_2_center:_generate",
      [
        (jump_to_scene, "scn_town_2_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_200",
      [],
      "town_2_prison:_indoors",
      [
        (jump_to_scene, "scn_town_2_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_201",
      [],
      "town_2_store:_indoors",
      [
        (jump_to_scene, "scn_town_2_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_202",
      [],
      "town_2_store:_indoors",
      [
        (jump_to_scene, "scn_town_2_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_203",
      [],
      "town_2_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_2_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_204",
      [],
      "town_2_walls:_generate",
      [
        (jump_to_scene, "scn_town_2_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_205",
      [],
      "town_3_alley:_generate",
      [
        (jump_to_scene, "scn_town_3_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_206",
      [],
      "town_3_arena:_generate",
      [
        (jump_to_scene, "scn_town_3_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_207",
      [],
      "town_3_castle:_indoors",
      [
        (jump_to_scene, "scn_town_3_castle"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_208", 0,
    "Choose a scene: (Page 17 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_221"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_195"),
      ]
      ),

      ("choose_scene_208",
      [],
      "town_3_center:_generate",
      [
        (jump_to_scene, "scn_town_3_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_209",
      [],
      "town_3_prison:_indoors",
      [
        (jump_to_scene, "scn_town_3_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_210",
      [],
      "town_3_store:_indoors",
      [
        (jump_to_scene, "scn_town_3_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_211",
      [],
      "town_3_store:_indoors",
      [
        (jump_to_scene, "scn_town_3_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_212",
      [],
      "town_3_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_3_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_213",
      [],
      "town_3_walls:_generate",
      [
        (jump_to_scene, "scn_town_3_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_214",
      [],
      "town_4_alley:_generate",
      [
        (jump_to_scene, "scn_town_4_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_215",
      [],
      "town_4_arena:_generate",
      [
        (jump_to_scene, "scn_town_4_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_216",
      [],
      "town_4_castle:_indoors",
      [
        (jump_to_scene, "scn_town_4_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_217",
      [],
      "town_4_center:_generate",
      [
        (jump_to_scene, "scn_town_4_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_218",
      [],
      "town_4_prison:_indoors",
      [
        (jump_to_scene, "scn_town_4_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_219",
      [],
      "town_4_store:_indoors",
      [
        (jump_to_scene, "scn_town_4_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_220",
      [],
      "town_4_store:_indoors",
      [
        (jump_to_scene, "scn_town_4_store"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_221", 0,
    "Choose a scene: (Page 18 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_234"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_208"),
      ]
      ),

      ("choose_scene_221",
      [],
      "town_4_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_4_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_222",
      [],
      "town_4_walls:_generate",
      [
        (jump_to_scene, "scn_town_4_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_223",
      [],
      "town_5_alley:_generate",
      [
        (jump_to_scene, "scn_town_5_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_224",
      [],
      "town_5_arena:_generate",
      [
        (jump_to_scene, "scn_town_5_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_225",
      [],
      "town_5_castle:_indoors",
      [
        (jump_to_scene, "scn_town_5_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_226",
      [],
      "town_5_center:_generate",
      [
        (jump_to_scene, "scn_town_5_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_227",
      [],
      "town_5_prison:_indoors",
      [
        (jump_to_scene, "scn_town_5_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_228",
      [],
      "town_5_store:_indoors",
      [
        (jump_to_scene, "scn_town_5_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_229",
      [],
      "town_5_store:_indoors",
      [
        (jump_to_scene, "scn_town_5_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_230",
      [],
      "town_5_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_5_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_231",
      [],
      "town_5_walls:_generate",
      [
        (jump_to_scene, "scn_town_5_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_232",
      [],
      "town_6_alley:_generate",
      [
        (jump_to_scene, "scn_town_6_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_233",
      [],
      "town_6_arena:_generate",
      [
        (jump_to_scene, "scn_town_6_arena"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_234", 0,
    "Choose a scene: (Page 19 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_247"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_221"),
      ]
      ),

      ("choose_scene_234",
      [],
      "town_6_castle:_indoors",
      [
        (jump_to_scene, "scn_town_6_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_235",
      [],
      "town_6_center:_generate",
      [
        (jump_to_scene, "scn_town_6_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_236",
      [],
      "town_6_prison:_indoors",
      [
        (jump_to_scene, "scn_town_6_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_237",
      [],
      "town_6_store:_indoors",
      [
        (jump_to_scene, "scn_town_6_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_238",
      [],
      "town_6_store:_indoors",
      [
        (jump_to_scene, "scn_town_6_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_239",
      [],
      "town_6_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_6_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_240",
      [],
      "town_6_walls:_generate",
      [
        (jump_to_scene, "scn_town_6_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_241",
      [],
      "town_7_alley:_generate",
      [
        (jump_to_scene, "scn_town_7_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_242",
      [],
      "town_7_arena:_generate",
      [
        (jump_to_scene, "scn_town_7_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_243",
      [],
      "town_7_castle:_indoors",
      [
        (jump_to_scene, "scn_town_7_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_244",
      [],
      "town_7_center:_generate",
      [
        (jump_to_scene, "scn_town_7_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_245",
      [],
      "town_7_prison:_indoors",
      [
        (jump_to_scene, "scn_town_7_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_246",
      [],
      "town_7_store:_indoors",
      [
        (jump_to_scene, "scn_town_7_store"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_247", 0,
    "Choose a scene: (Page 20 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_260"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_234"),
      ]
      ),

      ("choose_scene_247",
      [],
      "town_7_store:_indoors",
      [
        (jump_to_scene, "scn_town_7_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_248",
      [],
      "town_7_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_7_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_249",
      [],
      "town_7_walls:_generate",
      [
        (jump_to_scene, "scn_town_7_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_250",
      [],
      "town_8_alley:_generate",
      [
        (jump_to_scene, "scn_town_8_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_251",
      [],
      "town_8_arena:_generate",
      [
        (jump_to_scene, "scn_town_8_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_252",
      [],
      "town_8_arena:_generate",
      [
        (jump_to_scene, "scn_town_8_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_253",
      [],
      "town_8_castle:_indoors",
      [
        (jump_to_scene, "scn_town_8_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_254",
      [],
      "town_8_center:_generate",
      [
        (jump_to_scene, "scn_town_8_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_255",
      [],
      "town_8_prison:_indoors",
      [
        (jump_to_scene, "scn_town_8_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_256",
      [],
      "town_8_store:_indoors",
      [
        (jump_to_scene, "scn_town_8_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_257",
      [],
      "town_8_store:_indoors",
      [
        (jump_to_scene, "scn_town_8_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_258",
      [],
      "town_8_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_8_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_259",
      [],
      "town_8_walls:_generate",
      [
        (jump_to_scene, "scn_town_8_walls"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_260", 0,
    "Choose a scene: (Page 21 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_273"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_247"),
      ]
      ),

      ("choose_scene_260",
      [],
      "town_9_alley:_generate",
      [
        (jump_to_scene, "scn_town_9_alley"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_261",
      [],
      "town_9_arena:_generate",
      [
        (jump_to_scene, "scn_town_9_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_262",
      [],
      "town_9_castle:_indoors",
      [
        (jump_to_scene, "scn_town_9_castle"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_263",
      [],
      "town_9_center:_generate",
      [
        (jump_to_scene, "scn_town_9_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_264",
      [],
      "town_9_prison:_indoors",
      [
        (jump_to_scene, "scn_town_9_prison"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_265",
      [],
      "town_9_store:_indoors",
      [
        (jump_to_scene, "scn_town_9_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_266",
      [],
      "town_9_store:_indoors",
      [
        (jump_to_scene, "scn_town_9_store"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_267",
      [],
      "town_9_tavern:_indoors",
      [
        (jump_to_scene, "scn_town_9_tavern"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_268",
      [],
      "town_9_walls:_generate",
      [
        (jump_to_scene, "scn_town_9_walls"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_269",
      [],
      "train_heist:_generate",
      [
        (jump_to_scene, "scn_train_heist"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_270",
      [],
      "training_ground:_generate",
      [
        (jump_to_scene, "scn_training_ground"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_271",
      [],
      "training_ground_horse_track_1:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_272",
      [],
      "training_ground_horse_track_2:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_2"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_273", 0,
    "Choose a scene: (Page 22 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_286"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_260"),
      ]
      ),

      ("choose_scene_273",
      [],
      "training_ground_horse_track_3:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_274",
      [],
      "training_ground_horse_track_4:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_275",
      [],
      "training_ground_horse_track_5:_generate",
      [
        (jump_to_scene, "scn_training_ground_horse_track_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_276",
      [],
      "training_ground_ranged_melee_1:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_277",
      [],
      "training_ground_ranged_melee_2:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_278",
      [],
      "training_ground_ranged_melee_3:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_279",
      [],
      "training_ground_ranged_melee_4:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_280",
      [],
      "training_ground_ranged_melee_5:_generate",
      [
        (jump_to_scene, "scn_training_ground_ranged_melee_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_281",
      [],
      "tull:_generate",
      [
        (jump_to_scene, "scn_tull"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_282",
      [],
      "tutorial_1:_indoors",
      [
        (jump_to_scene, "scn_tutorial_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_283",
      [],
      "tutorial_2:_indoors",
      [
        (jump_to_scene, "scn_tutorial_2"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_284",
      [],
      "tutorial_3:_indoors",
      [
        (jump_to_scene, "scn_tutorial_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_285",
      [],
      "tutorial_4:_generate",
      [
        (jump_to_scene, "scn_tutorial_4"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_286", 0,
    "Choose a scene: (Page 23 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_299"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_273"),
      ]
      ),

      ("choose_scene_286",
      [],
      "tutorial_5:_generate",
      [
        (jump_to_scene, "scn_tutorial_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_287",
      [],
      "village_1:_generate",
      [
        (jump_to_scene, "scn_village_1"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_288",
      [],
      "village_10:_generate",
      [
        (jump_to_scene, "scn_village_10"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_289",
      [],
      "village_11:_generate",
      [
        (jump_to_scene, "scn_village_11"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_290",
      [],
      "village_12:_generate",
      [
        (jump_to_scene, "scn_village_12"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_291",
      [],
      "village_13:_generate",
      [
        (jump_to_scene, "scn_village_13"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_292",
      [],
      "village_14:_generate",
      [
        (jump_to_scene, "scn_village_14"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_293",
      [],
      "village_15:_generate",
      [
        (jump_to_scene, "scn_village_15"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_294",
      [],
      "village_16:_generate",
      [
        (jump_to_scene, "scn_village_16"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_295",
      [],
      "village_17:_generate",
      [
        (jump_to_scene, "scn_village_17"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_296",
      [],
      "village_18:_generate",
      [
        (jump_to_scene, "scn_village_18"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_297",
      [],
      "village_19:_generate",
      [
        (jump_to_scene, "scn_village_19"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_298",
      [],
      "village_2:_generate",
      [
        (jump_to_scene, "scn_village_2"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_299", 0,
    "Choose a scene: (Page 24 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("next",
      [],
      "Next...",
      [
        (jump_to_menu, "mnu_choose_scenes_312"),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_286"),
      ]
      ),

      ("choose_scene_299",
      [],
      "village_20:_generate",
      [
        (jump_to_scene, "scn_village_20"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_300",
      [],
      "village_21:_generate",
      [
        (jump_to_scene, "scn_village_21"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_301",
      [],
      "village_22:_generate",
      [
        (jump_to_scene, "scn_village_22"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_302",
      [],
      "village_23:_generate",
      [
        (jump_to_scene, "scn_village_23"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_303",
      [],
      "village_24:_generate",
      [
        (jump_to_scene, "scn_village_24"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_304",
      [],
      "village_25:_generate",
      [
        (jump_to_scene, "scn_village_25"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_305",
      [],
      "village_26:_generate",
      [
        (jump_to_scene, "scn_village_26"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_306",
      [],
      "village_27:_generate",
      [
        (jump_to_scene, "scn_village_27"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_307",
      [],
      "village_3:_generate",
      [
        (jump_to_scene, "scn_village_3"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_308",
      [],
      "village_4:_generate",
      [
        (jump_to_scene, "scn_village_4"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_309",
      [],
      "village_5:_generate",
      [
        (jump_to_scene, "scn_village_5"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_310",
      [],
      "village_6:_generate",
      [
        (jump_to_scene, "scn_village_6"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_311",
      [],
      "village_7:_generate",
      [
        (jump_to_scene, "scn_village_7"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

  ("choose_scenes_312", 0,
    "Choose a scene: (Page 25 of 25)",
    "none",
    [],
    [
      ("back",
      [],
      "Go_back.",
      [
        (change_screen_quit),
      ]
      ),

      ("previous",
      [],
      "Previous...",
      [
        (jump_to_menu, "mnu_choose_scenes_299"),
      ]
      ),

      ("choose_scene_312",
      [],
      "village_8:_generate",
      [
        (jump_to_scene, "scn_village_8"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_313",
      [],
      "village_9:_generate",
      [
        (jump_to_scene, "scn_village_9"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_314",
      [],
      "zendar_arena:_generate",
      [
        (jump_to_scene, "scn_zendar_arena"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_315",
      [],
      "zendar_center:_generate",
      [
        (jump_to_scene, "scn_zendar_center"),
        (change_screen_mission),
      ]
      ),

      ("choose_scene_316",
      [],
      "zendar_merchant:_indoors",
      [
        (jump_to_scene, "scn_zendar_merchant"),
        (change_screen_mission),
      ]
      ),
    ],
  ),

]